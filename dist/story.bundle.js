(()=>{var e,t,n={563:(e,t,n)=>{"use strict";n.r(t),n.d(t,{logger:()=>o});var r=n(965);function o(e){r.logging&&console.log(e)}},618:()=>{Macro.add("expBarMacro",{skipArgs:!1,handler:function(){var e=this.args[0],t=this.args[1],n=this.args[2],r=$("<div/>").addClass("statusBar").css("margin-".concat(t?"left":"right"),"auto"),o=$("<div/>").addClass("expBar statusBar"),i=$("<div/>").addClass("currentStatusText");switch(n){case"muscle":o.css("width","".concat(Math.clamp(Math.floor(e.exp.muscle/e.stats.strg*100),0,100),"%")),i.text("".concat(e.exp.muscle,"/").concat(e.stats.strg));break;case"agility":o.css("width","".concat(Math.clamp(Math.floor(e.exp.agility/e.stats.dex*100),0,100),"%")),i.text("".concat(e.exp.agility,"/").concat(e.stats.dex));break;case"physique":o.css("width","".concat(Math.clamp(Math.floor(e.exp.physique/e.stats.con*100),0,100),"%")),i.text("".concat(e.exp.physique,"/").concat(e.stats.con));break;case"size":o.css("width","".concat(Math.clamp(Math.floor(e.exp.size/e.measurements.height*100),0,100),"%")),i.text("".concat(e.exp.size,"/").concat(e.measurements.height))}this.args[1]&&r.css("float",this.args[1]),r.attr("id","macro-".concat(this.name,"-").concat(e.name,"-")+n).append(i).append(o).appendTo(this.output)}})},345:()=>{Macro.add("healthBarMacro",{skipArgs:!1,handler:function(){var e=this.args[0],t=this.args[1],n=$("<div/>").addClass("statusBar").css("margin-".concat(t?"left":"right"),"auto"),r=$("<div/>").addClass("currentHealthBar").css("width","".concat(Math.clamp(Math.floor(e.stats.hlth/e.stats.maxHlth*100),0,100),"%")),o=$("<div/>").addClass("currentStatusText").text("".concat(e.stats.hlth,"/").concat(e.stats.maxHlth));this.args[1]&&n.css("float",this.args[1]),n.attr("id","macro-".concat(this.name,"-").concat(e.name)).append(o).append(r).appendTo(this.output)}})},552:(e,t,n)=>{n(563).logger;Macro.add("restMessageMacro",{skipArgs:!1,handler:function(){var e,t,n,r=this.args[0],o=variables().player,i=(e=o.capacity,t=0,_.each(e,(function(n,r){r.includes("Max")||(t=e[r]/e[r+"Max"]>t?e[r]/e[r+"Max"]:t)})),t),s=$("<div/>");r?(i>=.9&&(n="You're about to burst, you will attract attention unless you rest!."),i<.9&&(n="You're so full, if you don't rest you might attract too much attention."),i<.5&&(n="You're pretty full, wouldn't be a bad idea to sleep a bit."),i<.25&&(n="You're a little full, maybe take a nap."),0==i&&(n=null)):(i>=.9&&(n="''You're ripe for the picking and could be attacked at any moment! Get home and rest asap!''"),i<.9&&(n="You're so full, eyes are starting to fall on you. Propably should go home and rest."),i<.5&&(n="You're pretty full, resting at home might be a good idea soon."),i<.25&&(n="You're a little full, maybe take a nap when you get back home."),0==i&&(n=null)),n&&s.wiki(n).prepend($("<br/>")).appendTo(this.output)}})},949:()=>{Macro.add("enemyDescriptionMacro",{skipArgs:!1,handler:function(){variables().enemy;$(this.output).wiki("A ?eHeight tall ?eSpecies weighing in at ?eWeight.<br/>They have ?eMuscle muscles and ?eFatSingular ?eFat amount of fat")}})},928:()=>{function e(e){var t=e.stats;return t.strg+t.dex+t.con}Macro.add("enemyDifficultyMacro",{skipArgs:!1,handler:function(){var t=variables(),n=t.player,r=e(t.enemy)-e(n),o="Appears that this will be a fair fight";r<-10&&(o="Might not even be worth your time"),r<-3&&(o="Looks like this will be an easier fight than normal"),r>3&&(o="Might have some trouble with this fight"),r>10&&(o="It's your funeral, I just work here"),$(this.output).wiki(o)}})},915:()=>{Macro.add("statusDisplayMacro",{skipArgs:!1,handler:function(){var e=this,t=this.args[0].statusEffect;_.each(t,(function(t){var n=t.name;t.duration,t.mod,t.dmg;$(e.output).wiki("".concat(n,"<br/>"))}))}})},191:()=>{Macro.add("bugMacro",{skipArgs:!1,handler:function(){var e=State.variables.player,t=$("<span/>"),n=$("<span/>").attr("id","playerData").text("".concat(JSON.stringify(e))),r=$("<br/>"),o=$("<Button/>").text("Copy to Clipboard");o.ariaClick((function(t){navigator.clipboard.writeText("".concat(JSON.stringify(e))),alert("Contents Copied")})),t.append(o).append(r).append(n).appendTo(this.output)}})},805:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw s}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Macro.add("progressiveText",{skipArgs:!1,tags:["nextText"],handler:function(){function n(n){var r,o=n.args,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",s=!1,a="Continue",l=0,c=t(o);try{for(c.s();!(r=c.n()).done;){var u=r.value;switch(e(u)){case"string":a=u;break;case"boolean":s=u;break;default:l=1e3*u}}}catch(e){c.e(e)}finally{c.f()}return s?$("<div/>").css({display:i}).wiki("<br/>").append($("<button/>").wiki(a).click((function(){$(this).parent().nextAll().slice(0,2).css({display:"block"}).hide().fadeIn(l),$(this).parent().remove()}))):$("<a/>").wiki("<br/>"+a).css({display:i,"transition-duration":"0s"}).click((function(){$(this).nextAll().slice(0,2).css({display:"block"}).hide().fadeIn(l),$(this).remove()}))}for(var r in this.payload){var o=this.payload[r];if("progressiveText"===o.name)$(this.output).append($("<div/>").wiki(o.contents)).append(n(this.payload[++r],"block"));else $(this.output).append($("<div/>").css({display:"none"}).hide().wiki(o.contents)),this.payload.length!==++r&&$(this.output).append(n(this.payload[r]))}}})},954:()=>{Macro.add("MagWingMacro",{skipArgs:!1,handler:function(){}})},543:function(e,t,n){var r;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */e=n.nmd(e),function(){var o,i="Expected a function",s="__lodash_hash_undefined__",a="__lodash_placeholder__",l=16,c=32,u=64,d=128,p=256,h=1/0,f=9007199254740991,m=NaN,g=4294967295,y=[["ary",d],["bind",1],["bindKey",2],["curry",8],["curryRight",l],["flip",512],["partial",c],["partialRight",u],["rearg",p]],v="[object Arguments]",b="[object Array]",w="[object Boolean]",k="[object Date]",x="[object Error]",M="[object Function]",S="[object GeneratorFunction]",C="[object Map]",O="[object Number]",A="[object Object]",T="[object Promise]",_="[object RegExp]",N="[object Set]",$="[object String]",E="[object Symbol]",D="[object WeakMap]",I="[object ArrayBuffer]",L="[object DataView]",P="[object Float32Array]",z="[object Float64Array]",j="[object Int8Array]",B="[object Int16Array]",V="[object Int32Array]",R="[object Uint8Array]",H="[object Uint8ClampedArray]",F="[object Uint16Array]",q="[object Uint32Array]",W=/\b__p \+= '';/g,J=/\b(__p \+=) '' \+/g,K=/(__e\(.*?\)|\b__t\)) \+\n'';/g,U=/&(?:amp|lt|gt|quot|#39);/g,G=/[&<>"']/g,Y=RegExp(U.source),Z=RegExp(G.source),X=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,ee=/<%=([\s\S]+?)%>/g,te=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ne=/^\w*$/,re=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oe=/[\\^$.*+?()[\]{}|]/g,ie=RegExp(oe.source),se=/^\s+/,ae=/\s/,le=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ce=/\{\n\/\* \[wrapped with (.+)\] \*/,ue=/,? & /,de=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pe=/[()=,{}\[\]\/\s]/,he=/\\(\\)?/g,fe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,me=/\w*$/,ge=/^[-+]0x[0-9a-f]+$/i,ye=/^0b[01]+$/i,ve=/^\[object .+?Constructor\]$/,be=/^0o[0-7]+$/i,we=/^(?:0|[1-9]\d*)$/,ke=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xe=/($^)/,Me=/['\n\r\u2028\u2029\\]/g,Se="\\ud800-\\udfff",Ce="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Oe="\\u2700-\\u27bf",Ae="a-z\\xdf-\\xf6\\xf8-\\xff",Te="A-Z\\xc0-\\xd6\\xd8-\\xde",_e="\\ufe0e\\ufe0f",Ne="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",$e="['’]",Ee="["+Se+"]",De="["+Ne+"]",Ie="["+Ce+"]",Le="\\d+",Pe="["+Oe+"]",ze="["+Ae+"]",je="[^"+Se+Ne+Le+Oe+Ae+Te+"]",Be="\\ud83c[\\udffb-\\udfff]",Ve="[^"+Se+"]",Re="(?:\\ud83c[\\udde6-\\uddff]){2}",He="[\\ud800-\\udbff][\\udc00-\\udfff]",Fe="["+Te+"]",qe="\\u200d",We="(?:"+ze+"|"+je+")",Je="(?:"+Fe+"|"+je+")",Ke="(?:['’](?:d|ll|m|re|s|t|ve))?",Ue="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ge="(?:"+Ie+"|"+Be+")"+"?",Ye="["+_e+"]?",Ze=Ye+Ge+("(?:"+qe+"(?:"+[Ve,Re,He].join("|")+")"+Ye+Ge+")*"),Xe="(?:"+[Pe,Re,He].join("|")+")"+Ze,Qe="(?:"+[Ve+Ie+"?",Ie,Re,He,Ee].join("|")+")",et=RegExp($e,"g"),tt=RegExp(Ie,"g"),nt=RegExp(Be+"(?="+Be+")|"+Qe+Ze,"g"),rt=RegExp([Fe+"?"+ze+"+"+Ke+"(?="+[De,Fe,"$"].join("|")+")",Je+"+"+Ue+"(?="+[De,Fe+We,"$"].join("|")+")",Fe+"?"+We+"+"+Ke,Fe+"+"+Ue,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Le,Xe].join("|"),"g"),ot=RegExp("["+qe+Se+Ce+_e+"]"),it=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,st=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],at=-1,lt={};lt[P]=lt[z]=lt[j]=lt[B]=lt[V]=lt[R]=lt[H]=lt[F]=lt[q]=!0,lt[v]=lt[b]=lt[I]=lt[w]=lt[L]=lt[k]=lt[x]=lt[M]=lt[C]=lt[O]=lt[A]=lt[_]=lt[N]=lt[$]=lt[D]=!1;var ct={};ct[v]=ct[b]=ct[I]=ct[L]=ct[w]=ct[k]=ct[P]=ct[z]=ct[j]=ct[B]=ct[V]=ct[C]=ct[O]=ct[A]=ct[_]=ct[N]=ct[$]=ct[E]=ct[R]=ct[H]=ct[F]=ct[q]=!0,ct[x]=ct[M]=ct[D]=!1;var ut={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},dt=parseFloat,pt=parseInt,ht="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,ft="object"==typeof self&&self&&self.Object===Object&&self,mt=ht||ft||Function("return this")(),gt=t&&!t.nodeType&&t,yt=gt&&e&&!e.nodeType&&e,vt=yt&&yt.exports===gt,bt=vt&&ht.process,wt=function(){try{var e=yt&&yt.require&&yt.require("util").types;return e||bt&&bt.binding&&bt.binding("util")}catch(e){}}(),kt=wt&&wt.isArrayBuffer,xt=wt&&wt.isDate,Mt=wt&&wt.isMap,St=wt&&wt.isRegExp,Ct=wt&&wt.isSet,Ot=wt&&wt.isTypedArray;function At(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Tt(e,t,n,r){for(var o=-1,i=null==e?0:e.length;++o<i;){var s=e[o];t(r,s,n(s),e)}return r}function _t(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function Nt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function $t(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function Et(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var s=e[n];t(s,n,e)&&(i[o++]=s)}return i}function Dt(e,t){return!!(null==e?0:e.length)&&Ft(e,t,0)>-1}function It(e,t,n){for(var r=-1,o=null==e?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1}function Lt(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}function Pt(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}function zt(e,t,n,r){var o=-1,i=null==e?0:e.length;for(r&&i&&(n=e[++o]);++o<i;)n=t(n,e[o],o,e);return n}function jt(e,t,n,r){var o=null==e?0:e.length;for(r&&o&&(n=e[--o]);o--;)n=t(n,e[o],o,e);return n}function Bt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var Vt=Kt("length");function Rt(e,t,n){var r;return n(e,(function(e,n,o){if(t(e,n,o))return r=n,!1})),r}function Ht(e,t,n,r){for(var o=e.length,i=n+(r?1:-1);r?i--:++i<o;)if(t(e[i],i,e))return i;return-1}function Ft(e,t,n){return t==t?function(e,t,n){var r=n-1,o=e.length;for(;++r<o;)if(e[r]===t)return r;return-1}(e,t,n):Ht(e,Wt,n)}function qt(e,t,n,r){for(var o=n-1,i=e.length;++o<i;)if(r(e[o],t))return o;return-1}function Wt(e){return e!=e}function Jt(e,t){var n=null==e?0:e.length;return n?Yt(e,t)/n:m}function Kt(e){return function(t){return null==t?o:t[e]}}function Ut(e){return function(t){return null==e?o:e[t]}}function Gt(e,t,n,r,o){return o(e,(function(e,o,i){n=r?(r=!1,e):t(n,e,o,i)})),n}function Yt(e,t){for(var n,r=-1,i=e.length;++r<i;){var s=t(e[r]);s!==o&&(n=n===o?s:n+s)}return n}function Zt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Xt(e){return e?e.slice(0,gn(e)+1).replace(se,""):e}function Qt(e){return function(t){return e(t)}}function en(e,t){return Lt(t,(function(t){return e[t]}))}function tn(e,t){return e.has(t)}function nn(e,t){for(var n=-1,r=e.length;++n<r&&Ft(t,e[n],0)>-1;);return n}function rn(e,t){for(var n=e.length;n--&&Ft(t,e[n],0)>-1;);return n}var on=Ut({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),sn=Ut({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(e){return"\\"+ut[e]}function ln(e){return ot.test(e)}function cn(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function un(e,t){return function(n){return e(t(n))}}function dn(e,t){for(var n=-1,r=e.length,o=0,i=[];++n<r;){var s=e[n];s!==t&&s!==a||(e[n]=a,i[o++]=n)}return i}function pn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function hn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function fn(e){return ln(e)?function(e){var t=nt.lastIndex=0;for(;nt.test(e);)++t;return t}(e):Vt(e)}function mn(e){return ln(e)?function(e){return e.match(nt)||[]}(e):function(e){return e.split("")}(e)}function gn(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var yn=Ut({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var vn=function e(t){var n,r=(t=null==t?mt:vn.defaults(mt.Object(),t,vn.pick(mt,st))).Array,ae=t.Date,Se=t.Error,Ce=t.Function,Oe=t.Math,Ae=t.Object,Te=t.RegExp,_e=t.String,Ne=t.TypeError,$e=r.prototype,Ee=Ce.prototype,De=Ae.prototype,Ie=t["__core-js_shared__"],Le=Ee.toString,Pe=De.hasOwnProperty,ze=0,je=(n=/[^.]+$/.exec(Ie&&Ie.keys&&Ie.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Be=De.toString,Ve=Le.call(Ae),Re=mt._,He=Te("^"+Le.call(Pe).replace(oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fe=vt?t.Buffer:o,qe=t.Symbol,We=t.Uint8Array,Je=Fe?Fe.allocUnsafe:o,Ke=un(Ae.getPrototypeOf,Ae),Ue=Ae.create,Ge=De.propertyIsEnumerable,Ye=$e.splice,Ze=qe?qe.isConcatSpreadable:o,Xe=qe?qe.iterator:o,Qe=qe?qe.toStringTag:o,nt=function(){try{var e=hi(Ae,"defineProperty");return e({},"",{}),e}catch(e){}}(),ot=t.clearTimeout!==mt.clearTimeout&&t.clearTimeout,ut=ae&&ae.now!==mt.Date.now&&ae.now,ht=t.setTimeout!==mt.setTimeout&&t.setTimeout,ft=Oe.ceil,gt=Oe.floor,yt=Ae.getOwnPropertySymbols,bt=Fe?Fe.isBuffer:o,wt=t.isFinite,Vt=$e.join,Ut=un(Ae.keys,Ae),bn=Oe.max,wn=Oe.min,kn=ae.now,xn=t.parseInt,Mn=Oe.random,Sn=$e.reverse,Cn=hi(t,"DataView"),On=hi(t,"Map"),An=hi(t,"Promise"),Tn=hi(t,"Set"),_n=hi(t,"WeakMap"),Nn=hi(Ae,"create"),$n=_n&&new _n,En={},Dn=Bi(Cn),In=Bi(On),Ln=Bi(An),Pn=Bi(Tn),zn=Bi(_n),jn=qe?qe.prototype:o,Bn=jn?jn.valueOf:o,Vn=jn?jn.toString:o;function Rn(e){if(na(e)&&!Ws(e)&&!(e instanceof Wn)){if(e instanceof qn)return e;if(Pe.call(e,"__wrapped__"))return Vi(e)}return new qn(e)}var Hn=function(){function e(){}return function(t){if(!ta(t))return{};if(Ue)return Ue(t);e.prototype=t;var n=new e;return e.prototype=o,n}}();function Fn(){}function qn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=o}function Wn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=g,this.__views__=[]}function Jn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Kn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Un(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Gn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Un;++t<n;)this.add(e[t])}function Yn(e){var t=this.__data__=new Kn(e);this.size=t.size}function Zn(e,t){var n=Ws(e),r=!n&&qs(e),o=!n&&!r&&Gs(e),i=!n&&!r&&!o&&ua(e),s=n||r||o||i,a=s?Zt(e.length,_e):[],l=a.length;for(var c in e)!t&&!Pe.call(e,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||wi(c,l))||a.push(c);return a}function Xn(e){var t=e.length;return t?e[Gr(0,t-1)]:o}function Qn(e,t){return Pi($o(e),lr(t,0,e.length))}function er(e){return Pi($o(e))}function tr(e,t,n){(n!==o&&!Rs(e[t],n)||n===o&&!(t in e))&&sr(e,t,n)}function nr(e,t,n){var r=e[t];Pe.call(e,t)&&Rs(r,n)&&(n!==o||t in e)||sr(e,t,n)}function rr(e,t){for(var n=e.length;n--;)if(Rs(e[n][0],t))return n;return-1}function or(e,t,n,r){return hr(e,(function(e,o,i){t(r,e,n(e),i)})),r}function ir(e,t){return e&&Eo(t,Ea(t),e)}function sr(e,t,n){"__proto__"==t&&nt?nt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ar(e,t){for(var n=-1,i=t.length,s=r(i),a=null==e;++n<i;)s[n]=a?o:Aa(e,t[n]);return s}function lr(e,t,n){return e==e&&(n!==o&&(e=e<=n?e:n),t!==o&&(e=e>=t?e:t)),e}function cr(e,t,n,r,i,s){var a,l=1&t,c=2&t,u=4&t;if(n&&(a=i?n(e,r,i,s):n(e)),a!==o)return a;if(!ta(e))return e;var d=Ws(e);if(d){if(a=function(e){var t=e.length,n=new e.constructor(t);t&&"string"==typeof e[0]&&Pe.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!l)return $o(e,a)}else{var p=gi(e),h=p==M||p==S;if(Gs(e))return Co(e,l);if(p==A||p==v||h&&!i){if(a=c||h?{}:vi(e),!l)return c?function(e,t){return Eo(e,mi(e),t)}(e,function(e,t){return e&&Eo(t,Da(t),e)}(a,e)):function(e,t){return Eo(e,fi(e),t)}(e,ir(a,e))}else{if(!ct[p])return i?e:{};a=function(e,t,n){var r=e.constructor;switch(t){case I:return Oo(e);case w:case k:return new r(+e);case L:return function(e,t){var n=t?Oo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case P:case z:case j:case B:case V:case R:case H:case F:case q:return Ao(e,n);case C:return new r;case O:case $:return new r(e);case _:return function(e){var t=new e.constructor(e.source,me.exec(e));return t.lastIndex=e.lastIndex,t}(e);case N:return new r;case E:return o=e,Bn?Ae(Bn.call(o)):{}}var o}(e,p,l)}}s||(s=new Yn);var f=s.get(e);if(f)return f;s.set(e,a),aa(e)?e.forEach((function(r){a.add(cr(r,t,n,r,e,s))})):ra(e)&&e.forEach((function(r,o){a.set(o,cr(r,t,n,o,e,s))}));var m=d?o:(u?c?si:ii:c?Da:Ea)(e);return _t(m||e,(function(r,o){m&&(r=e[o=r]),nr(a,o,cr(r,t,n,o,e,s))})),a}function ur(e,t,n){var r=n.length;if(null==e)return!r;for(e=Ae(e);r--;){var i=n[r],s=t[i],a=e[i];if(a===o&&!(i in e)||!s(a))return!1}return!0}function dr(e,t,n){if("function"!=typeof e)throw new Ne(i);return Ei((function(){e.apply(o,n)}),t)}function pr(e,t,n,r){var o=-1,i=Dt,s=!0,a=e.length,l=[],c=t.length;if(!a)return l;n&&(t=Lt(t,Qt(n))),r?(i=It,s=!1):t.length>=200&&(i=tn,s=!1,t=new Gn(t));e:for(;++o<a;){var u=e[o],d=null==n?u:n(u);if(u=r||0!==u?u:0,s&&d==d){for(var p=c;p--;)if(t[p]===d)continue e;l.push(u)}else i(t,d,r)||l.push(u)}return l}Rn.templateSettings={escape:X,evaluate:Q,interpolate:ee,variable:"",imports:{_:Rn}},Rn.prototype=Fn.prototype,Rn.prototype.constructor=Rn,qn.prototype=Hn(Fn.prototype),qn.prototype.constructor=qn,Wn.prototype=Hn(Fn.prototype),Wn.prototype.constructor=Wn,Jn.prototype.clear=function(){this.__data__=Nn?Nn(null):{},this.size=0},Jn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Jn.prototype.get=function(e){var t=this.__data__;if(Nn){var n=t[e];return n===s?o:n}return Pe.call(t,e)?t[e]:o},Jn.prototype.has=function(e){var t=this.__data__;return Nn?t[e]!==o:Pe.call(t,e)},Jn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Nn&&t===o?s:t,this},Kn.prototype.clear=function(){this.__data__=[],this.size=0},Kn.prototype.delete=function(e){var t=this.__data__,n=rr(t,e);return!(n<0)&&(n==t.length-1?t.pop():Ye.call(t,n,1),--this.size,!0)},Kn.prototype.get=function(e){var t=this.__data__,n=rr(t,e);return n<0?o:t[n][1]},Kn.prototype.has=function(e){return rr(this.__data__,e)>-1},Kn.prototype.set=function(e,t){var n=this.__data__,r=rr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Un.prototype.clear=function(){this.size=0,this.__data__={hash:new Jn,map:new(On||Kn),string:new Jn}},Un.prototype.delete=function(e){var t=di(this,e).delete(e);return this.size-=t?1:0,t},Un.prototype.get=function(e){return di(this,e).get(e)},Un.prototype.has=function(e){return di(this,e).has(e)},Un.prototype.set=function(e,t){var n=di(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Gn.prototype.add=Gn.prototype.push=function(e){return this.__data__.set(e,s),this},Gn.prototype.has=function(e){return this.__data__.has(e)},Yn.prototype.clear=function(){this.__data__=new Kn,this.size=0},Yn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Yn.prototype.get=function(e){return this.__data__.get(e)},Yn.prototype.has=function(e){return this.__data__.has(e)},Yn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Kn){var r=n.__data__;if(!On||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Un(r)}return n.set(e,t),this.size=n.size,this};var hr=Lo(kr),fr=Lo(xr,!0);function mr(e,t){var n=!0;return hr(e,(function(e,r,o){return n=!!t(e,r,o)})),n}function gr(e,t,n){for(var r=-1,i=e.length;++r<i;){var s=e[r],a=t(s);if(null!=a&&(l===o?a==a&&!ca(a):n(a,l)))var l=a,c=s}return c}function yr(e,t){var n=[];return hr(e,(function(e,r,o){t(e,r,o)&&n.push(e)})),n}function vr(e,t,n,r,o){var i=-1,s=e.length;for(n||(n=bi),o||(o=[]);++i<s;){var a=e[i];t>0&&n(a)?t>1?vr(a,t-1,n,r,o):Pt(o,a):r||(o[o.length]=a)}return o}var br=Po(),wr=Po(!0);function kr(e,t){return e&&br(e,t,Ea)}function xr(e,t){return e&&wr(e,t,Ea)}function Mr(e,t){return Et(t,(function(t){return Xs(e[t])}))}function Sr(e,t){for(var n=0,r=(t=ko(t,e)).length;null!=e&&n<r;)e=e[ji(t[n++])];return n&&n==r?e:o}function Cr(e,t,n){var r=t(e);return Ws(e)?r:Pt(r,n(e))}function Or(e){return null==e?e===o?"[object Undefined]":"[object Null]":Qe&&Qe in Ae(e)?function(e){var t=Pe.call(e,Qe),n=e[Qe];try{e[Qe]=o;var r=!0}catch(e){}var i=Be.call(e);r&&(t?e[Qe]=n:delete e[Qe]);return i}(e):function(e){return Be.call(e)}(e)}function Ar(e,t){return e>t}function Tr(e,t){return null!=e&&Pe.call(e,t)}function _r(e,t){return null!=e&&t in Ae(e)}function Nr(e,t,n){for(var i=n?It:Dt,s=e[0].length,a=e.length,l=a,c=r(a),u=1/0,d=[];l--;){var p=e[l];l&&t&&(p=Lt(p,Qt(t))),u=wn(p.length,u),c[l]=!n&&(t||s>=120&&p.length>=120)?new Gn(l&&p):o}p=e[0];var h=-1,f=c[0];e:for(;++h<s&&d.length<u;){var m=p[h],g=t?t(m):m;if(m=n||0!==m?m:0,!(f?tn(f,g):i(d,g,n))){for(l=a;--l;){var y=c[l];if(!(y?tn(y,g):i(e[l],g,n)))continue e}f&&f.push(g),d.push(m)}}return d}function $r(e,t,n){var r=null==(e=_i(e,t=ko(t,e)))?e:e[ji(Zi(t))];return null==r?o:At(r,e,n)}function Er(e){return na(e)&&Or(e)==v}function Dr(e,t,n,r,i){return e===t||(null==e||null==t||!na(e)&&!na(t)?e!=e&&t!=t:function(e,t,n,r,i,s){var a=Ws(e),l=Ws(t),c=a?b:gi(e),u=l?b:gi(t),d=(c=c==v?A:c)==A,p=(u=u==v?A:u)==A,h=c==u;if(h&&Gs(e)){if(!Gs(t))return!1;a=!0,d=!1}if(h&&!d)return s||(s=new Yn),a||ua(e)?ri(e,t,n,r,i,s):function(e,t,n,r,o,i,s){switch(n){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case I:return!(e.byteLength!=t.byteLength||!i(new We(e),new We(t)));case w:case k:case O:return Rs(+e,+t);case x:return e.name==t.name&&e.message==t.message;case _:case $:return e==t+"";case C:var a=cn;case N:var l=1&r;if(a||(a=pn),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;r|=2,s.set(e,t);var u=ri(a(e),a(t),r,o,i,s);return s.delete(e),u;case E:if(Bn)return Bn.call(e)==Bn.call(t)}return!1}(e,t,c,n,r,i,s);if(!(1&n)){var f=d&&Pe.call(e,"__wrapped__"),m=p&&Pe.call(t,"__wrapped__");if(f||m){var g=f?e.value():e,y=m?t.value():t;return s||(s=new Yn),i(g,y,n,r,s)}}if(!h)return!1;return s||(s=new Yn),function(e,t,n,r,i,s){var a=1&n,l=ii(e),c=l.length,u=ii(t),d=u.length;if(c!=d&&!a)return!1;var p=c;for(;p--;){var h=l[p];if(!(a?h in t:Pe.call(t,h)))return!1}var f=s.get(e),m=s.get(t);if(f&&m)return f==t&&m==e;var g=!0;s.set(e,t),s.set(t,e);var y=a;for(;++p<c;){var v=e[h=l[p]],b=t[h];if(r)var w=a?r(b,v,h,t,e,s):r(v,b,h,e,t,s);if(!(w===o?v===b||i(v,b,n,r,s):w)){g=!1;break}y||(y="constructor"==h)}if(g&&!y){var k=e.constructor,x=t.constructor;k==x||!("constructor"in e)||!("constructor"in t)||"function"==typeof k&&k instanceof k&&"function"==typeof x&&x instanceof x||(g=!1)}return s.delete(e),s.delete(t),g}(e,t,n,r,i,s)}(e,t,n,r,Dr,i))}function Ir(e,t,n,r){var i=n.length,s=i,a=!r;if(null==e)return!s;for(e=Ae(e);i--;){var l=n[i];if(a&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++i<s;){var c=(l=n[i])[0],u=e[c],d=l[1];if(a&&l[2]){if(u===o&&!(c in e))return!1}else{var p=new Yn;if(r)var h=r(u,d,c,e,t,p);if(!(h===o?Dr(d,u,3,r,p):h))return!1}}return!0}function Lr(e){return!(!ta(e)||(t=e,je&&je in t))&&(Xs(e)?He:ve).test(Bi(e));var t}function Pr(e){return"function"==typeof e?e:null==e?ol:"object"==typeof e?Ws(e)?Hr(e[0],e[1]):Rr(e):hl(e)}function zr(e){if(!Ci(e))return Ut(e);var t=[];for(var n in Ae(e))Pe.call(e,n)&&"constructor"!=n&&t.push(n);return t}function jr(e){if(!ta(e))return function(e){var t=[];if(null!=e)for(var n in Ae(e))t.push(n);return t}(e);var t=Ci(e),n=[];for(var r in e)("constructor"!=r||!t&&Pe.call(e,r))&&n.push(r);return n}function Br(e,t){return e<t}function Vr(e,t){var n=-1,o=Ks(e)?r(e.length):[];return hr(e,(function(e,r,i){o[++n]=t(e,r,i)})),o}function Rr(e){var t=pi(e);return 1==t.length&&t[0][2]?Ai(t[0][0],t[0][1]):function(n){return n===e||Ir(n,e,t)}}function Hr(e,t){return xi(e)&&Oi(t)?Ai(ji(e),t):function(n){var r=Aa(n,e);return r===o&&r===t?Ta(n,e):Dr(t,r,3)}}function Fr(e,t,n,r,i){e!==t&&br(t,(function(s,a){if(i||(i=new Yn),ta(s))!function(e,t,n,r,i,s,a){var l=Ni(e,n),c=Ni(t,n),u=a.get(c);if(u)return void tr(e,n,u);var d=s?s(l,c,n+"",e,t,a):o,p=d===o;if(p){var h=Ws(c),f=!h&&Gs(c),m=!h&&!f&&ua(c);d=c,h||f||m?Ws(l)?d=l:Us(l)?d=$o(l):f?(p=!1,d=Co(c,!0)):m?(p=!1,d=Ao(c,!0)):d=[]:ia(c)||qs(c)?(d=l,qs(l)?d=va(l):ta(l)&&!Xs(l)||(d=vi(c))):p=!1}p&&(a.set(c,d),i(d,c,r,s,a),a.delete(c));tr(e,n,d)}(e,t,a,n,Fr,r,i);else{var l=r?r(Ni(e,a),s,a+"",e,t,i):o;l===o&&(l=s),tr(e,a,l)}}),Da)}function qr(e,t){var n=e.length;if(n)return wi(t+=t<0?n:0,n)?e[t]:o}function Wr(e,t,n){t=t.length?Lt(t,(function(e){return Ws(e)?function(t){return Sr(t,1===e.length?e[0]:e)}:e})):[ol];var r=-1;t=Lt(t,Qt(ui()));var o=Vr(e,(function(e,n,o){var i=Lt(t,(function(t){return t(e)}));return{criteria:i,index:++r,value:e}}));return function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(o,(function(e,t){return function(e,t,n){var r=-1,o=e.criteria,i=t.criteria,s=o.length,a=n.length;for(;++r<s;){var l=To(o[r],i[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))}function Jr(e,t,n){for(var r=-1,o=t.length,i={};++r<o;){var s=t[r],a=Sr(e,s);n(a,s)&&eo(i,ko(s,e),a)}return i}function Kr(e,t,n,r){var o=r?qt:Ft,i=-1,s=t.length,a=e;for(e===t&&(t=$o(t)),n&&(a=Lt(e,Qt(n)));++i<s;)for(var l=0,c=t[i],u=n?n(c):c;(l=o(a,u,l,r))>-1;)a!==e&&Ye.call(a,l,1),Ye.call(e,l,1);return e}function Ur(e,t){for(var n=e?t.length:0,r=n-1;n--;){var o=t[n];if(n==r||o!==i){var i=o;wi(o)?Ye.call(e,o,1):ho(e,o)}}return e}function Gr(e,t){return e+gt(Mn()*(t-e+1))}function Yr(e,t){var n="";if(!e||t<1||t>f)return n;do{t%2&&(n+=e),(t=gt(t/2))&&(e+=e)}while(t);return n}function Zr(e,t){return Di(Ti(e,t,ol),e+"")}function Xr(e){return Xn(Ra(e))}function Qr(e,t){var n=Ra(e);return Pi(n,lr(t,0,n.length))}function eo(e,t,n,r){if(!ta(e))return e;for(var i=-1,s=(t=ko(t,e)).length,a=s-1,l=e;null!=l&&++i<s;){var c=ji(t[i]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=a){var d=l[c];(u=r?r(d,c,l):o)===o&&(u=ta(d)?d:wi(t[i+1])?[]:{})}nr(l,c,u),l=l[c]}return e}var to=$n?function(e,t){return $n.set(e,t),e}:ol,no=nt?function(e,t){return nt(e,"toString",{configurable:!0,enumerable:!1,value:tl(t),writable:!0})}:ol;function ro(e){return Pi(Ra(e))}function oo(e,t,n){var o=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=r(i);++o<i;)s[o]=e[o+t];return s}function io(e,t){var n;return hr(e,(function(e,r,o){return!(n=t(e,r,o))})),!!n}function so(e,t,n){var r=0,o=null==e?r:e.length;if("number"==typeof t&&t==t&&o<=2147483647){for(;r<o;){var i=r+o>>>1,s=e[i];null!==s&&!ca(s)&&(n?s<=t:s<t)?r=i+1:o=i}return o}return ao(e,t,ol,n)}function ao(e,t,n,r){var i=0,s=null==e?0:e.length;if(0===s)return 0;for(var a=(t=n(t))!=t,l=null===t,c=ca(t),u=t===o;i<s;){var d=gt((i+s)/2),p=n(e[d]),h=p!==o,f=null===p,m=p==p,g=ca(p);if(a)var y=r||m;else y=u?m&&(r||h):l?m&&h&&(r||!f):c?m&&h&&!f&&(r||!g):!f&&!g&&(r?p<=t:p<t);y?i=d+1:s=d}return wn(s,4294967294)}function lo(e,t){for(var n=-1,r=e.length,o=0,i=[];++n<r;){var s=e[n],a=t?t(s):s;if(!n||!Rs(a,l)){var l=a;i[o++]=0===s?0:s}}return i}function co(e){return"number"==typeof e?e:ca(e)?m:+e}function uo(e){if("string"==typeof e)return e;if(Ws(e))return Lt(e,uo)+"";if(ca(e))return Vn?Vn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function po(e,t,n){var r=-1,o=Dt,i=e.length,s=!0,a=[],l=a;if(n)s=!1,o=It;else if(i>=200){var c=t?null:Zo(e);if(c)return pn(c);s=!1,o=tn,l=new Gn}else l=t?[]:a;e:for(;++r<i;){var u=e[r],d=t?t(u):u;if(u=n||0!==u?u:0,s&&d==d){for(var p=l.length;p--;)if(l[p]===d)continue e;t&&l.push(d),a.push(u)}else o(l,d,n)||(l!==a&&l.push(d),a.push(u))}return a}function ho(e,t){return null==(e=_i(e,t=ko(t,e)))||delete e[ji(Zi(t))]}function fo(e,t,n,r){return eo(e,t,n(Sr(e,t)),r)}function mo(e,t,n,r){for(var o=e.length,i=r?o:-1;(r?i--:++i<o)&&t(e[i],i,e););return n?oo(e,r?0:i,r?i+1:o):oo(e,r?i+1:0,r?o:i)}function go(e,t){var n=e;return n instanceof Wn&&(n=n.value()),zt(t,(function(e,t){return t.func.apply(t.thisArg,Pt([e],t.args))}),n)}function yo(e,t,n){var o=e.length;if(o<2)return o?po(e[0]):[];for(var i=-1,s=r(o);++i<o;)for(var a=e[i],l=-1;++l<o;)l!=i&&(s[i]=pr(s[i]||a,e[l],t,n));return po(vr(s,1),t,n)}function vo(e,t,n){for(var r=-1,i=e.length,s=t.length,a={};++r<i;){var l=r<s?t[r]:o;n(a,e[r],l)}return a}function bo(e){return Us(e)?e:[]}function wo(e){return"function"==typeof e?e:ol}function ko(e,t){return Ws(e)?e:xi(e,t)?[e]:zi(ba(e))}var xo=Zr;function Mo(e,t,n){var r=e.length;return n=n===o?r:n,!t&&n>=r?e:oo(e,t,n)}var So=ot||function(e){return mt.clearTimeout(e)};function Co(e,t){if(t)return e.slice();var n=e.length,r=Je?Je(n):new e.constructor(n);return e.copy(r),r}function Oo(e){var t=new e.constructor(e.byteLength);return new We(t).set(new We(e)),t}function Ao(e,t){var n=t?Oo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function To(e,t){if(e!==t){var n=e!==o,r=null===e,i=e==e,s=ca(e),a=t!==o,l=null===t,c=t==t,u=ca(t);if(!l&&!u&&!s&&e>t||s&&a&&c&&!l&&!u||r&&a&&c||!n&&c||!i)return 1;if(!r&&!s&&!u&&e<t||u&&n&&i&&!r&&!s||l&&n&&i||!a&&i||!c)return-1}return 0}function _o(e,t,n,o){for(var i=-1,s=e.length,a=n.length,l=-1,c=t.length,u=bn(s-a,0),d=r(c+u),p=!o;++l<c;)d[l]=t[l];for(;++i<a;)(p||i<s)&&(d[n[i]]=e[i]);for(;u--;)d[l++]=e[i++];return d}function No(e,t,n,o){for(var i=-1,s=e.length,a=-1,l=n.length,c=-1,u=t.length,d=bn(s-l,0),p=r(d+u),h=!o;++i<d;)p[i]=e[i];for(var f=i;++c<u;)p[f+c]=t[c];for(;++a<l;)(h||i<s)&&(p[f+n[a]]=e[i++]);return p}function $o(e,t){var n=-1,o=e.length;for(t||(t=r(o));++n<o;)t[n]=e[n];return t}function Eo(e,t,n,r){var i=!n;n||(n={});for(var s=-1,a=t.length;++s<a;){var l=t[s],c=r?r(n[l],e[l],l,n,e):o;c===o&&(c=e[l]),i?sr(n,l,c):nr(n,l,c)}return n}function Do(e,t){return function(n,r){var o=Ws(n)?Tt:or,i=t?t():{};return o(n,e,ui(r,2),i)}}function Io(e){return Zr((function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:o,a=i>2?n[2]:o;for(s=e.length>3&&"function"==typeof s?(i--,s):o,a&&ki(n[0],n[1],a)&&(s=i<3?o:s,i=1),t=Ae(t);++r<i;){var l=n[r];l&&e(t,l,r,s)}return t}))}function Lo(e,t){return function(n,r){if(null==n)return n;if(!Ks(n))return e(n,r);for(var o=n.length,i=t?o:-1,s=Ae(n);(t?i--:++i<o)&&!1!==r(s[i],i,s););return n}}function Po(e){return function(t,n,r){for(var o=-1,i=Ae(t),s=r(t),a=s.length;a--;){var l=s[e?a:++o];if(!1===n(i[l],l,i))break}return t}}function zo(e){return function(t){var n=ln(t=ba(t))?mn(t):o,r=n?n[0]:t.charAt(0),i=n?Mo(n,1).join(""):t.slice(1);return r[e]()+i}}function jo(e){return function(t){return zt(Xa(qa(t).replace(et,"")),e,"")}}function Bo(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Hn(e.prototype),r=e.apply(n,t);return ta(r)?r:n}}function Vo(e){return function(t,n,r){var i=Ae(t);if(!Ks(t)){var s=ui(n,3);t=Ea(t),n=function(e){return s(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[s?t[a]:a]:o}}function Ro(e){return oi((function(t){var n=t.length,r=n,s=qn.prototype.thru;for(e&&t.reverse();r--;){var a=t[r];if("function"!=typeof a)throw new Ne(i);if(s&&!l&&"wrapper"==li(a))var l=new qn([],!0)}for(r=l?r:n;++r<n;){var c=li(a=t[r]),u="wrapper"==c?ai(a):o;l=u&&Mi(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[li(u[0])].apply(l,u[3]):1==a.length&&Mi(a)?l[c]():l.thru(a)}return function(){var e=arguments,r=e[0];if(l&&1==e.length&&Ws(r))return l.plant(r).value();for(var o=0,i=n?t[o].apply(this,e):r;++o<n;)i=t[o].call(this,i);return i}}))}function Ho(e,t,n,i,s,a,l,c,u,p){var h=t&d,f=1&t,m=2&t,g=24&t,y=512&t,v=m?o:Bo(e);return function d(){for(var b=arguments.length,w=r(b),k=b;k--;)w[k]=arguments[k];if(g)var x=ci(d),M=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(w,x);if(i&&(w=_o(w,i,s,g)),a&&(w=No(w,a,l,g)),b-=M,g&&b<p){var S=dn(w,x);return Go(e,t,Ho,d.placeholder,n,w,S,c,u,p-b)}var C=f?n:this,O=m?C[e]:e;return b=w.length,c?w=function(e,t){var n=e.length,r=wn(t.length,n),i=$o(e);for(;r--;){var s=t[r];e[r]=wi(s,n)?i[s]:o}return e}(w,c):y&&b>1&&w.reverse(),h&&u<b&&(w.length=u),this&&this!==mt&&this instanceof d&&(O=v||Bo(O)),O.apply(C,w)}}function Fo(e,t){return function(n,r){return function(e,t,n,r){return kr(e,(function(e,o,i){t(r,n(e),o,i)})),r}(n,e,t(r),{})}}function qo(e,t){return function(n,r){var i;if(n===o&&r===o)return t;if(n!==o&&(i=n),r!==o){if(i===o)return r;"string"==typeof n||"string"==typeof r?(n=uo(n),r=uo(r)):(n=co(n),r=co(r)),i=e(n,r)}return i}}function Wo(e){return oi((function(t){return t=Lt(t,Qt(ui())),Zr((function(n){var r=this;return e(t,(function(e){return At(e,r,n)}))}))}))}function Jo(e,t){var n=(t=t===o?" ":uo(t)).length;if(n<2)return n?Yr(t,e):t;var r=Yr(t,ft(e/fn(t)));return ln(t)?Mo(mn(r),0,e).join(""):r.slice(0,e)}function Ko(e){return function(t,n,i){return i&&"number"!=typeof i&&ki(t,n,i)&&(n=i=o),t=fa(t),n===o?(n=t,t=0):n=fa(n),function(e,t,n,o){for(var i=-1,s=bn(ft((t-e)/(n||1)),0),a=r(s);s--;)a[o?s:++i]=e,e+=n;return a}(t,n,i=i===o?t<n?1:-1:fa(i),e)}}function Uo(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=ya(t),n=ya(n)),e(t,n)}}function Go(e,t,n,r,i,s,a,l,d,p){var h=8&t;t|=h?c:u,4&(t&=~(h?u:c))||(t&=-4);var f=[e,t,i,h?s:o,h?a:o,h?o:s,h?o:a,l,d,p],m=n.apply(o,f);return Mi(e)&&$i(m,f),m.placeholder=r,Ii(m,e,t)}function Yo(e){var t=Oe[e];return function(e,n){if(e=ya(e),(n=null==n?0:wn(ma(n),292))&&wt(e)){var r=(ba(e)+"e").split("e");return+((r=(ba(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Zo=Tn&&1/pn(new Tn([,-0]))[1]==h?function(e){return new Tn(e)}:cl;function Xo(e){return function(t){var n=gi(t);return n==C?cn(t):n==N?hn(t):function(e,t){return Lt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Qo(e,t,n,s,h,f,m,g){var y=2&t;if(!y&&"function"!=typeof e)throw new Ne(i);var v=s?s.length:0;if(v||(t&=-97,s=h=o),m=m===o?m:bn(ma(m),0),g=g===o?g:ma(g),v-=h?h.length:0,t&u){var b=s,w=h;s=h=o}var k=y?o:ai(e),x=[e,t,n,s,h,b,w,f,m,g];if(k&&function(e,t){var n=e[1],r=t[1],o=n|r,i=o<131,s=r==d&&8==n||r==d&&n==p&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!i&&!s)return e;1&r&&(e[2]=t[2],o|=1&n?0:4);var l=t[3];if(l){var c=e[3];e[3]=c?_o(c,l,t[4]):l,e[4]=c?dn(e[3],a):t[4]}(l=t[5])&&(c=e[5],e[5]=c?No(c,l,t[6]):l,e[6]=c?dn(e[5],a):t[6]);(l=t[7])&&(e[7]=l);r&d&&(e[8]=null==e[8]?t[8]:wn(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=o}(x,k),e=x[0],t=x[1],n=x[2],s=x[3],h=x[4],!(g=x[9]=x[9]===o?y?0:e.length:bn(x[9]-v,0))&&24&t&&(t&=-25),t&&1!=t)M=8==t||t==l?function(e,t,n){var i=Bo(e);return function s(){for(var a=arguments.length,l=r(a),c=a,u=ci(s);c--;)l[c]=arguments[c];var d=a<3&&l[0]!==u&&l[a-1]!==u?[]:dn(l,u);return(a-=d.length)<n?Go(e,t,Ho,s.placeholder,o,l,d,o,o,n-a):At(this&&this!==mt&&this instanceof s?i:e,this,l)}}(e,t,g):t!=c&&33!=t||h.length?Ho.apply(o,x):function(e,t,n,o){var i=1&t,s=Bo(e);return function t(){for(var a=-1,l=arguments.length,c=-1,u=o.length,d=r(u+l),p=this&&this!==mt&&this instanceof t?s:e;++c<u;)d[c]=o[c];for(;l--;)d[c++]=arguments[++a];return At(p,i?n:this,d)}}(e,t,n,s);else var M=function(e,t,n){var r=1&t,o=Bo(e);return function t(){return(this&&this!==mt&&this instanceof t?o:e).apply(r?n:this,arguments)}}(e,t,n);return Ii((k?to:$i)(M,x),e,t)}function ei(e,t,n,r){return e===o||Rs(e,De[n])&&!Pe.call(r,n)?t:e}function ti(e,t,n,r,i,s){return ta(e)&&ta(t)&&(s.set(t,e),Fr(e,t,o,ti,s),s.delete(t)),e}function ni(e){return ia(e)?o:e}function ri(e,t,n,r,i,s){var a=1&n,l=e.length,c=t.length;if(l!=c&&!(a&&c>l))return!1;var u=s.get(e),d=s.get(t);if(u&&d)return u==t&&d==e;var p=-1,h=!0,f=2&n?new Gn:o;for(s.set(e,t),s.set(t,e);++p<l;){var m=e[p],g=t[p];if(r)var y=a?r(g,m,p,t,e,s):r(m,g,p,e,t,s);if(y!==o){if(y)continue;h=!1;break}if(f){if(!Bt(t,(function(e,t){if(!tn(f,t)&&(m===e||i(m,e,n,r,s)))return f.push(t)}))){h=!1;break}}else if(m!==g&&!i(m,g,n,r,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function oi(e){return Di(Ti(e,o,Ji),e+"")}function ii(e){return Cr(e,Ea,fi)}function si(e){return Cr(e,Da,mi)}var ai=$n?function(e){return $n.get(e)}:cl;function li(e){for(var t=e.name+"",n=En[t],r=Pe.call(En,t)?n.length:0;r--;){var o=n[r],i=o.func;if(null==i||i==e)return o.name}return t}function ci(e){return(Pe.call(Rn,"placeholder")?Rn:e).placeholder}function ui(){var e=Rn.iteratee||il;return e=e===il?Pr:e,arguments.length?e(arguments[0],arguments[1]):e}function di(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function pi(e){for(var t=Ea(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,Oi(o)]}return t}function hi(e,t){var n=function(e,t){return null==e?o:e[t]}(e,t);return Lr(n)?n:o}var fi=yt?function(e){return null==e?[]:(e=Ae(e),Et(yt(e),(function(t){return Ge.call(e,t)})))}:gl,mi=yt?function(e){for(var t=[];e;)Pt(t,fi(e)),e=Ke(e);return t}:gl,gi=Or;function yi(e,t,n){for(var r=-1,o=(t=ko(t,e)).length,i=!1;++r<o;){var s=ji(t[r]);if(!(i=null!=e&&n(e,s)))break;e=e[s]}return i||++r!=o?i:!!(o=null==e?0:e.length)&&ea(o)&&wi(s,o)&&(Ws(e)||qs(e))}function vi(e){return"function"!=typeof e.constructor||Ci(e)?{}:Hn(Ke(e))}function bi(e){return Ws(e)||qs(e)||!!(Ze&&e&&e[Ze])}function wi(e,t){var n=typeof e;return!!(t=null==t?f:t)&&("number"==n||"symbol"!=n&&we.test(e))&&e>-1&&e%1==0&&e<t}function ki(e,t,n){if(!ta(n))return!1;var r=typeof t;return!!("number"==r?Ks(n)&&wi(t,n.length):"string"==r&&t in n)&&Rs(n[t],e)}function xi(e,t){if(Ws(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ca(e))||(ne.test(e)||!te.test(e)||null!=t&&e in Ae(t))}function Mi(e){var t=li(e),n=Rn[t];if("function"!=typeof n||!(t in Wn.prototype))return!1;if(e===n)return!0;var r=ai(n);return!!r&&e===r[0]}(Cn&&gi(new Cn(new ArrayBuffer(1)))!=L||On&&gi(new On)!=C||An&&gi(An.resolve())!=T||Tn&&gi(new Tn)!=N||_n&&gi(new _n)!=D)&&(gi=function(e){var t=Or(e),n=t==A?e.constructor:o,r=n?Bi(n):"";if(r)switch(r){case Dn:return L;case In:return C;case Ln:return T;case Pn:return N;case zn:return D}return t});var Si=Ie?Xs:yl;function Ci(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||De)}function Oi(e){return e==e&&!ta(e)}function Ai(e,t){return function(n){return null!=n&&(n[e]===t&&(t!==o||e in Ae(n)))}}function Ti(e,t,n){return t=bn(t===o?e.length-1:t,0),function(){for(var o=arguments,i=-1,s=bn(o.length-t,0),a=r(s);++i<s;)a[i]=o[t+i];i=-1;for(var l=r(t+1);++i<t;)l[i]=o[i];return l[t]=n(a),At(e,this,l)}}function _i(e,t){return t.length<2?e:Sr(e,oo(t,0,-1))}function Ni(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var $i=Li(to),Ei=ht||function(e,t){return mt.setTimeout(e,t)},Di=Li(no);function Ii(e,t,n){var r=t+"";return Di(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(le,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return _t(y,(function(n){var r="_."+n[0];t&n[1]&&!Dt(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(ce);return t?t[1].split(ue):[]}(r),n)))}function Li(e){var t=0,n=0;return function(){var r=kn(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(o,arguments)}}function Pi(e,t){var n=-1,r=e.length,i=r-1;for(t=t===o?r:t;++n<t;){var s=Gr(n,i),a=e[s];e[s]=e[n],e[n]=a}return e.length=t,e}var zi=function(e){var t=Ls(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(re,(function(e,n,r,o){t.push(r?o.replace(he,"$1"):n||e)})),t}));function ji(e){if("string"==typeof e||ca(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Bi(e){if(null!=e){try{return Le.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Vi(e){if(e instanceof Wn)return e.clone();var t=new qn(e.__wrapped__,e.__chain__);return t.__actions__=$o(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ri=Zr((function(e,t){return Us(e)?pr(e,vr(t,1,Us,!0)):[]})),Hi=Zr((function(e,t){var n=Zi(t);return Us(n)&&(n=o),Us(e)?pr(e,vr(t,1,Us,!0),ui(n,2)):[]})),Fi=Zr((function(e,t){var n=Zi(t);return Us(n)&&(n=o),Us(e)?pr(e,vr(t,1,Us,!0),o,n):[]}));function qi(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=null==n?0:ma(n);return o<0&&(o=bn(r+o,0)),Ht(e,ui(t,3),o)}function Wi(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return n!==o&&(i=ma(n),i=n<0?bn(r+i,0):wn(i,r-1)),Ht(e,ui(t,3),i,!0)}function Ji(e){return(null==e?0:e.length)?vr(e,1):[]}function Ki(e){return e&&e.length?e[0]:o}var Ui=Zr((function(e){var t=Lt(e,bo);return t.length&&t[0]===e[0]?Nr(t):[]})),Gi=Zr((function(e){var t=Zi(e),n=Lt(e,bo);return t===Zi(n)?t=o:n.pop(),n.length&&n[0]===e[0]?Nr(n,ui(t,2)):[]})),Yi=Zr((function(e){var t=Zi(e),n=Lt(e,bo);return(t="function"==typeof t?t:o)&&n.pop(),n.length&&n[0]===e[0]?Nr(n,o,t):[]}));function Zi(e){var t=null==e?0:e.length;return t?e[t-1]:o}var Xi=Zr(Qi);function Qi(e,t){return e&&e.length&&t&&t.length?Kr(e,t):e}var es=oi((function(e,t){var n=null==e?0:e.length,r=ar(e,t);return Ur(e,Lt(t,(function(e){return wi(e,n)?+e:e})).sort(To)),r}));function ts(e){return null==e?e:Sn.call(e)}var ns=Zr((function(e){return po(vr(e,1,Us,!0))})),rs=Zr((function(e){var t=Zi(e);return Us(t)&&(t=o),po(vr(e,1,Us,!0),ui(t,2))})),os=Zr((function(e){var t=Zi(e);return t="function"==typeof t?t:o,po(vr(e,1,Us,!0),o,t)}));function is(e){if(!e||!e.length)return[];var t=0;return e=Et(e,(function(e){if(Us(e))return t=bn(e.length,t),!0})),Zt(t,(function(t){return Lt(e,Kt(t))}))}function ss(e,t){if(!e||!e.length)return[];var n=is(e);return null==t?n:Lt(n,(function(e){return At(t,o,e)}))}var as=Zr((function(e,t){return Us(e)?pr(e,t):[]})),ls=Zr((function(e){return yo(Et(e,Us))})),cs=Zr((function(e){var t=Zi(e);return Us(t)&&(t=o),yo(Et(e,Us),ui(t,2))})),us=Zr((function(e){var t=Zi(e);return t="function"==typeof t?t:o,yo(Et(e,Us),o,t)})),ds=Zr(is);var ps=Zr((function(e){var t=e.length,n=t>1?e[t-1]:o;return n="function"==typeof n?(e.pop(),n):o,ss(e,n)}));function hs(e){var t=Rn(e);return t.__chain__=!0,t}function fs(e,t){return t(e)}var ms=oi((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,i=function(t){return ar(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Wn&&wi(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:fs,args:[i],thisArg:o}),new qn(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(o),e}))):this.thru(i)}));var gs=Do((function(e,t,n){Pe.call(e,n)?++e[n]:sr(e,n,1)}));var ys=Vo(qi),vs=Vo(Wi);function bs(e,t){return(Ws(e)?_t:hr)(e,ui(t,3))}function ws(e,t){return(Ws(e)?Nt:fr)(e,ui(t,3))}var ks=Do((function(e,t,n){Pe.call(e,n)?e[n].push(t):sr(e,n,[t])}));var xs=Zr((function(e,t,n){var o=-1,i="function"==typeof t,s=Ks(e)?r(e.length):[];return hr(e,(function(e){s[++o]=i?At(t,e,n):$r(e,t,n)})),s})),Ms=Do((function(e,t,n){sr(e,n,t)}));function Ss(e,t){return(Ws(e)?Lt:Vr)(e,ui(t,3))}var Cs=Do((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));var Os=Zr((function(e,t){if(null==e)return[];var n=t.length;return n>1&&ki(e,t[0],t[1])?t=[]:n>2&&ki(t[0],t[1],t[2])&&(t=[t[0]]),Wr(e,vr(t,1),[])})),As=ut||function(){return mt.Date.now()};function Ts(e,t,n){return t=n?o:t,t=e&&null==t?e.length:t,Qo(e,d,o,o,o,o,t)}function _s(e,t){var n;if("function"!=typeof t)throw new Ne(i);return e=ma(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=o),n}}var Ns=Zr((function(e,t,n){var r=1;if(n.length){var o=dn(n,ci(Ns));r|=c}return Qo(e,r,t,n,o)})),$s=Zr((function(e,t,n){var r=3;if(n.length){var o=dn(n,ci($s));r|=c}return Qo(t,r,e,n,o)}));function Es(e,t,n){var r,s,a,l,c,u,d=0,p=!1,h=!1,f=!0;if("function"!=typeof e)throw new Ne(i);function m(t){var n=r,i=s;return r=s=o,d=t,l=e.apply(i,n)}function g(e){var n=e-u;return u===o||n>=t||n<0||h&&e-d>=a}function y(){var e=As();if(g(e))return v(e);c=Ei(y,function(e){var n=t-(e-u);return h?wn(n,a-(e-d)):n}(e))}function v(e){return c=o,f&&r?m(e):(r=s=o,l)}function b(){var e=As(),n=g(e);if(r=arguments,s=this,u=e,n){if(c===o)return function(e){return d=e,c=Ei(y,t),p?m(e):l}(u);if(h)return So(c),c=Ei(y,t),m(u)}return c===o&&(c=Ei(y,t)),l}return t=ya(t)||0,ta(n)&&(p=!!n.leading,a=(h="maxWait"in n)?bn(ya(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),b.cancel=function(){c!==o&&So(c),d=0,r=u=s=c=o},b.flush=function(){return c===o?l:v(As())},b}var Ds=Zr((function(e,t){return dr(e,1,t)})),Is=Zr((function(e,t,n){return dr(e,ya(t)||0,n)}));function Ls(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Ne(i);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=e.apply(this,r);return n.cache=i.set(o,s)||i,s};return n.cache=new(Ls.Cache||Un),n}function Ps(e){if("function"!=typeof e)throw new Ne(i);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ls.Cache=Un;var zs=xo((function(e,t){var n=(t=1==t.length&&Ws(t[0])?Lt(t[0],Qt(ui())):Lt(vr(t,1),Qt(ui()))).length;return Zr((function(r){for(var o=-1,i=wn(r.length,n);++o<i;)r[o]=t[o].call(this,r[o]);return At(e,this,r)}))})),js=Zr((function(e,t){var n=dn(t,ci(js));return Qo(e,c,o,t,n)})),Bs=Zr((function(e,t){var n=dn(t,ci(Bs));return Qo(e,u,o,t,n)})),Vs=oi((function(e,t){return Qo(e,p,o,o,o,t)}));function Rs(e,t){return e===t||e!=e&&t!=t}var Hs=Uo(Ar),Fs=Uo((function(e,t){return e>=t})),qs=Er(function(){return arguments}())?Er:function(e){return na(e)&&Pe.call(e,"callee")&&!Ge.call(e,"callee")},Ws=r.isArray,Js=kt?Qt(kt):function(e){return na(e)&&Or(e)==I};function Ks(e){return null!=e&&ea(e.length)&&!Xs(e)}function Us(e){return na(e)&&Ks(e)}var Gs=bt||yl,Ys=xt?Qt(xt):function(e){return na(e)&&Or(e)==k};function Zs(e){if(!na(e))return!1;var t=Or(e);return t==x||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ia(e)}function Xs(e){if(!ta(e))return!1;var t=Or(e);return t==M||t==S||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Qs(e){return"number"==typeof e&&e==ma(e)}function ea(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=f}function ta(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function na(e){return null!=e&&"object"==typeof e}var ra=Mt?Qt(Mt):function(e){return na(e)&&gi(e)==C};function oa(e){return"number"==typeof e||na(e)&&Or(e)==O}function ia(e){if(!na(e)||Or(e)!=A)return!1;var t=Ke(e);if(null===t)return!0;var n=Pe.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Le.call(n)==Ve}var sa=St?Qt(St):function(e){return na(e)&&Or(e)==_};var aa=Ct?Qt(Ct):function(e){return na(e)&&gi(e)==N};function la(e){return"string"==typeof e||!Ws(e)&&na(e)&&Or(e)==$}function ca(e){return"symbol"==typeof e||na(e)&&Or(e)==E}var ua=Ot?Qt(Ot):function(e){return na(e)&&ea(e.length)&&!!lt[Or(e)]};var da=Uo(Br),pa=Uo((function(e,t){return e<=t}));function ha(e){if(!e)return[];if(Ks(e))return la(e)?mn(e):$o(e);if(Xe&&e[Xe])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Xe]());var t=gi(e);return(t==C?cn:t==N?pn:Ra)(e)}function fa(e){return e?(e=ya(e))===h||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ma(e){var t=fa(e),n=t%1;return t==t?n?t-n:t:0}function ga(e){return e?lr(ma(e),0,g):0}function ya(e){if("number"==typeof e)return e;if(ca(e))return m;if(ta(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ta(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Xt(e);var n=ye.test(e);return n||be.test(e)?pt(e.slice(2),n?2:8):ge.test(e)?m:+e}function va(e){return Eo(e,Da(e))}function ba(e){return null==e?"":uo(e)}var wa=Io((function(e,t){if(Ci(t)||Ks(t))Eo(t,Ea(t),e);else for(var n in t)Pe.call(t,n)&&nr(e,n,t[n])})),ka=Io((function(e,t){Eo(t,Da(t),e)})),xa=Io((function(e,t,n,r){Eo(t,Da(t),e,r)})),Ma=Io((function(e,t,n,r){Eo(t,Ea(t),e,r)})),Sa=oi(ar);var Ca=Zr((function(e,t){e=Ae(e);var n=-1,r=t.length,i=r>2?t[2]:o;for(i&&ki(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],a=Da(s),l=-1,c=a.length;++l<c;){var u=a[l],d=e[u];(d===o||Rs(d,De[u])&&!Pe.call(e,u))&&(e[u]=s[u])}return e})),Oa=Zr((function(e){return e.push(o,ti),At(La,o,e)}));function Aa(e,t,n){var r=null==e?o:Sr(e,t);return r===o?n:r}function Ta(e,t){return null!=e&&yi(e,t,_r)}var _a=Fo((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Be.call(t)),e[t]=n}),tl(ol)),Na=Fo((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Be.call(t)),Pe.call(e,t)?e[t].push(n):e[t]=[n]}),ui),$a=Zr($r);function Ea(e){return Ks(e)?Zn(e):zr(e)}function Da(e){return Ks(e)?Zn(e,!0):jr(e)}var Ia=Io((function(e,t,n){Fr(e,t,n)})),La=Io((function(e,t,n,r){Fr(e,t,n,r)})),Pa=oi((function(e,t){var n={};if(null==e)return n;var r=!1;t=Lt(t,(function(t){return t=ko(t,e),r||(r=t.length>1),t})),Eo(e,si(e),n),r&&(n=cr(n,7,ni));for(var o=t.length;o--;)ho(n,t[o]);return n}));var za=oi((function(e,t){return null==e?{}:function(e,t){return Jr(e,t,(function(t,n){return Ta(e,n)}))}(e,t)}));function ja(e,t){if(null==e)return{};var n=Lt(si(e),(function(e){return[e]}));return t=ui(t),Jr(e,n,(function(e,n){return t(e,n[0])}))}var Ba=Xo(Ea),Va=Xo(Da);function Ra(e){return null==e?[]:en(e,Ea(e))}var Ha=jo((function(e,t,n){return t=t.toLowerCase(),e+(n?Fa(t):t)}));function Fa(e){return Za(ba(e).toLowerCase())}function qa(e){return(e=ba(e))&&e.replace(ke,on).replace(tt,"")}var Wa=jo((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Ja=jo((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Ka=zo("toLowerCase");var Ua=jo((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));var Ga=jo((function(e,t,n){return e+(n?" ":"")+Za(t)}));var Ya=jo((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Za=zo("toUpperCase");function Xa(e,t,n){return e=ba(e),(t=n?o:t)===o?function(e){return it.test(e)}(e)?function(e){return e.match(rt)||[]}(e):function(e){return e.match(de)||[]}(e):e.match(t)||[]}var Qa=Zr((function(e,t){try{return At(e,o,t)}catch(e){return Zs(e)?e:new Se(e)}})),el=oi((function(e,t){return _t(t,(function(t){t=ji(t),sr(e,t,Ns(e[t],e))})),e}));function tl(e){return function(){return e}}var nl=Ro(),rl=Ro(!0);function ol(e){return e}function il(e){return Pr("function"==typeof e?e:cr(e,1))}var sl=Zr((function(e,t){return function(n){return $r(n,e,t)}})),al=Zr((function(e,t){return function(n){return $r(e,n,t)}}));function ll(e,t,n){var r=Ea(t),o=Mr(t,r);null!=n||ta(t)&&(o.length||!r.length)||(n=t,t=e,e=this,o=Mr(t,Ea(t)));var i=!(ta(n)&&"chain"in n&&!n.chain),s=Xs(e);return _t(o,(function(n){var r=t[n];e[n]=r,s&&(e.prototype[n]=function(){var t=this.__chain__;if(i||t){var n=e(this.__wrapped__);return(n.__actions__=$o(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Pt([this.value()],arguments))})})),e}function cl(){}var ul=Wo(Lt),dl=Wo($t),pl=Wo(Bt);function hl(e){return xi(e)?Kt(ji(e)):function(e){return function(t){return Sr(t,e)}}(e)}var fl=Ko(),ml=Ko(!0);function gl(){return[]}function yl(){return!1}var vl=qo((function(e,t){return e+t}),0),bl=Yo("ceil"),wl=qo((function(e,t){return e/t}),1),kl=Yo("floor");var xl,Ml=qo((function(e,t){return e*t}),1),Sl=Yo("round"),Cl=qo((function(e,t){return e-t}),0);return Rn.after=function(e,t){if("function"!=typeof t)throw new Ne(i);return e=ma(e),function(){if(--e<1)return t.apply(this,arguments)}},Rn.ary=Ts,Rn.assign=wa,Rn.assignIn=ka,Rn.assignInWith=xa,Rn.assignWith=Ma,Rn.at=Sa,Rn.before=_s,Rn.bind=Ns,Rn.bindAll=el,Rn.bindKey=$s,Rn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Ws(e)?e:[e]},Rn.chain=hs,Rn.chunk=function(e,t,n){t=(n?ki(e,t,n):t===o)?1:bn(ma(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var s=0,a=0,l=r(ft(i/t));s<i;)l[a++]=oo(e,s,s+=t);return l},Rn.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,o=[];++t<n;){var i=e[t];i&&(o[r++]=i)}return o},Rn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=r(e-1),n=arguments[0],o=e;o--;)t[o-1]=arguments[o];return Pt(Ws(n)?$o(n):[n],vr(t,1))},Rn.cond=function(e){var t=null==e?0:e.length,n=ui();return e=t?Lt(e,(function(e){if("function"!=typeof e[1])throw new Ne(i);return[n(e[0]),e[1]]})):[],Zr((function(n){for(var r=-1;++r<t;){var o=e[r];if(At(o[0],this,n))return At(o[1],this,n)}}))},Rn.conforms=function(e){return function(e){var t=Ea(e);return function(n){return ur(n,e,t)}}(cr(e,1))},Rn.constant=tl,Rn.countBy=gs,Rn.create=function(e,t){var n=Hn(e);return null==t?n:ir(n,t)},Rn.curry=function e(t,n,r){var i=Qo(t,8,o,o,o,o,o,n=r?o:n);return i.placeholder=e.placeholder,i},Rn.curryRight=function e(t,n,r){var i=Qo(t,l,o,o,o,o,o,n=r?o:n);return i.placeholder=e.placeholder,i},Rn.debounce=Es,Rn.defaults=Ca,Rn.defaultsDeep=Oa,Rn.defer=Ds,Rn.delay=Is,Rn.difference=Ri,Rn.differenceBy=Hi,Rn.differenceWith=Fi,Rn.drop=function(e,t,n){var r=null==e?0:e.length;return r?oo(e,(t=n||t===o?1:ma(t))<0?0:t,r):[]},Rn.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?oo(e,0,(t=r-(t=n||t===o?1:ma(t)))<0?0:t):[]},Rn.dropRightWhile=function(e,t){return e&&e.length?mo(e,ui(t,3),!0,!0):[]},Rn.dropWhile=function(e,t){return e&&e.length?mo(e,ui(t,3),!0):[]},Rn.fill=function(e,t,n,r){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&ki(e,t,n)&&(n=0,r=i),function(e,t,n,r){var i=e.length;for((n=ma(n))<0&&(n=-n>i?0:i+n),(r=r===o||r>i?i:ma(r))<0&&(r+=i),r=n>r?0:ga(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},Rn.filter=function(e,t){return(Ws(e)?Et:yr)(e,ui(t,3))},Rn.flatMap=function(e,t){return vr(Ss(e,t),1)},Rn.flatMapDeep=function(e,t){return vr(Ss(e,t),h)},Rn.flatMapDepth=function(e,t,n){return n=n===o?1:ma(n),vr(Ss(e,t),n)},Rn.flatten=Ji,Rn.flattenDeep=function(e){return(null==e?0:e.length)?vr(e,h):[]},Rn.flattenDepth=function(e,t){return(null==e?0:e.length)?vr(e,t=t===o?1:ma(t)):[]},Rn.flip=function(e){return Qo(e,512)},Rn.flow=nl,Rn.flowRight=rl,Rn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var o=e[t];r[o[0]]=o[1]}return r},Rn.functions=function(e){return null==e?[]:Mr(e,Ea(e))},Rn.functionsIn=function(e){return null==e?[]:Mr(e,Da(e))},Rn.groupBy=ks,Rn.initial=function(e){return(null==e?0:e.length)?oo(e,0,-1):[]},Rn.intersection=Ui,Rn.intersectionBy=Gi,Rn.intersectionWith=Yi,Rn.invert=_a,Rn.invertBy=Na,Rn.invokeMap=xs,Rn.iteratee=il,Rn.keyBy=Ms,Rn.keys=Ea,Rn.keysIn=Da,Rn.map=Ss,Rn.mapKeys=function(e,t){var n={};return t=ui(t,3),kr(e,(function(e,r,o){sr(n,t(e,r,o),e)})),n},Rn.mapValues=function(e,t){var n={};return t=ui(t,3),kr(e,(function(e,r,o){sr(n,r,t(e,r,o))})),n},Rn.matches=function(e){return Rr(cr(e,1))},Rn.matchesProperty=function(e,t){return Hr(e,cr(t,1))},Rn.memoize=Ls,Rn.merge=Ia,Rn.mergeWith=La,Rn.method=sl,Rn.methodOf=al,Rn.mixin=ll,Rn.negate=Ps,Rn.nthArg=function(e){return e=ma(e),Zr((function(t){return qr(t,e)}))},Rn.omit=Pa,Rn.omitBy=function(e,t){return ja(e,Ps(ui(t)))},Rn.once=function(e){return _s(2,e)},Rn.orderBy=function(e,t,n,r){return null==e?[]:(Ws(t)||(t=null==t?[]:[t]),Ws(n=r?o:n)||(n=null==n?[]:[n]),Wr(e,t,n))},Rn.over=ul,Rn.overArgs=zs,Rn.overEvery=dl,Rn.overSome=pl,Rn.partial=js,Rn.partialRight=Bs,Rn.partition=Cs,Rn.pick=za,Rn.pickBy=ja,Rn.property=hl,Rn.propertyOf=function(e){return function(t){return null==e?o:Sr(e,t)}},Rn.pull=Xi,Rn.pullAll=Qi,Rn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Kr(e,t,ui(n,2)):e},Rn.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Kr(e,t,o,n):e},Rn.pullAt=es,Rn.range=fl,Rn.rangeRight=ml,Rn.rearg=Vs,Rn.reject=function(e,t){return(Ws(e)?Et:yr)(e,Ps(ui(t,3)))},Rn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,o=[],i=e.length;for(t=ui(t,3);++r<i;){var s=e[r];t(s,r,e)&&(n.push(s),o.push(r))}return Ur(e,o),n},Rn.rest=function(e,t){if("function"!=typeof e)throw new Ne(i);return Zr(e,t=t===o?t:ma(t))},Rn.reverse=ts,Rn.sampleSize=function(e,t,n){return t=(n?ki(e,t,n):t===o)?1:ma(t),(Ws(e)?Qn:Qr)(e,t)},Rn.set=function(e,t,n){return null==e?e:eo(e,t,n)},Rn.setWith=function(e,t,n,r){return r="function"==typeof r?r:o,null==e?e:eo(e,t,n,r)},Rn.shuffle=function(e){return(Ws(e)?er:ro)(e)},Rn.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&ki(e,t,n)?(t=0,n=r):(t=null==t?0:ma(t),n=n===o?r:ma(n)),oo(e,t,n)):[]},Rn.sortBy=Os,Rn.sortedUniq=function(e){return e&&e.length?lo(e):[]},Rn.sortedUniqBy=function(e,t){return e&&e.length?lo(e,ui(t,2)):[]},Rn.split=function(e,t,n){return n&&"number"!=typeof n&&ki(e,t,n)&&(t=n=o),(n=n===o?g:n>>>0)?(e=ba(e))&&("string"==typeof t||null!=t&&!sa(t))&&!(t=uo(t))&&ln(e)?Mo(mn(e),0,n):e.split(t,n):[]},Rn.spread=function(e,t){if("function"!=typeof e)throw new Ne(i);return t=null==t?0:bn(ma(t),0),Zr((function(n){var r=n[t],o=Mo(n,0,t);return r&&Pt(o,r),At(e,this,o)}))},Rn.tail=function(e){var t=null==e?0:e.length;return t?oo(e,1,t):[]},Rn.take=function(e,t,n){return e&&e.length?oo(e,0,(t=n||t===o?1:ma(t))<0?0:t):[]},Rn.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?oo(e,(t=r-(t=n||t===o?1:ma(t)))<0?0:t,r):[]},Rn.takeRightWhile=function(e,t){return e&&e.length?mo(e,ui(t,3),!1,!0):[]},Rn.takeWhile=function(e,t){return e&&e.length?mo(e,ui(t,3)):[]},Rn.tap=function(e,t){return t(e),e},Rn.throttle=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new Ne(i);return ta(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),Es(e,t,{leading:r,maxWait:t,trailing:o})},Rn.thru=fs,Rn.toArray=ha,Rn.toPairs=Ba,Rn.toPairsIn=Va,Rn.toPath=function(e){return Ws(e)?Lt(e,ji):ca(e)?[e]:$o(zi(ba(e)))},Rn.toPlainObject=va,Rn.transform=function(e,t,n){var r=Ws(e),o=r||Gs(e)||ua(e);if(t=ui(t,4),null==n){var i=e&&e.constructor;n=o?r?new i:[]:ta(e)&&Xs(i)?Hn(Ke(e)):{}}return(o?_t:kr)(e,(function(e,r,o){return t(n,e,r,o)})),n},Rn.unary=function(e){return Ts(e,1)},Rn.union=ns,Rn.unionBy=rs,Rn.unionWith=os,Rn.uniq=function(e){return e&&e.length?po(e):[]},Rn.uniqBy=function(e,t){return e&&e.length?po(e,ui(t,2)):[]},Rn.uniqWith=function(e,t){return t="function"==typeof t?t:o,e&&e.length?po(e,o,t):[]},Rn.unset=function(e,t){return null==e||ho(e,t)},Rn.unzip=is,Rn.unzipWith=ss,Rn.update=function(e,t,n){return null==e?e:fo(e,t,wo(n))},Rn.updateWith=function(e,t,n,r){return r="function"==typeof r?r:o,null==e?e:fo(e,t,wo(n),r)},Rn.values=Ra,Rn.valuesIn=function(e){return null==e?[]:en(e,Da(e))},Rn.without=as,Rn.words=Xa,Rn.wrap=function(e,t){return js(wo(t),e)},Rn.xor=ls,Rn.xorBy=cs,Rn.xorWith=us,Rn.zip=ds,Rn.zipObject=function(e,t){return vo(e||[],t||[],nr)},Rn.zipObjectDeep=function(e,t){return vo(e||[],t||[],eo)},Rn.zipWith=ps,Rn.entries=Ba,Rn.entriesIn=Va,Rn.extend=ka,Rn.extendWith=xa,ll(Rn,Rn),Rn.add=vl,Rn.attempt=Qa,Rn.camelCase=Ha,Rn.capitalize=Fa,Rn.ceil=bl,Rn.clamp=function(e,t,n){return n===o&&(n=t,t=o),n!==o&&(n=(n=ya(n))==n?n:0),t!==o&&(t=(t=ya(t))==t?t:0),lr(ya(e),t,n)},Rn.clone=function(e){return cr(e,4)},Rn.cloneDeep=function(e){return cr(e,5)},Rn.cloneDeepWith=function(e,t){return cr(e,5,t="function"==typeof t?t:o)},Rn.cloneWith=function(e,t){return cr(e,4,t="function"==typeof t?t:o)},Rn.conformsTo=function(e,t){return null==t||ur(e,t,Ea(t))},Rn.deburr=qa,Rn.defaultTo=function(e,t){return null==e||e!=e?t:e},Rn.divide=wl,Rn.endsWith=function(e,t,n){e=ba(e),t=uo(t);var r=e.length,i=n=n===o?r:lr(ma(n),0,r);return(n-=t.length)>=0&&e.slice(n,i)==t},Rn.eq=Rs,Rn.escape=function(e){return(e=ba(e))&&Z.test(e)?e.replace(G,sn):e},Rn.escapeRegExp=function(e){return(e=ba(e))&&ie.test(e)?e.replace(oe,"\\$&"):e},Rn.every=function(e,t,n){var r=Ws(e)?$t:mr;return n&&ki(e,t,n)&&(t=o),r(e,ui(t,3))},Rn.find=ys,Rn.findIndex=qi,Rn.findKey=function(e,t){return Rt(e,ui(t,3),kr)},Rn.findLast=vs,Rn.findLastIndex=Wi,Rn.findLastKey=function(e,t){return Rt(e,ui(t,3),xr)},Rn.floor=kl,Rn.forEach=bs,Rn.forEachRight=ws,Rn.forIn=function(e,t){return null==e?e:br(e,ui(t,3),Da)},Rn.forInRight=function(e,t){return null==e?e:wr(e,ui(t,3),Da)},Rn.forOwn=function(e,t){return e&&kr(e,ui(t,3))},Rn.forOwnRight=function(e,t){return e&&xr(e,ui(t,3))},Rn.get=Aa,Rn.gt=Hs,Rn.gte=Fs,Rn.has=function(e,t){return null!=e&&yi(e,t,Tr)},Rn.hasIn=Ta,Rn.head=Ki,Rn.identity=ol,Rn.includes=function(e,t,n,r){e=Ks(e)?e:Ra(e),n=n&&!r?ma(n):0;var o=e.length;return n<0&&(n=bn(o+n,0)),la(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&Ft(e,t,n)>-1},Rn.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=null==n?0:ma(n);return o<0&&(o=bn(r+o,0)),Ft(e,t,o)},Rn.inRange=function(e,t,n){return t=fa(t),n===o?(n=t,t=0):n=fa(n),function(e,t,n){return e>=wn(t,n)&&e<bn(t,n)}(e=ya(e),t,n)},Rn.invoke=$a,Rn.isArguments=qs,Rn.isArray=Ws,Rn.isArrayBuffer=Js,Rn.isArrayLike=Ks,Rn.isArrayLikeObject=Us,Rn.isBoolean=function(e){return!0===e||!1===e||na(e)&&Or(e)==w},Rn.isBuffer=Gs,Rn.isDate=Ys,Rn.isElement=function(e){return na(e)&&1===e.nodeType&&!ia(e)},Rn.isEmpty=function(e){if(null==e)return!0;if(Ks(e)&&(Ws(e)||"string"==typeof e||"function"==typeof e.splice||Gs(e)||ua(e)||qs(e)))return!e.length;var t=gi(e);if(t==C||t==N)return!e.size;if(Ci(e))return!zr(e).length;for(var n in e)if(Pe.call(e,n))return!1;return!0},Rn.isEqual=function(e,t){return Dr(e,t)},Rn.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:o)?n(e,t):o;return r===o?Dr(e,t,o,n):!!r},Rn.isError=Zs,Rn.isFinite=function(e){return"number"==typeof e&&wt(e)},Rn.isFunction=Xs,Rn.isInteger=Qs,Rn.isLength=ea,Rn.isMap=ra,Rn.isMatch=function(e,t){return e===t||Ir(e,t,pi(t))},Rn.isMatchWith=function(e,t,n){return n="function"==typeof n?n:o,Ir(e,t,pi(t),n)},Rn.isNaN=function(e){return oa(e)&&e!=+e},Rn.isNative=function(e){if(Si(e))throw new Se("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Lr(e)},Rn.isNil=function(e){return null==e},Rn.isNull=function(e){return null===e},Rn.isNumber=oa,Rn.isObject=ta,Rn.isObjectLike=na,Rn.isPlainObject=ia,Rn.isRegExp=sa,Rn.isSafeInteger=function(e){return Qs(e)&&e>=-9007199254740991&&e<=f},Rn.isSet=aa,Rn.isString=la,Rn.isSymbol=ca,Rn.isTypedArray=ua,Rn.isUndefined=function(e){return e===o},Rn.isWeakMap=function(e){return na(e)&&gi(e)==D},Rn.isWeakSet=function(e){return na(e)&&"[object WeakSet]"==Or(e)},Rn.join=function(e,t){return null==e?"":Vt.call(e,t)},Rn.kebabCase=Wa,Rn.last=Zi,Rn.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return n!==o&&(i=(i=ma(n))<0?bn(r+i,0):wn(i,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,i):Ht(e,Wt,i,!0)},Rn.lowerCase=Ja,Rn.lowerFirst=Ka,Rn.lt=da,Rn.lte=pa,Rn.max=function(e){return e&&e.length?gr(e,ol,Ar):o},Rn.maxBy=function(e,t){return e&&e.length?gr(e,ui(t,2),Ar):o},Rn.mean=function(e){return Jt(e,ol)},Rn.meanBy=function(e,t){return Jt(e,ui(t,2))},Rn.min=function(e){return e&&e.length?gr(e,ol,Br):o},Rn.minBy=function(e,t){return e&&e.length?gr(e,ui(t,2),Br):o},Rn.stubArray=gl,Rn.stubFalse=yl,Rn.stubObject=function(){return{}},Rn.stubString=function(){return""},Rn.stubTrue=function(){return!0},Rn.multiply=Ml,Rn.nth=function(e,t){return e&&e.length?qr(e,ma(t)):o},Rn.noConflict=function(){return mt._===this&&(mt._=Re),this},Rn.noop=cl,Rn.now=As,Rn.pad=function(e,t,n){e=ba(e);var r=(t=ma(t))?fn(e):0;if(!t||r>=t)return e;var o=(t-r)/2;return Jo(gt(o),n)+e+Jo(ft(o),n)},Rn.padEnd=function(e,t,n){e=ba(e);var r=(t=ma(t))?fn(e):0;return t&&r<t?e+Jo(t-r,n):e},Rn.padStart=function(e,t,n){e=ba(e);var r=(t=ma(t))?fn(e):0;return t&&r<t?Jo(t-r,n)+e:e},Rn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),xn(ba(e).replace(se,""),t||0)},Rn.random=function(e,t,n){if(n&&"boolean"!=typeof n&&ki(e,t,n)&&(t=n=o),n===o&&("boolean"==typeof t?(n=t,t=o):"boolean"==typeof e&&(n=e,e=o)),e===o&&t===o?(e=0,t=1):(e=fa(e),t===o?(t=e,e=0):t=fa(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var i=Mn();return wn(e+i*(t-e+dt("1e-"+((i+"").length-1))),t)}return Gr(e,t)},Rn.reduce=function(e,t,n){var r=Ws(e)?zt:Gt,o=arguments.length<3;return r(e,ui(t,4),n,o,hr)},Rn.reduceRight=function(e,t,n){var r=Ws(e)?jt:Gt,o=arguments.length<3;return r(e,ui(t,4),n,o,fr)},Rn.repeat=function(e,t,n){return t=(n?ki(e,t,n):t===o)?1:ma(t),Yr(ba(e),t)},Rn.replace=function(){var e=arguments,t=ba(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Rn.result=function(e,t,n){var r=-1,i=(t=ko(t,e)).length;for(i||(i=1,e=o);++r<i;){var s=null==e?o:e[ji(t[r])];s===o&&(r=i,s=n),e=Xs(s)?s.call(e):s}return e},Rn.round=Sl,Rn.runInContext=e,Rn.sample=function(e){return(Ws(e)?Xn:Xr)(e)},Rn.size=function(e){if(null==e)return 0;if(Ks(e))return la(e)?fn(e):e.length;var t=gi(e);return t==C||t==N?e.size:zr(e).length},Rn.snakeCase=Ua,Rn.some=function(e,t,n){var r=Ws(e)?Bt:io;return n&&ki(e,t,n)&&(t=o),r(e,ui(t,3))},Rn.sortedIndex=function(e,t){return so(e,t)},Rn.sortedIndexBy=function(e,t,n){return ao(e,t,ui(n,2))},Rn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=so(e,t);if(r<n&&Rs(e[r],t))return r}return-1},Rn.sortedLastIndex=function(e,t){return so(e,t,!0)},Rn.sortedLastIndexBy=function(e,t,n){return ao(e,t,ui(n,2),!0)},Rn.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var n=so(e,t,!0)-1;if(Rs(e[n],t))return n}return-1},Rn.startCase=Ga,Rn.startsWith=function(e,t,n){return e=ba(e),n=null==n?0:lr(ma(n),0,e.length),t=uo(t),e.slice(n,n+t.length)==t},Rn.subtract=Cl,Rn.sum=function(e){return e&&e.length?Yt(e,ol):0},Rn.sumBy=function(e,t){return e&&e.length?Yt(e,ui(t,2)):0},Rn.template=function(e,t,n){var r=Rn.templateSettings;n&&ki(e,t,n)&&(t=o),e=ba(e),t=xa({},t,r,ei);var i,s,a=xa({},t.imports,r.imports,ei),l=Ea(a),c=en(a,l),u=0,d=t.interpolate||xe,p="__p += '",h=Te((t.escape||xe).source+"|"+d.source+"|"+(d===ee?fe:xe).source+"|"+(t.evaluate||xe).source+"|$","g"),f="//# sourceURL="+(Pe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++at+"]")+"\n";e.replace(h,(function(t,n,r,o,a,l){return r||(r=o),p+=e.slice(u,l).replace(Me,an),n&&(i=!0,p+="' +\n__e("+n+") +\n'"),a&&(s=!0,p+="';\n"+a+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+t.length,t})),p+="';\n";var m=Pe.call(t,"variable")&&t.variable;if(m){if(pe.test(m))throw new Se("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(s?p.replace(W,""):p).replace(J,"$1").replace(K,"$1;"),p="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=Qa((function(){return Ce(l,f+"return "+p).apply(o,c)}));if(g.source=p,Zs(g))throw g;return g},Rn.times=function(e,t){if((e=ma(e))<1||e>f)return[];var n=g,r=wn(e,g);t=ui(t),e-=g;for(var o=Zt(r,t);++n<e;)t(n);return o},Rn.toFinite=fa,Rn.toInteger=ma,Rn.toLength=ga,Rn.toLower=function(e){return ba(e).toLowerCase()},Rn.toNumber=ya,Rn.toSafeInteger=function(e){return e?lr(ma(e),-9007199254740991,f):0===e?e:0},Rn.toString=ba,Rn.toUpper=function(e){return ba(e).toUpperCase()},Rn.trim=function(e,t,n){if((e=ba(e))&&(n||t===o))return Xt(e);if(!e||!(t=uo(t)))return e;var r=mn(e),i=mn(t);return Mo(r,nn(r,i),rn(r,i)+1).join("")},Rn.trimEnd=function(e,t,n){if((e=ba(e))&&(n||t===o))return e.slice(0,gn(e)+1);if(!e||!(t=uo(t)))return e;var r=mn(e);return Mo(r,0,rn(r,mn(t))+1).join("")},Rn.trimStart=function(e,t,n){if((e=ba(e))&&(n||t===o))return e.replace(se,"");if(!e||!(t=uo(t)))return e;var r=mn(e);return Mo(r,nn(r,mn(t))).join("")},Rn.truncate=function(e,t){var n=30,r="...";if(ta(t)){var i="separator"in t?t.separator:i;n="length"in t?ma(t.length):n,r="omission"in t?uo(t.omission):r}var s=(e=ba(e)).length;if(ln(e)){var a=mn(e);s=a.length}if(n>=s)return e;var l=n-fn(r);if(l<1)return r;var c=a?Mo(a,0,l).join(""):e.slice(0,l);if(i===o)return c+r;if(a&&(l+=c.length-l),sa(i)){if(e.slice(l).search(i)){var u,d=c;for(i.global||(i=Te(i.source,ba(me.exec(i))+"g")),i.lastIndex=0;u=i.exec(d);)var p=u.index;c=c.slice(0,p===o?l:p)}}else if(e.indexOf(uo(i),l)!=l){var h=c.lastIndexOf(i);h>-1&&(c=c.slice(0,h))}return c+r},Rn.unescape=function(e){return(e=ba(e))&&Y.test(e)?e.replace(U,yn):e},Rn.uniqueId=function(e){var t=++ze;return ba(e)+t},Rn.upperCase=Ya,Rn.upperFirst=Za,Rn.each=bs,Rn.eachRight=ws,Rn.first=Ki,ll(Rn,(xl={},kr(Rn,(function(e,t){Pe.call(Rn.prototype,t)||(xl[t]=e)})),xl),{chain:!1}),Rn.VERSION="4.17.21",_t(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Rn[e].placeholder=Rn})),_t(["drop","take"],(function(e,t){Wn.prototype[e]=function(n){n=n===o?1:bn(ma(n),0);var r=this.__filtered__&&!t?new Wn(this):this.clone();return r.__filtered__?r.__takeCount__=wn(n,r.__takeCount__):r.__views__.push({size:wn(n,g),type:e+(r.__dir__<0?"Right":"")}),r},Wn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),_t(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;Wn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:ui(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),_t(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Wn.prototype[e]=function(){return this[n](1).value()[0]}})),_t(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Wn.prototype[e]=function(){return this.__filtered__?new Wn(this):this[n](1)}})),Wn.prototype.compact=function(){return this.filter(ol)},Wn.prototype.find=function(e){return this.filter(e).head()},Wn.prototype.findLast=function(e){return this.reverse().find(e)},Wn.prototype.invokeMap=Zr((function(e,t){return"function"==typeof e?new Wn(this):this.map((function(n){return $r(n,e,t)}))})),Wn.prototype.reject=function(e){return this.filter(Ps(ui(e)))},Wn.prototype.slice=function(e,t){e=ma(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Wn(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==o&&(n=(t=ma(t))<0?n.dropRight(-t):n.take(t-e)),n)},Wn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Wn.prototype.toArray=function(){return this.take(g)},kr(Wn.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),i=Rn[r?"take"+("last"==t?"Right":""):t],s=r||/^find/.test(t);i&&(Rn.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,l=t instanceof Wn,c=a[0],u=l||Ws(t),d=function(e){var t=i.apply(Rn,Pt([e],a));return r&&p?t[0]:t};u&&n&&"function"==typeof c&&1!=c.length&&(l=u=!1);var p=this.__chain__,h=!!this.__actions__.length,f=s&&!p,m=l&&!h;if(!s&&u){t=m?t:new Wn(this);var g=e.apply(t,a);return g.__actions__.push({func:fs,args:[d],thisArg:o}),new qn(g,p)}return f&&m?e.apply(this,a):(g=this.thru(d),f?r?g.value()[0]:g.value():g)})})),_t(["pop","push","shift","sort","splice","unshift"],(function(e){var t=$e[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Rn.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var o=this.value();return t.apply(Ws(o)?o:[],e)}return this[n]((function(n){return t.apply(Ws(n)?n:[],e)}))}})),kr(Wn.prototype,(function(e,t){var n=Rn[t];if(n){var r=n.name+"";Pe.call(En,r)||(En[r]=[]),En[r].push({name:t,func:n})}})),En[Ho(o,2).name]=[{name:"wrapper",func:o}],Wn.prototype.clone=function(){var e=new Wn(this.__wrapped__);return e.__actions__=$o(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=$o(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=$o(this.__views__),e},Wn.prototype.reverse=function(){if(this.__filtered__){var e=new Wn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Wn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Ws(e),r=t<0,o=n?e.length:0,i=function(e,t,n){var r=-1,o=n.length;for(;++r<o;){var i=n[r],s=i.size;switch(i.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=wn(t,e+s);break;case"takeRight":e=bn(e,t-s)}}return{start:e,end:t}}(0,o,this.__views__),s=i.start,a=i.end,l=a-s,c=r?a:s-1,u=this.__iteratees__,d=u.length,p=0,h=wn(l,this.__takeCount__);if(!n||!r&&o==l&&h==l)return go(e,this.__actions__);var f=[];e:for(;l--&&p<h;){for(var m=-1,g=e[c+=t];++m<d;){var y=u[m],v=y.iteratee,b=y.type,w=v(g);if(2==b)g=w;else if(!w){if(1==b)continue e;break e}}f[p++]=g}return f},Rn.prototype.at=ms,Rn.prototype.chain=function(){return hs(this)},Rn.prototype.commit=function(){return new qn(this.value(),this.__chain__)},Rn.prototype.next=function(){this.__values__===o&&(this.__values__=ha(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?o:this.__values__[this.__index__++]}},Rn.prototype.plant=function(e){for(var t,n=this;n instanceof Fn;){var r=Vi(n);r.__index__=0,r.__values__=o,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t},Rn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Wn){var t=e;return this.__actions__.length&&(t=new Wn(this)),(t=t.reverse()).__actions__.push({func:fs,args:[ts],thisArg:o}),new qn(t,this.__chain__)}return this.thru(ts)},Rn.prototype.toJSON=Rn.prototype.valueOf=Rn.prototype.value=function(){return go(this.__wrapped__,this.__actions__)},Rn.prototype.first=Rn.prototype.head,Xe&&(Rn.prototype[Xe]=function(){return this}),Rn}();mt._=vn,(r=function(){return vn}.call(t,n,t,e))===o||(e.exports=r)}.call(this)},965:e=>{"use strict";e.exports=JSON.parse('{"history":{"controls":true,"maxStates":40},"debug":true,"logging":true}')}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var i=Object.create(null);o.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,o.d(i,s),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e={};o.r(e),o.d(e,{ballSize:()=>T,bodyTypes:()=>M,breastSize:()=>O,fatAmount:()=>C,muscleAmount:()=>S,penisSize:()=>A,sizes:()=>x});var t={};o.r(t),o.d(t,{megaCity:()=>z,microCity:()=>L,normalCity:()=>P});var n={};o.r(n),o.d(n,{attackSkill:()=>p,cityText:()=>t,genders:()=>N,items:()=>u,largerText:()=>g,loot:()=>b,measurements:()=>e,muchLargerText:()=>y,muchSmallerText:()=>h,pronouns:()=>E,sameText:()=>m,settings:()=>j,smallerText:()=>f,species:()=>D,speciesDetail:()=>I,statTypes:()=>V,stats:()=>H,statusEffect:()=>k,stores:()=>d});var r={};o.r(r),o.d(r,{attackSkillsMap:()=>Et,itemsMap:()=>Lt,statusEffectMap:()=>Dt,storesMap:()=>It});var i={};o.r(i),o.d(i,{migrations:()=>ch,upgrade:()=>uh});var s={};o.r(s),o.d(s,{migrations:()=>hh,upgrade:()=>fh});var a={};o.r(a),o.d(a,{v010:()=>s,v09:()=>i});var l=o(965);const c=JSON.parse('[{"name":"Little Health Potion","mod":5,"type":"stats","stat":"hlth","desc":"Restores 5% of health, 5 health minimum"},{"name":"Protein Powder","mod":3,"type":"exp","stat":"muscle","desc":"Increases muscle experience by 3"},{"name":"Size Elixir","mod":10,"type":"exp","stat":"size","desc":"Increases size experience by 3"},{"name":"Tub of Grease","mod":0.01,"type":"exp","stat":"fat","desc":"Increases fat experience by 1%"},{"name":"Vitamins","mod":1,"type":"stats","stat":"con","desc":"Increases constitution by 1"},{"name":"Blue Pill","mod":0.02,"type":"gender","stat":"penis","desc":"Increases penis size by 2%"},{"name":"Magnesium Pills","mod":0.01,"type":"gender","stat":"balls","desc":"Increases ball size by 1%"},{"name":"Injection","mod":0.01,"type":"gender","stat":"breasts","desc":"Increases breast size by 1%"},{"name":"Health Potion","mod":25,"type":"stats","stat":"hlth","desc":"Restores 10% of health, 25 health minimum"},{"name":"Muscle Reducer","mod":-3,"type":"exp","stat":"muscle","desc":"Decreases muscle experience by 3"},{"name":"Shrink Elixir","mod":-10,"type":"exp","stat":"size","desc":"Decreases size experience by 10"},{"name":"Soybeans","mod":-0.05,"type":"exp","stat":"fat","desc":"Decreases fat experience by 5%"},{"name":"Penis Reducer","mod":-0.02,"type":"gender","stat":"penis","desc":"Decreases penis size by 2%"},{"name":"Heat Pad","mod":-0.01,"type":"gender","stat":"balls","desc":"Decreases ball size by 1%"},{"name":"Breast Reducer","mod":-0.01,"type":"gender","stat":"breasts","desc":"Decreases breast size by 1%"},{"name":"Large Health Potion","mod":50,"type":"stats","stat":"hlth","desc":"Restores 20% of health, 50 health minimum"}]');var u=o.t(c,2),d=[{name:"Micro Marketplace",stock:[{id:0,qty:10,price:10},{id:9,qty:3,price:50},{id:10,qty:3,price:50},{id:11,qty:3,price:50},{id:12,qty:3,price:50},{id:13,qty:3,price:50},{id:14,qty:3,price:50}]},{name:"Standard Shopping Center",stock:[{id:8,qty:10,price:50},{id:4,qty:3,price:100}]},{name:"Macro Megamart",stock:[{id:15,qty:10,price:100},{id:1,qty:3,price:100},{id:2,qty:3,price:100},{id:3,qty:3,price:100},{id:5,qty:3,price:100},{id:6,qty:3,price:100},{id:7,qty:3,price:100}]}],p=[{name:"Scratch",skill:!1,passive:!1,cooldown:0,skillPoints:10,desc:{baseDesc:"You use your claws for a swiping attack",critDesc:"2x",statMods:[{stat:"Strength"}],reqs:[{req:"None"}],atkTooltip:"Basic claw attack"},direct:{hit:75,stat:"strg",dmg:{min:.3,max:.6,crit:{canCrit:!0,critMulti:2}}},status:null,requirements:{}},{name:"Bite",skill:!1,passive:!1,cooldown:0,skillPoints:10,desc:{baseDesc:"Getting a taste before the meal.",critDesc:"2x",atkTooltip:"Basic bite attack",statMods:[{stat:"Strength"}],reqs:[{req:"None"}]},direct:{hit:50,stat:"strg",dmg:{min:.6,max:.9,crit:{canCrit:!0,critMulti:2}}},status:{},requirements:{}},{name:"Stomp",skill:!1,passive:!1,cooldown:1,skillPoints:10,desc:{baseDesc:"You are large enough to step on your opponent.",critDesc:"2x",atkTooltip:"Paw slam for higher damage",statMods:[{stat:"Strength"}],reqs:[{req:"Must be 2x taller than oppenent"}]},direct:{hit:65,stat:"strg",dmg:{min:.6,max:.99,crit:{canCrit:!0,critMulti:2}}},status:{},requirements:{conditions:[{reqCondition:"attackerHeight > (defenderHeight * 2)",failText:"Not large enough"}]}},{name:"Pepper Spray",skill:!0,passive:!1,cooldown:5,skillPoints:50,desc:{baseDesc:"Taking some pepper spray, you aim for the eyes to blind your opponent for 3 turns.",critDesc:"No",statMods:[{stat:"None"}],reqs:[{req:"None"}],atkTooltip:"Blinds enemy for 3 turns"},direct:{},status:{hit:90,type:1,stat:"strg",mod:{amt:-1e3,type:"hit",multi:!1,min:!1,max:!1},dmg:{},duration:3},requirements:{}},{name:"Improved Paw-Eye Coordination",skill:!1,passive:!0,cooldown:0,skillPoints:10,desc:{baseDesc:"Accuracy improved by 10%",critDesc:"",statMods:[],reqs:[]},direct:null,status:{hit:0,type:0,stat:"",mod:{amt:10,type:"hit",multi:!0,min:!1,max:!1},dmg:null,duration:-1},requirements:{}},{name:"Gouge",skill:!0,passive:!1,cooldown:0,skillPoints:30,desc:{baseDesc:"Strike and cause a deep gash which will continue to bleed for 5 turns",critDesc:"2x",atkTooltip:"Has a chance to cause bleed for 5 turns along with direct damage",statMods:[{stat:"Dexterity"}],reqs:[{req:"None"}]},direct:{hit:90,stat:"dex",dmg:{min:.4,max:.6,crit:{canCrit:!0,critMulti:2}}},status:{hit:60,duration:5,type:2,stat:"dmg",mod:{},dmg:{min:5,max:5,crit:{canCrit:!1,critMulti:1}}},requirements:{}}],h={Eat:"Looking down you see the $enemy.name. Their form before you, small enough to fit in your paw.\n    <br>Picking them up you play with them for a bit, rolling them between your large digits before giving them a massive lick. Their taste is all consuming, it sends a thrill down your spine. You can imagine what it would be like to consume them, but why do you have to imagine when you can make it reality?\n    <br>Giving them another lick, you revel in their flavor. Edging closer and closer to a euphoric high. Then, letting the feeling over take you, you use your tounge to scoop them up and slide them into your hungry maw.\n    <br>The feeling is more than you imagined. Their body between the roof of your maw and your tounge delights the senses. The taste, the feeling! Your tounge moves on it's own and proceeds to explore every inch of their body. Wrapping your tounge around their most sensitive regions, you elicit a shudder from them.\n    <br>You continue to poke and prod with your tounge while also exploring your own body. The prey in your maw finally squeaks in lust as you've pushed them over the edge. Not only can they not take anymore, but you yourself are pushed over the edge. As you both climax, you instinctively swallow and can feel the $enemy.name slide down your throat. As you're recovering from your climax, you move a paw you slowly up to your throat and message the prey further down.\n    <br>When the prey reaches your stomach, they make a slight bump under your skin. Sitting back you rub the bump and revel in the afterglow of your consumption. After coming down from the experience, you pick up everything from your altercation and move on patting your stomach.",Anal:"",Unbirth:"",Sound:""},f={Eat:"Looking down you see the $enemy.name. Their form before you, coming up to around your hip.\n    <br>Grabbing them by their waist, you hoist them up to your eyeline. Their smell is... intoxicating, you wonder what their taste might be. You give them a quick lick on their face and the flavor explodes in your mind. Unconsciously you stare into space and drool for a moment, lost in the rapture of the $enemy.name's taste.\n    <br>After a moment you snap back to reality and know you must have more, much more. You start licking your prey all over, slowly and methodically. As the tounge massaging continues $enemy.name lets out a small moan as you work your way around their more erotic areas. This excitement also gets you hot and bothered, you straddle the prey on your shoulders to continue and to also move a paw to pleasure yourself.\n    <br>You begin to moan with your prey as the feeling build up, ultimately leading to a moment of release. You and your prey cry out when the moment hits. As you cry out, you take your free paw and shove the $enemy.name into your maw and proceed to push them down into your gaping void. A sizeable bulge can be seen in your throat as the prey slides down. To help out you take a paw to coax them to your waiting stomach.\n    <br>Pushing and pulling the prey make their way to your stomach. With a final push, your stomach distends to a sizable bump. You take a moment to bask in your meal, rub your belly, and collect everything that your prey had dropped.",Anal:"",Unbirth:"",Sound:""},m={Eat:"Looking down you see the $enemy.name. Their form coming in roughly the same size as you.\n    <br>You let out a long breath, the tension of the fight easing from your body. As you let in a deep breath you catch the smell of your prey, it smells... delicious. As you think on the aroma, a bit of drool slips from your muzzle. The thought of a decently sized meal is enticing.\n    <br>Taking a minute to ponder which way to go with eating your prey you decide on head first, less complaining if they decide to wake up. Shuffling around to their head you pick them up by the shoulders, open your mouth, and proceed with your delectable consumption.\n    <br>Sliding their head into your maw the taste is indescribable, it's everything you had hoped for from the smell. Pulling your prey in, you slowly fit their shoulders in your jaw and let out a shudder. The feeling of fullness is starting to overtake you. As you get closer to the $enemy.name's more erotic areas, a soft moan escapes your throat. However the moan is not your own, it appears your prey has been caught in the throughs of pleasure from their dire experience. The thought and feeling of your prey's delight begins to overtake you and from you there is a duet of pleasure.\n    <br>The cacophony of lust continues as you work your way down to the end of your meal. A rather sizable bulge is showing from your stomach with your prey half way through their journey. With a final slurp you both let go and the moment takes over both of you. Laying back, the $enemy.name in your throat has completed their fated path and has enlarged your stomach to the point of making it difficult to reach around it.\n    <br>Rubbing your large gut you slowly get up and wobble a little bit as you find your footing. Thankfully you had grabbed all of your loot before your meal. Grabbing your things you waddle of, full and content.",Anal:"",Unbirth:"",Sound:""},g={Eat:"Looking down you see the $enemy.name. Their form slightly looming in front of you.\n    <br>You let out a sigh, that was pretty rude of the $enemy.name to fight you. They had the height advantage and everything! As you complain to yourself a strong scent comes to your nose. Taking a moment to think on the smell, your mouth begins to water. Looking for the source of the delicious smell, your eyes fall on the large opponent and your stomach begins to gurgle. You're not sure how you would begin to eat them, but you know you have to.\n    <br>Looking over them you decide on starting at their feet, just so they can't get away if they wake up. Moving down to their lower digits you pick up their feet and size them up. Smacking your lips you put their feet in your mouth and begin swallowing. The size of them makes you stretch your maw as much as you can to accomodate.\n    <br>More and more you pull the prey in, their taste and size over taking you. Moaning and swallowing their waist disappears into your void of a mouth. Your stomach distending with each gulp of your prey, some might mistakenly think you would have eaten a beach ball. Your quest and their journey continues as you make it past their chest, the feeling of fullness starting to overtake you. Reaching the peak as you engulf their, your eyes roll back with a final slurp of the $enemy.name.\n    <br>It was everything you thought it would be, the feeling of gorged stomach brings you back. Your arms resting on top, unable to even get around the sides. Patting it you hear a deep thrum, the reverberations tingling your very essence.\n    <br>Gingerly taking a step, you feel the bottom of your belly drag on the ground. It's not as bad as you expected it to be. Sliding over to the $enemy.name's things you pick them up and slowly make your way back.",Anal:"",Unbirth:"",Sound:""},y={Eat:"Looking up you see the $enemy.name. Their stature dwarfing yours.\n    @@color:transparent;I don't even know how you got here, but you did. Congratulations!@@\n    \"That wasn't even close to fair!\" you scream as you stare daggers at your opponent. Miracle of miracles though you beat them and your not really sure how! You know for one thing though, you will take your prize no matter what. Patting your empty stomach you make your way to the $enemy.name's head to start your meal.\n    <br>Unhinging your jaw you start to slide the huge cranium into your maw. It's crazy to you how this much can fit into you, almost unnatural. The head fully in your mouth, start to choke down their neck. The feeling of unease starts to creep in.\n    <br>The going is extremely slow, you've been at it for 10 minutes now and just reached your prey's shoulders. Wincing you max out your mouth to as wide as it can go, barely fitting in their shoulders. The worst behind you, you feel the unease starting to wane. Sliding further down, you start enjoying the challenge with an extremely muffled moan reverberating your body. Except, that wasn't you...\n    <br>For some reason your prey is excited with either the sensation or the predicament, you're not sure which, but it doesn't really matter. All that matters is that you finish your meal before you're unable to and maybe have a little excitement in the process. Reaching below their waist you are less pulling them in and more of dragging yourself further down their body. It shouldn't be much further, but your stomach already looks like you've swallowed several shipping containers.\n    <br>At last your reach the $enemy.name's feet and slurp with everything you have. As they finish their journey to your stomach, you take a deep breath from the feast. You're resting on your massive stomach, arms hanging down unable to fit around your sides.\n    <br>Your not sure how, but you think you'll have to convice someone larger to carry you around. Good luck with that!",Anal:"",Unbirth:"",Sound:""};const v=JSON.parse('[{"id":1,"chnc":30},{"id":3,"chnc":30},{"id":2,"chnc":30},{"id":5,"chnc":30},{"id":6,"chnc":30},{"id":7,"chnc":30},{"id":4,"chnc":30},{"id":0,"chnc":30}]');var b=o.t(v,2);const w=JSON.parse('[{"name":"Buff","finalEffect":false},{"name":"Blind","finalEffect":true},{"name":"Bleed","finalEffect":false}]');var k=o.t(w,2),x=[{name:"Micro",range:[1,7],sizeMulti:4,statBase:10,loot:[7]},{name:"Tiny",range:[7,30],sizeMulti:66,statBase:20,loot:[7]},{name:"Mini",range:[30,60],sizeMulti:150,statBase:30,loot:[7]},{name:"Small",range:[60,152],sizeMulti:387,statBase:40,loot:[7]},{name:"Average",range:[152,180],sizeMulti:470,statBase:50,loot:[7]},{name:"Tall",range:[180,244],sizeMulti:600,statBase:60,loot:[2]},{name:"Huge",range:[244,457],sizeMulti:700,statBase:80,loot:[2]},{name:"Massive",range:[457,6095],sizeMulti:800,statBase:100,loot:[2]},{name:"Macro",range:[6095],sizeMulti:900,statBase:120,loot:[2]}],M=[{Thin:{bodyFat:[.05,.07],statMods:{strg:[.1,.4],dex:[1.25,1.75],con:[.4,.6]},expMods:{pawEye:2,size:1,skill:1},loot:[7]}},{Normal:{bodyFat:[.1,.2],statMods:{strg:[.6,1],dex:[.75,1],con:[.75,1]},expMods:{size:1,skill:1},loot:[7]}},{Fit:{bodyFat:[.08,.1],statMods:{strg:[.8,1.4],dex:[1,1.5],con:[1,1.5]},expMods:{agility:2,physique:2,size:1,skill:1},loot:[6]}},{Muscle:{bodyFat:[.05,.08],statMods:{strg:[1.5,2.5],dex:[.6,.9],con:[1,1.25]},expMods:{muscle:2,physique:3,size:1,skill:1},loot:[0]}},{Fat:{bodyFat:[.45,.8],statMods:{strg:[1,1.5],dex:[.3,.5],con:[1.5,2.5]},expMods:{fat:.01,physique:2,size:1,skill:1},loot:[6]}}],S=[{name:"Frail",range:[0,10],singular:"a",pecs:"no",abs:"your imaginary abs",arms:"not much to look at",muscleGut:!1,armsSecond:"are slightly better than twigs"},{name:"Weak",range:[10,30],singular:"a",pecs:"no",abs:"your flat stomach",arms:"they're not much to look at",muscleGut:!1,armsSecond:"are slightly better than twigs"},{name:"Average",range:[30,50],singular:"an",pecs:"a little amount of",abs:"your singular muscle that is your abs",muscleGut:!1,arms:"they're about what you would expect",armsSecond:"have a a bit of meat on them"},{name:"Healthy",range:[50,80],singular:"a",pecs:"a decent amount of",abs:"the start of your soon to be six-pack abs",muscleGut:!1,arms:"they've put on some heft",armsSecond:"are starting to show more definition"},{name:"Modest",range:[80,100],singular:"a",pecs:"a modest amount of",abs:"your firm six-pack abs",muscleGut:!0,arms:"they've become bulkier",armsSecond:"are defined and showing growth"},{name:"Large",range:[100,130],singular:"a",pecs:"a generous amount of",abs:"your washboard abs",muscleGut:!0,arms:"they're more muscle than anything else",armsSecond:"have become the size of coconuts"},{name:"Herculean",range:[130,200],singular:"a",pecs:"near demi-god like",abs:"your mythical abs",muscleGut:!0,arms:"they've become near perfect",armsSecond:"have become as large as a soccer ball"},{name:"Colossal",range:[200],singular:"a",pecs:"mountain",abs:"your absolute cheese grater abs",arms:"even the gods would be jealous",muscleGut:!0,armsSecond:"look like boulders shaped by time and erosion"}],C=[{"Non-existant":{range:[0,.05],singular:"a",stomach:"there is nothing there other than",showAbs:!0}},{Thin:{range:[.05,.1],singular:"a",stomach:"there is a thin layer of fat on top of",showAbs:!0}},{Lean:{range:[.1,.15],singular:"a",stomach:"there is some fat on",showAbs:!0}},{Healthy:{range:[.15,.2],singular:"a",stomach:"you see a small bit of fat on",showAbs:!0}},{Fair:{range:[.2,.25],singular:"a",stomach:"you see a little bump sticking out from underneath your shirt",showAbs:!1}},{Pudgey:{range:[.25,.3],singular:"a",stomach:"there is some flab starting to form",showAbs:!1}},{Large:{range:[.3,.35],singular:"a",stomach:"a gut has formed slightly lifting your shirt",showAbs:!1}},{Huge:{range:[.35],singular:"a",stomach:"a mound of flesh encompases the area, eating any abs that may be underneath",showAbs:!1}}],O=[{AA:{range:[.001,.01]}},{A:{range:[.01,.02]}},{B:{range:[.02,.03]}},{C:{range:[.03,.04]}},{D:{range:[.04,.055]}},{E:{range:[.055,.07]}},{F:{range:[.07,.085]}},{G:{range:[.085,.1]}},{H:{range:[.1,.12]}},{I:{range:[.12,.13]}},{J:{range:[.13,.14]}},{K:{range:[.14,.154]}},{L:{range:[.154,.168]}},{M:{range:[.168,.182]}},{N:{range:[.182,.196]}},{O:{range:[.196,.21]}},{P:{range:[.21,.223]}},{Q:{range:[.223,.238]}},{R:{range:[.238,.252]}},{S:{range:[.252,.265]}},{T:{range:[.265,.28]}},{U:{range:[.28,.293]}},{V:{range:[.293,.31]}},{W:{range:[.31,.321]}},{X:{range:[.321,.335]}},{Y:{range:[.335,.35]}},{Z:{range:[.35]}}],A=[{Peanut:{range:[0,.05]}},{Cucumber:{range:[.05,.09]}},{Bratwurst:{range:[.09,.11]}},{Cucumber:{range:[.11,.16]}},{Baton:{range:[.16,.3]}},{"Baseball bat":{range:[.3,.5]}},{"Concrete barrier":{range:[.5,.7]}},{"Telephone pole":{range:[.7]}}],T=[{Walnut:{range:[0,.02]}},{Orange:{range:[.02,.06]}},{Cantaloupe:{range:[.06,.18]}},{Watermelon:{range:[.18,.23]}},{"Beach ball":{range:[.23,.3]}},{"Yoga ball":{range:[.3,.4]}},{"Wrecking ball":{range:[.4]}}],N=[{Male:{type:"Male",penis:!0,balls:!0,vagina:!1,breasts:!1,pronouns:0,loot:[3,4]}},{Female:{type:"Female",penis:!1,balls:!1,vagina:!0,breasts:!0,pronouns:1,loot:[5]}},{Futa:{type:"Futa",penis:!0,balls:!0,vagina:!0,breasts:!0,pronouns:3,loot:[3,4,5]}},{"Futa No Balls":{type:"Futa",penis:!0,balls:!1,vagina:!0,breasts:!0,pronouns:3,loot:[3,5]}},{"Futa No Breasts":{type:"Futa",penis:!0,balls:!0,vagina:!0,breasts:!1,pronouns:3,loot:[3,4]}},{"Futa No Breasts & No Balls":{type:"Futa",penis:!0,balls:!1,vagina:!0,breasts:!1,pronouns:3,loot:[3]}},{Cuntboi:{type:"Cuntboi",penis:!1,balls:!1,vagina:!0,breasts:!1,pronouns:2,loot:[7]}}],E=[{subjective:"he",objective:"him",possessive:"his",reflexive:"himself"},{subjective:"she",objective:"her",possessive:"hers",reflexive:"herself"},{subjective:"they",objective:"them",possessive:"theirs",reflexive:"themself"},{subjective:"shi",objective:"hir",possessive:"hirs",reflexive:"hirself"}],D=["Dragon","Fox","Wolf","Snake","Rabbit","Dog","Badger","Tiger","Bear","Mouse","Elephant","Crocodile","Alligator","Horse"].sort(),I=[{name:"Dragon"}],L=[{name:"Too Small",desc:"How was this even possible? These people were small. Tiny! They were Micros for god’s sake!\n        <br>So how did you get even smaller than they were?!\n        <br>Paws that you knew weren’t even an inch tall thundered around you like the footsteps of titans. Tails swept overhead and created gusts of wind strong enough hey threatened to lift you up off your feet! Even here, amongst the smallest people in the city you felt small.\n        <br>Insignificant.\n        <br>Powerless."},{name:"Normal",desc:"Finally, a place sized just right for you! You didn’t have to worry about giant paws slamming down on top of you or fingers curling around you to scoop you off of the ground! Hundreds of fellow small people bustled around you like an endless stream of civilization. Dozens of shops lined the roads and apartment complexes towered dozens of stories into the air! Though most of them you knew in reality were less than four feet tall. Still, it was finally a space where you could feel like a normal person! At least, as long as one of the normies didn’t come through and decide to go exploring off of the path. \n        <br>The nearby convenience store’s sign flashed brightly enough to catch your attention even from blocks down the road. The building was huge! At least, to you it was. You called it a convenience store but it was more like a department store to someone of your size. It was a small (proportionally) warehouse space that sold hundreds of products from food and drink cut down to portions for someone of your size to supplements and even some transformative products properly dosed for someone of a smaller-than-average size.\n        <br>The gym was extensive, if maybe a tiny bit demeaning. It was equipped with enough workout gear to let over a hundred people get their pump on! Even if much of the equipment was made of things like Legos, q-tips with screw washers used as weight plates and other similarly ‘makeshift’ items. But each piece of equipment, if cobbled together, was done so expertly and sturdily!"},{name:"Too Large",desc:"A toy city! Or at least that’s what it looked like to you. The tallest skyscrapers, which had to be at least a dozen stories tall to the little people down below didn’t even come up to your chin. Most of the buildings didn’t even reach past your waist. You have to be careful where you step to avoid letting any of the locals wind up underfoot. Luckily there were a few roads wide enough for you to walk through without too much difficulty. Just being here was a bit exciting for you considering that, if you forgot your actual height for a moment, walking around this district let you feel like a giant for once.\n        <br>The local shops were almost universally too small for you. Few had any accommodation whatsoever for people of your stature. Not that there was much you could imagine needing from a place like this. Luckily there were a couple of places with at least minimal allowances for someone of your size. The most notable of which being a convenience store near the station that had a pseudo drive through facing towards a parking lot that was clearly designed to let normal size people get down on hands and knees and place an order at the window based on a small billboard listing a dozen items big enough to be of interest to someone of your size. After ordering the item would be delivered through a nearby loading dock door.\n        <br>The gym was far less impressive. The chances of you being able to get even a token workout were practically non-existent unless you jogged around the block a few times. The biggest weight in the whole gym, from what you could see through the windows, was a single five pound free-weight the ‘biggest’ of the little people would use as a squat bar."}],P=[{name:"Too Small",desc:"This city center is a bit intimidating for someone of your size. Even with specially designated walkways for those small enough to risk being stepped on it was still intimidating to watch dozens of sets of huge paws thundering past on the adjacent sidewalk. And that wasn’t even taking into consideration the true giants walking down the main street bisecting the neighborhood. Any one of them could have flattened entire city blocks in the Micro Metroplex with a single step!\n        <br/>Luckily the local convenience store had a micro-friendly entrance beside the main entrance. It was a good thing, too. You doubted anyone of your size could have set off the pressure sensor and prompted the main door to open. But just because they had an entrance for your kind didn’t mean they had much inventory catering to you. The overwhelming majority of the shop’s products were sized for people of an average size rather than tiny people like you or the giants lumbering around outside.\n        <br/>Though the Gym has a similar tiny entrance for you and those of your size category the interior is little better than the convenience store. The overwhelming majority of the equipment was sized for creatures far larger than yourself. At your scale it would have taken an entire work crew and a flatbed truck to move around the lightest of the free-weights! The chances of getting an effective workout here were not very high at your size. It was quickly becoming apparent the accommodations for people of your size were meant more for you to admire the normal sized facilities rather than use them."},{name:"Normal",desc:"In a city catering to creatures ranging in size from toys to titans it was almost comforting to have a part of the city for someone of your height. You weren’t supposed to call it the ‘normal’ sized area since that implied that the little and giant people were abnormal. But it was the closest you could get to a district made for someone like you who fell into the median size range. There were still accommodations made for the other sizes, of course. There was a small, roped off section of most sidewalks designated little-only so they didn’t have to share walking space with larger people and risk getting stepped on. In addition, most shops had a smaller entrance for the little people. There wasn’t much they could do to make room for the giants, though. By definition they were the type that took up a lot of space and the best the center of town could offer was to make the city center a car-free zone and designate the roads exclusively for the giants use lest they risk stepping on people like you like you might have for the little people.\n        <br/>The convenience store in the central district had a little bit of everything; including even a few things for the other size categories. Though the overwhelming majority of those sections were nothing but merchandise. It was almost funny to see an entire shelving unit outside one of the stores holding up a single pair of shirts sized for giants. Each one was the size of a tarp! While you had your own entrance separate from the little people you still had to watch where you were going unless you wanted to be the one flattened instead of them. Occasionally one of the giants would get down on their hands and knees to peer a giant eye in the window to try and get a look at the inventory or ask one of the clerks a question. \n        <br/>The gym in the area was surprisingly popular for people of your size and hosted an extensive array of equipment. You suspected that many of the people in your size category found themselves inadequate in a city where some were big enough to juggle trucks and worked to improve their athleticism and strength to compensate. Not that the difference between being able to bench press a refrigerator instead of a broom handle or running a mile in five minutes instead of eight would make much of a difference compared to a giant who could crush said refrigerator like an empty soda can and cover the same distance any of them could run with a single step."},{name:"Too Large",desc:"This city center was supposed to be the hub for people of all sizes. Sitting as a divider between the little and giant districts it got a lot of traffic from people of all sizes. Though they put in token efforts to cater to both littles and giants it ultimately didn’t make the area any more accommodating for someone of your stature than any other normal city would. Not that they could have done much more than having the roads designated for the paw traffic of people your size. Not when the average building in the city center was barely waist-high to most giants. In the giant district it was sometimes possible for someone of your size to forget how big you were with most things there sized for your kind. So coming to a space like this was a rather pleasant reminder that you were, in fact, huge. \n        <br/>While some of the shops had merch stands in the walkways outside for people of your stature they were token efforts at best. Rarely could you find more than an oversized shirt usually either too big or too small for you saying something like “I went to the central district and left it standing!” in some cheap, half-assed attempt to poke fun at the idea that people of your size could, in fact, decimate the place if you really wanted too. The temptation was stronger sometimes; particularly when you were forced to get on your hands and knees and press your face down into the ground just so you could peer an eye into one of the shop windows and get someone’s attention if you had a question or wanted to buy something. \n        <br/>The gym was far too small for you, of course. It was almost laughable to think that anything in the large, at least by average-sized people’s standards, building could have anything inside it that would be even a remote physical challenge. You would probably get more of a workout trying to lift the building itself than any of its equipment. If you wanted an effective workout this was definitely not the place to go at your size."}],z=[{name:"Too Small",desc:"It was concerning to be around so many people that were so much larger than you. Sure you had seen giants before but being surrounded by dozens upon dozens of them was something else entirely. It was like a parade of living buildings were strolling their way up and down the street, many casually having conversations in voices so deep and loud that they could have blown out your eardrums if they were closer. And with multiple conversations happening at once it all melted together into a dull roar like you were surrounded by the constant sound of passing airplanes. \n        <br/>The convenience store near the station wasn’t like the shops in Variable Village. It didn’t bother catering for average-sized individuals like yourself. You had to wait until one of the giants stepped on the pressure pad to open the titanic glass doors and rush inside before the airplane hangar-sized doors slid closed behind you. You doubted they had much of anything of use to you here. Even if they did, you doubted you could have carried it out on your own.\n        <br/>The gym was similarly unwilling to cater to anyone shorter than a few stories tall. Again you had to wait for someone else to enter and slip in behind them if you wanted to get inside. The interior was sparsely equipped. It wasn’t surprising considering how much material was needed to make any kind of workout equipment big enough for someone big enough to juggle cars to make use of. The scent of sweat was much stronger as well thanks to the gallon-sized droplets of sweat that dripped off of most of the people working out there."},{name:"Normal",desc:"It was nice to be back somewhere that you didn’t have to constantly watch your step. Sure there were still people of smaller sizes that sometimes visited that might wind up underpaw. But here it was their job to watch your step not the other way around. The shops may have been few but it was still one of the only places in the country that actually had a significant number of businesses that specifically catered to people of your size. It wasn’t easy to make items big enough for someone like you, much less build a shop big enough to sell them.\n        <br/>The convenience store wasn’t exactly bursting at the seams for inventory or selection. It held far less of a variety of items than the other districts in town did. But it also was one of the only places you could actually get items like snacks and food big enough for someone of your size. It would have taken the entire stock of orange soda from the Variable Village convenience store to fill a single one of the bottled drinks displayed within. Occationally you noticed someone from a smaller size category waiting near the edge of the door for a giant to approach. When one did, they would scurry inside the store before the doors closed. If they wanted to run around the floor beneath their feet and risk getting stepped on that was their business. \n        <br/>The gym was surprisingly one of the more popular businesses around. It was rare for a giant to find anything they could actually get a decent workout with so many of your fellow bigs were eager to work up a sweat with something other than cardio. The equipment may have been a bit simple and crude, much of it looking like glorified scrap metal welded or chained together, but it was sturdy and heavy enough to work. And that was all that mattered. "},{name:"Too Large",desc:"Tiny\n        <br/>Mega City was tiny.\n        <br/>It was something you never thought you would be able to say with any level of seriousness. Even the other giants down below stared up at you with shocked, wide eyes as you loomed above them all. You could have reached down and scooped up any of the shops from the ground with ease. There was no way that you could possibly fit inside any of them much less that they would have anything of use to you. You were simply too big for even the most size-friendly city in the country. And while that was inconvenient in a lot of ways it still had one benefit that you couldn’t get enough of.\n        <br/>It made you feel POWERFUL."}],j={units:{imperial:!1,twelveHour:!1},warning:{overConsumeWarning:!0},info:{learnedAttackInfo:!0},tweak:{hyperMode:!0},skip:{consumeText:!1}};const B=JSON.parse('[{"name":"Stats","pathName":"stats"},{"name":"Experience","pathName":"exp"},{"name":"Gender","pathName":"gender"}]');var V=o.t(B,2);const R=JSON.parse('[{"name":"Strength","pathName":"strg"},{"name":"Constitution","pathName":"con"},{"name":"Dexterity","pathName":"dex"},{"name":"Health","pathName":"hlth"},{"name":"Muscle","pathName":"muscle"},{"name":"Fat","pathName":"fat"},{"name":"Size","pathName":"size"},{"name":"Agility","pathName":"agility"},{"name":"Skill","pathName":"skill"},{"name":"Penis","pathName":"penis"},{"name":"Balls","pathName":"balls"},{"name":"Breasts","pathName":"breasts"},{"name":"Height","pathName":"height"},{"name":"Hit Chance","pathName":"hit"},{"name":"Damage","pathName":"dmg"}]');var H=o.t(R,2),F=o(563),q=o(543),W=o.n(q);function J(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e,t){return t?Math.floor(e/28.35):Math.floor(e/2.54)}function G(e,t){var n="",r="",o=e.height;o=function(e,t){var n,r,o=[];t?(n=63360,r=12,e=U(e,!1)):(n=1e5,r=100);return o.push(Math.floor(e/n)),e-=o[0]*n,o.push(Math.floor(e/r)),e-=o[1]*r,o.push(Math.floor(e)),o}(o,t),n+=t?"".concat(o[0]>0?o[0]+"mi ":"").concat(o[1]>0?o[1]+"' ":"").concat(o[2],'"'):"".concat(o[0]>0?o[0]+"km ":"").concat(o[1]>0?o[1]+"m ":"").concat(o[2],"cm");var i=function(e,t){var n,r,o=[];t?(n=32e3,r=16,e=U(e,!0)):(n=1e6,r=1e3);return o.push(Math.floor(e/n)),e-=o[0]*n,o.push(Math.floor(e/r)),e-=o[1]*r,o.push(Math.floor(e)),o}(function(e){var t=Math.pow(e.height/100,2),n=(r=e.bodyFat,(100*(r=Number(r))+5.4+10.8-5.75)/1.2);var r;return n*t*1e3}(e),t);return{heightText:n,weightText:r+=t?"".concat(i[0]>0?i[0]+"t ":"").concat(i[1]>0?i[1]+"lb ":"").concat(i[2],"oz"):"".concat(i[0]>0?i[0]+"t ":"").concat(i[1]>0?i[1]+"kg ":"").concat(i[2],"g")}}function Y(e){return W().find(x,(function(t){var n=t.range;return!(n.length>1)||W().inRange(e,n[0],n[1])})).name}function Z(e){var t=e.stats.strg,n=Y(e.measurements.height),r=W().find(x,{name:n});return W().find(S,(function(e){var n=e.range,o=t/r.statBase*100;return!(n.length>1)||W().inRange(o,n[0],n[1])}))}function X(e){var t,n=J(C);try{for(n.s();!(t=n.n()).done;){var r=t.value,o=Object.keys(r)[0];if(e>=r[o].range[0]&&(1==r[o].range.length||e<r[o].range[1]))return r}}catch(e){n.e(e)}finally{n.f()}}function Q(e){var t,n=e.gender.breasts,r=J(O);try{for(r.s();!(t=r.n()).done;){var o=t.value,i=Object.keys(o)[0];if(n>=o[i].range[0]&&(1==o[i].range.length||n<o[i].range[1]))return i}}catch(e){r.e(e)}finally{r.f()}return""}function ee(e){var t,n=e.gender.penis,r=J(A);try{for(r.s();!(t=r.n()).done;){var o=t.value,i=Object.keys(o)[0];if(n>=o[i].range[0]&&(1==o[i].range.length||n<o[i].range[1]))return i}}catch(e){r.e(e)}finally{r.f()}return""}function te(e){var t,n=e.gender.balls,r=J(T);try{for(r.s();!(t=r.n()).done;){var o=t.value,i=Object.keys(o)[0];if(n>=o[i].range[0]&&(1==o[i].range.length||n<o[i].range[1]))return i}}catch(e){r.e(e)}finally{r.f()}return""}function ne(e,t){var n=(e.measurements.height-t.measurements.height)/e.measurements.height;return(n=isNaN(n)?0:n)>=.6?2:n>=.18?1:n>=0?0:n<=-.6?-2:n<0?-1:sizeId}function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return W().each(x,(function(n,r){e&&!W().includes(e,r)||t.push(n.name)})),t}function oe(e,t){var n=e.capacity,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return W().each(n[t],(function(e){r+=e.capacityAmount})),r}function ie(e){return W().filter(W().keys(e),(function(e){return!e.includes("Max")}))}function se(e,t){var n,r=(n=e.height,W().findIndex(x,(function(e){var t=e.range;return!(t.length>1)||W().inRange(n,t[0],t[1])}))+1);(0,F.logger)({newCap:r}),W().each(t,(function(e,n){(0,F.logger)({capKey:n}),n.includes("Max")&&(t[n]=r)}))}function ae(e){return function(e){if(Array.isArray(e))return ce(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||le(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function le(e,t){if(e){if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ue(e,t,n,r,o,i,s){var a,l={name:"",stats:{},exp:{},measurements:{},gender:N[o],capacity:{},statusEffect:[]},c=function(e,t){t=Array.isArray(e)?random(Math.clamp(e[0],0,x.length-1),Math.clamp(e[1],0,x.length-1)):Math.clamp(e,0,x.length-1);var n=x[t];return t++,{size:n,capacityAmount:t}}(n),u=c.size,d=c.capacityAmount,p=function(e){var t;t=Array.isArray(e)?random(Math.clamp(e[0],0,M.length-1),Math.clamp(e[1],0,M.length-1)):Math.clamp(e,0,M.length-1);var n=M[t],r=Object.keys(n)[0],o=n[r];return{bodyTypeName:r,bodyType:o}}(r),h=p.bodyTypeName,f=p.bodyType,m=f.statMods,g=f.expMods,y=[].concat(ae(f.loot),ae(u.loot),ae(l.gender[Object.keys(l.gender)[0]].loot)),v=[],w=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=le(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}(y);try{var k=function(){var e=a.value,t=!1;v.forEach((function(n,r){b[e].id===n.id&&(t=!0,v[r].qty+=1)})),t||v.push({id:b[e].id,qty:1,chnc:b[e].chnc})};for(w.s();!(a=w.n()).done;)k()}catch(e){w.e(e)}finally{w.f()}var S=Math.clamp(W().random(1,100),75,100)/100,C=Math.floor(100*S);l.measurements.height=W().random(u.range[0],u.range[1]?u.range[1]-1:1e6),l.measurements.bodyFat=W().round(W().random(f.bodyFat[0],f.bodyFat[1]),2);if(l.species=D[t],pe(l,m,e=u.statBase),i)l.name=i,l.exp={muscle:0,fat:0,pawEye:0,physique:0,agility:0,size:0,skill:0},l.credits=0,l.skillPoints=0,l.inv=[],l.attacks=de([0,1,2]),l.learnedAttacks=l.attacks,l.passives=[];else{for(var O in l.name="".concat(u.name," ").concat(h," ").concat(D[t]),g)l.exp[O]=he(l,O,g[O],e);l.loot=v,l.credits=C,l.capacityAmount=d,l.attacks=de([0,1]),l.learnedAttacks=l.attacks}return l.gender=function(e,t){var n=Object.keys(e)[0],r={penis:!!e[n].penis&&W().round(W().random(.01,.7,!0),2),balls:!!e[n].balls&&W().round(W().random(.01,.4,!0),2),breasts:!!e[n].breasts&&W().round(W().random(.001,.35,!0),3),vagina:e[n].vagina};return r.type=e[n].type,r.pronouns=t||e[n].pronouns,r}(l.gender,s),function(e){e.stats.hlth=fe(e),e.stats.maxHlth=fe(e)}(l),l.capacity={},function(e,t){var n=e.capacity,r=e.gender;n.stomachMax=t,n.stomach=[],r.balls&&(n.testiMax=t,n.testi=[]);r.vagina&&(n.wombMax=t,n.womb=[])}(l,d),l}function de(e){return W().map(e,(function(e){return{id:e,cooldown:p[e].cooldown,currCooldown:0}}))}function pe(e,t,n){W().each(t,(function(t,r){var o=W().ceil(W().random(t[0],t[1]),2);e.stats[r]=Math.ceil(n*o)}))}function he(e,t,n,r){var o=variables().settings.tweak.hyperMode,i=o?4:1;switch(t){case"muscle":return Math.round(Math.log10(e.stats.strg))*n*i;case"fat":case"physique":return Math.round(Math.log10(e.stats.con))*n*i;case"size":return W().ceil(e.measurements.height*(o?16:8));case"skill":return Math.floor(Math.log2(r))*i;case"pawEye":return Math.round(Math.log10(e.stats.acc))*n*i;case"agility":return Math.round(Math.log10(e.stats.dex))*n*i}}function fe(e){var t=e.stats.con,n=e.measurements,r=n.height,o=n.bodyFat,i=Math.ceil(r*o);return Math.ceil(t*Math.log(i)+5)}function me(e){return(e.stats.strg+e.stats.con+e.stats.dex)/4}function ge(e){switch(e){case"con":return"Constitution";case"hlth":return"Health";case"strg":return"Strength";case"def":return"Defense";case"acc":return"Accuracy";case"dex":return"Dexterity";case"muscle":return"Muscle";case"fat":return"Fat";case"size":return"Size";case"agility":return"Agility";case"pawEye":return"Paw-Eye Coordination";case"physique":return"Physique";case"skill":return"Skill";case"penis":return"Penis";case"balls":return"Balls";case"breasts":return"Breasts";case"height":return"Height";case"bodyFat":return"Body Fat"}}function ye(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return W().each((t=e.exp,W().filter(W().keys(t),(function(e){return"skill"!==e}))),(function(t){for(var r=function(e){switch(e){case"muscle":return"stats.strg";case"pawEye":return"stats.acc";case"agility":return"stats.dex";case"physique":return"stats.con";case"fat":return"measurements.bodyFat";case"size":return"measurements.height"}}(t),o=W().get(e,r);e.exp[t]>=W().get(e,r);)e.exp[t]-=W().get(e,r),W().set(e,r,W().get(e,r)+1);if(o!==W().get(e,r))switch(ge(r=W().split(r,".")[1])){case"Strength":n+="Your muscles feel stronger and feel as though you could hit harder now!<br/>";break;case"Dexterity":n+="Standing up you feel a bit lighter on your paws!<br/>";break;case"Constitution":n+="With a thump of your chest you feel much more sturdy now!<br/>";break;case"Height":n+="Getting up you're a little dizzy from your new height!<br/>";break;case"Body Fat":n+="Looking down you find your new girth!<br/>"}})),e.skillPoints+=e.exp.skill,e.exp.skill=0,n}function ve(e){e.stats.maxHlth=fe(e),e.stats.hlth=e.stats.maxHlth}function be(e,t){var n=e.loot,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return W().each(n,(function(e){var t=e.id,n=e.qty;we({id:t,qty:n=W().random(1,n)}),r.push("".concat(n," ").concat(u[t].name))})),function(e){variables().player.credits+=e}(t),r.push("".concat(t," credits")),r}function we(e){var t=e.id,n=e.qty,r=variables().player,o=W().findIndex(r.inv,{id:t});return o>-1?r.inv[o].qty+=n:r.inv.push({id:t,qty:n}),n}function ke(e){return u[e]}function xe(e){variables().player.credits-=e}function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){Oe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Oe(e,t,n){return t=function(e){var t=function(e,t){if("object"!=Me(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Me(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Me(t)?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ae(e){variables().playerCombatLog&&variables().enemyCombatLog||Te({playerCombatLog:[],enemyCombatLog:[]});var t=variables(),n=t.player,r=t.playerCombatLog,o=t.enemy,i=t.enemyCombatLog,s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.stats.hlth/e.stats.maxHlth<=.1&&W().random(0,100)<5?t:(t=W().sample(W().filter(e.attacks,{currCooldown:0})),Ce(Ce({},p[t.id]),t))}(o,{runaway:!0});!function(e,t,n,r){e.stats.dex,t.stats.dex}(n,o,Fe(n,o,e,!0,r),Fe(o,n,s,!1,i)),je(n),je(o),Ve(n),Ve(o),Be(n,e),Be(o,s),W().isBoolean(temporary().playerDead)&&(temporary().playerDead?Te({combat:!1,combatResults:"You took a blow to the head and begin to pass out. As you pass out, you feel all your experience fading away."}):Te({combat:!1,win:!0,combatResults:"You've knocked out your enemy!",foundItems:be(o,o.credits)}),variables().player.statusEffect=[])}function Te(e){W().each(e,(function(e,t){variables()[t]=e}))}function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{color:"white"};return $("<span/>").css(t).wiki(e)}function Ne(e,t,n){var r=100-$e(e,t,n),o=random(1,100);return o>r?o>=100?{hit:!0,crit:!0}:{hit:!0,crit:!1}:{hit:!1,crit:!1}}function $e(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=t.stats,s=i.con,a=i.dex,l=n.stats,c=l.con;l.dex;return r=e.direct&&!W().isEmpty(e.direct)?e.direct.hit:e.status.hit,o=a/4+r+s-c,t.skills&&(o+=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Le("hit",e);return W().each(n,(function(e){var n=e.status.mod,r=(n.type,n.min,n.max,n.amt);n.multi;t+=r})),t}(t)),W().each(W().filter(t.statusEffect,{mod:{type:"hit"}}),(function(e){var t=e.mod,n=e.finalEffect;return o+=t.amt,!n})),W().each(W().filter(n.statusEffect,{mod:{type:"hit"}}),(function(e){var t=e.name,n=(e.mod,e.finalEffect);return"Blind"===t&&(o+=15),!n})),W().clamp(W().floor(o),0,100)}function Ee(e,t){var n=e.direct,r=n.dmg,o=n.stat,i={min:Math.floor(Math.pow(t.stats[o],r.min)),max:Math.floor(Math.pow(t.stats[o],r.max))};return t.passives&&(i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=Le("dmg",e);return W().each(r,(function(e){var r=e.status.mod,o=(r.type,r.min),i=r.max,s=r.amt;r.multi?n.push({min:o,max:i,amt:s}):(o&&(t.min+=o),i&&(t.max+=i))})),W().each(n,(function(e){var n=e.min,r=e.max;e.amt;n&&(t.min*=n),r&&(t.max*=r)})),t}(t,i)),i}function De(e){return e.stats.hlth>0}function Ie(e,t){e.stats.hlth=W().clamp(e.stats.hlth-t,0,e.stats.hlth)}function Le(e,t){var n=t.passives;return W().filter(W().map(n,(function(e){return p[e]})),{status:{mod:{type:e}}})}function Pe(){var e;!function(e){W().each(e.attacks,(function(e){e.currCooldown=0}))}(variables().player),e={enemyHitDmg:!0,enemyCombatLog:!0,foundItems:!0,playerHitDmg:!0,combatResults:!0,playerCombatLog:!0,enemy:!0,willing:!0,consumeObj:!0},W().each(e,(function(e,t){delete variables()[t]})),Te({combat:!1,win:!1})}function ze(e,t){var n=e.status,r=n.type,o=n.duration,i=n.mod,s=n.dmg,a=k[r],l=a.name,c=a.finalEffect;return!!W().isEmpty(W().filter(t.statusEffect,{name:l}))&&(t.statusEffect.push({name:l,duration:o,mod:i,dmg:s,finalEffect:c}),!0)}function je(e){var t=e.statusEffect;W().remove(t,(function(e){return 0===e.duration})),W().each(t,(function(e){e.duration-=1}))}function Be(e,t){var n=t.cooldown,r=t.id;W().each(e.attacks,(function(e){e.id===r&&(e.currCooldown=n)}))}function Ve(e){var t=e.attacks;W().each(t,(function(e){e.currCooldown>0&&(e.currCooldown-=1)}))}function Re(e){temporary().playerDead=e}function He(e,t){return n=t,r=e.stats.dex,o=n.stats.dex,W().clamp(r*(200/o)/4,1,100)>=W().random(1,100);var n,r,o}function Fe(e,t,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];if(De(e)&&De(t)&&variables().combat){if(void 0!==n.runaway){if(He(e,t))return variables().combat=!1,void o.push(_e("".concat(e.name," turned tail and fled!")));i.push("".concat(e.name," tried to run, but was unable to!"))}else{var s=Ne(n,e,t),a=s.hit,l=s.crit,c=s.combatText,u=void 0===c?"":c;if(a){if(n.direct&&!W().isEmpty(n.direct)){var d=function(e,t,n){var r=Ee(e,t),o=r.min,i=r.max;return W().floor(W().random(o,i))*(n&&e.direct.dmg.crit.canCrit?e.direct.dmg.crit.critMulti:1)}(n,e,!!r&&l);if(Ie(t,d),u="Hit ".concat(t.name," for ").concat(d," damage"),n.status&&!W().isEmpty(n.status))(a=Ne({status:n.status},e,t).hit)&&ze(n,t)&&(u+=" and inflicted ".concat(k[n.status.type].name));u+="!"}else n.status&&!W().isEmpty(n.status)&&(ze(n,t)?u+="".concat(n.name," ").concat(t.name,", inflicting them with ").concat(k[n.status.type].name):u+="Nothing happened, ".concat(t.name," already has ").concat(k[n.status.type].name));i.push(u),De(t)||Re(!r)}else i.push("Missed ".concat(t.name," with ").concat(n.name,"!"))}if(!W().isBoolean(temporary().playerDead)){var p=function(e,t){var n=e.statusEffect,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return W().each(W().filter(n,(function(e){return!W().isEmpty(e.dmg)})),(function(e){var n=e.name,o=e.dmg,i=o.min,s=o.max,a=W().floor(W().random(i,s));r+=a,t.push("Took ".concat(a," damage from ").concat(n,"!"))})),r}(e,i);Ie(e,p),De(e)||(i.push("".concat(e.name," passed out!")),Re(r))}}else De(t)&&!variables().combat?i.push("Not quick enough to catch up as ".concat(t.name," runs away.")):i.push("".concat(e.name," passed out!"));o.push(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{color:"white"};return _e(W().join(e,"<br/>"),t)}(i))}function qe(e,t){var n=State.variables.time.hour+e,r=State.variables.time.min+t,o=State.variables.time.day;r/60>=1&&(n+=Math.floor(r/60),r%=60),(24==n&&r>0||n>24)&&(n-=24,(0,F.logger)(n),o+=1,(0,F.logger)(o),Ke(o)),State.variables.time={day:o,hour:n,min:r}}function We(e){return e?(t=State.variables.time.hour%12||12,n=State.variables.time.min,r=State.variables.time.hour>11?"pm":"am","".concat(t,":").concat(n>9?n:"0"+n).concat(r)):"".concat(State.variables.time.hour,":").concat(State.variables.time.min>9?State.variables.time.min:"0"+State.variables.time.min);var t,n,r}function Je(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];temporary().advanceTime=e}function Ke(e){e%7==0&&(variables().stores=d)}function Ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ge(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.convertToLargerUnits=G,window.sizeArray=re,Macro.add("attackAction",{skipArgs:!1,handler:function(){var e=variables(),t=e.player,n=e.enemy;e.player.attacks;W().each(attackList,(function(e){var r=$("<button/>").class("combat-attack-list").click((function(){Ae(e),Engine.play(passage(),!0)})).appendTo($column);r.attr("title",e.desc.atkTooltip),function(e,t){var n=t.req,r=t.currCooldown;t.desc;n&&!W().isEmpty(n)?e.addClass("disabledAttack").attr("title",n.tooltip).off():r>0?e.addClass("disabledAttack").off():e.removeClass("disabledAttack")}(r,e);var o="".concat(e.name,"<br>");if(e.direct&&!W().isEmpty(e.direct)){var i=Ee(e,t);o+="[".concat(i.min,"-").concat(i.max,"] ")}o+=e.currCooldown>0?"".concat(e.currCooldown," turn").concat(e.currCooldown>1?"s":""):"".concat($e(e,t,n),"%"),r.tooltip({track:!0,hide:{duration:500}}).wiki(o)}))}}),Macro.add("timeAction",{skipArgs:!1,tags:null,handler:function(){var e=this,t=Ue(this.args,5),n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],a=variables().player,l=$("<a/>").wiki(n);l.click(this.createShadowWrapper((function(){$.wiki(e.payload[0].contents.trim())}),(function(){if(passage()===r)temporary().advanceTime&&qe(o,i),Engine.play(r,!0);else if(qe(o,i),!function(e){var t=e.capacity;return W().every(ie(t),(function(n){return oe(e,n)<t["".concat(n,"Max")]}))}(a)&&"fight"!==r&&W().random(0,100)<20){var e=W().findIndex(x,{name:Y(a.measurements.height)}),t=e+2<=x.length-1?e+2:x.length-1;$.wiki("<<enemyMacro ".concat(e," ").concat(t,' "').concat(s,'">>')),Engine.play("fight")}else Engine.play(r)}))),$(this.output).append(l)}});o(949),o(928);function Ye(e,t,n,r){var o,i=$("<div/>").dialog({resizable:!1,height:"auto",width:400,modal:!0,draggable:!1,title:e,buttons:(o={},W().each(n,(function(e,t){o[t]=function(){var t;e&&((0,F.logger)("In button"),r&&(t=r,(0,F.logger)("In noshow"),variables().settings[t.type][t.name]=!$("#noShow").prop("checked")),e()),i.dialog("destroy")}})),o)}).append($("<span/>").wiki(t)).attr("id","modalWarning");return r&&$(".ui-dialog-buttonset").after($("<label/>").wiki("Do not show again").addClass("disable-popup-checkbox").prepend($('<input id="noShow" type="checkbox"/>'))),i}function Ze(e){return $('<span class="fa-stack fa-1x"><i class="fa fa-circle fa-stack-1x info info-back"></i><i class="fa fa-info fa-stack-1x info info-letter"></i> </span>').tooltip({track:!0,hide:{delay:100}}).attr("title",e)}function Xe(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var r in e.exp){var o=(t=e.exp[r],Array.isArray(t)?random(t[0],t[1]):t);o>0&&(n[r]=o)}return n}function Qe(e,t,n){return oe(e,n)+t>=e.capacity["".concat(n,"Max")]}function et(e,t,n){var r={consume:e,points:Xe(n),sDiff:ne(t,n)};!function(e,t,n){e.capacity[n].push(t)}(t,n,r.consume.capacity),variables().consumeObj=r,variables().consumeText=W().map(function(e){var t=[];for(var n in e)t.push("Gained +".concat(Math.ceil(e[n])," ").concat(ge(n)," to Experience"));return t}(r.points),(function(e){return e})),variables().settings.skip.consumeText?(Pe(),Engine.play(variables().return)):Engine.play("consume")}function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){ot(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ot(e,t,n){return t=function(e){var t=function(e,t){if("object"!=tt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=tt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==tt(t)?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function it(e){var t=$("#actionPanel"),n=$("#statPanel"),r=$("#lootPanel");if(n.css({display:"none"}),"loot"!==e){if("dead"!==e){if(t.data().type&&t.data().type===e)return t.data({type:"none"}),t.css({display:"none"}),void n.css({display:"flex"});t.empty(),t.wiki("<<playerActionsPanelMacro ".concat(e,">>")),t.data({type:e}),t.css({display:"flex"})}}else r.css({display:"flex"})}function st(e){var t=variables().player.attacks;return _.filter(_.map(t,(function(e){var t=e.id,n=e.currCooldown;return rt(rt({},p[t]),{},{currCooldown:n,id:t})})),{skill:e})}function at(e){return e.stats.hlth>0}function lt(e){return/[+\-*\/\^%=(),><]/.test(e)}function ct(e){return/[0-9]/.test(e)}function ut(e){return/\s/.test(e)}function dt(e){return"string"==typeof e&&!lt(e)&&!ct(e)&&!ut(e)}function pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={};function r(e,t,r,o){var i=n[e]||{};n[e]={ldp:i.ldp||r,nud:i.nud||t,led:i.led||o}}var o,i,s=0;function a(){return function(e){var t=Object.create(n[e.type]);return t.type=e.type,t.value=e.value,t}(e[s])}function l(){return s++,a()}function c(e){var t,n=a();if(l(),!n.nud)throw"Unexpected token: "+n.type;for(t=n.nud(n);e<a().ldp;){if(n=a(),l(),!n.led)throw"Unexpected token: "+n.type;t=n.led(t)}return t}function u(e,t,n,o){n=n||t,r(e,null,t,o||function(t){return{type:e,left:t,right:c(n)}})}for(i=7,r(o="-",(function(){return{type:o,right:c(i)}})),u("^",6,5),u("*",4),u("/",4),u("%",4),u("+",3),u("-",3),u(">",2),u("<",2),r(","),r(")"),r("(end)"),r("(",(function(){var e=c(2);if(")"!==a().type)throw"Expected closing parenthesis ')'";return l(),e})),r("number",(function(e){return e})),r("identifier",(function(t){if("("===a().type){var n=[];if(")"===e[s+1].type)l();else{do{l(),n.push(c(2))}while(","===a().type);if(")"!==a().type)throw"Expected closing parenthesis ')'"}return l(),{type:"call",args:n,name:t.value}}return t})),u("=",1,2,(function(e){if("call"===e.type){for(var t=0;t<e.args.length;t++)if("identifier"!==e.args[t].type)throw"Invalid argument name";return{type:"function",name:e.name,args:e.args,value:c(2)}}if("identifier"===e.type)return{type:"assign",name:e.value,value:c(2)};throw"Invalid lvalue"}));"(end)"!==a().type;)t.push(c(0));return t}Macro.add("enemyMacro",{skipArgs:!1,handler:function(){var e=this.args[0],t=this.args[1];variables().fightHeader=this.args[2];var n=ue(me(variables().player),random(0,D.length-1),[e,t],[0,4],random(0,6));variables().combat=!0,variables().enemy=n}}),window.infoBubble=Ze,Macro.add("consumeEnemy",{skipArgs:!1,handler:function(){var e=this,t=function(e){var t=e.name,n=e.species,r=e.exp,o=e.capacityAmount,i=e.measurements;return{name:t,species:n,exp:r,capacityAmount:o,measurements:i}}(this.args[0]),n=variables(),r=n.player,o=n.settings,i=o.skip,s=o.warning,a=n.return;W().each([{method:"Eat",gen:"",desc:"You shove the enemy down your gullet.",capacity:"stomach"},{method:"Anal",gen:"",desc:"You shove the enemy up your hole",capacity:"stomach"},{method:"Unbirth",gen:"vagina",desc:"You shove the enemy up your lady bits.",capacity:"womb"},{method:"Urethral",gen:"penis",desc:"You shove the enemy in your man bits",capacity:"testi"}],(function(n){if(""===n.gen||r.gender[n.gen]){var o=$("<button/>").addClass("combat-actions-button").wiki(n.method).click((function(){s.overConsumeWarning&&Qe(r,t.capacityAmount,n.capacity)?Ye("Over Capacity","You are about to go over your max capacity. If you continue you will be attacked randomly until you rest at home. <br><br>Do you wish to consume?",{Yes:function(){et(n,r,t)},No:!1},{type:"warning",name:"overConsumeWarning"}):et(n,r,t)}));Qe(r,t.capacityAmount,n.capacity)&&o.append("<i class='fa fa-exclamation-triangle consume-alert'></i>"),$(e.output).append(o)}}));var l=$("<div/>").append($("<label/>").wiki("Fast Consume ").addClass("combat-fast-consume-label").prepend($('<input id="fastConsume" type="checkbox" '.concat(i.consumeText?"checked":"","/>")).on("input",(function(e){i.consumeText=$(this)[0].checked}))).append(Ze("Skips over consume text."))).addClass("combat-fast-consume"),c=$("<button/>").wiki("Leave").addClass("combat-actions-button  combat-actions-leave").click((function(){Pe(),Engine.play(a)}));$(this.output).append(c),$(this.output).append(l)}}),Macro.add("playerActionsMacro",{skipArgs:!1,handler:function(){var e=variables(),t=e.player,n=e.enemy,r=at(t),o=at(n),i=$("<div/>").addClass("combat-actions-wrapper"),s=$("<button/>").addClass("combat-actions-button combat-actions-leave").click((function(){if(r&&o&&variables().combat)return Ae({runaway:!0}),void Engine.play(passage(),!0);r?Engine.play(variables().return):(ve(t),variables().restText=function(e,t){var n=e.capacity,r=W().filter(n,(function(e,t){return W().isArray(e)&&e.length>0}));if(r.length>0){var o=W().random(0,r.length-1),i=r[o];o=W().random(0,i.length-1);var s=i[o],a=W().findKey(n,(function(e){return W().isEqual(e,i)}));W().remove(i,(function(e,t){return t===o})),t="With a groan you roll over and reach for your head. As you pull your paw away some goo trails off a ribbon that connects to your head. <br/><br/>Gross, not sure what that is. Better get cleaned up before doing anything else. <br/><br/>On your way to the restroom you notice your ".concat(function(e){switch(e){case"stomach":return"stomach";case"testi":return"balls";case"womb":return"womb"}}(a)," is feeling lighter than before you passed out. The ").concat(s.name," feels like they either escaped or was taken from you. Damn.<br/>")}else t="Your eyes flutter open, a little confused at where you are. Looking around, someone or something has brought you back home. <br/><br/>You're covered in goo? No, it's something else. <br/><br/>You decide it's probably not a good idea to think about it and to just take a shower. Getting up you're a bit stiff and slowly make your way to the restroom.<br/><br/>After a quick shower you're feeling a little more refreshed, but could be better.<br/>";return variables().player.credits>0&&(variables().player.credits=variables().player.credits>0?W().ceil(.75*variables().player.credits):variables().player.credits,t+="<br/>As you gather yourself you notice that your coin purse is a little lighter as well. Damn cutpurse.<br/>"),t}(t),Engine.play("home")),Pe()}));if(r&&o&&variables().combat){var a=$("<button/>").addClass("combat-actions-button combat-actions-attack").wiki("Attacks").click((function(){it("attack")})).appendTo(i);0===st(!1).length&&a.addClass("disabledAttack").off();var l=$("<button/>").addClass("combat-actions-button combat-actions-skills").wiki("Skills").click((function(){it("skill")})).appendTo(i);0===st(!0).length&&l.addClass("disabledAttack").off(),s.wiki("Run").appendTo(i)}i.appendTo(this.output),r?o?variables().combat||s.wiki("Leave").appendTo(i):(it("loot"),i.wiki("<<consumeEnemy $enemy>>")):(s.wiki("Pass Out").appendTo(i),it("dead"))}});var ht={"+":function(e,t){return e+t},"-":function(e,t){return void 0===t?-e:e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"%":function(e,t){return e%t},"^":function(e,t){return Math.pow(e,t)},">":function(e,t){return e>t},"<":function(e,t){return e<t}},ft={sin:Math.sin,cos:Math.cos,tan:Math.cos,asin:Math.asin,acos:Math.acos,atan:Math.atan,abs:Math.abs,round:Math.round,ceil:Math.ceil,floor:Math.floor,log:Math.log,exp:Math.exp,sqrt:Math.sqrt,max:Math.max,min:Math.min,random:Math.random};function mt(e,t,n){return function(e,t,n){var r={},o={pi:Math.PI,e:Math.E,attackerHeight:t.measurements.height,defenderHeight:n.measurements.height};function i(e){if("number"===e.type)return e.value;if(ht[e.type])return e.left?ht[e.type](i(e.left),i(e.right)):ht[e.type](i(e.right));if("identifier"===e.type){var t=r.hasOwnProperty(e.value)?r[e.value]:o[e.value];if(void 0===t)throw e.value+" is undefined";return t}if("assign"===e.type)o[e.name]=i(e.value);else{if("call"===e.type){for(var n=0;n<e.args.length;n++)e.args[n]=i(e.args[n]);return ft[e.name].apply(null,e.args)}"function"===e.type&&(ft[e.name]=function(){for(var t=0;t<e.args.length;t++)r[e.args[t].value]=arguments[t];var n=i(e.value);return r={},n})}}for(var s="",a=0;a<e.length;a++){var l=i(e[a]);void 0!==l&&(s+=l)}return s}(pt(function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=function(){return n=e[++r]},i=function(e,n){t.push({type:e,value:n})};r<e.length;)if(ut(n=e[r]))o();else if(lt(n))i(n),o();else if(ct(n)){for(var s=n;ct(o());)s+=n;if("."===n)do{s+=n}while(ct(o()));if(s=parseFloat(s),!isFinite(s))throw"Number is exceeds 64-bit double bounds.";i("number",s)}else{if(!dt(n))throw"Unrecognized token.";for(var a=n;dt(o());)a+=n;i("identifier",a)}return i("(end)"),t}(e)),t,n)}function gt(e){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gt(e)}function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach((function(t){bt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bt(e,t,n){return t=function(e){var t=function(e,t){if("object"!=gt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==gt(t)?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e){var t=variables().player.attacks;return W().filter(W().map(t,(function(e){var t=e.id,n=e.currCooldown;return vt(vt({},p[t]),{},{currCooldown:n,id:t})})),{skill:e})}function kt(e,t,n){W().each(e,(function(e,r){if(!(r<4))return!1;xt(e,(r+1)%2?t:n)}))}function xt(e,t){var n=variables(),r=n.player,o=n.enemy,i=$("<button/>").addClass("combat-actions-panel-button").click((function(){Ae(e),Engine.play(passage(),!0)})).appendTo(t);i.attr("title",e.desc.atkTooltip),function(e,t){var n,r=t.requirements.conditions,o=t.currCooldown;t.desc;W().each(r,(function(e){var t,r=e.reqCondition,o=e.failText;if(!("true"===(t=mt(r,variables().player,variables().enemy))||"false"===t?JSON.parse(t):t))return n=o,!1})),n&&!W().isEmpty(n)?e.addClass("disabledAttack").attr("title",n).off():o>0?e.addClass("disabledAttack").off():e.removeClass("disabledAttack")}(i,e);var s="".concat(e.name,"<br>");if(e.direct&&!W().isEmpty(e.direct)){var a=Ee(e,r);s+="[".concat(a.min,"-").concat(a.max,"] ")}s+=e.currCooldown>0?"".concat(e.currCooldown," turn").concat(e.currCooldown>1?"s":""):"".concat($e(e,r,o),"%"),i.tooltip({track:!0,hide:{duration:500}}).wiki(s)}function Mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return St(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return St(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function St(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Macro.add("playerActionsPanelMacro",{skipArgs:!1,handler:function(){var e=this.args[0],t=$("<div/>").addClass("combat-actions-panel-wrapper"),n=$("<div/>").addClass("combat-actions-panel-left"),r=$("<div/>").addClass("combat-actions-panel-right"),o=[];switch(e){case"attack":(o=wt(!1)).length>0?kt(o,n,r):n.wiki("No Attacks");break;case"skill":(o=wt(!0)).length>0?kt(o,n,r):n.wiki("No Skills");break;case"dead":break;default:(0,F.logger)("Default Panel Type")}t.append(n).append(r).appendTo(this.output),$(this.output).addClass("full-width")}}),Macro.add("combatMessageMacro",{skipArgs:!1,handler:function(){var e=Mt(this.args,2),t=e[0],n=e[1],r=$("<div/>").addClass("combat-message combat-message-"+[n]);t?r.append(_.last(t)):r.css({display:"none"}),$(this.output).append(r)}});o(915);function Ct(e){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ct(e)}function Ot(e,t){var n;for(var r in e){if("object"!==Ct(e[r])||Array.isArray(e[r])||(n=Ot(e[r],t)),void 0!==n)return n;if(r===t)return e[r]}}function At(e){var t=variables().player;return"hlth"===e.stat&&e.mod+t.stats.hlth>t.stats.maxHlth?(t.stats.hlth=t.stats.maxHlth,!1):"size"===e.stat?(t.measurements.height+=e.mod,!0):(t[e.type][e.stat]+=e.mod,t.stats.maxHlth=fe(t),function(e){var t=e.gender,n=t.penis,r=t.balls,o=t.vagina,i=e.capacity,s=i.wombMax,a=i.testiMax;n>0&&r>0&&W().isUndefined(a)&&(e.capacity.testi=[],e.capacity.testiMax=0),o&&W().isUndefined(s)&&(e.capacity.womb=[],e.capacity.wombMax=0),se(e.measurements,e.capacity)}(t),!0)}function Tt(e,t){t[e].qty-=1,0==t[e].qty&&t.splice(e,1)}function _t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $t(e,t){we({id:e[0],qty:1}),xe(e[2]),function(e,t){t[e].qty-=1}(e[3],t)}Macro.add("combatReset",{skipArgs:!1,handler:function(){Pe(),this.args[0]&&(!function(){for(var e in State.variables.player.exp)variables().player.exp[e]=0;for(var t in State.variables.player.capacity)t.contains("Max")||(variables().player.capacity[t]=0)}(),variables().player.stats.hlth=1)}}),Macro.add("attackSkill",{skipArgs:!1,handler:function(){var e=$("<span/>"),t=variables().player;e.append($("<span/>").wiki("''__Self Defence Class__''"));var n=$("<table/>").addClass("skillTable").addClass("skillTable"),r=[["Attack","Description","Requirements","Points"]];return W().each(p,(function(e,n){var o=e.name,i=e.desc.baseDesc,s=e.skillPoints;e.reqs;(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return W().each(t.learnedAttacks,(function(t){if(t.id===e)return n=!0,!1})),n||t.passives.includes(e)})(n,t)||r.push([o,i,s,n,""])})),$.each(r,(function(e,r){var o=$("<tr/>").attr("id","attack-".concat(r[3]));if(e>0){o.append($("<td/>").wiki(r[0])),o.append($("<td/>").wiki(r[1]));var i="";$.each(r[4],(function(e,t){""!==i&&(i+="<br>"),i+="".concat(ge(e),": ").concat("height"===e?Y(t):t)})),o.append($("<td/>").wiki(""!==i?i:"None"));var s=$(document.createElement("button")).wiki(r[2]).addClass("inactiveButton");t.skillPoints>=r[2]&&function(e,t){for(var n in e)if(e[n]>Ot(t,n))return!1;return!0}(r[4],t)&&s.ariaClick((function(e){if(variables().player.skillPoints>=r[2]){var t=p[r[3]];t.passive?variables().player.passives.push(r[3]):variables().player.learnedAttacks.push({id:r[3],cooldown:t.cooldown,currCooldown:0}),variables().player.skillPoints-=r[2],$("#attack-".concat(r[3])).remove(),$("<li/>").wiki("''".concat(r[0],"'' - ").concat(r[1])).hide().appendTo("ul.no-bullets").fadeIn(1e3).fadeOut(1e3).fadeIn(1e3),variables().settings.info.learnedAttackInfo&&!t.passive&&Ye("Learned ".concat(r[0]),"You learned ".concat(r[0],"! <br><br>To equip you'll need to go Home and change your moveset."),{Ok:function(){}},{type:"info",name:"learnedAttackInfo"})}else"You don't have enough Skill Points!"})).removeClass("inactiveButton"),o.append($("<td/>").addClass("fullSizeTableButton").append(s))}else $.each(r,(function(e,t){o.append($("<th/>").wiki(t))}));n.append(o)})),e.append($("<p/>").attr("id","notificationText").addClass("red-text").hide()).append(n).appendTo(this.output),e}}),Macro.add("invMacro",{skipArgs:!1,handler:function(){var e=State.variables.player.inv,t=$("<table/>").addClass("inventoryTable"),n=$("<span/>"),r=[["Item","Description","Quantity","",""]];e.forEach((function(e,t){r.push([ke(e.id),e.qty,t])})),$.each(r,(function(n,r){var o=$("<tr/>");if(n>0){o.append($("<td/>").wiki(r[0].name)),o.append($("<td/>").wiki(r[0].desc)),o.append($("<td/>").wiki(r[1]));var i=$(document.createElement("button")).wiki("Use").ariaClick((function(t){var n="";r[1]>0?At(r[0])?(Tt(r[2],e),n="Buffed ".concat(ge(r[0].stat)," by ").concat(r[0].mod)):n="Health is already full":n="".concat(r[0].name," is not in  inventory"),State.variables.invText=n,Engine.play(passage(),!0)}));o.append($("<td/>").append(i));var s=$(document.createElement("button")).wiki("Use All").ariaClick((function(t){var n="",o=0;if(r[1]>0){for(var i=0;i<r[1];i++){At(r[0])&&(Tt(r[2],e),o++)}n="Used "+o+" ".concat(r[0].name,"(s) and buffed ").concat(ge(r[0].stat)," by ").concat(r[0].mod*o)}else n="".concat(r[0].name," is not in  inventory");State.variables.invText=n,Engine.play(passage(),!0)}));o.append($("<td/>").append(s))}else $.each(r,(function(e,t){o.append($("<th/>").wiki(t))}));t.append(o)})),n.attr("id","macro-".concat(this.name)).append(t).appendTo(this.output)}}),Macro.add("skillPassage",{skipArgs:!1,handler:function(){var e=$("<div/>").addClass("skills-grid");e.append($("<div/>").wiki("''__Learned Skills__''").addClass("grid-header"));var t=variables().player.passives;W().each(t,(function(t){var n=p[t],r=n.name,o=n.desc.baseDesc;e.append($("<div/>").wiki("''".concat(r,"''"))),e.append($("<div/>").wiki("".concat(o)))})),e.appendTo(this.output)}}),Macro.add("cityMacro",{skipArgs:!1,handler:function(){var e=variables().player,n=_t(this.args,3),r=n[0],o=n[1],i=n[2],s=function(e,t,n){var r=n.measurements.height,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=W().findIndex(x,{name:Y(r)});return e>i&&(o=0),t<i&&(o=2),o}(r,o,e),a=$("<span/>");a.wiki(t[i][s].desc),a.appendTo(this.output)}}),Macro.add("storeItem",{skipArgs:!1,handler:function(){var e=this.args[0].stock,t=$("<table/>").addClass("storeTable"),n=$("<span/>"),r=[["Item","Description","Quantity","Price","",""]];e.forEach((function(e,t){r.push([e.id,e.qty,e.price,t])})),$.each(r,(function(n,r){var o=$("<tr/>");if(n>0){o.append($("<td/>").wiki(ke(r[0]).name)),o.append($("<td/>").wiki(ke(r[0]).desc)),o.append($("<td/>").wiki(r[1])),o.append($("<td/>").wiki(r[2]));var i=$(document.createElement("button")).wiki("Buy").ariaClick((function(t){var n="";r[1]>0?State.variables.player.credits>=r[2]?($t(r,e),n="Bought 1 ".concat(ke(r[0]).name,"!")):n="Not enough credits for ".concat(ke(r[0]).name):n="".concat(ke(r[0]).name," is not in stock"),State.variables.storeText=n,Engine.play(passage(),!0)}));o.append($("<td/>").append(i));var s=$(document.createElement("button")).wiki("Buy max").ariaClick((function(t){var n="",o=0;if(r[1]>0){for(var i=0;i<r[1];i++)State.variables.player.credits>=r[2]&&($t(r,e),o++);n="Bought "+o+" ".concat(r[0].name,"(s)")}else n="".concat(ke(r[0]).name," is not in stock");State.variables.storeText=n,Engine.play(passage(),!0)}));o.append($("<td/>").append(s))}else $.each(r,(function(e,t){o.append($("<th/>").wiki(t))}));t.append(o)})),n.attr("id","macro-".concat(this.name)).append(t).appendTo(this.output)}}),Macro.add("consumeMacro",{skipArgs:!1,handler:function(){var e=variables(),t=e.enemy,n=e.consumeObj,r=e.consumeText,o=$("<h1/>").wiki("".concat(n.consume.method,"ing ").concat(t.name)),i=$("<span/>"),s=$("<span/>");if(temporary().enemyText={sizeLC:W().lowerFirst(Y(t.measurements.height))},"Eat"!==n.consume.method)i.wiki(n.consume.desc);else switch(n.sDiff){case 2:i.wiki(h[n.consume.method]);break;case 1:i.wiki(f[n.consume.method]);break;case 0:i.wiki(m[n.consume.method]);break;case-1:i.wiki(g[n.consume.method]);break;case-2:i.wiki(y[n.consume.method])}W().each(r,(function(e){s.append($("<span/>"))})),o.appendTo(this.output),i.appendTo(this.output),s.appendTo(this.output)}});o(191);const Et=JSON.parse('{"name":"Attack Skills","dataName":"attackSkill","propName":"","type":"Array","field":{},"header":false,"children":[{"name":"Name","propName":"name","type":"String","field":{},"header":true,"children":[]},{"name":"Skill","propName":"skill","type":"Boolean","field":{"data":[{"selection":"Yes","value":true},{"selection":"No","value":false}],"displayProp":"selection","dataProp":"value"},"header":true,"children":[]},{"name":"Passive","propName":"passive","type":"Boolean","field":{"data":[{"selection":"Yes","value":true},{"selection":"No","value":false}],"displayProp":"selection","dataProp":"value"},"header":true,"children":[]},{"name":"Cooldown","propName":"cooldown","type":"Number","field":{},"header":false,"children":[]},{"name":"Skill Points","propName":"skillPoints","type":"Number","field":{},"header":false,"children":[]},{"name":"Descriptions","propName":"desc","type":"Object","deep":true,"field":{"type":"Section","sectionLevel":2},"header":false,"children":[{"name":"Base Description","propName":"baseDesc","type":"String","field":{"type":"TextArea"},"header":false,"children":[]},{"name":"Crit Description","propName":"critDesc","type":"String","field":{"type":"TextArea"},"header":false,"children":[]},{"name":"Attack Tooltip","propName":"atkTooltip","type":"String","field":{"type":"TextArea"},"header":false,"children":[]},{"name":"Stat Modifier Descriptions","propName":"statMods","type":"Array","field":{},"header":false,"children":[{"name":"Stat Name","propName":"stat","type":"String","field":{},"header":true,"children":[]}]},{"name":"Requirement Descriptions","propName":"reqs","type":"Array","field":{},"header":false,"children":[{"name":"Requirement Desc","propName":"req","type":"String","field":{},"header":true,"children":[]}]}]},{"name":"Direct Attack","propName":"direct","type":"Object","field":{"type":"Section","sectionLevel":2,"hasAdd":true},"header":false,"children":[{"name":"Hit","propName":"hit","type":"Number","field":{},"header":false,"children":[]},{"name":"Stat Modifier","propName":"stat","type":"String","field":{"type":"Dropdown","data":"stats","displayProp":"name","dataProp":"pathName"},"header":false,"children":[]},{"name":"Damage","propName":"dmg","deep":true,"type":"Object","field":{"type":"Section","sectionLevel":3},"header":false,"children":[{"name":"Minimum","propName":"min","type":"Number","field":{},"header":false,"children":[]},{"name":"Maximum","propName":"max","type":"Number","field":{},"header":false,"children":[]},{"name":"Crit","propName":"crit","deep":true,"type":"Object","field":{"type":"Section","sectionLevel":3},"header":false,"children":[{"name":"Can Crit","propName":"canCrit","type":"Boolean","field":{"data":[{"selection":"Yes","value":true},{"selection":"No","value":false}],"displayProp":"selection","dataProp":"value"},"header":false,"children":[]},{"name":"Multiplier","propName":"critMulti","type":"Number","field":{},"header":false,"children":[]}]}]}]},{"name":"Status Effect","propName":"status","type":"Object","field":{"type":"Section","sectionLevel":2,"hasAdd":true},"header":false,"children":[{"name":"Hit","propName":"hit","type":"Number","field":{},"header":false,"children":[]},{"name":"Duration","propName":"duration","type":"Number","field":{},"header":false,"children":[]},{"name":"Status Type","propName":"type","type":"Number","field":{"type":"Dropdown","data":"statusEffect","displayProp":"name"},"header":false,"children":[]},{"name":"Stat Modifier","propName":"stat","type":"String","field":{"type":"Dropdown","data":"stats","displayProp":"name","dataProp":"pathName"},"header":false,"children":[]},{"name":"Modifier","propName":"mod","deep":true,"type":"Object","field":{"type":"Section","sectionLevel":3,"hasAdd":true},"header":false,"children":[{"name":"Amount","propName":"amt","type":"Number","field":{},"header":false,"children":[]},{"name":"Type","propName":"type","type":"String","field":{"type":"Dropdown","data":"stats","displayProp":"name","dataProp":"pathName"},"header":false,"children":[]},{"name":"Is Multiplier","propName":"multi","type":"Boolean","field":{"data":[{"selection":"Yes","value":true},{"selection":"No","value":false}],"displayProp":"selection","dataProp":"value"},"header":false,"children":[]},{"name":"Effects Minimum","propName":"min","type":"Boolean","field":{"data":[{"selection":"Yes","value":true},{"selection":"No","value":false}],"displayProp":"selection","dataProp":"value"},"header":false,"children":[]},{"name":"Effects Maximum","propName":"max","type":"Boolean","field":{"data":[{"selection":"Yes","value":true},{"selection":"No","value":false}],"displayProp":"selection","dataProp":"value"},"header":false,"children":[]}]},{"name":"Damage","propName":"dmg","deep":false,"type":"Object","field":{"type":"Section","sectionLevel":3,"hasAdd":true},"header":false,"children":[{"name":"Minimum Damage","propName":"min","type":"Number","field":{},"header":false,"children":[]},{"name":"Maximum Damage","propName":"max","type":"Number","field":{},"header":false,"children":[]},{"name":"Crit","propName":"crit","deep":true,"type":"Object","field":{"type":"Section","sectionLevel":4},"header":false,"children":[{"name":"Can Crit","propName":"canCrit","type":"Boolean","field":{"data":[{"selection":"Yes","value":true},{"selection":"No","value":false}],"displayProp":"selection","dataProp":"value"},"header":false,"children":[]},{"name":"Multiplier","propName":"critMulti","type":"Number","field":{},"header":false,"children":[]}]}]}]},{"name":"Requirements","propName":"requirements","type":"Object","field":{"type":"Section","sectionLevel":2,"hasAdd":true},"header":false,"children":[{"name":"Conditions","propName":"conditions","type":"Array","field":{},"header":false,"children":[{"name":"Condition","propName":"reqCondition","type":"String","field":{},"header":true,"children":[]},{"name":"Fail Text","propName":"failText","type":"String","field":{},"header":true,"children":[]}]}]}]}'),Dt=JSON.parse('{"name":"Status Effect","dataName":"statusEffect","propName":"","type":"Array","field":{},"header":false,"children":[{"name":"Name","propName":"name","type":"String","field":{},"header":true,"children":[]},{"name":"Final Effect","propName":"finalEffect","type":"Boolean","field":{"data":[{"selection":"Yes","value":true},{"selection":"No","value":false}],"displayProp":"selection","dataProp":"value"},"header":true,"children":[]}]}'),It=JSON.parse('{"name":"Stores","dataName":"stores","propName":"","type":"Array","header":false,"children":[{"name":"Store Name","propName":"name","type":"String","field":{},"header":true,"children":[]},{"name":"Stock","propName":"stock","type":"Array","field":{},"header":false,"children":[{"name":"Item Name","propName":"id","type":"Number","field":{"type":"Dropdown","data":"items","displayProp":"name","dataProp":"index"},"header":true,"children":[]},{"name":"Quantity","propName":"qty","type":"Number","field":{},"header":true,"children":[]},{"name":"Price","propName":"price","type":"Number","field":{},"header":true,"children":[]}]}]}'),Lt=JSON.parse('{"name":"Items","dataName":"items","propName":"","type":"Array","header":false,"children":[{"name":"Item Name","propName":"name","type":"String","field":{},"header":true,"children":[]},{"name":"Modifier","propName":"mod","type":"Number","field":{},"header":true,"children":[]},{"name":"Type","propName":"type","type":"String","field":{"type":"Dropdown","data":"statTypes","displayProp":"name","dataProp":"pathName"},"header":false,"children":[]},{"name":"Stat","propName":"stat","type":"String","field":{"type":"Dropdown","data":"stats","displayProp":"name","dataProp":"pathName"},"header":true,"children":[]}]}');function Pt(e){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pt(e)}function zt(e,t,n){var r={name:"",propName:"",type:"",field:{},header:!1,children:[]};switch(Pt(t)){case"number":r.propName=n,r.type="Number",e=r;break;case"object":var o;Array.isArray(t)?(o="Array",t=t[0]):o="Object",_.each(t,(function(e,t){r.children.push(zt([],e,t))})),r.type=o,r.propName=n||"",e=r;break;case"string":r.propName=n,r.type="String",e=r;break;case"boolean":r.propName=n,r.type="Boolean",e=r;break;case"function":r.propName=n,r.type="Function",e=r;break;default:logger("default")}return e}function jt(e){var t=e.$parent,n=e.dataMap,r=e.data,o=e.name,i=e.title,s=e.btns,a=s.hasDelete,l=s.hasAdd,c=e.rowCallback,u=e.dataCallback,d=e.editable,p=$("<table/>").attr("id","".concat(o,"-table")).attr("name",o).addClass("dataEditorTable"),h=$("<tr/>").appendTo(p);return _.each(n.children,(function(e){e.header&&h.append($("<th/>").attr("id","".concat(e.propName,"-column")).wiki(e.name))})),a&&h.append($("<th/>").attr("id","delete-column")),_.each(r,(function(e){Bt({$table:p,data:e,dataMap:n.children,btns:{hasDelete:a},rowCallback:c,dataCallback:u,editable:d,name:o})})),i&&t.append($("<span/>").wiki(i)),t.append(p),l&&Ht({type:"Add",icon:"fa-plus",style:{float:"right",width:"35px","border-radius":"5px","margin-right":"3px"},callback:function(){Bt({$table:p,data:l(n),dataMap:n.children,btns:{hasDelete:!0},rowCallback:c,dataCallback:u,editable:d,name:o})}}).appendTo(t),p}function Bt(e){var t=e.$table,r=e.data,o=e.dataMap,i=e.name,s=e.btns.hasDelete,a=e.rowCallback,l=e.editable,c=$("<tr/>").addClass("dataRow").data(r);_.each(o,(function(e){var s=e.header,u=e.propName,d=e.type,p=e.field;if(s){var h=$("<td/>").attr("name",u);a&&h.addClass("dataCell").click((function(){return a({$table:t,$row:c,data:c.data(),dataMap:o,name:i})})),l?qt({$parent:h,type:d,field:p,dataObj:n[p.data],data:r[u],style:{wrapper:{},input:{width:"93%"}},callback:function(e){c.data()[u]=e}}):h.wiki(r[u]),c.append(h)}})),s&&c.append($("<td/>").append(Ht({type:"Delete",icon:"fa-times",style:{border:"0px"},callback:function(){c.remove()}}))),t.append(c)}function Vt(e){var t=e.$row,n=e.data;t.data(n),$("td",t).each((function(){$(this).attr("name")&&($(this).text(""),$(this).wiki(n[$(this).attr("name")]))}))}function Rt(e){var t=e.$parent,n=e.$menuParent,r=e.label,o=e.name,i=e.data,s=e.prop,a=e.displayProp,l=e.selectedData,c=e.callback,u=e.style,d=(u.wrapper,u.input,$("<div/>")),p=$('<select name="'.concat(o,'"/>'));return r&&d.append($("<label for=".concat(o,"/>")).wiki(r)),d.append(p),d.appendTo(t),p.selectmenu({appendTo:n,width:200}),W().each(i,(function(e,t){p.append($('<option value="'.concat(void 0!==e[s]?e[s]:t,'"/>')).wiki(e[a||s]))})),c&&p.selectmenu({select:function(e,t){var n=t.item.value;c(isNaN(n)?n:Number(n))}}),p.selectmenu("refresh",!0),null!=l&&p.val(l.toString()).selectmenu("refresh",!0),p}function Ht(e){var t=e.type,n=e.icon,r=e.text,o=e.style,i=e.callback,s=$('<Button type="button"/>');if(s.css(o||{}),s.click(i),n&&s.append($("<i/>").addClass("fa ".concat(n))),s.wiki(r||""),"Delete"===t)s.addClass("button-delete");return s}function Ft(e){var t=e.type,n=e.label,r=e.prop,o=e.data,i=e.style,s=(i.wrapper,i.input,e.callback),a=$("<div/>"),l=$("<input/>").attr("type",t).attr("name",r);return(o||0===o)&&l.val(o),n&&a.append($("<label/>").attr("for",r).wiki(n)),s&&l.change((function(){s("number"===t?Number($(this).val()):$(this).val())})),a.append(l)}function qt(e){var t=e.$parent,r=e.type,o=e.field,i=e.data,s=e.dataObj,a=e.prop,l=e.label,c=e.map,u=e.style,d=e.callback;switch(o.type||r){case"String":t.append(Ft({type:"text",prop:a,label:l,data:i,style:u,callback:d}));break;case"TextArea":t.append(function(e){var t=e.label,n=e.prop,r=e.data,o=e.style,i=(o.wrapper,o.input,e.callback),s=$("<div/>"),a=$("<textarea/>").attr("name",n);return(r||0===r)&&a.text(r),t&&s.append($("<label/>").attr("for",n).wiki(t)),i&&a.change((function(){i($(this).val())})),s.append(a)}({label:l,prop:a,data:i,style:u,callback:d}));break;case"Number":t.append(Ft({type:"number",prop:a,label:l,data:i,style:u,callback:d}));break;case"Dropdown":Rt({$parent:t,$menuParent:t,label:l,prop:o.dataProp,displayProp:o.displayProp,data:s,selectedData:i,name:a,style:u,callback:d});break;case"Boolean":Rt({$parent:t,$menuParent:t,label:l,prop:o.dataProp,displayProp:o.displayProp,data:o.data,selectedData:i,name:a,style:u,callback:d});break;case"Section":t.append(function(e){var t=e.label,r=e.map,o=e.prop,i=e.data,s=e.field.sectionLevel,a=e.field,l=$("<div/>").wiki("".concat(W().repeat("!",s),"__").concat(t,"__")),c=$("<div/>").attr("name",o).append(l).data(i);if(a.hasAdd)var u=Ht({type:"Add",icon:"fa-plus",callback:function(){var e=Wt({children:r.children,deep:!0});c.data(e),e&&W().each(r.children,(function(t){var r=t.name,o=t.propName,i=t.type,s=t.field,a=t.children;qt({$parent:c,data:e[o],dataObj:n[s.data],type:i,field:s,prop:o,label:"".concat(r,": "),map:{children:a},style:{wrapper:!1,input:!1},callback:function(e){c.data(o,e)}})})),$(this).css("display","none"),d.css("display","block")}}).appendTo(l),d=Ht({type:"Delete",icon:"fa-times",callback:function(){c.removeData(),l.siblings().remove(),$(this).css("display","none"),u.css("display","block")}}).appendTo(l);return i&&!W().isEmpty(i)&&W().each(r.children,(function(e){var t=e.name,r=e.propName,o=e.type,s=e.field,a=e.children;qt({$parent:c,data:i[r],dataObj:n[s.data],type:o,field:s,prop:r,label:"".concat(t,": "),map:{children:a},style:{wrapper:!1,input:!1},callback:function(e){c.data(r,e)}})})),c}({label:l,map:c,prop:a,data:i,field:o,dataObj:s}));break;case"Array":jt({$parent:t,dataMap:c,data:i,name:a,title:l,btns:{hasAdd:Wt,hasDelete:!0},editable:function(){},dataCallback:d,field:o})}}function Wt(e){var t=e.children,n=(e.deep,e.response),r=void 0===n?{}:n;return W().each(t,(function(e){var t=e.propName,n=e.type,o=e.children,i=e.deep;switch(n){case"String":r[t]="New Data";break;case"Number":r[t]=0;break;case"Boolean":r[t]=!1;break;case"Object":r[t]=i?Wt({children:o,deep:i}):null}})),r}function Jt(e){var t=e.type,n=e.response;return"Array"===t&&(n=[],$(".dataEditorTable > tr.dataRow").each((function(){n.push($(this).data())}))),n}function Kt(e){var t=e.$row,r=e.data,o=e.dataMap,i=e.name,s=$('<form id="formEditor"/>').dialog({modal:!0,title:i,resizeable:!0,width:800,height:600,buttons:{Save:function(){Vt({$row:t,data:Ut({$form:a,data:r})})},"Save & Close":function(){Vt({$row:t,data:Ut({$form:a,data:r})}),s.remove()}},close:function(e,t){s.remove()}}),a=$("<form/>");W().each(o,(function(e){var t=e.name,o=e.propName,i=e.type,s=e.field,l=e.children;qt({$parent:a,data:r[o],dataObj:n[s.data],type:i,field:s,name:t,prop:o,label:"".concat(t,": "),map:{children:l},style:{wrapper:!1,input:!1}})})),s.append(a)}function Ut(e){var t=e.$form,n=e.data;return t.find("> div[name]").each((function(){n[$(this).attr("name")]=$(this).data(),Ut({$form:$(this),data:n[$(this).attr("name")]})})),t.find("> div > input").each((function(){n[$(this).attr("name")]=Gt($(this).val())})),t.find("> div > select").each((function(){var e;n[$(this).attr("name")]="true"===(e=Gt($(this).val()))||"false"===e?JSON.parse(e):e})),t.find("> table").each((function(e){var t=e.arr,r=void 0===t?[]:t;(0,F.logger)($(this).text()),(0,F.logger)(n),$(this).find("tr.dataRow").each((function(){r.push($(this).data())})),n[$(this).attr("name")]=r})),n}function Gt(e){var t=parseFloat(e);return isNaN(t)?e:t}function Yt(e){return function(e){if(Array.isArray(e))return Zt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xt(e){return Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xt(e)}function Qt(){var e=$('<div id="stateEditor"/>').dialog({title:"State Editor",resizeable:!0,width:360,height:600,close:function(t,n){e.remove()}}),t=function(e,t,n){var r=$('<label for="'.concat(n,'"/>')).wiki("".concat(t,": ")),o=$('<select id="'.concat(n,'" name="').concat(n,'"/>')),i=$("<div/>").append(r).append(o);return e.append(i),o.selectmenu({width:200}),o}(e,"Variable","testDropdow"),n=$('<div id="fieldContainer"/>');e.append(n),function(e,t){for(var n in t)e.append($("<option/>").wiki(n));e.selectmenu("refresh")}(t,variables()),t.selectmenu({select:function(e,t){n.empty(),en(n,[t.item.value],variables()[t.item.value])}});var r=Object.keys(variables())[0];return en(n,[r],variables()[r]),e}function en(e,t,n,r,o){var i=t[t.length-1];if(o&&(i="".concat(i,"-").concat(o)),"string"==typeof n){var s=$("<div/>");r||s.append($('<label for="'.concat(i,'-text"/>')).wiki("".concat(i,": "))),s.append($('<input type="text" id="'.concat(i,'-text" name="').concat(i,'-text" value="').concat(n,'"/>')).on("input",(function(e){var n=this;W().update(variables(),t,(function(){return $(n).val()})),Engine.show()}))),e.append(s)}if("boolean"==typeof n){var a=$("<div/>");r||a.append($('<label for="'.concat(i,'-text"/>')).wiki("".concat(i,": "))),a.append($('<input type="checkbox" id="'.concat(i,'-text" ').concat(n?"checked":"","/>")).on("input",(function(e){var n=this;W().update(variables(),t,(function(){return $(n)[0].checked})),Engine.show()}))),e.append(a)}if("number"==typeof n){var l=$("<div/>");r||l.append($('<label for="'.concat(i,'-text"/>')).wiki("".concat(i,": "))),l.append($('<input type="text" id="'.concat(i,'-text" name="').concat(i,'-text" value="').concat(n,'"/>')).on("input",(function(e){var n=this;W().update(variables(),t,(function(){return Number($(n).val())})),Engine.show()})).inputFilter((function(e){return/^-?\d*.?\d*$/.test(e)}))),e.append(l)}if("object"==Xt(n))if(Array.isArray(n)&&!W().isEmpty(n))if((0,F.logger)("Object data type of Array"),"string"==typeof n[0]||"number"==typeof n[0])e.append($('<label for="'.concat(i,'-text"/>')).wiki("".concat(i,": "))),W().each(n,(function(n,r){en(e,[].concat(Yt(t),[r]),n,!0,r)}));else{(0,F.logger)(n);var c=Object.keys(n[0]);if(e.append($('<label for="'.concat(i,'-text"/>')).wiki("".concat(i,": "))).append($("<br/>")),(0,F.logger)(c),c.length>1){var u=$("<table/>").addClass("skillTable"),d=$("<tr/>");W().each(c,(function(e,t){d.append($("<th/>").wiki(e))})),u.append(d),W().each(n,(function(e,n){d=$("<tr/>"),W().each(e,(function(e,r){var o=$("<td/>");en(o,[].concat(Yt(t),[n,r]),e,!0,n),d.append(o)})),u.append(d)})),e.append(u)}else W().each(n,(function(n,r){var o=Object.keys(n)[0];e.append($('<label for="'.concat(o,'-text"/>')).wiki("".concat(o,": "))),en(e,[].concat(Yt(t),[r,o]),n[o],!1,o)}))}else for(var p in(0,F.logger)("Object data type of JSON"),n)en(e,[].concat(Yt(t),[p]),n[p])}function tn(e){this.content=e}Macro.add("dataEditorMacro",{skipArgs:!1,handler:function(){var e=Rt({$parent:this.output,label:"Data Map: ",data:r,displayProp:"name",callback:function(e){t.empty();var o=r[e],i=n[o.dataName];jt({$parent:t,dataMap:o,data:i,field:{},name:o.name,btns:{hasDelete:!0,hasAdd:Wt},rowCallback:function(e){Kt({$table:e.$table,$row:e.$row,data:e.data,dataMap:e.dataMap,name:e.name})}})},style:{wrapper:!1,input:!1}}),t=$("<div/>").attr("id","fieldsContainer").appendTo(this.output),o=r[e.val()],i=n[o.dataName];jt({$parent:t,dataMap:o,data:i,field:{},name:o.name,btns:{hasDelete:!0,hasAdd:Wt},rowCallback:function(e){Kt({$row:e.$row,data:e.data,dataMap:e.dataMap,name:e.name})}});Ht({type:"Action",icon:"fa-floppy-o",text:" Export",callback:function(){var e=new Blob([JSON.stringify(Jt(o),null,0)],{type:"application/json"}),t=document.createElement("a");t.download=o.dataName+".json",t.href=URL.createObjectURL(e),t.click()}}).appendTo(this.output),Ht({type:"Action",icon:"fa-files-o",text:" Copy",style:{"margin-left":"5px"},callback:function(){navigator.clipboard.writeText("".concat(JSON.stringify(Jt(o),null,1)))}}).appendTo(this.output),Ht({type:"Action",icon:"fa-floppy-o",text:" Save State",style:{"margin-left":"5px"},callback:function(){variables()[o.dataName]=Jt(o),Engine.show()}}).appendTo(this.output);var s=zt([],p);$("<button/>").wiki("Copy JSON").click((function(){navigator.clipboard.writeText("".concat(JSON.stringify(s)))})).appendTo(this.output)}}),jQuery.fn.inputFilter=function(e){return this.on("input keydown keyup mousedown mouseup select contextmenu drop",(function(){e(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}))},Macro.add("devMacro",{skipArgs:!1,handler:function(){(0,F.logger)($("#stateEditor").length),$("<button/>").wiki("State Editor").click((function(){0==$("#stateEditor").length&&Qt()})).appendTo(this.output)}}),tn.prototype={constructor:tn,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,n){var r=n&&n!=e?this.remove(n):this,o=r.find(e),i=r.content.slice();return-1==o?i.push(n||e,t):(i[o+1]=t,n&&(i[o]=n)),new tn(i)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new tn(n)},addToStart:function(e,t){return new tn([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new tn(n)},addBefore:function(e,t,n){var r=this.remove(t),o=r.content.slice(),i=r.find(e);return o.splice(-1==i?o.length:i,0,t,n),new tn(o)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=tn.from(e)).size?new tn(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=tn.from(e)).size?new tn(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=tn.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach((function(t,n){e[t]=n})),e},get size(){return this.content.length>>1}},tn.from=function(e){if(e instanceof tn)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new tn(t)};const nn=tn;function rn(e,t,n){for(let r=0;;r++){if(r==e.childCount||r==t.childCount)return e.childCount==t.childCount?null:n;let o=e.child(r),i=t.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(let e=0;o.text[e]==i.text[e];e++)n++;return n}if(o.content.size||i.content.size){let e=rn(o.content,i.content,n+1);if(null!=e)return e}n+=o.nodeSize}else n+=o.nodeSize}}function on(e,t,n,r){for(let o=e.childCount,i=t.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};let s=e.child(--o),a=t.child(--i),l=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){let e=0,t=Math.min(s.text.length,a.text.length);for(;e<t&&s.text[s.text.length-e-1]==a.text[a.text.length-e-1];)e++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){let e=on(s.content,a.content,n-1,r-1);if(e)return e}n-=l,r-=l}else n-=l,r-=l}}class sn{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let t=0;t<e.length;t++)this.size+=e[t].nodeSize}nodesBetween(e,t,n,r=0,o){for(let i=0,s=0;s<t;i++){let a=this.content[i],l=s+a.nodeSize;if(l>e&&!1!==n(a,r+s,o||null,i)&&a.content.size){let o=s+1;a.nodesBetween(Math.max(0,e-o),Math.min(a.content.size,t-o),n,r+o)}s=l}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let o="",i=!0;return this.nodesBetween(e,t,((s,a)=>{let l=s.isText?s.text.slice(Math.max(e,a)-a,t-a):s.isLeaf?r?"function"==typeof r?r(s):r:s.type.spec.leafText?s.type.spec.leafText(s):"":"";s.isBlock&&(s.isLeaf&&l||s.isTextblock)&&n&&(i?i=!1:o+=n),o+=l}),0),o}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,r=this.content.slice(),o=0;for(t.isText&&t.sameMarkup(n)&&(r[r.length-1]=t.withText(t.text+n.text),o=1);o<e.content.length;o++)r.push(e.content[o]);return new sn(r,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],r=0;if(t>e)for(let o=0,i=0;i<t;o++){let s=this.content[o],a=i+s.nodeSize;a>e&&((i<e||a>t)&&(s=s.isText?s.cut(Math.max(0,e-i),Math.min(s.text.length,t-i)):s.cut(Math.max(0,e-i-1),Math.min(s.content.size,t-i-1))),n.push(s),r+=s.nodeSize),i=a}return new sn(n,r)}cutByIndex(e,t){return e==t?sn.empty:0==e&&t==this.content.length?this:new sn(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let r=this.content.slice(),o=this.size+t.nodeSize-n.nodeSize;return r[e]=t,new sn(r,o)}addToStart(e){return new sn([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new sn(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return rn(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return on(this,e,t,n)}findIndex(e,t=-1){if(0==e)return ln(0,e);if(e==this.size)return ln(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let o=r+this.child(n).nodeSize;if(o>=e)return o==e||t>0?ln(n+1,o):ln(n,r);r=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((e=>e.toJSON())):null}static fromJSON(e,t){if(!t)return sn.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new sn(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return sn.empty;let t,n=0;for(let r=0;r<e.length;r++){let o=e[r];n+=o.nodeSize,r&&o.isText&&e[r-1].sameMarkup(o)?(t||(t=e.slice(0,r)),t[t.length-1]=o.withText(t[t.length-1].text+o.text)):t&&t.push(o)}return new sn(t||e,n)}static from(e){if(!e)return sn.empty;if(e instanceof sn)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new sn([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}sn.empty=new sn([],0);const an={index:0,offset:0};function ln(e,t){return an.index=e,an.offset=t,an}function cn(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!cn(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!cn(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}class un{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let o=e[r];if(this.eq(o))return e;if(this.type.excludes(o.type))t||(t=e.slice(0,r));else{if(o.type.excludes(this.type))return e;!n&&o.type.rank>this.type.rank&&(t||(t=e.slice(0,r)),t.push(this),n=!0),t&&t.push(o)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&cn(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);return n.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&0==e.length)return un.none;if(e instanceof un)return[e];let t=e.slice();return t.sort(((e,t)=>e.type.rank-t.type.rank)),t}}un.none=[];class dn extends Error{}class pn{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=fn(this.content,e+this.openStart,t);return n&&new pn(n,this.openStart,this.openEnd)}removeBetween(e,t){return new pn(hn(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return pn.empty;let n=t.openStart||0,r=t.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new pn(sn.fromJSON(e,t.content),n,r)}static maxOpen(e,t=!0){let n=0,r=0;for(let r=e.firstChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.firstChild)n++;for(let n=e.lastChild;n&&!n.isLeaf&&(t||!n.type.spec.isolating);n=n.lastChild)r++;return new pn(e,n,r)}}function hn(e,t,n){let{index:r,offset:o}=e.findIndex(t),i=e.maybeChild(r),{index:s,offset:a}=e.findIndex(n);if(o==t||i.isText){if(a!=n&&!e.child(s).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(r!=s)throw new RangeError("Removing non-flat range");return e.replaceChild(r,i.copy(hn(i.content,t-o-1,n-o-1)))}function fn(e,t,n,r){let{index:o,offset:i}=e.findIndex(t),s=e.maybeChild(o);if(i==t||s.isText)return r&&!r.canReplace(o,o,n)?null:e.cut(0,t).append(n).append(e.cut(t));let a=fn(s.content,t-i-1,n);return a&&e.replaceChild(o,s.copy(a))}function mn(e,t,n){if(n.openStart>e.depth)throw new dn("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new dn("Inconsistent open depths");return gn(e,t,n,0)}function gn(e,t,n,r){let o=e.index(r),i=e.node(r);if(o==t.index(r)&&r<e.depth-n.openStart){let s=gn(e,t,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||e.depth!=r||t.depth!=r){let{start:o,end:s}=function(e,t){let n=t.depth-e.openStart,r=t.node(n).copy(e.content);for(let e=n-1;e>=0;e--)r=t.node(e).copy(sn.from(r));return{start:r.resolveNoCache(e.openStart+n),end:r.resolveNoCache(r.content.size-e.openEnd-n)}}(n,e);return kn(i,xn(e,o,s,t,r))}{let r=e.parent,o=r.content;return kn(r,o.cut(0,e.parentOffset).append(n.content).append(o.cut(t.parentOffset)))}}return kn(i,Mn(e,t,r))}function yn(e,t){if(!t.type.compatibleContent(e.type))throw new dn("Cannot join "+t.type.name+" onto "+e.type.name)}function vn(e,t,n){let r=e.node(n);return yn(r,t.node(n)),r}function bn(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function wn(e,t,n,r){let o=(t||e).node(n),i=0,s=t?t.index(n):o.childCount;e&&(i=e.index(n),e.depth>n?i++:e.textOffset&&(bn(e.nodeAfter,r),i++));for(let e=i;e<s;e++)bn(o.child(e),r);t&&t.depth==n&&t.textOffset&&bn(t.nodeBefore,r)}function kn(e,t){return e.type.checkContent(t),e.copy(t)}function xn(e,t,n,r,o){let i=e.depth>o&&vn(e,t,o+1),s=r.depth>o&&vn(n,r,o+1),a=[];return wn(null,e,o,a),i&&s&&t.index(o)==n.index(o)?(yn(i,s),bn(kn(i,xn(e,t,n,r,o+1)),a)):(i&&bn(kn(i,Mn(e,t,o+1)),a),wn(t,n,o,a),s&&bn(kn(s,Mn(n,r,o+1)),a)),wn(r,null,o,a),new sn(a)}function Mn(e,t,n){let r=[];if(wn(null,e,n,r),e.depth>n){bn(kn(vn(e,t,n+1),Mn(e,t,n+1)),r)}return wn(t,null,n,r),new sn(r)}pn.empty=new pn(sn.empty,0,0);class Sn{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],r=0==t?0:this.path[3*t-1]+1;for(let t=0;t<e;t++)r+=n.child(t).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return un.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let e=n;n=r,r=e}let o=n.marks;for(var i=0;i<o.length;i++)!1!==o[i].type.spec.inclusive||r&&o[i].isInSet(r.marks)||(o=o[i--].removeFromSet(o));return o}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new Tn(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],r=0,o=t;for(let t=e;;){let{index:e,offset:i}=t.content.findIndex(o),s=o-i;if(n.push(t,e,r+i),!s)break;if(t=t.child(e),t.isText)break;o=s-1,r+=i+1}return new Sn(t,n,o)}static resolveCached(e,t){for(let n=0;n<Cn.length;n++){let r=Cn[n];if(r.pos==t&&r.doc==e)return r}let n=Cn[On]=Sn.resolve(e,t);return On=(On+1)%An,n}}let Cn=[],On=0,An=12;class Tn{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const _n=Object.create(null);class Nn{constructor(e,t,n,r=un.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||sn.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&cn(this.attrs,t||e.defaultAttrs||_n)&&un.sameSet(this.marks,n||un.none)}copy(e=null){return e==this.content?this:new Nn(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Nn(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return pn.empty;let r=this.resolve(e),o=this.resolve(t),i=n?0:r.sharedDepth(t),s=r.start(i),a=r.node(i).content.cut(r.pos-s,o.pos-s);return new pn(a,r.depth-i,o.depth-i)}replace(e,t,n){return mn(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return Sn.resolveCached(this,e)}resolveNoCache(e){return Sn.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,(e=>(n.isInSet(e.marks)&&(r=!0),!r))),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),En(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=sn.empty,r=0,o=n.childCount){let i=this.contentMatchAt(e).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,t);if(!s||!s.validEnd)return!1;for(let e=r;e<o;e++)if(!this.type.allowsMarks(n.child(e).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let o=this.contentMatchAt(e).matchType(n),i=o&&o.matchFragment(this.content,t);return!!i&&i.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=un.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!un.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((e=>e.type.name))}`);this.content.forEach((e=>e.check()))}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map((e=>e.toJSON()))),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let r=sn.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,r,n)}}Nn.prototype.text=void 0;class $n extends Nn{constructor(e,t,n,r){if(super(e,t,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):En(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new $n(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new $n(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function En(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class Dn{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new In(e,t);if(null==n.next)return Dn.empty;let r=Ln(n);n.next&&n.err("Unexpected trailing text");let o=function(e){let t=Object.create(null);return n(Rn(e,0));function n(r){let o=[];r.forEach((t=>{e[t].forEach((({term:t,to:n})=>{if(!t)return;let r;for(let e=0;e<o.length;e++)o[e][0]==t&&(r=o[e][1]);Rn(e,n).forEach((e=>{r||o.push([t,r=[]]),-1==r.indexOf(e)&&r.push(e)}))}))}));let i=t[r.join(",")]=new Dn(r.indexOf(e.length-1)>-1);for(let e=0;e<o.length;e++){let r=o[e][1].sort(Vn);i.next.push({type:o[e][0],next:t[r.join(",")]||n(r)})}return i}}(function(e){let t=[[]];return o(i(e,0),n()),t;function n(){return t.push([])-1}function r(e,n,r){let o={term:r,to:n};return t[e].push(o),o}function o(e,t){e.forEach((e=>e.to=t))}function i(e,t){if("choice"==e.type)return e.exprs.reduce(((e,n)=>e.concat(i(n,t))),[]);if("seq"!=e.type){if("star"==e.type){let s=n();return r(t,s),o(i(e.expr,s),s),[r(s)]}if("plus"==e.type){let s=n();return o(i(e.expr,t),s),o(i(e.expr,s),s),[r(s)]}if("opt"==e.type)return[r(t)].concat(i(e.expr,t));if("range"==e.type){let s=t;for(let t=0;t<e.min;t++){let t=n();o(i(e.expr,s),t),s=t}if(-1==e.max)o(i(e.expr,s),s);else for(let t=e.min;t<e.max;t++){let t=n();r(s,t),o(i(e.expr,s),t),s=t}return[r(s)]}if("name"==e.type)return[r(t,void 0,e.value)];throw new Error("Unknown expr type")}for(let r=0;;r++){let s=i(e.exprs[r],t);if(r==e.exprs.length-1)return s;o(s,t=n())}}}(r));return function(e,t){for(let n=0,r=[e];n<r.length;n++){let e=r[n],o=!e.validEnd,i=[];for(let t=0;t<e.next.length;t++){let{type:n,next:s}=e.next[t];i.push(n.name),!o||n.isText||n.hasRequiredAttrs()||(o=!1),-1==r.indexOf(s)&&r.push(s)}o&&t.err("Only non-generatable nodes ("+i.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(o,n),o}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let o=t;r&&o<n;o++)r=r.matchType(e.child(o).type);return r}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];return function o(i,s){let a=i.matchFragment(e,n);if(a&&(!t||a.validEnd))return sn.from(s.map((e=>e.createAndFill())));for(let e=0;e<i.next.length;e++){let{type:t,next:n}=i.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==r.indexOf(n)){r.push(n);let e=o(n,s.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),o=r.match;if(o.matchType(e)){let e=[];for(let t=r;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<o.next.length;e++){let{type:i,next:s}=o.next[e];i.isLeaf||i.hasRequiredAttrs()||i.name in t||r.type&&!s.validEnd||(n.push({match:i.contentMatch,type:i,via:r}),t[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return function t(n){e.push(n);for(let r=0;r<n.next.length;r++)-1==e.indexOf(n.next[r].next)&&t(n.next[r].next)}(this),e.map(((t,n)=>{let r=n+(t.validEnd?"*":" ")+" ";for(let n=0;n<t.next.length;n++)r+=(n?", ":"")+t.next[n].type.name+"->"+e.indexOf(t.next[n].next);return r})).join("\n")}}Dn.empty=new Dn(!0);class In{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Ln(e){let t=[];do{t.push(Pn(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function Pn(e){let t=[];do{t.push(zn(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function zn(e){let t=function(e){if(e.eat("(")){let t=Ln(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=function(e,t){let n=e.nodeTypes,r=n[t];if(r)return[r];let o=[];for(let e in n){let r=n[e];r.groups.indexOf(t)>-1&&o.push(r)}0==o.length&&e.err("No node type or group '"+t+"' found");return o}(e,e.next).map((t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t})));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=Bn(e,t)}return t}function jn(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function Bn(e,t){let n=jn(e),r=n;return e.eat(",")&&(r="}"!=e.next?jn(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:t}}function Vn(e,t){return t-e}function Rn(e,t){let n=[];return function t(r){let o=e[r];if(1==o.length&&!o[0].term)return t(o[0].to);n.push(r);for(let e=0;e<o.length;e++){let{term:r,to:i}=o[e];r||-1!=n.indexOf(i)||t(i)}}(t),n.sort(Vn)}function Hn(e){let t=Object.create(null);for(let n in e){let r=e[n];if(!r.hasDefault)return null;t[n]=r.default}return t}function Fn(e,t){let n=Object.create(null);for(let r in e){let o=t&&t[r];if(void 0===o){let t=e[r];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=t.default}n[r]=o}return n}function qn(e){let t=Object.create(null);if(e)for(let n in e)t[n]=new Jn(e[n]);return t}class Wn{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=qn(n.attrs),this.defaultAttrs=Hn(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Dn.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Fn(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Nn(this,this.computeAttrs(e),sn.from(t),un.setFrom(n))}createChecked(e=null,t,n){return t=sn.from(t),this.checkContent(t),new Nn(this,this.computeAttrs(e),t,un.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),(t=sn.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let r=this.contentMatch.matchFragment(t),o=r&&r.fillBefore(sn.empty,!0);return o?new Nn(this,e,t.append(o),un.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let t=0;t<e.childCount;t++)if(!this.allowsMarks(e.child(t).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:un.none:e}static compile(e,t){let n=Object.create(null);e.forEach(((e,r)=>n[e]=new Wn(e,t,r)));let r=t.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let e in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}}class Jn{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class Kn{constructor(e,t,n,r){this.name=e,this.rank=t,this.schema=n,this.spec=r,this.attrs=qn(r.attrs),this.excluded=null;let o=Hn(this.attrs);this.instance=o?new un(this,o):null}create(e=null){return!e&&this.instance?this.instance:new un(this,Fn(this.attrs,e))}static compile(e,t){let n=Object.create(null),r=0;return e.forEach(((e,o)=>n[e]=new Kn(e,r++,t,o))),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}}class Un{constructor(e){this.cached=Object.create(null);let t=this.spec={};for(let n in e)t[n]=e[n];t.nodes=nn.from(e.nodes),t.marks=nn.from(e.marks||{}),this.nodes=Wn.compile(this.spec.nodes,this),this.marks=Kn.compile(this.spec.marks,this);let n=Object.create(null);for(let e in this.nodes){if(e in this.marks)throw new RangeError(e+" can not be both a node and a mark");let t=this.nodes[e],r=t.spec.content||"",o=t.spec.marks;t.contentMatch=n[r]||(n[r]=Dn.parse(r,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.markSet="_"==o?null:o?Gn(this,o.split(" ")):""!=o&&t.inlineContent?null:[]}for(let e in this.marks){let t=this.marks[e],n=t.spec.excludes;t.excluded=null==n?[t]:""==n?[]:Gn(this,n.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,r){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof Wn))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,r)}text(e,t){let n=this.nodes.text;return new $n(n,n.defaultAttrs,e,un.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Nn.fromJSON(this,e)}markFromJSON(e){return un.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Gn(e,t){let n=[];for(let r=0;r<t.length;r++){let o=t[r],i=e.marks[o],s=i;if(i)n.push(i);else for(let t in e.marks){let r=e.marks[t];("_"==o||r.spec.group&&r.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=r)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[r]+"'")}return n}class Yn{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach((e=>{!function(e){return null!=e.tag}(e)?function(e){return null!=e.style}(e)&&this.styles.push(e):this.tags.push(e)})),this.normalizeLists=!this.tags.some((t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)}))}parse(e,t={}){let n=new nr(this,t,!1);return n.addAll(e,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new nr(this,t,!0);return n.addAll(e,t.from,t.to),pn.maxOpen(n.finish())}matchTag(e,t,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(rr(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,r){for(let o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){let r=this.styles[o],i=r.style;if(!(0!=i.indexOf(e)||r.context&&!n.matchesContext(r.context)||i.length>e.length&&(61!=i.charCodeAt(e.length)||i.slice(e.length+1)!=t))){if(r.getAttrs){let e=r.getAttrs(t);if(!1===e)continue;r.attrs=e||void 0}return r}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,r=0;for(;r<t.length;r++){let e=t[r];if((null==e.priority?50:e.priority)<n)break}t.splice(r,0,e)}for(let t in e.marks){let r=e.marks[t].spec.parseDOM;r&&r.forEach((e=>{n(e=or(e)),e.mark||e.ignore||e.clearMark||(e.mark=t)}))}for(let t in e.nodes){let r=e.nodes[t].spec.parseDOM;r&&r.forEach((e=>{n(e=or(e)),e.node||e.ignore||e.mark||(e.node=t)}))}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Yn(e,Yn.schemaRules(e)))}}const Zn={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Xn={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Qn={ol:!0,ul:!0};function er(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}class tr{constructor(e,t,n,r,o,i,s){this.type=e,this.attrs=t,this.marks=n,this.pendingMarks=r,this.solid=o,this.options=s,this.content=[],this.activeMarks=un.none,this.stashMarks=[],this.match=i||(4&s?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(sn.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=sn.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(sn.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,n=this.pendingMarks;t<n.length;t++){let r=n[t];(this.type?this.type.allowsMarkType(r.type):ir(r.type,e))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Zn.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class nr{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0;let r,o=t.topNode,i=er(null,t.preserveWhitespace,0)|(n?4:0);r=o?new tr(o.type,o.attrs,un.none,un.none,!0,t.topMatch||o.type.contentMatch,i):new tr(n?null:e.schema.topNodeType,null,un.none,un.none,!0,null,i),this.nodes=[r],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){3==e.nodeType?this.addTextNode(e):1==e.nodeType&&this.addElement(e)}withStyleRules(e,t){let n=e.getAttribute("style");if(!n)return t();let r=this.readStyles(function(e){let t,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];for(;t=n.exec(e);)r.push(t[1],t[2].trim());return r}(n));if(!r)return;let[o,i]=r,s=this.top;for(let e=0;e<i.length;e++)this.removePendingMark(i[e],s);for(let e=0;e<o.length;e++)this.addPendingMark(o[e]);t();for(let e=0;e<o.length;e++)this.removePendingMark(o[e],s);for(let e=0;e<i.length;e++)this.addPendingMark(i[e])}addTextNode(e){let t=e.nodeValue,n=this.top;if(2&n.options||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(1&n.options)t=2&n.options?t.replace(/\r\n?/g,"\n"):t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let r=n.content[n.content.length-1],o=e.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let n,r=e.nodeName.toLowerCase();Qn.hasOwnProperty(r)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&Qn.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let o=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(n=this.parser.matchTag(e,this,t));if(o?o.ignore:Xn.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(e=o.skip);let t,n=this.top,i=this.needsBlock;if(Zn.hasOwnProperty(r))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),t=!0,n.type||(this.needsBlock=!0);else if(!e.firstChild)return void this.leafFallback(e);o&&o.skip?this.addAll(e):this.withStyleRules(e,(()=>this.addAll(e))),t&&this.sync(n),this.needsBlock=i}else this.withStyleRules(e,(()=>{this.addElementByRule(e,o,!1===o.consuming?n:void 0)}))}leafFallback(e){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"))}ignoreFallback(e){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=un.none,n=un.none;for(let r=0;r<e.length;r+=2)for(let o;;){let i=this.parser.matchStyle(e[r],e[r+1],this,o);if(!i)break;if(i.ignore)return null;if(i.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach((e=>{i.clearMark(e)&&(n=e.addToSet(n))})):t=this.parser.schema.marks[i.mark].create(i.attrs).addToSet(t),!1!==i.consuming)break;o=i}return[t,n]}addElementByRule(e,t,n){let r,o,i;if(t.node)o=this.parser.schema.nodes[t.node],o.isLeaf?this.insertNode(o.create(t.attrs))||this.leafFallback(e):r=this.enter(o,t.attrs||null,t.preserveWhitespace);else{i=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(i)}let s=this.top;if(o&&o.isLeaf)this.findInside(e);else if(n)this.addElement(e,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach((e=>this.insertNode(e)));else{let n=e;"string"==typeof t.contentElement?n=e.querySelector(t.contentElement):"function"==typeof t.contentElement?n=t.contentElement(e):t.contentElement&&(n=t.contentElement),this.findAround(e,n,!0),this.addAll(n)}r&&this.sync(s)&&this.open--,i&&this.removePendingMark(i,s)}addAll(e,t,n){let r=t||0;for(let o=t?e.childNodes[t]:e.firstChild,i=null==n?null:e.childNodes[n];o!=i;o=o.nextSibling,++r)this.findAtPoint(e,r),this.addDOM(o);this.findAtPoint(e,r)}findPlace(e){let t,n;for(let r=this.open;r>=0;r--){let o=this.nodes[r],i=o.findWrapping(e);if(i&&(!t||t.length>i.length)&&(t=i,n=o,!i.length))break;if(o.solid)break}if(!t)return!1;this.sync(n);for(let e=0;e<t.length;e++)this.enterInner(t[e],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let n=t.activeMarks;for(let r=0;r<e.marks.length;r++)t.type&&!t.type.allowsMarkType(e.marks[r].type)||(n=e.marks[r].addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n){let r=this.findPlace(e.create(t));return r&&this.enterInner(e,t,!0,n),r}enterInner(e,t=null,n=!1,r){this.closeExtra();let o=this.top;o.applyPending(e),o.match=o.match&&o.match.matchType(e);let i=er(e,r,o.options);4&o.options&&0==o.content.length&&(i|=4),this.nodes.push(new tr(e,t,o.activeMarks,o.pendingMarks,n,null,i)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==e.nodeType&&e.contains(this.find[r].node)){t.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,r=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),o=-(n?n.depth+1:0)+(r?0:1),i=(e,s)=>{for(;e>=0;e--){let a=t[e];if(""==a){if(e==t.length-1||0==e)continue;for(;s>=o;s--)if(i(e-1,s))return!0;return!1}{let e=s>0||0==s&&r?this.nodes[s].type:n&&s>=o?n.node(s-o).type:null;if(!e||e.name!=a&&-1==e.groups.indexOf(a))return!1;s--}}return!0};return i(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}addPendingMark(e){let t=function(e,t){for(let n=0;n<t.length;n++)if(e.eq(t[n]))return t[n]}(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let n=this.open;n>=0;n--){let r=this.nodes[n];if(r.pendingMarks.lastIndexOf(e)>-1)r.pendingMarks=e.removeFromSet(r.pendingMarks);else{r.activeMarks=e.removeFromSet(r.activeMarks);let t=r.popFromStashMark(e);t&&r.type&&r.type.allowsMarkType(t.type)&&(r.activeMarks=t.addToSet(r.activeMarks))}if(r==t)break}}}function rr(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function or(e){let t={};for(let n in e)t[n]=e[n];return t}function ir(e,t){let n=t.schema.nodes;for(let r in n){let o=n[r];if(!o.allowsMarkType(e))continue;let i=[],s=e=>{i.push(e);for(let n=0;n<e.edgeCount;n++){let{type:r,next:o}=e.edge(n);if(r==t)return!0;if(i.indexOf(o)<0&&s(o))return!0}};if(s(o.contentMatch))return!0}}class sr{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=lr(t).createDocumentFragment());let r=n,o=[];return e.forEach((e=>{if(o.length||e.marks.length){let n=0,i=0;for(;n<o.length&&i<e.marks.length;){let t=e.marks[i];if(this.marks[t.type.name]){if(!t.eq(o[n][0])||!1===t.type.spec.spanning)break;n++,i++}else i++}for(;n<o.length;)r=o.pop()[1];for(;i<e.marks.length;){let n=e.marks[i++],s=this.serializeMark(n,e.isInline,t);s&&(o.push([n,r]),r.appendChild(s.dom),r=s.contentDOM||s.dom)}}r.appendChild(this.serializeNodeInner(e,t))})),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=sr.renderSpec(lr(t),this.nodes[e.type.name](e));if(r){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let o=this.serializeMark(e.marks[r],e.isInline,t);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&sr.renderSpec(lr(n),r(e,t))}static renderSpec(e,t,n=null){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let r,o=t[0],i=o.indexOf(" ");i>0&&(n=o.slice(0,i),o=o.slice(i+1));let s=n?e.createElementNS(n,o):e.createElement(o),a=t[1],l=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a)){l=2;for(let e in a)if(null!=a[e]){let t=e.indexOf(" ");t>0?s.setAttributeNS(e.slice(0,t),e.slice(t+1),a[e]):s.setAttribute(e,a[e])}}for(let o=l;o<t.length;o++){let i=t[o];if(0===i){if(o<t.length-1||o>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}{let{dom:t,contentDOM:o}=sr.renderSpec(e,i,n);if(s.appendChild(t),o){if(r)throw new RangeError("Multiple content holes");r=o}}}return{dom:s,contentDOM:r}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new sr(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=ar(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return ar(e.marks)}}function ar(e){let t={};for(let n in e){let r=e[n].spec.toDOM;r&&(t[n]=r)}return t}function lr(e){return e.document||window.document}const cr=Math.pow(2,16);function ur(e,t){return e+t*cr}function dr(e){return 65535&e}class pr{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class hr{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&hr.empty)return hr.empty}recover(e){let t=0,n=dr(e);if(!this.inverted)for(let e=0;e<n;e++)t+=this.ranges[3*e+2]-this.ranges[3*e+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/cr}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,o=this.inverted?2:1,i=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let a=this.ranges[s]-(this.inverted?r:0);if(a>e)break;let l=this.ranges[s+o],c=this.ranges[s+i],u=a+l;if(e<=u){let o=a+r+((l?e==a?-1:e==u?1:t:t)<0?0:c);if(n)return o;let i=e==(t<0?a:u)?null:ur(s/3,e-a),d=e==a?2:e==u?1:4;return(t<0?e!=a:e!=u)&&(d|=8),new pr(o,d,i)}r+=c-l}return n?e+r:new pr(e+r,0,null)}touches(e,t){let n=0,r=dr(t),o=this.inverted?2:1,i=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let s=this.ranges[t]-(this.inverted?n:0);if(s>e)break;let a=this.ranges[t+o];if(e<=s+a&&t==3*r)return!0;n+=this.ranges[t+i]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,o=0;r<this.ranges.length;r+=3){let i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),l=this.ranges[r+t],c=this.ranges[r+n];e(s,s+l,a,a+c),o+=c-l}}invert(){return new hr(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?hr.empty:new hr(e<0?[0,-e,0]:[0,0,e])}}hr.empty=new hr([]);class fr{constructor(e=[],t,n=0,r=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=r}slice(e=0,t=this.maps.length){return new fr(this.maps,this.mirror,e,t)}copy(){return new fr(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let r=e.getMirror(t);this.appendMap(e.maps[t],null!=r&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=r&&r>t?n-r-1:void 0)}}invert(){let e=new fr;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let n=this.from;n<this.to;n++){let o=this.maps[n].mapResult(e,t);if(null!=o.recover){let t=this.getMirror(n);if(null!=t&&t>n&&t<this.to){n=t,e=this.maps[t].recover(o.recover);continue}}r|=o.delInfo,e=o.pos}return n?e:new pr(e,r,null)}}const mr=Object.create(null);class gr{getMap(){return hr.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=mr[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in mr)throw new RangeError("Duplicate use of step JSON ID "+e);return mr[e]=t,t.prototype.jsonID=e,t}}class yr{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new yr(e,null)}static fail(e){return new yr(null,e)}static fromReplace(e,t,n,r){try{return yr.ok(e.replace(t,n,r))}catch(e){if(e instanceof dn)return yr.fail(e.message);throw e}}}function vr(e,t,n){let r=[];for(let o=0;o<e.childCount;o++){let i=e.child(o);i.content.size&&(i=i.copy(vr(i.content,t,i))),i.isInline&&(i=t(i,n,o)),r.push(i)}return sn.fromArray(r)}class br extends gr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),o=new pn(vr(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),r),t.openStart,t.openEnd);return yr.fromReplace(e,this.from,this.to,o)}invert(){return new wr(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new br(t.pos,n.pos,this.mark)}merge(e){return e instanceof br&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new br(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new br(t.from,t.to,e.markFromJSON(t.mark))}}gr.jsonID("addMark",br);class wr extends gr{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new pn(vr(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return yr.fromReplace(e,this.from,this.to,n)}invert(){return new br(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new wr(t.pos,n.pos,this.mark)}merge(e){return e instanceof wr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new wr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new wr(t.from,t.to,e.markFromJSON(t.mark))}}gr.jsonID("removeMark",wr);class kr extends gr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return yr.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return yr.fromReplace(e,this.pos,this.pos+1,new pn(sn.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new kr(this.pos,t.marks[n]);return new kr(this.pos,this.mark)}}return new xr(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new kr(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new kr(t.pos,e.markFromJSON(t.mark))}}gr.jsonID("addNodeMark",kr);class xr extends gr{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return yr.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return yr.fromReplace(e,this.pos,this.pos+1,new pn(sn.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new kr(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new xr(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new xr(t.pos,e.markFromJSON(t.mark))}}gr.jsonID("removeNodeMark",xr);class Mr extends gr{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&Cr(e,this.from,this.to)?yr.fail("Structure replace would overwrite content"):yr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new hr([this.from,this.to-this.from,this.slice.size])}invert(e){return new Mr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new Mr(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof Mr)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?pn.empty:new pn(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Mr(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?pn.empty:new pn(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Mr(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Mr(t.from,t.to,pn.fromJSON(e,t.slice),!!t.structure)}}gr.jsonID("replace",Mr);class Sr extends gr{constructor(e,t,n,r,o,i,s=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=o,this.insert=i,this.structure=s}apply(e){if(this.structure&&(Cr(e,this.from,this.gapFrom)||Cr(e,this.gapTo,this.to)))return yr.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return yr.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?yr.fromReplace(e,this.from,this.to,n):yr.fail("Content does not fit in gap")}getMap(){return new hr([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Sr(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=e.map(this.gapFrom,-1),o=e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||r<t.pos||o>n.pos?null:new Sr(t.pos,n.pos,r,o,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Sr(t.from,t.to,t.gapFrom,t.gapTo,pn.fromJSON(e,t.slice),t.insert,!!t.structure)}}function Cr(e,t,n){let r=e.resolve(t),o=n-t,i=r.depth;for(;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0){let e=r.node(i).maybeChild(r.indexAfter(i));for(;o>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,o--}}return!1}function Or(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function Ar(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let r=e.$from.node(n),o=e.$from.index(n),i=e.$to.indexAfter(n);if(n<e.depth&&r.canReplace(o,i,t))return n;if(0==n||r.type.spec.isolating||!Or(r,o,i))break}return null}function Tr(e,t,n=null,r=e){let o=function(e,t){let{parent:n,startIndex:r,endIndex:o}=e,i=n.contentMatchAt(r).findWrapping(t);if(!i)return null;let s=i.length?i[0]:t;return n.canReplaceWith(r,o,s)?i:null}(e,t),i=o&&function(e,t){let{parent:n,startIndex:r,endIndex:o}=e,i=n.child(r),s=t.contentMatch.findWrapping(i.type);if(!s)return null;let a=(s.length?s[s.length-1]:t).contentMatch;for(let e=r;a&&e<o;e++)a=a.matchType(n.child(e).type);return a&&a.validEnd?s:null}(r,t);return i?o.map(_r).concat({type:t,attrs:n}).concat(i.map(_r)):null}function _r(e){return{type:e,attrs:null}}function Nr(e,t,n=1,r){let o=e.resolve(t),i=o.depth-n,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(let e=o.depth-1,t=n-2;e>i;e--,t--){let n=o.node(e),i=o.index(e);if(n.type.spec.isolating)return!1;let s=n.content.cutByIndex(i,n.childCount),a=r&&r[t+1];a&&(s=s.replaceChild(0,a.type.create(a.attrs)));let l=r&&r[t]||n;if(!n.canReplace(i+1,n.childCount)||!l.type.validContent(s))return!1}let a=o.indexAfter(i),l=r&&r[0];return o.node(i).canReplaceWith(a,a,l?l.type:o.node(i+1).type)}function $r(e,t){let n=e.resolve(t),r=n.index();return Er(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Er(e,t){return!(!e||!t||e.isLeaf||!e.canAppend(t))}function Dr(e,t,n=-1){let r=e.resolve(t);for(let e=r.depth;;e--){let o,i,s=r.index(e);if(e==r.depth?(o=r.nodeBefore,i=r.nodeAfter):n>0?(o=r.node(e+1),s++,i=r.node(e).maybeChild(s)):(o=r.node(e).maybeChild(s-1),i=r.node(e+1)),o&&!o.isTextblock&&Er(o,i)&&r.node(e).canReplace(s,s+1))return t;if(0==e)break;t=n<0?r.before(e):r.after(e)}}function Ir(e,t,n){let r=e.resolve(t);if(!n.content.size)return t;let o=n.content;for(let e=0;e<n.openStart;e++)o=o.firstChild.content;for(let e=1;e<=(0==n.openStart&&n.size?2:1);e++)for(let t=r.depth;t>=0;t--){let n=t==r.depth?0:r.pos<=(r.start(t+1)+r.end(t+1))/2?-1:1,i=r.index(t)+(n>0?1:0),s=r.node(t),a=!1;if(1==e)a=s.canReplace(i,i,o);else{let e=s.contentMatchAt(i).findWrapping(o.firstChild.type);a=e&&s.canReplaceWith(i,i,e[0])}if(a)return 0==n?r.pos:n<0?r.before(t+1):r.after(t+1)}return null}function Lr(e,t,n=t,r=pn.empty){if(t==n&&!r.size)return null;let o=e.resolve(t),i=e.resolve(n);return Pr(o,i,r)?new Mr(t,n,r):new zr(o,i,r).fit()}function Pr(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}gr.jsonID("replaceAround",Sr);class zr{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=sn.empty;for(let t=0;t<=e.depth;t++){let n=e.node(t);this.frontier.push({type:n.type,match:n.contentMatchAt(e.indexAfter(t))})}for(let t=e.depth;t>0;t--)this.placed=sn.from(e.node(t).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(e<0?this.$to:n.doc.resolve(e));if(!r)return null;let o=this.placed,i=n.depth,s=r.depth;for(;i&&s&&1==o.childCount;)o=o.firstChild.content,i--,s--;let a=new pn(o,i,s);return e>-1?new Sr(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new Mr(n.pos,r.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let o=t.firstChild;if(t.childCount>1&&(r=0),o.type.spec.isolating&&r<=n){e=n;break}t=o.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,r=null;n?(r=Vr(this.unplaced.content,n-1).firstChild,e=r.content):e=this.unplaced.content;let o=e.firstChild;for(let e=this.depth;e>=0;e--){let i,{type:s,match:a}=this.frontier[e],l=null;if(1==t&&(o?a.matchType(o.type)||(l=a.fillBefore(sn.from(o),!1)):r&&s.compatibleContent(r.type)))return{sliceDepth:n,frontierDepth:e,parent:r,inject:l};if(2==t&&o&&(i=a.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:e,parent:r,wrap:i};if(r&&a.matchType(r.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=Vr(e,t);return!(!r.childCount||r.firstChild.isLeaf)&&(this.unplaced=new pn(e,t+1,Math.max(n,r.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=Vr(e,t);if(r.childCount<=1&&t>0){let o=e.size-t<=t+r.size;this.unplaced=new pn(jr(e,t-1,1),t-1,o?t-1:n)}else this.unplaced=new pn(jr(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:r,wrap:o}){for(;this.depth>t;)this.closeFrontierNode();if(o)for(let e=0;e<o.length;e++)this.openFrontierNode(o[e]);let i=this.unplaced,s=n?n.content:i.content,a=i.openStart-e,l=0,c=[],{match:u,type:d}=this.frontier[t];if(r){for(let e=0;e<r.childCount;e++)c.push(r.child(e));u=u.matchFragment(r)}let p=s.size+e-(i.content.size-i.openEnd);for(;l<s.childCount;){let e=s.child(l),t=u.matchType(e.type);if(!t)break;l++,(l>1||0==a||e.content.size)&&(u=t,c.push(Rr(e.mark(d.allowedMarks(e.marks)),1==l?a:0,l==s.childCount?p:-1)))}let h=l==s.childCount;h||(p=-1),this.placed=Br(this.placed,t,sn.from(c)),this.frontier[t].match=u,h&&p<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let e=0,t=s;e<p;e++){let e=t.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),t=e.content}this.unplaced=h?0==e?pn.empty:new pn(jr(i.content,e-1,1),e-1,p<0?i.openEnd:e-1):new pn(jr(i.content,e,l),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!Hr(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:r}=this.frontier[t],o=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),i=Hr(e,t,r,n,o);if(i){for(let n=t-1;n>=0;n--){let{match:t,type:r}=this.frontier[n],o=Hr(e,n,r,t,!0);if(!o||o.childCount)continue e}return{depth:t,fit:i,move:o?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Br(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),r=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,r)}return e}openFrontierNode(e,t=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(e),this.placed=Br(this.placed,this.depth,sn.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(sn.empty,!0);e.childCount&&(this.placed=Br(this.placed,this.frontier.length,e))}}function jr(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(jr(e.firstChild.content,t-1,n)))}function Br(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(Br(e.lastChild.content,t-1,n)))}function Vr(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function Rr(e,t,n){if(t<=0)return e;let r=e.content;return t>1&&(r=r.replaceChild(0,Rr(r.firstChild,t-1,1==r.childCount?n-1:0))),t>0&&(r=e.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(e.type.contentMatch.matchFragment(r).fillBefore(sn.empty,!0)))),e.copy(r)}function Hr(e,t,n,r,o){let i=e.node(t),s=o?e.indexAfter(t):e.index(t);if(s==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,s);return a&&!function(e,t,n){for(let r=n;r<t.childCount;r++)if(!e.allowsMarks(t.child(r).marks))return!0;return!1}(n,i.content,s)?a:null}function Fr(e,t,n,r,o){if(t<n){let o=e.firstChild;e=e.replaceChild(0,o.copy(Fr(o.content,t+1,n,r,o)))}if(t>r){let t=o.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(sn.empty,!0))}return e}function qr(e,t){let n=[];for(let r=Math.min(e.depth,t.depth);r>=0;r--){let o=e.start(r);if(o<e.pos-(e.depth-r)||t.end(r)>t.pos+(t.depth-r)||e.node(r).type.spec.isolating||t.node(r).type.spec.isolating)break;(o==t.start(r)||r==e.depth&&r==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&r&&t.start(r-1)==o-1)&&n.push(r)}return n}class Wr extends gr{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return yr.fail("No node at attribute step's position");let n=Object.create(null);for(let e in t.attrs)n[e]=t.attrs[e];n[this.attr]=this.value;let r=t.type.create(n,null,t.marks);return yr.fromReplace(e,this.pos,this.pos+1,new pn(sn.from(r),0,t.isLeaf?0:1))}getMap(){return hr.empty}invert(e){return new Wr(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Wr(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new Wr(t.pos,t.attr,t.value)}}gr.jsonID("attr",Wr);class Jr extends gr{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let n in e.attrs)t[n]=e.attrs[n];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return yr.ok(n)}getMap(){return hr.empty}invert(e){return new Jr(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if("string"!=typeof t.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Jr(t.attr,t.value)}}gr.jsonID("docAttr",Jr);let Kr=class extends Error{};Kr=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(Kr.prototype=Object.create(Error.prototype)).constructor=Kr,Kr.prototype.name="TransformError";class Ur{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new fr}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Kr(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=pn.empty){let r=Lr(this.doc,e,t,n);return r&&this.step(r),this}replaceWith(e,t,n){return this.replace(e,t,new pn(sn.from(n),0,0))}delete(e,t){return this.replace(e,t,pn.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return function(e,t,n,r){if(!r.size)return e.deleteRange(t,n);let o=e.doc.resolve(t),i=e.doc.resolve(n);if(Pr(o,i,r))return e.step(new Mr(t,n,r));let s=qr(o,e.doc.resolve(n));0==s[s.length-1]&&s.pop();let a=-(o.depth+1);s.unshift(a);for(let e=o.depth,t=o.pos-1;e>0;e--,t--){let n=o.node(e).type.spec;if(n.defining||n.definingAsContext||n.isolating)break;s.indexOf(e)>-1?a=e:o.before(e)==t&&s.splice(1,0,-e)}let l=s.indexOf(a),c=[],u=r.openStart;for(let e=r.content,t=0;;t++){let n=e.firstChild;if(c.push(n),t==r.openStart)break;e=n.content}for(let e=u-1;e>=0;e--){let t=c[e],n=(d=t.type).spec.defining||d.spec.definingForContent;if(n&&!t.sameMarkup(o.node(Math.abs(a)-1)))u=e;else if(n||!t.type.isTextblock)break}var d;for(let t=r.openStart;t>=0;t--){let a=(t+u+1)%(r.openStart+1),d=c[a];if(d)for(let t=0;t<s.length;t++){let c=s[(t+l)%s.length],u=!0;c<0&&(u=!1,c=-c);let p=o.node(c-1),h=o.index(c-1);if(p.canReplaceWith(h,h,d.type,d.marks))return e.replace(o.before(c),u?i.after(c):n,new pn(Fr(r.content,0,r.openStart,a),a,r.openEnd))}}let p=e.steps.length;for(let a=s.length-1;a>=0&&(e.replace(t,n,r),!(e.steps.length>p));a--){let e=s[a];e<0||(t=o.before(e),n=i.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return function(e,t,n,r){if(!r.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let o=function(e,t,n){let r=e.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),n))return t;if(0==r.parentOffset)for(let e=r.depth-1;e>=0;e--){let t=r.index(e);if(r.node(e).canReplaceWith(t,t,n))return r.before(e+1);if(t>0)return null}if(r.parentOffset==r.parent.content.size)for(let e=r.depth-1;e>=0;e--){let t=r.indexAfter(e);if(r.node(e).canReplaceWith(t,t,n))return r.after(e+1);if(t<r.node(e).childCount)return null}return null}(e.doc,t,r.type);null!=o&&(t=n=o)}e.replaceRange(t,n,new pn(sn.from(r),0,0))}(this,e,t,n),this}deleteRange(e,t){return function(e,t,n){let r=e.doc.resolve(t),o=e.doc.resolve(n),i=qr(r,o);for(let t=0;t<i.length;t++){let n=i[t],s=t==i.length-1;if(s&&0==n||r.node(n).type.contentMatch.validEnd)return e.delete(r.start(n),o.end(n));if(n>0&&(s||r.node(n-1).canReplace(r.index(n-1),o.indexAfter(n-1))))return e.delete(r.before(n),o.after(n))}for(let i=1;i<=r.depth&&i<=o.depth;i++)if(t-r.start(i)==r.depth-i&&n>r.end(i)&&o.end(i)-n!=o.depth-i)return e.delete(r.before(i),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return function(e,t,n){let{$from:r,$to:o,depth:i}=t,s=r.before(i+1),a=o.after(i+1),l=s,c=a,u=sn.empty,d=0;for(let e=i,t=!1;e>n;e--)t||r.index(e)>0?(t=!0,u=sn.from(r.node(e).copy(u)),d++):l--;let p=sn.empty,h=0;for(let e=i,t=!1;e>n;e--)t||o.after(e+1)<o.end(e)?(t=!0,p=sn.from(o.node(e).copy(p)),h++):c++;e.step(new Sr(l,c,s,a,new pn(u.append(p),d,h),u.size-d,!0))}(this,e,t),this}join(e,t=1){return function(e,t,n){let r=new Mr(t-n,t+n,pn.empty,!0);e.step(r)}(this,e,t),this}wrap(e,t){return function(e,t,n){let r=sn.empty;for(let e=n.length-1;e>=0;e--){if(r.size){let t=n[e].type.contentMatch.matchFragment(r);if(!t||!t.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=sn.from(n[e].type.create(n[e].attrs,r))}let o=t.start,i=t.end;e.step(new Sr(o,i,o,i,new pn(r,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,r=null){return function(e,t,n,r,o){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=e.steps.length;e.doc.nodesBetween(t,n,((t,n)=>{if(t.isTextblock&&!t.hasMarkup(r,o)&&function(e,t,n){let r=e.resolve(t),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}(e.doc,e.mapping.slice(i).map(n),r)){e.clearIncompatible(e.mapping.slice(i).map(n,1),r);let s=e.mapping.slice(i),a=s.map(n,1),l=s.map(n+t.nodeSize,1);return e.step(new Sr(a,l,a+1,l-1,new pn(sn.from(r.create(o,null,t.marks)),0,0),1,!0)),!1}}))}(this,e,t,n,r),this}setNodeMarkup(e,t,n=null,r){return function(e,t,n,r,o){let i=e.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let s=n.create(r,null,o||i.marks);if(i.isLeaf)return e.replaceWith(t,t+i.nodeSize,s);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new Sr(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new pn(sn.from(s),0,0),1,!0))}(this,e,t,n,r),this}setNodeAttribute(e,t,n){return this.step(new Wr(e,t,n)),this}setDocAttribute(e,t){return this.step(new Jr(e,t)),this}addNodeMark(e,t){return this.step(new kr(e,t)),this}removeNodeMark(e,t){if(!(t instanceof un)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(!(t=t.isInSet(n.marks)))return this}return this.step(new xr(e,t)),this}split(e,t=1,n){return function(e,t,n=1,r){let o=e.doc.resolve(t),i=sn.empty,s=sn.empty;for(let e=o.depth,t=o.depth-n,a=n-1;e>t;e--,a--){i=sn.from(o.node(e).copy(i));let t=r&&r[a];s=sn.from(t?t.type.create(t.attrs,s):o.node(e).copy(s))}e.step(new Mr(t,t,new pn(i.append(s),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){return function(e,t,n,r){let o,i,s=[],a=[];e.doc.nodesBetween(t,n,((e,l,c)=>{if(!e.isInline)return;let u=e.marks;if(!r.isInSet(u)&&c.type.allowsMarkType(r.type)){let c=Math.max(l,t),d=Math.min(l+e.nodeSize,n),p=r.addToSet(u);for(let e=0;e<u.length;e++)u[e].isInSet(p)||(o&&o.to==c&&o.mark.eq(u[e])?o.to=d:s.push(o=new wr(c,d,u[e])));i&&i.to==c?i.to=d:a.push(i=new br(c,d,r))}})),s.forEach((t=>e.step(t))),a.forEach((t=>e.step(t)))}(this,e,t,n),this}removeMark(e,t,n){return function(e,t,n,r){let o=[],i=0;e.doc.nodesBetween(t,n,((e,s)=>{if(!e.isInline)return;i++;let a=null;if(r instanceof Kn){let t,n=e.marks;for(;t=r.isInSet(n);)(a||(a=[])).push(t),n=t.removeFromSet(n)}else r?r.isInSet(e.marks)&&(a=[r]):a=e.marks;if(a&&a.length){let r=Math.min(s+e.nodeSize,n);for(let e=0;e<a.length;e++){let n,l=a[e];for(let e=0;e<o.length;e++){let t=o[e];t.step==i-1&&l.eq(o[e].style)&&(n=t)}n?(n.to=r,n.step=i):o.push({style:l,from:Math.max(s,t),to:r,step:i})}}})),o.forEach((t=>e.step(new wr(t.from,t.to,t.style))))}(this,e,t,n),this}clearIncompatible(e,t,n){return function(e,t,n,r=n.contentMatch){let o=e.doc.nodeAt(t),i=[],s=t+1;for(let t=0;t<o.childCount;t++){let a=o.child(t),l=s+a.nodeSize,c=r.matchType(a.type);if(c){r=c;for(let t=0;t<a.marks.length;t++)n.allowsMarkType(a.marks[t].type)||e.step(new wr(s,l,a.marks[t]));if(a.isText&&!n.spec.code){let e,t,r=/\r?\n|\r/g;for(;e=r.exec(a.text);)t||(t=new pn(sn.from(n.schema.text(" ",n.allowedMarks(a.marks))),0,0)),i.push(new Mr(s+e.index,s+e.index+e[0].length,t))}}else i.push(new Mr(s,l,pn.empty));s=l}if(!r.validEnd){let t=r.fillBefore(sn.empty,!0);e.replace(s,s,new pn(t,0,0))}for(let t=i.length-1;t>=0;t--)e.step(i[t])}(this,e,t,n),this}}const Gr=Object.create(null);class Yr{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Zr(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=pn.empty){let n=t.content.lastChild,r=null;for(let e=0;e<t.openEnd;e++)r=n,n=n.lastChild;let o=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:a,$to:l}=i[s],c=e.mapping.slice(o);e.replaceRange(c.map(a.pos),c.map(l.pos),s?pn.empty:t),0==s&&ao(e,o,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let o=0;o<r.length;o++){let{$from:i,$to:s}=r[o],a=e.mapping.slice(n),l=a.map(i.pos),c=a.map(s.pos);o?e.deleteRange(l,c):(e.replaceRangeWith(l,c,t),ao(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new eo(e):so(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let r=e.depth-1;r>=0;r--){let o=t<0?so(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):so(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new oo(e.node(0))}static atStart(e){return so(e,e,0,0,1)||new oo(e)}static atEnd(e){return so(e,e,e.content.size,e.childCount,-1)||new oo(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=Gr[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Gr)throw new RangeError("Duplicate use of selection JSON ID "+e);return Gr[e]=t,t.prototype.jsonID=e,t}getBookmark(){return eo.between(this.$anchor,this.$head).getBookmark()}}Yr.prototype.visible=!0;class Zr{constructor(e,t){this.$from=e,this.$to=t}}let Xr=!1;function Qr(e){Xr||e.parent.inlineContent||(Xr=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class eo extends Yr{constructor(e,t=e){Qr(e),Qr(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Yr.near(n);let r=e.resolve(t.map(this.anchor));return new eo(r.parent.inlineContent?r:n,n)}replace(e,t=pn.empty){if(super.replace(e,t),t==pn.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof eo&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new to(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new eo(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if(n&&!r||(n=r>=0?1:-1),!t.parent.inlineContent){let e=Yr.findFrom(t,n,!0)||Yr.findFrom(t,-n,!0);if(!e)return Yr.near(t,n);t=e.$head}return e.parent.inlineContent||(0==r||(e=(Yr.findFrom(e,-n,!0)||Yr.findFrom(e,n,!0)).$anchor).pos<t.pos!=r<0)&&(e=t),new eo(e,t)}}Yr.jsonID("text",eo);class to{constructor(e,t){this.anchor=e,this.head=t}map(e){return new to(e.map(this.anchor),e.map(this.head))}resolve(e){return eo.between(e.resolve(this.anchor),e.resolve(this.head))}}class no extends Yr{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),o=e.resolve(r);return n?Yr.near(o):new no(o)}content(){return new pn(sn.from(this.node),0,0)}eq(e){return e instanceof no&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new ro(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new no(e.resolve(t.anchor))}static create(e,t){return new no(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}no.prototype.visible=!1,Yr.jsonID("node",no);class ro{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new to(n,n):new ro(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&no.isSelectable(n)?new no(t):Yr.near(t)}}class oo extends Yr{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=pn.empty){if(t==pn.empty){e.delete(0,e.doc.content.size);let t=Yr.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new oo(e)}map(e){return new oo(e)}eq(e){return e instanceof oo}getBookmark(){return io}}Yr.jsonID("all",oo);const io={map(){return this},resolve:e=>new oo(e)};function so(e,t,n,r,o,i=!1){if(t.inlineContent)return eo.create(e,n);for(let s=r-(o>0?0:1);o>0?s<t.childCount:s>=0;s+=o){let r=t.child(s);if(r.isAtom){if(!i&&no.isSelectable(r))return no.create(e,n-(o<0?r.nodeSize:0))}else{let t=so(e,r,n+o,o<0?r.childCount:0,o,i);if(t)return t}n+=r.nodeSize*o}return null}function ao(e,t,n){let r=e.steps.length-1;if(r<t)return;let o,i=e.steps[r];(i instanceof Mr||i instanceof Sr)&&(e.mapping.maps[r].forEach(((e,t,n,r)=>{null==o&&(o=r)})),e.setSelection(Yr.near(e.doc.resolve(o),n)))}class lo extends Ur{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return un.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||un.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let o=this.storedMarks;if(!o){let e=this.doc.resolve(t);o=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,o)),this.selection.empty||this.setSelection(Yr.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function co(e,t){return t&&e?e.bind(t):e}class uo{constructor(e,t,n){this.name=e,this.init=co(t.init,n),this.apply=co(t.apply,n)}}const po=[new uo("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new uo("selection",{init:(e,t)=>e.selection||Yr.atStart(t.doc),apply:e=>e.selection}),new uo("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,r)=>r.selection.$cursor?e.storedMarks:null}),new uo("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class ho{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=po.slice(),t&&t.forEach((e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new uo(e.key,e.spec.state,e))}))}}class fo{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let o=!1;for(let i=0;i<this.config.plugins.length;i++){let s=this.config.plugins[i];if(s.spec.appendTransaction){let a=r?r[i].n:0,l=r?r[i].state:this,c=a<t.length&&s.spec.appendTransaction.call(s,a?t.slice(a):t,l,n);if(c&&n.filterTransaction(c,i)){if(c.setMeta("appendedTransaction",e),!r){r=[];for(let e=0;e<this.config.plugins.length;e++)r.push(e<i?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),o=!0}r&&(r[i]={state:n,n:t.length})}}if(!o)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new fo(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let o=n[r];t[o.name]=o.apply(e,this[o.name],this,t)}return t}get tr(){return new lo(this)}static create(e){let t=new ho(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new fo(t);for(let r=0;r<t.fields.length;r++)n[t.fields[r].name]=t.fields[r].init(e,n);return n}reconfigure(e){let t=new ho(this.schema,e.plugins),n=t.fields,r=new fo(t);for(let t=0;t<n.length;t++){let o=n[t].name;r[o]=this.hasOwnProperty(o)?this[o]:n[t].init(e,r)}return r}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map((e=>e.toJSON()))),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],o=r.spec.state;o&&o.toJSON&&(t[n]=o.toJSON.call(r,this[r.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let r=new ho(e.schema,e.plugins),o=new fo(r);return r.fields.forEach((r=>{if("doc"==r.name)o.doc=Nn.fromJSON(e.schema,t.doc);else if("selection"==r.name)o.selection=Yr.fromJSON(o.doc,t.selection);else if("storedMarks"==r.name)t.storedMarks&&(o.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let i in n){let s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(t,i))return void(o[r.name]=a.fromJSON.call(s,e,t[i],o))}o[r.name]=r.init(e,o)}})),o}}function mo(e,t,n){for(let r in e){let o=e[r];o instanceof Function?o=o.bind(t):"handleDOMEvents"==r&&(o=mo(o,t,{})),n[r]=o}return n}class go{constructor(e){this.spec=e,this.props={},e.props&&mo(e.props,this,this.props),this.key=e.key?e.key.key:vo("plugin")}getState(e){return e[this.key]}}const yo=Object.create(null);function vo(e){return e in yo?e+"$"+ ++yo[e]:(yo[e]=0,e+"$")}class bo{constructor(e="key"){this.key=vo(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const wo=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function ko(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}const xo=(e,t,n)=>{let r=ko(e,n);if(!r)return!1;let o=Oo(r);if(!o){let n=r.blockRange(),o=n&&Ar(n);return null!=o&&(t&&t(e.tr.lift(n,o).scrollIntoView()),!0)}let i=o.nodeBefore;if(!i.type.spec.isolating&&Vo(e,o,t))return!0;if(0==r.parent.content.size&&(So(i,"end")||no.isSelectable(i))){let n=Lr(e.doc,r.before(),r.after(),pn.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(So(i,"end")?Yr.findFrom(r.doc.resolve(r.mapping.map(o.pos,-1)),-1):no.create(r.doc,o.pos-i.nodeSize)),t(r.scrollIntoView())}return!0}}return!(!i.isAtom||o.depth!=r.depth-1)&&(t&&t(e.tr.delete(o.pos-i.nodeSize,o.pos).scrollIntoView()),!0)};function Mo(e,t,n){let r=t.nodeBefore,o=t.pos-1;for(;!r.isTextblock;o--){if(r.type.spec.isolating)return!1;let e=r.lastChild;if(!e)return!1;r=e}let i=t.nodeAfter,s=t.pos+1;for(;!i.isTextblock;s++){if(i.type.spec.isolating)return!1;let e=i.firstChild;if(!e)return!1;i=e}let a=Lr(e.doc,o,s,pn.empty);if(!a||a.from!=o||a instanceof Mr&&a.slice.size>=s-o)return!1;if(n){let t=e.tr.step(a);t.setSelection(eo.create(t.doc,o)),n(t.scrollIntoView())}return!0}function So(e,t,n=!1){for(let r=e;r;r="start"==t?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)return!1}return!1}const Co=(e,t,n)=>{let{$head:r,empty:o}=e.selection,i=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):r.parentOffset>0)return!1;i=Oo(r)}let s=i&&i.nodeBefore;return!(!s||!no.isSelectable(s))&&(t&&t(e.tr.setSelection(no.create(e.doc,i.pos-s.nodeSize)).scrollIntoView()),!0)};function Oo(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function Ao(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}const To=(e,t,n)=>{let r=Ao(e,n);if(!r)return!1;let o=No(r);if(!o)return!1;let i=o.nodeAfter;if(Vo(e,o,t))return!0;if(0==r.parent.content.size&&(So(i,"start")||no.isSelectable(i))){let n=Lr(e.doc,r.before(),r.after(),pn.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(So(i,"start")?Yr.findFrom(r.doc.resolve(r.mapping.map(o.pos)),1):no.create(r.doc,r.mapping.map(o.pos))),t(r.scrollIntoView())}return!0}}return!(!i.isAtom||o.depth!=r.depth-1)&&(t&&t(e.tr.delete(o.pos,o.pos+i.nodeSize).scrollIntoView()),!0)},_o=(e,t,n)=>{let{$head:r,empty:o}=e.selection,i=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):r.parentOffset<r.parent.content.size)return!1;i=No(r)}let s=i&&i.nodeAfter;return!(!s||!no.isSelectable(s))&&(t&&t(e.tr.setSelection(no.create(e.doc,i.pos)).scrollIntoView()),!0)};function No(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const $o=(e,t)=>{let{$from:n,$to:r}=e.selection,o=n.blockRange(r),i=o&&Ar(o);return null!=i&&(t&&t(e.tr.lift(o,i).scrollIntoView()),!0)},Eo=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(r))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function Do(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const Io=(e,t)=>{let{$head:n,$anchor:r}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let o=n.node(-1),i=n.indexAfter(-1),s=Do(o.contentMatchAt(i));if(!s||!o.canReplaceWith(i,i,s))return!1;if(t){let r=n.after(),o=e.tr.replaceWith(r,r,s.createAndFill());o.setSelection(Yr.near(o.doc.resolve(r),1)),t(o.scrollIntoView())}return!0},Lo=(e,t)=>{let n=e.selection,{$from:r,$to:o}=n;if(n instanceof oo||r.parent.inlineContent||o.parent.inlineContent)return!1;let i=Do(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(t){let n=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,s=e.tr.insert(n,i.createAndFill());s.setSelection(eo.create(s.doc,n+1)),t(s.scrollIntoView())}return!0},Po=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if(Nr(e.doc,r))return t&&t(e.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),o=r&&Ar(r);return null!=o&&(t&&t(e.tr.lift(r,o).scrollIntoView()),!0)};const zo=(e,t)=>{let{$from:n,$to:r}=e.selection;if(e.selection instanceof no&&e.selection.node.isBlock)return!(!n.parentOffset||!Nr(e.doc,n.pos)||(t&&t(e.tr.split(n.pos).scrollIntoView()),0));if(!n.parent.isBlock)return!1;if(t){let o=r.parentOffset==r.parent.content.size,i=e.tr;(e.selection instanceof eo||e.selection instanceof oo)&&i.deleteSelection();let s=0==n.depth?null:Do(n.node(-1).contentMatchAt(n.indexAfter(-1))),a=jo&&jo(r.parent,o),l=a?[a]:o&&s?[{type:s}]:void 0,c=Nr(i.doc,i.mapping.map(n.pos),1,l);if(l||c||!Nr(i.doc,i.mapping.map(n.pos),1,s?[{type:s}]:void 0)||(s&&(l=[{type:s}]),c=!0),c&&(i.split(i.mapping.map(n.pos),1,l),!o&&!n.parentOffset&&n.parent.type!=s)){let e=i.mapping.map(n.before()),t=i.doc.resolve(e);s&&n.node(-1).canReplaceWith(t.index(),t.index()+1,s)&&i.setNodeMarkup(i.mapping.map(n.before()),s)}t(i.scrollIntoView())}return!0};var jo;const Bo=(e,t)=>{let n,{$from:r,to:o}=e.selection,i=r.sharedDepth(o);return 0!=i&&(n=r.before(i),t&&t(e.tr.setSelection(no.create(e.doc,n))),!0)};function Vo(e,t,n){let r,o,i=t.nodeBefore,s=t.nodeAfter;if(i.type.spec.isolating||s.type.spec.isolating)return!1;if(function(e,t,n){let r=t.nodeBefore,o=t.nodeAfter,i=t.index();return!(!(r&&o&&r.type.compatibleContent(o.type))||(!r.content.size&&t.parent.canReplace(i-1,i)?(n&&n(e.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(i,i+1)||!o.isTextblock&&!$r(e.doc,t.pos)||(n&&n(e.tr.clearIncompatible(t.pos,r.type,r.contentMatchAt(r.childCount)).join(t.pos).scrollIntoView()),0)))}(e,t,n))return!0;let a=t.parent.canReplace(t.index(),t.index()+1);if(a&&(r=(o=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&o.matchType(r[0]||s.type).validEnd){if(n){let o=t.pos+s.nodeSize,a=sn.empty;for(let e=r.length-1;e>=0;e--)a=sn.from(r[e].create(null,a));a=sn.from(i.copy(a));let l=e.tr.step(new Sr(t.pos-1,o,t.pos,o,new pn(a,1,0),r.length,!0)),c=o+2*r.length;$r(l.doc,c)&&l.join(c),n(l.scrollIntoView())}return!0}let l=Yr.findFrom(t,1),c=l&&l.$from.blockRange(l.$to),u=c&&Ar(c);if(null!=u&&u>=t.depth)return n&&n(e.tr.lift(c,u).scrollIntoView()),!0;if(a&&So(s,"start",!0)&&So(i,"end")){let r=i,o=[];for(;o.push(r),!r.isTextblock;)r=r.lastChild;let a=s,l=1;for(;!a.isTextblock;a=a.firstChild)l++;if(r.canReplace(r.childCount,r.childCount,a.content)){if(n){let r=sn.empty;for(let e=o.length-1;e>=0;e--)r=sn.from(o[e].copy(r));n(e.tr.step(new Sr(t.pos-o.length,t.pos+s.nodeSize,t.pos+l,t.pos+s.nodeSize-l,new pn(r,o.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Ro(e){return function(t,n){let r=t.selection,o=e<0?r.$from:r.$to,i=o.depth;for(;o.node(i).isInline;){if(!i)return!1;i--}return!!o.node(i).isTextblock&&(n&&n(t.tr.setSelection(eo.create(t.doc,e<0?o.start(i):o.end(i)))),!0)}}const Ho=Ro(-1),Fo=Ro(1);function qo(e,t=null){return function(n,r){let{$from:o,$to:i}=n.selection,s=o.blockRange(i),a=s&&Tr(s,e,t);return!!a&&(r&&r(n.tr.wrap(s,a).scrollIntoView()),!0)}}function Wo(e,t=null){return function(n,r){let o=!1;for(let r=0;r<n.selection.ranges.length&&!o;r++){let{$from:{pos:i},$to:{pos:s}}=n.selection.ranges[r];n.doc.nodesBetween(i,s,((r,i)=>{if(o)return!1;if(r.isTextblock&&!r.hasMarkup(e,t))if(r.type==e)o=!0;else{let t=n.doc.resolve(i),r=t.index();o=t.parent.canReplaceWith(r,r+1,e)}}))}if(!o)return!1;if(r){let o=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:i},$to:{pos:s}}=n.selection.ranges[r];o.setBlockType(i,s,e,t)}r(o.scrollIntoView())}return!0}}function Jo(...e){return function(t,n,r){for(let o=0;o<e.length;o++)if(e[o](t,n,r))return!0;return!1}}let Ko=Jo(wo,xo,Co),Uo=Jo(wo,To,_o);const Go={Enter:Jo(Eo,Lo,Po,zo),"Mod-Enter":Io,Backspace:Ko,"Mod-Backspace":Ko,"Shift-Backspace":Ko,Delete:Uo,"Mod-Delete":Uo,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new oo(e.doc))),!0)},Yo={"Ctrl-h":Go.Backspace,"Alt-Backspace":Go["Mod-Backspace"],"Ctrl-d":Go.Delete,"Ctrl-Alt-Backspace":Go["Mod-Delete"],"Alt-Delete":Go["Mod-Delete"],"Alt-d":Go["Mod-Delete"],"Ctrl-a":Ho,"Ctrl-e":Fo};for(let e in Go)Yo[e]=Go[e];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&os.platform();function Zo(e,t=null){return function(n,r){let{$from:o,$to:i}=n.selection,s=o.blockRange(i),a=!1,l=s;if(!s)return!1;if(s.depth>=2&&o.node(s.depth-1).type.compatibleContent(e)&&0==s.startIndex){if(0==o.index(s.depth-1))return!1;let e=n.doc.resolve(s.start-2);l=new Tn(e,e,s.depth),s.endIndex<s.parent.childCount&&(s=new Tn(o,n.doc.resolve(i.end(s.depth)),s.depth)),a=!0}let c=Tr(l,e,t,s);return!!c&&(r&&r(function(e,t,n,r,o){let i=sn.empty;for(let e=n.length-1;e>=0;e--)i=sn.from(n[e].type.create(n[e].attrs,i));e.step(new Sr(t.start-(r?2:0),t.end,t.start,t.end,new pn(i,0,0),n.length,!0));let s=0;for(let e=0;e<n.length;e++)n[e].type==o&&(s=e+1);let a=n.length-s,l=t.start+n.length-(r?2:0),c=t.parent;for(let n=t.startIndex,r=t.endIndex,o=!0;n<r;n++,o=!1)!o&&Nr(e.doc,l,a)&&(e.split(l,a),l+=2*a),l+=c.child(n).nodeSize;return e}(n.tr,s,c,a,e).scrollIntoView()),!0)}}function Xo(e){return function(t,n){let{$from:r,$to:o}=t.selection,i=r.blockRange(o,(t=>t.childCount>0&&t.firstChild.type==e));return!!i&&(!n||(r.node(i.depth-1).type==e?function(e,t,n,r){let o=e.tr,i=r.end,s=r.$to.end(r.depth);i<s&&(o.step(new Sr(i-1,s,i,s,new pn(sn.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Tn(o.doc.resolve(r.$from.pos),o.doc.resolve(s),r.depth));const a=Ar(r);if(null==a)return!1;o.lift(r,a);let l=o.mapping.map(i,-1)-1;$r(o.doc,l)&&o.join(l);return t(o.scrollIntoView()),!0}(t,n,e,i):function(e,t,n){let r=e.tr,o=n.parent;for(let e=n.end,t=n.endIndex-1,i=n.startIndex;t>i;t--)e-=o.child(t).nodeSize,r.delete(e-1,e+1);let i=r.doc.resolve(n.start),s=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,l=n.endIndex==o.childCount,c=i.node(-1),u=i.index(-1);if(!c.canReplace(u+(a?0:1),u+1,s.content.append(l?sn.empty:sn.from(o))))return!1;let d=i.pos,p=d+s.nodeSize;return r.step(new Sr(d-(a?1:0),p+(l?1:0),d+1,p-1,new pn((a?sn.empty:sn.from(o.copy(sn.empty))).append(l?sn.empty:sn.from(o.copy(sn.empty))),a?0:1,l?0:1),a?0:1)),t(r.scrollIntoView()),!0}(t,n,i)))}}function Qo(e){return function(t,n){let{$from:r,$to:o}=t.selection,i=r.blockRange(o,(t=>t.childCount>0&&t.firstChild.type==e));if(!i)return!1;let s=i.startIndex;if(0==s)return!1;let a=i.parent,l=a.child(s-1);if(l.type!=e)return!1;if(n){let r=l.lastChild&&l.lastChild.type==a.type,o=sn.from(r?e.create():null),s=new pn(sn.from(e.create(null,sn.from(a.type.create(null,o)))),r?3:1,0),c=i.start,u=i.end;n(t.tr.step(new Sr(c-(r?3:1),u,c,u,s,1,!0)).scrollIntoView())}return!0}}const ei=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},ti=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let ni=null;const ri=function(e,t,n){let r=ni||(ni=document.createRange());return r.setEnd(e,null==n?e.nodeValue.length:n),r.setStart(e,t||0),r},oi=function(e,t,n,r){return n&&(si(e,t,n,r,-1)||si(e,t,n,r,1))},ii=/^(img|br|input|textarea|hr)$/i;function si(e,t,n,r,o){for(;;){if(e==n&&t==r)return!0;if(t==(o<0?0:ai(e))){let n=e.parentNode;if(!n||1!=n.nodeType||li(e)||ii.test(e.nodeName)||"false"==e.contentEditable)return!1;t=ei(e)+(o<0?0:1),e=n}else{if(1!=e.nodeType)return!1;if("false"==(e=e.childNodes[t+(o<0?-1:0)]).contentEditable)return!1;t=o<0?ai(e):0}}}function ai(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function li(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const ci=function(e){return e.focusNode&&oi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function ui(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}const di="undefined"!=typeof navigator?navigator:null,pi="undefined"!=typeof document?document:null,hi=di&&di.userAgent||"",fi=/Edge\/(\d+)/.exec(hi),mi=/MSIE \d/.exec(hi),gi=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(hi),yi=!!(mi||gi||fi),vi=mi?document.documentMode:gi?+gi[1]:fi?+fi[1]:0,bi=!yi&&/gecko\/(\d+)/i.test(hi);bi&&(/Firefox\/(\d+)/.exec(hi)||[0,0])[1];const wi=!yi&&/Chrome\/(\d+)/.exec(hi),ki=!!wi,xi=wi?+wi[1]:0,Mi=!yi&&!!di&&/Apple Computer/.test(di.vendor),Si=Mi&&(/Mobile\/\w+/.test(hi)||!!di&&di.maxTouchPoints>2),Ci=Si||!!di&&/Mac/.test(di.platform),Oi=!!di&&/Win/.test(di.platform),Ai=/Android \d/.test(hi),Ti=!!pi&&"webkitFontSmoothing"in pi.documentElement.style,_i=Ti?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Ni(e){let t=e.defaultView&&e.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function $i(e,t){return"number"==typeof e?e:e[t]}function Ei(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,r=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*r}}function Di(e,t,n){let r=e.someProp("scrollThreshold")||0,o=e.someProp("scrollMargin")||5,i=e.dom.ownerDocument;for(let s=n||e.dom;s;s=ti(s)){if(1!=s.nodeType)continue;let e=s,n=e==i.body,a=n?Ni(i):Ei(e),l=0,c=0;if(t.top<a.top+$i(r,"top")?c=-(a.top-t.top+$i(o,"top")):t.bottom>a.bottom-$i(r,"bottom")&&(c=t.bottom-t.top>a.bottom-a.top?t.top+$i(o,"top")-a.top:t.bottom-a.bottom+$i(o,"bottom")),t.left<a.left+$i(r,"left")?l=-(a.left-t.left+$i(o,"left")):t.right>a.right-$i(r,"right")&&(l=t.right-a.right+$i(o,"right")),l||c)if(n)i.defaultView.scrollBy(l,c);else{let n=e.scrollLeft,r=e.scrollTop;c&&(e.scrollTop+=c),l&&(e.scrollLeft+=l);let o=e.scrollLeft-n,i=e.scrollTop-r;t={left:t.left-o,top:t.top-i,right:t.right-o,bottom:t.bottom-i}}if(n||/^(fixed|sticky)$/.test(getComputedStyle(s).position))break}}function Ii(e){let t=[],n=e.ownerDocument;for(let r=e;r&&(t.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),e!=n);r=ti(r));return t}function Li(e,t){for(let n=0;n<e.length;n++){let{dom:r,top:o,left:i}=e[n];r.scrollTop!=o+t&&(r.scrollTop=o+t),r.scrollLeft!=i&&(r.scrollLeft=i)}}let Pi=null;function zi(e,t){let n,r,o,i,s=2e8,a=0,l=t.top,c=t.top;for(let u=e.firstChild,d=0;u;u=u.nextSibling,d++){let e;if(1==u.nodeType)e=u.getClientRects();else{if(3!=u.nodeType)continue;e=ri(u).getClientRects()}for(let p=0;p<e.length;p++){let h=e[p];if(h.top<=l&&h.bottom>=c){l=Math.max(h.bottom,l),c=Math.min(h.top,c);let e=h.left>t.left?h.left-t.left:h.right<t.left?t.left-h.right:0;if(e<s){n=u,s=e,r=e&&3==n.nodeType?{left:h.right<t.left?h.right:h.left,top:t.top}:t,1==u.nodeType&&e&&(a=d+(t.left>=(h.left+h.right)/2?1:0));continue}}else h.top>t.top&&!o&&h.left<=t.left&&h.right>=t.left&&(o=u,i={left:Math.max(h.left,Math.min(h.right,t.left)),top:h.top});!n&&(t.left>=h.right&&t.top>=h.top||t.left>=h.left&&t.top>=h.bottom)&&(a=d+1)}}return!n&&o&&(n=o,r=i,s=0),n&&3==n.nodeType?function(e,t){let n=e.nodeValue.length,r=document.createRange();for(let o=0;o<n;o++){r.setEnd(e,o+1),r.setStart(e,o);let n=Hi(r,1);if(n.top!=n.bottom&&ji(t,n))return{node:e,offset:o+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}(n,r):!n||s&&1==n.nodeType?{node:e,offset:a}:zi(n,r)}function ji(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function Bi(e,t,n){let r=e.childNodes.length;if(r&&n.top<n.bottom)for(let o=Math.max(0,Math.min(r-1,Math.floor(r*(t.top-n.top)/(n.bottom-n.top))-2)),i=o;;){let n=e.childNodes[i];if(1==n.nodeType){let e=n.getClientRects();for(let r=0;r<e.length;r++){let o=e[r];if(ji(t,o))return Bi(n,t,o)}}if((i=(i+1)%r)==o)break}return e}function Vi(e,t){let n,r=e.dom.ownerDocument,o=0,i=function(e,t,n){if(e.caretPositionFromPoint)try{let r=e.caretPositionFromPoint(t,n);if(r)return{node:r.offsetNode,offset:r.offset}}catch(e){}if(e.caretRangeFromPoint){let r=e.caretRangeFromPoint(t,n);if(r)return{node:r.startContainer,offset:r.startOffset}}}(r,t.left,t.top);i&&({node:n,offset:o}=i);let s,a=(e.root.elementFromPoint?e.root:r).elementFromPoint(t.left,t.top);if(!a||!e.dom.contains(1!=a.nodeType?a.parentNode:a)){let n=e.dom.getBoundingClientRect();if(!ji(t,n))return null;if(a=Bi(e.dom,t,n),!a)return null}if(Mi)for(let e=a;n&&e;e=ti(e))e.draggable&&(n=void 0);if(a=function(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}(a,t),n){if(bi&&1==n.nodeType&&(o=Math.min(o,n.childNodes.length),o<n.childNodes.length)){let e,r=n.childNodes[o];"IMG"==r.nodeName&&(e=r.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&o++}let r;Ti&&o&&1==n.nodeType&&1==(r=n.childNodes[o-1]).nodeType&&"false"==r.contentEditable&&r.getBoundingClientRect().top>=t.top&&o--,n==e.dom&&o==n.childNodes.length-1&&1==n.lastChild.nodeType&&t.top>n.lastChild.getBoundingClientRect().bottom?s=e.state.doc.content.size:0!=o&&1==n.nodeType&&"BR"==n.childNodes[o-1].nodeName||(s=function(e,t,n,r){let o=-1;for(let n=t,i=!1;n!=e.dom;){let t=e.docView.nearestDesc(n,!0);if(!t)return null;if(1==t.dom.nodeType&&(t.node.isBlock&&t.parent&&!i||!t.contentDOM)){let e=t.dom.getBoundingClientRect();if(t.node.isBlock&&t.parent&&!i&&(i=!0,e.left>r.left||e.top>r.top?o=t.posBefore:(e.right<r.left||e.bottom<r.top)&&(o=t.posAfter)),!t.contentDOM&&o<0&&!t.node.isText)return(t.node.isBlock?r.top<(e.top+e.bottom)/2:r.left<(e.left+e.right)/2)?t.posBefore:t.posAfter}n=t.dom.parentNode}return o>-1?o:e.docView.posFromDOM(t,n,-1)}(e,n,o,t))}null==s&&(s=function(e,t,n){let{node:r,offset:o}=zi(t,n),i=-1;if(1==r.nodeType&&!r.firstChild){let e=r.getBoundingClientRect();i=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(r,o,i)}(e,a,t));let l=e.docView.nearestDesc(a,!0);return{pos:s,inside:l?l.posAtStart-l.border:-1}}function Ri(e){return e.top<e.bottom||e.left<e.right}function Hi(e,t){let n=e.getClientRects();if(n.length){let e=n[t<0?0:n.length-1];if(Ri(e))return e}return Array.prototype.find.call(n,Ri)||e.getBoundingClientRect()}const Fi=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function qi(e,t,n){let{node:r,offset:o,atom:i}=e.docView.domFromPos(t,n<0?-1:1),s=Ti||bi;if(3==r.nodeType){if(!s||!Fi.test(r.nodeValue)&&(n<0?o:o!=r.nodeValue.length)){let e=o,t=o,i=n<0?1:-1;return n<0&&!o?(t++,i=-1):n>=0&&o==r.nodeValue.length?(e--,i=1):n<0?e--:t++,Wi(Hi(ri(r,e,t),i),i<0)}{let e=Hi(ri(r,o,o),n);if(bi&&o&&/\s/.test(r.nodeValue[o-1])&&o<r.nodeValue.length){let t=Hi(ri(r,o-1,o-1),-1);if(t.top==e.top){let n=Hi(ri(r,o,o+1),-1);if(n.top!=e.top)return Wi(n,n.left<t.left)}}return e}}if(!e.state.doc.resolve(t-(i||0)).parent.inlineContent){if(null==i&&o&&(n<0||o==ai(r))){let e=r.childNodes[o-1];if(1==e.nodeType)return Ji(e.getBoundingClientRect(),!1)}if(null==i&&o<ai(r)){let e=r.childNodes[o];if(1==e.nodeType)return Ji(e.getBoundingClientRect(),!0)}return Ji(r.getBoundingClientRect(),n>=0)}if(null==i&&o&&(n<0||o==ai(r))){let e=r.childNodes[o-1],t=3==e.nodeType?ri(e,ai(e)-(s?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return Wi(Hi(t,1),!1)}if(null==i&&o<ai(r)){let e=r.childNodes[o];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?3==e.nodeType?ri(e,0,s?0:1):1==e.nodeType?e:null:null;if(t)return Wi(Hi(t,-1),!0)}return Wi(Hi(3==r.nodeType?ri(r):r,-n),n>=0)}function Wi(e,t){if(0==e.width)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function Ji(e,t){if(0==e.height)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function Ki(e,t,n){let r=e.state,o=e.root.activeElement;r!=t&&e.updateState(t),o!=e.dom&&e.focus();try{return n()}finally{r!=t&&e.updateState(r),o!=e.dom&&o&&o.focus()}}const Ui=/[\u0590-\u08ac]/;let Gi=null,Yi=null,Zi=!1;function Xi(e,t,n){return Gi==t&&Yi==n?Zi:(Gi=t,Yi=n,Zi="up"==n||"down"==n?function(e,t,n){let r=t.selection,o="up"==n?r.$from:r.$to;return Ki(e,t,(()=>{let{node:t}=e.docView.domFromPos(o.pos,"up"==n?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let r=qi(e,o.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=ri(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let o=t[e];if(o.bottom>o.top+1&&("up"==n?r.top-o.top>2*(o.bottom-r.top):o.bottom-r.bottom>2*(r.bottom-o.top)))return!1}}return!0}))}(e,t,n):function(e,t,n){let{$head:r}=t.selection;if(!r.parent.isTextblock)return!1;let o=r.parentOffset,i=!o,s=o==r.parent.content.size,a=e.domSelection();return Ui.test(r.parent.textContent)&&a.modify?Ki(e,t,(()=>{let{focusNode:t,focusOffset:o,anchorNode:i,anchorOffset:s}=e.domSelectionRange(),l=a.caretBidiLevel;a.modify("move",n,"character");let c=r.depth?e.docView.domAfterPos(r.before()):e.dom,{focusNode:u,focusOffset:d}=e.domSelectionRange(),p=u&&!c.contains(1==u.nodeType?u:u.parentNode)||t==u&&o==d;try{a.collapse(i,s),t&&(t!=i||o!=s)&&a.extend&&a.extend(t,o)}catch(e){}return null!=l&&(a.caretBidiLevel=l),p})):"left"==n||"backward"==n?i:s}(e,t,n))}class Qi{constructor(e,t,n,r){this.parent=e,this.children=t,this.dom=n,this.contentDOM=r,this.dirty=0,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let r=this.children[t];if(r==e)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(n<0){let n,r;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&(!(r=n.pmViewDesc)||r.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(r)+r.size:this.posAtStart}{let n,r;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&(!(r=n.pmViewDesc)||r.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(r):this.posAtEnd}}let r;if(e==this.dom&&this.contentDOM)r=t>ei(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){r=!1;break}if(t.previousSibling)break}if(null==r&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){r=!0;break}if(t.nextSibling)break}}return(null==r?n>0:r)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,r=e;r;r=r.parentNode){let o,i=this.getDesc(r);if(i&&(!t||i.node)){if(!n||!(o=i.nodeDOM)||(1==o.nodeType?o.contains(1==e.nodeType?e:e.parentNode):o==e))return i;n=!1}}}getDesc(e){let t=e.pmViewDesc;for(let e=t;e;e=e.parent)if(e==this)return t}posFromDOM(e,t,n){for(let r=e;r;r=r.parentNode){let o=this.getDesc(r);if(o)return o.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let r=this.children[t],o=n+r.size;if(n==e&&o!=n){for(;!r.border&&r.children.length;)r=r.children[0];return r}if(e<o)return r.descAt(e-n-r.border);n=o}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,r=0;for(let t=0;n<this.children.length;n++){let o=this.children[n],i=t+o.size;if(i>e||o instanceof as){r=e-t;break}t=i}if(r)return this.children[n].domFromPos(r-this.children[n].border,t);for(let e;n&&!(e=this.children[n-1]).size&&e instanceof es&&e.side>=0;n--);if(t<=0){let e,r=!0;for(;e=n?this.children[n-1]:null,e&&e.dom.parentNode!=this.contentDOM;n--,r=!1);return e&&t&&r&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?ei(e.dom)+1:0}}{let e,r=!0;for(;e=n<this.children.length?this.children[n]:null,e&&e.dom.parentNode!=this.contentDOM;n++,r=!1);return e&&r&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?ei(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,o=-1;for(let i=n,s=0;;s++){let n=this.children[s],a=i+n.size;if(-1==r&&e<=a){let o=i+n.border;if(e>=o&&t<=a-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,o);e=i;for(let t=s;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){r=ei(n.dom)+1;break}e-=n.size}-1==r&&(r=0)}if(r>-1&&(a>t||s==this.children.length-1)){t=a;for(let e=s+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){o=ei(n.dom);break}t+=n.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=a}return{node:this.contentDOM,from:e,to:t,fromOffset:r,toOffset:o}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(1!=t.nodeType||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,r=!1){let o=Math.min(e,t),i=Math.max(e,t);for(let s=0,a=0;s<this.children.length;s++){let l=this.children[s],c=a+l.size;if(o>a&&i<c)return l.setSelection(e-a-l.border,t-a-l.border,n,r);a=c}let s=this.domFromPos(e,e?-1:1),a=t==e?s:this.domFromPos(t,t?-1:1),l=n.getSelection(),c=!1;if((bi||Mi)&&e==t){let{node:e,offset:t}=s;if(3==e.nodeType){if(c=!(!t||"\n"!=e.nodeValue[t-1]),c&&t==e.nodeValue.length)for(let t,n=e;n;n=n.parentNode){if(t=n.nextSibling){"BR"==t.nodeName&&(s=a={node:t.parentNode,offset:ei(t)+1});break}let e=n.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];c=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(bi&&l.focusNode&&l.focusNode!=a.node&&1==l.focusNode.nodeType){let e=l.focusNode.childNodes[l.focusOffset];e&&"false"==e.contentEditable&&(r=!0)}if(!(r||c&&Mi)&&oi(s.node,s.offset,l.anchorNode,l.anchorOffset)&&oi(a.node,a.offset,l.focusNode,l.focusOffset))return;let u=!1;if((l.extend||e==t)&&!c){l.collapse(s.node,s.offset);try{e!=t&&l.extend(a.node,a.offset),u=!0}catch(e){}}if(!u){if(e>t){let e=s;s=a,a=e}let n=document.createRange();n.setEnd(a.node,a.offset),n.setStart(s.node,s.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,r=0;r<this.children.length;r++){let o=this.children[r],i=n+o.size;if(n==i?e<=i&&t>=n:e<i&&t>n){let r=n+o.border,s=i-o.border;if(e>=r&&t<=s)return this.dirty=e==n||t==i?2:1,void(e!=r||t!=s||!o.contentLost&&o.dom.parentNode==this.contentDOM?o.markDirty(e-r,t-r):o.dirty=3);o.dirty=o.dom!=o.contentDOM||o.dom.parentNode!=this.contentDOM||o.children.length?3:2}n=i}this.dirty=2}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=1==e?2:1;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class es extends Qi{constructor(e,t,n,r){let o,i=t.type.toDOM;if("function"==typeof i&&(i=i(n,(()=>o?o.parent?o.parent.posBeforeChild(o):void 0:r))),!t.type.spec.raw){if(1!=i.nodeType){let e=document.createElement("span");e.appendChild(i),i=e}i.contentEditable="false",i.classList.add("ProseMirror-widget")}super(e,[],i,null),this.widget=t,this.widget=t,o=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class ts extends Qi{constructor(e,t,n,r){super(e,[],t,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class ns extends Qi{constructor(e,t,n,r){super(e,[],n,r),this.mark=t}static create(e,t,n,r){let o=r.nodeViews[t.type.name],i=o&&o(t,r,n);return i&&i.dom||(i=sr.renderSpec(document,t.type.spec.toDOM(t,n))),new ns(e,t,i.dom,i.contentDOM||i.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),0!=this.dirty){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=0}}slice(e,t,n){let r=ns.create(this.parent,this.mark,!0,n),o=this.children,i=this.size;t<i&&(o=ws(o,t,i,n)),e>0&&(o=ws(o,0,e,n));for(let e=0;e<o.length;e++)o[e].parent=r;return r.children=o,r}}class rs extends Qi{constructor(e,t,n,r,o,i,s,a,l){super(e,[],o,i),this.node=t,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=s}static create(e,t,n,r,o,i){let s,a=o.nodeViews[t.type.name],l=a&&a(t,o,(()=>s?s.parent?s.parent.posBeforeChild(s):void 0:i),n,r),c=l&&l.dom,u=l&&l.contentDOM;if(t.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(t.text);else c||({dom:c,contentDOM:u}=sr.renderSpec(document,t.type.spec.toDOM(t)));u||t.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let d=c;return c=ms(c,n,t),l?s=new ls(e,t,n,r,c,u||null,d,l,o,i+1):t.isText?new ss(e,t,n,r,c,d,o):new rs(e,t,n,r,c,u||null,d,o,i+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>sn.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,n){return 0==this.dirty&&e.eq(this.node)&&gs(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,r=t,o=e.composing?this.localCompositionInfo(e,t):null,i=o&&o.pos>-1?o:null,s=o&&o.pos<0,a=new vs(this,i&&i.node,e);!function(e,t,n,r){let o=t.locals(e),i=0;if(0==o.length){for(let n=0;n<e.childCount;n++){let s=e.child(n);r(s,o,t.forChild(i,s),n),i+=s.nodeSize}return}let s=0,a=[],l=null;for(let c=0;;){let u,d,p,h;for(;s<o.length&&o[s].to==i;){let e=o[s++];e.widget&&(u?(d||(d=[u])).push(e):u=e)}if(u)if(d){d.sort(bs);for(let e=0;e<d.length;e++)n(d[e],c,!!l)}else n(u,c,!!l);if(l)h=-1,p=l,l=null;else{if(!(c<e.childCount))break;h=c,p=e.child(c++)}for(let e=0;e<a.length;e++)a[e].to<=i&&a.splice(e--,1);for(;s<o.length&&o[s].from<=i&&o[s].to>i;)a.push(o[s++]);let f=i+p.nodeSize;if(p.isText){let e=f;s<o.length&&o[s].from<e&&(e=o[s].from);for(let t=0;t<a.length;t++)a[t].to<e&&(e=a[t].to);e<f&&(l=p.cut(e-i),p=p.cut(0,e-i),f=e,h=-1)}else for(;s<o.length&&o[s].to<f;)s++;r(p,p.isInline&&!p.isLeaf?a.filter((e=>!e.inline)):a.slice(),t.forChild(i,p),h),i=f}}(this.node,this.innerDeco,((t,o,i)=>{t.spec.marks?a.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!i&&a.syncToMarks(o==this.node.childCount?un.none:this.node.child(o).marks,n,e),a.placeWidget(t,e,r)}),((t,i,l,c)=>{let u;a.syncToMarks(t.marks,n,e),a.findNodeMatch(t,i,l,c)||s&&e.state.selection.from>r&&e.state.selection.to<r+t.nodeSize&&(u=a.findIndexWithChild(o.node))>-1&&a.updateNodeAt(t,i,l,u,e)||a.updateNextNode(t,i,l,e,c,r)||a.addNode(t,i,l,e,r),r+=t.nodeSize})),a.syncToMarks([],n,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||2==this.dirty)&&(i&&this.protectLocalComposition(e,i),cs(this.contentDOM,this.children,e),Si&&function(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}(this.dom))}localCompositionInfo(e,t){let{from:n,to:r}=e.state.selection;if(!(e.state.selection instanceof eo)||n<t||r>t+this.node.content.size)return null;let o=e.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let e=o.nodeValue,i=function(e,t,n,r){for(let o=0,i=0;o<e.childCount&&i<=r;){let s=e.child(o++),a=i;if(i+=s.nodeSize,!s.isText)continue;let l=s.text;for(;o<e.childCount;){let t=e.child(o++);if(i+=t.nodeSize,!t.isText)break;l+=t.text}if(i>=n){if(i>=r&&l.slice(r-t.length-a,r-a)==t)return r-t.length;let e=a<r?l.lastIndexOf(t,r-a-1):-1;if(e>=0&&e+t.length+a>=n)return a+e;if(n==r&&l.length>=r+t.length-a&&l.slice(r-a,r-a+t.length)==t)return r}}return-1}(this.node.content,e,n-t,r-t);return i<0?null:{node:o,pos:i,text:e}}return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:r}){if(this.getDesc(t))return;let o=t;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let i=new ts(this,o,t,r);e.input.compositionNodes.push(i),this.children=ws(this.children,n,n+r.length,e,i)}update(e,t,n,r){return!(3==this.dirty||!e.sameMarkup(this.node))&&(this.updateInner(e,t,n,r),!0)}updateInner(e,t,n,r){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(gs(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=hs(this.dom,this.nodeDOM,ps(this.outerDeco,this.node,t),ps(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function is(e,t,n,r,o){ms(r,t,e);let i=new rs(void 0,e,t,n,r,r,r,o,0);return i.contentDOM&&i.updateChildren(o,0),i}class ss extends rs{constructor(e,t,n,r,o,i,s){super(e,t,n,r,o,null,i,s,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,r){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node))&&(this.updateOuterDeco(t),0==this.dirty&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=e,this.dirty=0,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,n){let r=this.node.cut(e,t),o=document.createTextNode(r.text);return new ss(this.parent,r,this.outerDeco,this.innerDeco,o,o,n)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}isText(e){return this.node.text==e}}class as extends Qi{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class ls extends rs{constructor(e,t,n,r,o,i,s,a,l,c){super(e,t,n,r,o,i,s,l,c),this.spec=a}update(e,t,n,r){if(3==this.dirty)return!1;if(this.spec.update){let o=this.spec.update(e,t,n);return o&&this.updateInner(e,t,n,r),o}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,r){this.spec.setSelection?this.spec.setSelection(e,t,n):super.setSelection(e,t,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function cs(e,t,n){let r=e.firstChild,o=!1;for(let i=0;i<t.length;i++){let s=t[i],a=s.dom;if(a.parentNode==e){for(;a!=r;)r=ys(r),o=!0;r=r.nextSibling}else o=!0,e.insertBefore(a,r);if(s instanceof ns){let t=r?r.previousSibling:e.lastChild;cs(s.contentDOM,s.children,n),r=t?t.nextSibling:e.firstChild}}for(;r;)r=ys(r),o=!0;o&&n.trackWrites==e&&(n.trackWrites=null)}const us=function(e){e&&(this.nodeName=e)};us.prototype=Object.create(null);const ds=[new us];function ps(e,t,n){if(0==e.length)return ds;let r=n?ds[0]:new us,o=[r];for(let i=0;i<e.length;i++){let s=e[i].type.attrs;if(s){s.nodeName&&o.push(r=new us(s.nodeName));for(let e in s){let i=s[e];null!=i&&(n&&1==o.length&&o.push(r=new us(t.isInline?"span":"div")),"class"==e?r.class=(r.class?r.class+" ":"")+i:"style"==e?r.style=(r.style?r.style+";":"")+i:"nodeName"!=e&&(r[e]=i))}}}return o}function hs(e,t,n,r){if(n==ds&&r==ds)return t;let o=t;for(let t=0;t<r.length;t++){let i=r[t],s=n[t];if(t){let t;s&&s.nodeName==i.nodeName&&o!=e&&(t=o.parentNode)&&t.nodeName.toLowerCase()==i.nodeName||(t=document.createElement(i.nodeName),t.pmIsDeco=!0,t.appendChild(o),s=ds[0]),o=t}fs(o,s||ds[0],i)}return o}function fs(e,t,n){for(let r in t)"class"==r||"style"==r||"nodeName"==r||r in n||e.removeAttribute(r);for(let r in n)"class"!=r&&"style"!=r&&"nodeName"!=r&&n[r]!=t[r]&&e.setAttribute(r,n[r]);if(t.class!=n.class){let r=t.class?t.class.split(" ").filter(Boolean):[],o=n.class?n.class.split(" ").filter(Boolean):[];for(let t=0;t<r.length;t++)-1==o.indexOf(r[t])&&e.classList.remove(r[t]);for(let t=0;t<o.length;t++)-1==r.indexOf(o[t])&&e.classList.add(o[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let n,r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=r.exec(t.style);)e.style.removeProperty(n[1])}n.style&&(e.style.cssText+=n.style)}}function ms(e,t,n){return hs(e,e,ds,ps(t,n,1!=e.nodeType))}function gs(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function ys(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class vs{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(e,t){let n=t,r=n.children.length,o=e.childCount,i=new Map,s=[];e:for(;o>0;){let a;for(;;)if(r){let e=n.children[r-1];if(!(e instanceof ns)){a=e,r--;break}n=e,r=e.children.length}else{if(n==t)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=e.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let r=0,o=this.stack.length>>1,i=Math.min(o,e.length);for(;r<i&&(r==o-1?this.top:this.stack[r+1<<1]).matchesMark(e[r])&&!1!==e[r].type.spec.spanning;)r++;for(;r<o;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<e.length;){this.stack.push(this.top,this.index+1);let r=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[o])&&!this.isLocked(n.dom)){r=t;break}}if(r>-1)r>this.index&&(this.changed=!0,this.destroyBetween(this.index,r)),this.top=this.top.children[this.index];else{let r=ns.create(this.top,e[o],t,n);this.top.children.splice(this.index,0,r),this.top=r,this.changed=!0}this.index=0,o++}}findNodeMatch(e,t,n,r){let o,i=-1;if(r>=this.preMatch.index&&(o=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,n))i=this.top.children.indexOf(o,this.index);else for(let r=this.index,o=Math.min(this.top.children.length,r+5);r<o;r++){let o=this.top.children[r];if(o.matchesNode(e,t,n)&&!this.preMatch.matched.has(o)){i=r;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,n,r,o){let i=this.top.children[r];return 3==i.dirty&&i.dom==i.contentDOM&&(i.dirty=2),!!i.update(e,t,n,o)&&(this.destroyBetween(this.index,r),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,n,r,o,i){for(let s=this.index;s<this.top.children.length;s++){let a=this.top.children[s];if(a instanceof rs){let l=this.preMatch.matched.get(a);if(null!=l&&l!=o)return!1;let c,u=a.dom,d=this.isLocked(u)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&3!=a.dirty&&gs(t,a.outerDeco));if(!d&&a.update(e,t,n,r))return this.destroyBetween(this.index,s),a.dom!=u&&(this.changed=!0),this.index++,!0;if(!d&&(c=this.recreateWrapper(a,e,t,n,r,i)))return this.top.children[this.index]=c,c.contentDOM&&(c.dirty=2,c.updateChildren(r,i+1),c.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,r,o,i){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content))return null;let s=rs.create(this.top,t,n,r,o,i);if(s.contentDOM){s.children=e.children,e.children=[];for(let e of s.children)e.parent=s}return e.destroy(),s}addNode(e,t,n,r,o){let i=rs.create(this.top,e,t,n,r,o);i.contentDOM&&i.updateChildren(r,o+1),this.top.children.splice(this.index++,0,i),this.changed=!0}placeWidget(e,t,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(e)||e!=r.widget&&r.widget.type.toDOM.parentNode){let r=new es(this.top,e,t,n);this.top.children.splice(this.index++,0,r),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof ns;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof ss)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Mi||ki)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);"IMG"==e&&(n.className="ProseMirror-separator",n.alt=""),"BR"==e&&(n.className="ProseMirror-trailingBreak");let r=new as(this.top,[],n,null);t!=this.top?t.children.push(r):t.children.splice(this.index++,0,r),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||1==e.nodeType&&e.contains(this.lock.parentNode))}}function bs(e,t){return e.type.side-t.type.side}function ws(e,t,n,r,o){let i=[];for(let s=0,a=0;s<e.length;s++){let l=e[s],c=a,u=a+=l.size;c>=n||u<=t?i.push(l):(c<t&&i.push(l.slice(0,t-c,r)),o&&(i.push(o),o=void 0),u>n&&i.push(l.slice(n-c,l.size,r)))}return i}function ks(e,t=null){let n=e.domSelectionRange(),r=e.state.doc;if(!n.focusNode)return null;let o=e.docView.nearestDesc(n.focusNode),i=o&&0==o.size,s=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;let a,l,c=r.resolve(s);if(ci(n)){for(a=c;o&&!o.node;)o=o.parent;let e=o.node;if(o&&e.isAtom&&no.isSelectable(e)&&o.parent&&(!e.isInline||!function(e,t,n){for(let r=0==t,o=t==ai(e);r||o;){if(e==n)return!0;let t=ei(e);if(!(e=e.parentNode))return!1;r=r&&0==t,o=o&&t==ai(e)}}(n.focusNode,n.focusOffset,o.dom))){let e=o.posBefore;l=new no(s==e?c:r.resolve(e))}}else{let t=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(t<0)return null;a=r.resolve(t)}if(!l){l=Ns(e,a,c,"pointer"==t||e.state.selection.head<c.pos&&!i?1:-1)}return l}function xs(e){return e.editable?e.hasFocus():Es(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function Ms(e,t=!1){let n=e.state.selection;if(Ts(e,n),xs(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&ki){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&oi(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection(),n=document.createRange(),r=e.cursorWrapper.dom,o="IMG"==r.nodeName;o?n.setEnd(r.parentNode,ei(r)+1):n.setEnd(r,0);n.collapse(!1),t.removeAllRanges(),t.addRange(n),!o&&!e.state.selection.visible&&yi&&vi<=11&&(r.disabled=!0,r.disabled=!1)}(e);else{let r,o,{anchor:i,head:s}=n;!Ss||n instanceof eo||(n.$from.parent.inlineContent||(r=Cs(e,n.from)),n.empty||n.$from.parent.inlineContent||(o=Cs(e,n.to))),e.docView.setSelection(i,s,e.root,t),Ss&&(r&&As(r),o&&As(o)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),r=n.anchorNode,o=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==r&&n.anchorOffset==o||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout((()=>{xs(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")}),20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const Ss=Mi||ki&&xi<63;function Cs(e,t){let{node:n,offset:r}=e.docView.domFromPos(t,0),o=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(Mi&&o&&"false"==o.contentEditable)return Os(o);if(!(o&&"false"!=o.contentEditable||i&&"false"!=i.contentEditable)){if(o)return Os(o);if(i)return Os(i)}}function Os(e){return e.contentEditable="true",Mi&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function As(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function Ts(e,t){if(t instanceof no){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(_s(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else _s(e)}function _s(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Ns(e,t,n,r){return e.someProp("createSelectionBetween",(r=>r(e,t,n)))||eo.between(t,n,r)}function $s(e){return!(e.editable&&!e.hasFocus())&&Es(e)}function Es(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}function Ds(e,t){let{$anchor:n,$head:r}=e.selection,o=t>0?n.max(r):n.min(r),i=o.parent.inlineContent?o.depth?e.doc.resolve(t>0?o.after():o.before()):null:o;return i&&Yr.findFrom(i,t)}function Is(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function Ls(e,t,n){let r=e.state.selection;if(!(r instanceof eo)){if(r instanceof no&&r.node.isInline)return Is(e,new eo(t>0?r.$to:r.$from));{let n=Ds(e.state,t);return!!n&&Is(e,n)}}if(n.indexOf("s")>-1){let{$head:n}=r,o=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let i=e.state.doc.resolve(n.pos+o.nodeSize*(t<0?-1:1));return Is(e,new eo(r.$anchor,i))}if(!r.empty)return!1;if(e.endOfTextblock(t>0?"forward":"backward")){let n=Ds(e.state,t);return!!(n&&n instanceof no)&&Is(e,n)}if(!(Ci&&n.indexOf("m")>-1)){let n,o=r.$head,i=o.textOffset?null:t<0?o.nodeBefore:o.nodeAfter;if(!i||i.isText)return!1;let s=t<0?o.pos-i.nodeSize:o.pos;return!!(i.isAtom||(n=e.docView.descAt(s))&&!n.contentDOM)&&(no.isSelectable(i)?Is(e,new no(t<0?e.state.doc.resolve(o.pos-i.nodeSize):o)):!!Ti&&Is(e,new eo(e.state.doc.resolve(t<0?s:s+i.nodeSize))))}}function Ps(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function zs(e,t){let n=e.pmViewDesc;return n&&0==n.size&&(t<0||e.nextSibling||"BR"!=e.nodeName)}function js(e,t){return t<0?function(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let o,i,s=!1;bi&&1==n.nodeType&&r<Ps(n)&&zs(n.childNodes[r],-1)&&(s=!0);for(;;)if(r>0){if(1!=n.nodeType)break;{let e=n.childNodes[r-1];if(zs(e,-1))o=n,i=--r;else{if(3!=e.nodeType)break;n=e,r=n.nodeValue.length}}}else{if(Bs(n))break;{let t=n.previousSibling;for(;t&&zs(t,-1);)o=n.parentNode,i=ei(t),t=t.previousSibling;if(t)n=t,r=Ps(n);else{if(n=n.parentNode,n==e.dom)break;r=0}}}s?Vs(e,n,r):o&&Vs(e,o,i)}(e):function(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let o,i,s=Ps(n);for(;;)if(r<s){if(1!=n.nodeType)break;if(!zs(n.childNodes[r],1))break;o=n,i=++r}else{if(Bs(n))break;{let t=n.nextSibling;for(;t&&zs(t,1);)o=t.parentNode,i=ei(t)+1,t=t.nextSibling;if(t)n=t,r=0,s=Ps(n);else{if(n=n.parentNode,n==e.dom)break;r=s=0}}}o&&Vs(e,o,i)}(e)}function Bs(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Vs(e,t,n){if(3!=t.nodeType){let e,r;(r=function(e,t){for(;e&&t==e.childNodes.length&&!li(e);)t=ei(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=n,t=0}}(t,n))?(t=r,n=0):(e=function(e,t){for(;e&&!t&&!li(e);)t=ei(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=(e=n).childNodes.length}}(t,n))&&(t=e,n=e.nodeValue.length)}let r=e.domSelection();if(ci(r)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),r.removeAllRanges(),r.addRange(e)}else r.extend&&r.extend(t,n);e.domObserver.setCurSelection();let{state:o}=e;setTimeout((()=>{e.state==o&&Ms(e)}),50)}function Rs(e,t){let n=e.state.doc.resolve(t);if(!ki&&!Oi&&n.parent.inlineContent){let r=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),o=(n.top+n.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(n.left-r.left)>1)return n.left<r.left?"ltr":"rtl"}if(t<n.end()){let n=e.coordsAtPos(t+1),o=(n.top+n.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(n.left-r.left)>1)return n.left>r.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(e.dom).direction?"rtl":"ltr"}function Hs(e,t,n){let r=e.state.selection;if(r instanceof eo&&!r.empty||n.indexOf("s")>-1)return!1;if(Ci&&n.indexOf("m")>-1)return!1;let{$from:o,$to:i}=r;if(!o.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=Ds(e.state,t);if(n&&n instanceof no)return Is(e,n)}if(!o.parent.inlineContent){let n=t<0?o:i,s=r instanceof oo?Yr.near(n,t):Yr.findFrom(n,t);return!!s&&Is(e,s)}return!1}function Fs(e,t){if(!(e.state.selection instanceof eo))return!0;let{$head:n,$anchor:r,empty:o}=e.state.selection;if(!n.sameParent(r))return!0;if(!o)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let i=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let r=e.state.tr;return t<0?r.delete(n.pos-i.nodeSize,n.pos):r.delete(n.pos,n.pos+i.nodeSize),e.dispatch(r),!0}return!1}function qs(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function Ws(e,t){let n=t.keyCode,r=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);if(8==n||Ci&&72==n&&"c"==r)return Fs(e,-1)||js(e,-1);if(46==n&&!t.shiftKey||Ci&&68==n&&"c"==r)return Fs(e,1)||js(e,1);if(13==n||27==n)return!0;if(37==n||Ci&&66==n&&"c"==r){let t=37==n?"ltr"==Rs(e,e.state.selection.from)?-1:1:-1;return Ls(e,t,r)||js(e,t)}if(39==n||Ci&&70==n&&"c"==r){let t=39==n?"ltr"==Rs(e,e.state.selection.from)?1:-1:1;return Ls(e,t,r)||js(e,t)}return 38==n||Ci&&80==n&&"c"==r?Hs(e,-1,r)||js(e,-1):40==n||Ci&&78==n&&"c"==r?function(e){if(!Mi||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;qs(e,n,"true"),setTimeout((()=>qs(e,n,"false")),20)}return!1}(e)||Hs(e,1,r)||js(e,1):r==(Ci?"m":"c")&&(66==n||73==n||89==n||90==n)}function Js(e,t){e.someProp("transformCopied",(n=>{t=n(t,e)}));let n=[],{content:r,openStart:o,openEnd:i}=t;for(;o>1&&i>1&&1==r.childCount&&1==r.firstChild.childCount;){o--,i--;let e=r.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),r=e.content}let s=e.someProp("clipboardSerializer")||sr.fromSchema(e.state.schema),a=na(),l=a.createElement("div");l.appendChild(s.serializeFragment(r,{document:a}));let c,u=l.firstChild,d=0;for(;u&&1==u.nodeType&&(c=ea[u.nodeName.toLowerCase()]);){for(let e=c.length-1;e>=0;e--){let t=a.createElement(c[e]);for(;l.firstChild;)t.appendChild(l.firstChild);l.appendChild(t),d++}u=l.firstChild}return u&&1==u.nodeType&&u.setAttribute("data-pm-slice",`${o} ${i}${d?` -${d}`:""} ${JSON.stringify(n)}`),{dom:l,text:e.someProp("clipboardTextSerializer",(n=>n(t,e)))||t.content.textBetween(0,t.content.size,"\n\n")}}function Ks(e,t,n,r,o){let i,s,a=o.parent.type.spec.code;if(!n&&!t)return null;let l=t&&(r||a||!n);if(l){if(e.someProp("transformPastedText",(n=>{t=n(t,a||r,e)})),a)return t?new pn(sn.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):pn.empty;let n=e.someProp("clipboardTextParser",(n=>n(t,o,r,e)));if(n)s=n;else{let n=o.marks(),{schema:r}=e.state,s=sr.fromSchema(r);i=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach((e=>{let t=i.appendChild(document.createElement("p"));e&&t.appendChild(s.serializeNode(r.text(e,n)))}))}}else e.someProp("transformPastedHTML",(t=>{n=t(n,e)})),i=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,r=na().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(e);(n=o&&ea[o[1].toLowerCase()])&&(e=n.map((e=>"<"+e+">")).join("")+e+n.map((e=>"</"+e+">")).reverse().join(""));if(r.innerHTML=e,n)for(let e=0;e<n.length;e++)r=r.querySelector(n[e])||r;return r}(n),Ti&&function(e){let t=e.querySelectorAll(ki?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let r=t[n];1==r.childNodes.length&&" "==r.textContent&&r.parentNode&&r.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),r)}}(i);let c=i&&i.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let e=+u[3];e>0;e--){let e=i.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;i=e}if(!s){let t=e.someProp("clipboardParser")||e.someProp("domParser")||Yn.fromSchema(e.state.schema);s=t.parseSlice(i,{preserveWhitespace:!(!l&&!u),context:o,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||Us.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(u)s=function(e,t){if(!e.size)return e;let n,r=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(t){return e}let{content:o,openStart:i,openEnd:s}=e;for(let e=n.length-2;e>=0;e-=2){let t=r.nodes[n[e]];if(!t||t.hasRequiredAttrs())break;o=sn.from(t.create(n[e+1],o)),i++,s++}return new pn(o,i,s)}(Qs(s,+u[1],+u[2]),u[4]);else if(s=pn.maxOpen(function(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let r,o=t.node(n).contentMatchAt(t.index(n)),i=[];if(e.forEach((e=>{if(!i)return;let t,n=o.findWrapping(e.type);if(!n)return i=null;if(t=i.length&&r.length&&Ys(n,r,e,i[i.length-1],0))i[i.length-1]=t;else{i.length&&(i[i.length-1]=Zs(i[i.length-1],r.length));let t=Gs(e,n);i.push(t),o=o.matchType(t.type),r=n}})),i)return sn.from(i)}return e}(s.content,o),!0),s.openStart||s.openEnd){let e=0,t=0;for(let t=s.content.firstChild;e<s.openStart&&!t.type.spec.isolating;e++,t=t.firstChild);for(let e=s.content.lastChild;t<s.openEnd&&!e.type.spec.isolating;t++,e=e.lastChild);s=Qs(s,e,t)}return e.someProp("transformPasted",(t=>{s=t(s,e)})),s}const Us=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Gs(e,t,n=0){for(let r=t.length-1;r>=n;r--)e=t[r].create(null,sn.from(e));return e}function Ys(e,t,n,r,o){if(o<e.length&&o<t.length&&e[o]==t[o]){let i=Ys(e,t,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(o==e.length-1?n.type:e[o+1]))return r.copy(r.content.append(sn.from(Gs(n,e,o+1))))}}function Zs(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,Zs(e.lastChild,t-1)),r=e.contentMatchAt(e.childCount).fillBefore(sn.empty,!0);return e.copy(n.append(r))}function Xs(e,t,n,r,o,i){let s=t<0?e.firstChild:e.lastChild,a=s.content;return e.childCount>1&&(i=0),o<r-1&&(a=Xs(a,t,n,r,o+1,i)),o>=n&&(a=t<0?s.contentMatchAt(0).fillBefore(a,i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(sn.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,s.copy(a))}function Qs(e,t,n){return t<e.openStart&&(e=new pn(Xs(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new pn(Xs(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const ea={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let ta=null;function na(){return ta||(ta=document.implementation.createHTMLDocument("title"))}const ra={},oa={},ia={touchstart:!0,touchmove:!0};class sa{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function aa(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function la(e){e.someProp("handleDOMEvents",(t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>ca(e,t))}))}function ca(e,t){return e.someProp("handleDOMEvents",(n=>{let r=n[t.type];return!!r&&(r(e,t)||t.defaultPrevented)}))}function ua(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function da(e){return{left:e.clientX,top:e.clientY}}function pa(e,t,n,r,o){if(-1==r)return!1;let i=e.state.doc.resolve(r);for(let r=i.depth+1;r>0;r--)if(e.someProp(t,(t=>r>i.depth?t(e,n,i.nodeAfter,i.before(r),o,!0):t(e,n,i.node(r),i.before(r),o,!1))))return!0;return!1}function ha(e,t,n){e.focused||e.focus();let r=e.state.tr.setSelection(t);"pointer"==n&&r.setMeta("pointer",!0),e.dispatch(r)}function fa(e,t,n,r,o){return pa(e,"handleClickOn",t,n,r)||e.someProp("handleClick",(n=>n(e,t,r)))||(o?function(e,t){if(-1==t)return!1;let n,r,o=e.state.selection;o instanceof no&&(n=o.node);let i=e.state.doc.resolve(t);for(let e=i.depth+1;e>0;e--){let t=e>i.depth?i.nodeAfter:i.node(e);if(no.isSelectable(t)){r=n&&o.$from.depth>0&&e>=o.$from.depth&&i.before(o.$from.depth+1)==o.$from.pos?i.before(o.$from.depth):i.before(e);break}}return null!=r&&(ha(e,no.create(e.state.doc,r),"pointer"),!0)}(e,n):function(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),r=n.nodeAfter;return!!(r&&r.isAtom&&no.isSelectable(r))&&(ha(e,new no(n),"pointer"),!0)}(e,n))}function ma(e,t,n,r){return pa(e,"handleDoubleClickOn",t,n,r)||e.someProp("handleDoubleClick",(n=>n(e,t,r)))}function ga(e,t,n,r){return pa(e,"handleTripleClickOn",t,n,r)||e.someProp("handleTripleClick",(n=>n(e,t,r)))||function(e,t,n){if(0!=n.button)return!1;let r=e.state.doc;if(-1==t)return!!r.inlineContent&&(ha(e,eo.create(r,0,r.content.size),"pointer"),!0);let o=r.resolve(t);for(let t=o.depth+1;t>0;t--){let n=t>o.depth?o.nodeAfter:o.node(t),i=o.before(t);if(n.inlineContent)ha(e,eo.create(r,i+1,i+1+n.content.size),"pointer");else{if(!no.isSelectable(n))continue;ha(e,no.create(r,i),"pointer")}return!0}}(e,n,r)}function ya(e){return Ca(e)}oa.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!wa(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!Ai||!ki||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!Si||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",(t=>t(e,n)))||Ws(e,n)?n.preventDefault():aa(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",(t=>t(e,ui(13,"Enter")))),e.input.lastIOSEnter=0)}),200)}},oa.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},oa.keypress=(e,t)=>{let n=t;if(wa(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ci&&n.metaKey)return;if(e.someProp("handleKeyPress",(t=>t(e,n))))return void n.preventDefault();let r=e.state.selection;if(!(r instanceof eo&&r.$from.sameParent(r.$to))){let t=String.fromCharCode(n.charCode);/[\r\n]/.test(t)||e.someProp("handleTextInput",(n=>n(e,r.$from.pos,r.$to.pos,t)))||e.dispatch(e.state.tr.insertText(t).scrollIntoView()),n.preventDefault()}};const va=Ci?"metaKey":"ctrlKey";ra.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let r=ya(e),o=Date.now(),i="singleClick";o-e.input.lastClick.time<500&&function(e,t){let n=t.x-e.clientX,r=t.y-e.clientY;return n*n+r*r<100}(n,e.input.lastClick)&&!n[va]&&("singleClick"==e.input.lastClick.type?i="doubleClick":"doubleClick"==e.input.lastClick.type&&(i="tripleClick")),e.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:i};let s=e.posAtCoords(da(n));s&&("singleClick"==i?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new ba(e,s,n,!!r)):("doubleClick"==i?ma:ga)(e,s.pos,s.inside,n)?n.preventDefault():aa(e,"pointer"))};class ba{constructor(e,t,n,r){let o,i;if(this.view=e,this.pos=t,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[va],this.allowDefault=n.shiftKey,t.inside>-1)o=e.state.doc.nodeAt(t.inside),i=t.inside;else{let n=e.state.doc.resolve(t.pos);o=n.parent,i=n.depth?n.before():0}const s=r?null:n.target,a=s?e.docView.nearestDesc(s,!0):null;this.target=a?a.dom:null;let{selection:l}=e.state;(0==n.button&&o.type.spec.draggable&&!1!==o.type.spec.selectable||l instanceof no&&l.from<=i&&l.to>i)&&(this.mightDrag={node:o,pos:i,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!bi||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),aa(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>Ms(this.view))),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(da(e))),this.updateAllowDefault(e),this.allowDefault||!t?aa(this.view,"pointer"):fa(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||Mi&&this.mightDrag&&!this.mightDrag.node.isAtom||ki&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(ha(this.view,Yr.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):aa(this.view,"pointer")}move(e){this.updateAllowDefault(e),aa(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function wa(e,t){return!!e.composing||!!(Mi&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}ra.touchstart=e=>{e.input.lastTouch=Date.now(),ya(e),aa(e,"pointer")},ra.touchmove=e=>{e.input.lastTouch=Date.now(),aa(e,"pointer")},ra.contextmenu=e=>ya(e);const ka=Ai?5e3:-1;function xa(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout((()=>Ca(e)),t))}function Ma(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function Sa(e){let t=e.domSelectionRange();if(!t.focusNode)return null;let n=function(e,t){for(;;){if(3==e.nodeType&&t)return e;if(1==e.nodeType&&t>0){if("false"==e.contentEditable)return null;t=ai(e=e.childNodes[t-1])}else{if(!e.parentNode||li(e))return null;t=ei(e),e=e.parentNode}}}(t.focusNode,t.focusOffset),r=function(e,t){for(;;){if(3==e.nodeType&&t<e.nodeValue.length)return e;if(1==e.nodeType&&t<e.childNodes.length){if("false"==e.contentEditable)return null;e=e.childNodes[t],t=0}else{if(!e.parentNode||li(e))return null;t=ei(e)+1,e=e.parentNode}}}(t.focusNode,t.focusOffset);if(n&&r&&n!=r){let t=r.pmViewDesc;if(!t||!t.isText(r.nodeValue))return r;if(e.input.compositionNode==r){let e=n.pmViewDesc;if(e&&e.isText(n.nodeValue))return r}}return n}function Ca(e,t=!1){if(!(Ai&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),Ma(e),t||e.docView&&e.docView.dirty){let t=ks(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):e.updateState(e.state),!0}return!1}}oa.compositionstart=oa.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((e=>!1===e.type.spec.inclusive))))e.markCursor=e.state.storedMarks||n.marks(),Ca(e,!0),e.markCursor=null;else if(Ca(e),bi&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,r=t.focusOffset;n&&1==n.nodeType&&0!=r;){let t=r<0?n.lastChild:n.childNodes[r-1];if(!t)break;if(3==t.nodeType){e.domSelection().collapse(t,t.nodeValue.length);break}n=t,r=-1}}e.input.composing=!0}xa(e,ka)},oa.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then((()=>e.domObserver.flush())),e.input.compositionID++,xa(e,20))};const Oa=yi&&vi<15||Si&&_i<604;function Aa(e,t,n,r,o){let i=Ks(e,t,n,r,e.state.selection.$from);if(e.someProp("handlePaste",(t=>t(e,o,i||pn.empty))))return!0;if(!i)return!1;let s=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(i),a=s?e.state.tr.replaceSelectionWith(s,r):e.state.tr.replaceSelection(i);return e.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Ta(e){let t=e.getData("text/plain")||e.getData("Text");if(t)return t;let n=e.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}ra.copy=oa.cut=(e,t)=>{let n=t,r=e.state.selection,o="cut"==n.type;if(r.empty)return;let i=Oa?null:n.clipboardData,s=r.content(),{dom:a,text:l}=Js(e,s);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):function(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),o=document.createRange();o.selectNodeContents(t),e.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()}),50)}(e,a),o&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},oa.paste=(e,t)=>{let n=t;if(e.composing&&!Ai)return;let r=Oa?null:n.clipboardData,o=e.input.shiftKey&&45!=e.input.lastKeyCode;r&&Aa(e,Ta(r),r.getData("text/html"),o,n)?n.preventDefault():function(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,r=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let o=e.input.shiftKey&&45!=e.input.lastKeyCode;setTimeout((()=>{e.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Aa(e,r.value,null,o,t):Aa(e,r.textContent,r.innerHTML,o,t)}),50)}(e,n)};class _a{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}}const Na=Ci?"altKey":"ctrlKey";ra.dragstart=(e,t)=>{let n=t,r=e.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let o,i=e.state.selection,s=i.empty?null:e.posAtCoords(da(n));if(s&&s.pos>=i.from&&s.pos<=(i instanceof no?i.to-1:i.to));else if(r&&r.mightDrag)o=no.create(e.state.doc,r.mightDrag.pos);else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&(o=no.create(e.state.doc,t.posBefore))}let a=(o||e.state.selection).content(),{dom:l,text:c}=Js(e,a);n.dataTransfer.clearData(),n.dataTransfer.setData(Oa?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Oa||n.dataTransfer.setData("text/plain",c),e.dragging=new _a(a,!n[Na],o)},ra.dragend=e=>{let t=e.dragging;window.setTimeout((()=>{e.dragging==t&&(e.dragging=null)}),50)},oa.dragover=oa.dragenter=(e,t)=>t.preventDefault(),oa.drop=(e,t)=>{let n=t,r=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let o=e.posAtCoords(da(n));if(!o)return;let i=e.state.doc.resolve(o.pos),s=r&&r.slice;s?e.someProp("transformPasted",(t=>{s=t(s,e)})):s=Ks(e,Ta(n.dataTransfer),Oa?null:n.dataTransfer.getData("text/html"),!1,i);let a=!(!r||n[Na]);if(e.someProp("handleDrop",(t=>t(e,n,s||pn.empty,a))))return void n.preventDefault();if(!s)return;n.preventDefault();let l=s?Ir(e.state.doc,i.pos,s):i.pos;null==l&&(l=i.pos);let c=e.state.tr;if(a){let{node:e}=r;e?e.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=0==s.openStart&&0==s.openEnd&&1==s.content.childCount,p=c.doc;if(d?c.replaceRangeWith(u,u,s.content.firstChild):c.replaceRange(u,u,s),c.doc.eq(p))return;let h=c.doc.resolve(u);if(d&&no.isSelectable(s.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new no(h));else{let t=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach(((e,n,r,o)=>t=o)),c.setSelection(Ns(e,h,c.doc.resolve(t)))}e.focus(),e.dispatch(c.setMeta("uiEvent","drop"))},ra.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout((()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&Ms(e)}),20))},ra.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},ra.beforeinput=(e,t)=>{if(ki&&Ai&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout((()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",(t=>t(e,ui(8,"Backspace")))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let e in oa)ra[e]=oa[e];function $a(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class Ea{constructor(e,t){this.toDOM=e,this.spec=t||za,this.side=this.spec.side||0}map(e,t,n,r){let{pos:o,deleted:i}=e.mapResult(t.from+r,this.side<0?-1:1);return i?null:new La(o-n,o-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Ea&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&$a(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Da{constructor(e,t){this.attrs=e,this.spec=t||za}map(e,t,n,r){let o=e.map(t.from+r,this.spec.inclusiveStart?-1:1)-n,i=e.map(t.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new La(o,i,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Da&&$a(this.attrs,e.attrs)&&$a(this.spec,e.spec)}static is(e){return e.type instanceof Da}destroy(){}}class Ia{constructor(e,t){this.attrs=e,this.spec=t||za}map(e,t,n,r){let o=e.mapResult(t.from+r,1);if(o.deleted)return null;let i=e.mapResult(t.to+r,-1);return i.deleted||i.pos<=o.pos?null:new La(o.pos-n,i.pos-n,this)}valid(e,t){let n,{index:r,offset:o}=e.content.findIndex(t.from);return o==t.from&&!(n=e.child(r)).isText&&o+n.nodeSize==t.to}eq(e){return this==e||e instanceof Ia&&$a(this.attrs,e.attrs)&&$a(this.spec,e.spec)}destroy(){}}class La{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new La(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new La(e,e,new Ea(t,n))}static inline(e,t,n,r){return new La(e,t,new Da(n,r))}static node(e,t,n,r){return new La(e,t,new Ia(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof Da}get widget(){return this.type instanceof Ea}}const Pa=[],za={};class ja{constructor(e,t){this.local=e.length?e:Pa,this.children=t.length?t:Pa}static create(e,t){return t.length?qa(t,e,0,za):Ba}find(e,t,n){let r=[];return this.findInner(null==e?0:e,null==t?1e9:t,r,0,n),r}findInner(e,t,n,r,o){for(let i=0;i<this.local.length;i++){let s=this.local[i];s.from<=t&&s.to>=e&&(!o||o(s.spec))&&n.push(s.copy(s.from+r,s.to+r))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<t&&this.children[i+1]>e){let s=this.children[i]+1;this.children[i+2].findInner(e-s,t-s,n,r+s,o)}}map(e,t,n){return this==Ba||0==e.maps.length?this:this.mapInner(e,t,0,0,n||za)}mapInner(e,t,n,r,o){let i;for(let s=0;s<this.local.length;s++){let a=this.local[s].map(e,n,r);a&&a.type.valid(t,a)?(i||(i=[])).push(a):o.onRemove&&o.onRemove(this.local[s].spec)}return this.children.length?function(e,t,n,r,o,i,s){let a=e.slice();for(let e=0,t=i;e<n.maps.length;e++){let r=0;n.maps[e].forEach(((e,n,o,i)=>{let s=i-o-(n-e);for(let o=0;o<a.length;o+=3){let i=a[o+1];if(i<0||e>i+t-r)continue;let l=a[o]+t-r;n>=l?a[o+1]=e<=l?-2:-1:e>=t&&s&&(a[o]+=s,a[o+1]+=s)}r+=s})),t=n.maps[e].map(t,-1)}let l=!1;for(let t=0;t<a.length;t+=3)if(a[t+1]<0){if(-2==a[t+1]){l=!0,a[t+1]=-1;continue}let c=n.map(e[t]+i),u=c-o;if(u<0||u>=r.content.size){l=!0;continue}let d=n.map(e[t+1]+i,-1)-o,{index:p,offset:h}=r.content.findIndex(u),f=r.maybeChild(p);if(f&&h==u&&h+f.nodeSize==d){let r=a[t+2].mapInner(n,f,c+1,e[t]+i+1,s);r!=Ba?(a[t]=u,a[t+1]=d,a[t+2]=r):(a[t+1]=-2,l=!0)}else l=!0}if(l){let l=function(e,t,n,r,o,i,s){function a(e,t){for(let i=0;i<e.local.length;i++){let a=e.local[i].map(r,o,t);a?n.push(a):s.onRemove&&s.onRemove(e.local[i].spec)}for(let n=0;n<e.children.length;n+=3)a(e.children[n+2],e.children[n]+t+1)}for(let n=0;n<e.length;n+=3)-1==e[n+1]&&a(e[n+2],t[n]+i+1);return n}(a,e,t,n,o,i,s),c=qa(l,r,0,s);t=c.local;for(let e=0;e<a.length;e+=3)a[e+1]<0&&(a.splice(e,3),e-=3);for(let e=0,t=0;e<c.children.length;e+=3){let n=c.children[e];for(;t<a.length&&a[t]<n;)t+=3;a.splice(t,0,c.children[e],c.children[e+1],c.children[e+2])}}return new ja(t.sort(Wa),a)}(this.children,i||[],e,t,n,r,o):i?new ja(i.sort(Wa),Pa):Ba}add(e,t){return t.length?this==Ba?ja.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let r,o=0;e.forEach(((e,i)=>{let s,a=i+n;if(s=Ha(t,e,a)){for(r||(r=this.children.slice());o<r.length&&r[o]<i;)o+=3;r[o]==i?r[o+2]=r[o+2].addInner(e,s,a+1):r.splice(o,0,i,i+e.nodeSize,qa(s,e,a+1,za)),o+=3}}));let i=Ra(o?Fa(t):t,-n);for(let t=0;t<i.length;t++)i[t].type.valid(e,i[t])||i.splice(t--,1);return new ja(i.length?this.local.concat(i).sort(Wa):this.local,r||this.children)}remove(e){return 0==e.length||this==Ba?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,r=this.local;for(let r=0;r<n.length;r+=3){let o,i=n[r]+t,s=n[r+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>i&&t.to<s&&(e[n]=null,(o||(o=[])).push(t));if(!o)continue;n==this.children&&(n=this.children.slice());let a=n[r+2].removeInner(o,i+1);a!=Ba?n[r+2]=a:(n.splice(r,3),r-=3)}if(r.length)for(let n,o=0;o<e.length;o++)if(n=e[o])for(let e=0;e<r.length;e++)r[e].eq(n,t)&&(r==this.local&&(r=this.local.slice()),r.splice(e--,1));return n==this.children&&r==this.local?this:r.length||n.length?new ja(r,n):Ba}forChild(e,t){if(this==Ba)return this;if(t.isLeaf)return ja.empty;let n,r;for(let t=0;t<this.children.length;t+=3)if(this.children[t]>=e){this.children[t]==e&&(n=this.children[t+2]);break}let o=e+1,i=o+t.content.size;for(let e=0;e<this.local.length;e++){let t=this.local[e];if(t.from<i&&t.to>o&&t.type instanceof Da){let e=Math.max(o,t.from)-o,n=Math.min(i,t.to)-o;e<n&&(r||(r=[])).push(t.copy(e,n))}}if(r){let e=new ja(r.sort(Wa),Pa);return n?new Va([e,n]):e}return n||Ba}eq(e){if(this==e)return!0;if(!(e instanceof ja)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Ja(this.localsInner(e))}localsInner(e){if(this==Ba)return Pa;if(e.inlineContent||!this.local.some(Da.is))return this.local;let t=[];for(let e=0;e<this.local.length;e++)this.local[e].type instanceof Da||t.push(this.local[e]);return t}}ja.empty=new ja([],[]),ja.removeOverlap=Ja;const Ba=ja.empty;class Va{constructor(e){this.members=e}map(e,t){const n=this.members.map((n=>n.map(e,t,za)));return Va.from(n)}forChild(e,t){if(t.isLeaf)return ja.empty;let n=[];for(let r=0;r<this.members.length;r++){let o=this.members[r].forChild(e,t);o!=Ba&&(o instanceof Va?n=n.concat(o.members):n.push(o))}return Va.from(n)}eq(e){if(!(e instanceof Va)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let r=0;r<this.members.length;r++){let o=this.members[r].localsInner(e);if(o.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<o.length;e++)t.push(o[e])}else t=o}return t?Ja(n?t:t.sort(Wa)):Pa}static from(e){switch(e.length){case 0:return Ba;case 1:return e[0];default:return new Va(e.every((e=>e instanceof ja))?e:e.reduce(((e,t)=>e.concat(t instanceof ja?t:t.members)),[]))}}}function Ra(e,t){if(!t||!e.length)return e;let n=[];for(let r=0;r<e.length;r++){let o=e[r];n.push(new La(o.from+t,o.to+t,o.type))}return n}function Ha(e,t,n){if(t.isLeaf)return null;let r=n+t.nodeSize,o=null;for(let t,i=0;i<e.length;i++)(t=e[i])&&t.from>n&&t.to<r&&((o||(o=[])).push(t),e[i]=null);return o}function Fa(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function qa(e,t,n,r){let o=[],i=!1;t.forEach(((t,s)=>{let a=Ha(e,t,s+n);if(a){i=!0;let e=qa(a,t,n+s+1,r);e!=Ba&&o.push(s,s+t.nodeSize,e)}}));let s=Ra(i?Fa(e):e,-n).sort(Wa);for(let e=0;e<s.length;e++)s[e].type.valid(t,s[e])||(r.onRemove&&r.onRemove(s[e].spec),s.splice(e--,1));return s.length||o.length?new ja(s,o):Ba}function Wa(e,t){return e.from-t.from||e.to-t.to}function Ja(e){let t=e;for(let n=0;n<t.length-1;n++){let r=t[n];if(r.from!=r.to)for(let o=n+1;o<t.length;o++){let i=t[o];if(i.from!=r.from){i.from<r.to&&(t==e&&(t=e.slice()),t[n]=r.copy(r.from,i.from),Ka(t,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(t==e&&(t=e.slice()),t[o]=i.copy(i.from,r.to),Ka(t,o+1,i.copy(r.to,i.to)))}}return t}function Ka(e,t,n){for(;t<e.length&&Wa(n,e[t])>0;)t++;e.splice(t,0,n)}function Ua(e){let t=[];return e.someProp("decorations",(n=>{let r=n(e.state);r&&r!=Ba&&t.push(r)})),e.cursorWrapper&&t.push(ja.create(e.state.doc,[e.cursorWrapper.deco])),Va.from(t)}const Ga={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Ya=yi&&vi<=11;class Za{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Xa{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Za,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);yi&&vi<=11&&e.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),Ya&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Ga)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if($s(this.view)){if(this.suppressingSelectionUpdates)return Ms(this.view);if(yi&&vi<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&oi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,n=new Set;for(let t=e.focusNode;t;t=ti(t))n.add(t);for(let r=e.anchorNode;r;r=ti(r))if(n.has(r)){t=r;break}let r=t&&this.view.docView.nearestDesc(t);return r&&r.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&$s(e)&&!this.ignoreSelectionChange(n),o=-1,i=-1,s=!1,a=[];if(e.editable)for(let e=0;e<t.length;e++){let n=this.registerMutation(t[e],a);n&&(o=o<0?n.from:Math.min(n.from,o),i=i<0?n.to:Math.max(n.to,i),n.typeOver&&(s=!0))}if(bi&&a.length>1){let e=a.filter((e=>"BR"==e.nodeName));if(2==e.length){let t=e[0],n=e[1];t.parentNode&&t.parentNode.parentNode==n.parentNode?n.remove():t.remove()}}let l=null;o<0&&r&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&ci(n)&&(l=ks(e))&&l.eq(Yr.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Ms(e),this.currentSelection.set(n),e.scrollToSelection()):(o>-1||r)&&(o>-1&&(e.docView.markDirty(o,i),function(e){if(Qa.has(e))return;if(Qa.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)){if(e.requiresGeckoHackNode=bi,el)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),el=!0}}(e)),this.handleDOMChange(o,i,s,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||Ms(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(n==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(e))return null;if("childList"==e.type){for(let n=0;n<e.addedNodes.length;n++)t.push(e.addedNodes[n]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let r=e.previousSibling,o=e.nextSibling;if(yi&&vi<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:i}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(r=n),(!i||Array.prototype.indexOf.call(e.addedNodes,i)<0)&&(o=i)}let i=r&&r.parentNode==e.target?ei(r)+1:0,s=n.localPosFromDOM(e.target,i,-1),a=o&&o.parentNode==e.target?ei(o):e.target.childNodes.length;return{from:s,to:n.localPosFromDOM(e.target,a,1)}}return"attributes"==e.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let Qa=new WeakMap,el=!1;function tl(e,t){let n=t.startContainer,r=t.startOffset,o=t.endContainer,i=t.endOffset,s=e.domAtPos(e.state.selection.anchor);return oi(s.node,s.offset,o,i)&&([n,r,o,i]=[o,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:o,focusOffset:i}}function nl(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(Mi&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||Mi&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}const rl=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function ol(e,t,n,r,o){let i=e.input.compositionPendingChanges||(e.composing?e.input.compositionID:0);if(e.input.compositionPendingChanges=0,t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=ks(e,t);if(n&&!e.state.selection.eq(n)){if(ki&&Ai&&13===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",(t=>t(e,ui(13,"Enter")))))return;let r=e.state.tr.setSelection(n);"pointer"==t?r.setMeta("pointer",!0):"key"==t&&r.scrollIntoView(),i&&r.setMeta("composition",i),e.dispatch(r)}return}let s=e.state.doc.resolve(t),a=s.sharedDepth(n);t=s.before(a+1),n=e.state.doc.resolve(n).after(a+1);let l,c,u=e.state.selection,d=function(e,t,n){let r,{node:o,fromOffset:i,toOffset:s,from:a,to:l}=e.docView.parseRange(t,n),c=e.domSelectionRange(),u=c.anchorNode;if(u&&e.dom.contains(1==u.nodeType?u:u.parentNode)&&(r=[{node:u,offset:c.anchorOffset}],ci(c)||r.push({node:c.focusNode,offset:c.focusOffset})),ki&&8===e.input.lastKeyCode)for(let e=s;e>i;e--){let t=o.childNodes[e-1],n=t.pmViewDesc;if("BR"==t.nodeName&&!n){s=e;break}if(!n||n.size)break}let d=e.state.doc,p=e.someProp("domParser")||Yn.fromSchema(e.state.schema),h=d.resolve(a),f=null,m=p.parse(o,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:i,to:s,preserveWhitespace:"pre"!=h.parent.type.whitespace||"full",findPositions:r,ruleFromNode:nl,context:h});if(r&&null!=r[0].pos){let e=r[0].pos,t=r[1]&&r[1].pos;null==t&&(t=e),f={anchor:e+a,head:t+a}}return{doc:m,sel:f,from:a,to:l}}(e,t,n),p=e.state.doc,h=p.slice(d.from,d.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(l=e.state.selection.to,c="end"):(l=e.state.selection.from,c="start"),e.input.lastKeyCode=null;let f=function(e,t,n,r,o){let i=e.findDiffStart(t,n);if(null==i)return null;let{a:s,b:a}=e.findDiffEnd(t,n+e.size,n+t.size);if("end"==o){r-=s+Math.max(0,i-Math.min(s,a))-i}if(s<i&&e.size<t.size){let e=r<=i&&r>=s?i-r:0;i-=e,i&&i<t.size&&al(t.textBetween(i-1,i+1))&&(i+=e?1:-1),a=i+(a-s),s=i}else if(a<i){let t=r<=i&&r>=a?i-r:0;i-=t,i&&i<e.size&&al(e.textBetween(i-1,i+1))&&(i+=t?1:-1),s=i+(s-a),a=i}return{start:i,endA:s,endB:a}}(h.content,d.doc.content,d.from,l,c);if((Si&&e.input.lastIOSEnter>Date.now()-225||Ai)&&o.some((e=>1==e.nodeType&&!rl.test(e.nodeName)))&&(!f||f.endA>=f.endB)&&e.someProp("handleKeyDown",(t=>t(e,ui(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(!f){if(!(r&&u instanceof eo&&!u.empty&&u.$head.sameParent(u.$anchor))||e.composing||d.sel&&d.sel.anchor!=d.sel.head){if(d.sel){let t=il(e,e.state.doc,d.sel);if(t&&!t.eq(e.state.selection)){let n=e.state.tr.setSelection(t);i&&n.setMeta("composition",i),e.dispatch(n)}}return}f={start:u.from,endA:u.to,endB:u.to}}e.input.domChangeCount++,e.state.selection.from<e.state.selection.to&&f.start==f.endB&&e.state.selection instanceof eo&&(f.start>e.state.selection.from&&f.start<=e.state.selection.from+2&&e.state.selection.from>=d.from?f.start=e.state.selection.from:f.endA<e.state.selection.to&&f.endA>=e.state.selection.to-2&&e.state.selection.to<=d.to&&(f.endB+=e.state.selection.to-f.endA,f.endA=e.state.selection.to)),yi&&vi<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>d.from&&"  "==d.doc.textBetween(f.start-d.from-1,f.start-d.from+1)&&(f.start--,f.endA--,f.endB--);let m,g=d.doc.resolveNoCache(f.start-d.from),y=d.doc.resolveNoCache(f.endB-d.from),v=p.resolve(f.start),b=g.sameParent(y)&&g.parent.inlineContent&&v.end()>=f.endA;if((Si&&e.input.lastIOSEnter>Date.now()-225&&(!b||o.some((e=>"DIV"==e.nodeName||"P"==e.nodeName)))||!b&&g.pos<d.doc.content.size&&!g.sameParent(y)&&(m=Yr.findFrom(d.doc.resolve(g.pos+1),1,!0))&&m.head==y.pos)&&e.someProp("handleKeyDown",(t=>t(e,ui(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>f.start&&function(e,t,n,r,o){if(n-t<=o.pos-r.pos||sl(r,!0,!1)<o.pos)return!1;let i=e.resolve(t);if(!r.parent.isTextblock){let e=i.nodeAfter;return null!=e&&n==t+e.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let s=e.resolve(sl(i,!0,!0));return!(!s.parent.isTextblock||s.pos>n||sl(s,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(s.parent.content)}(p,f.start,f.endA,g,y)&&e.someProp("handleKeyDown",(t=>t(e,ui(8,"Backspace")))))return void(Ai&&ki&&e.domObserver.suppressSelectionUpdates());ki&&Ai&&f.endB==f.start&&(e.input.lastAndroidDelete=Date.now()),Ai&&!b&&g.start()!=y.start()&&0==y.parentOffset&&g.depth==y.depth&&d.sel&&d.sel.anchor==d.sel.head&&d.sel.head==f.endA&&(f.endB-=2,y=d.doc.resolveNoCache(f.endB-d.from),setTimeout((()=>{e.someProp("handleKeyDown",(function(t){return t(e,ui(13,"Enter"))}))}),20));let w,k,x,M=f.start,S=f.endA;if(b)if(g.pos==y.pos)yi&&vi<=11&&0==g.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout((()=>Ms(e)),20)),w=e.state.tr.delete(M,S),k=p.resolve(f.start).marksAcross(p.resolve(f.endA));else if(f.endA==f.endB&&(x=function(e,t){let n,r,o,i=e.firstChild.marks,s=t.firstChild.marks,a=i,l=s;for(let e=0;e<s.length;e++)a=s[e].removeFromSet(a);for(let e=0;e<i.length;e++)l=i[e].removeFromSet(l);if(1==a.length&&0==l.length)r=a[0],n="add",o=e=>e.mark(r.addToSet(e.marks));else{if(0!=a.length||1!=l.length)return null;r=l[0],n="remove",o=e=>e.mark(r.removeFromSet(e.marks))}let c=[];for(let e=0;e<t.childCount;e++)c.push(o(t.child(e)));if(sn.from(c).eq(e))return{mark:r,type:n}}(g.parent.content.cut(g.parentOffset,y.parentOffset),v.parent.content.cut(v.parentOffset,f.endA-v.start()))))w=e.state.tr,"add"==x.type?w.addMark(M,S,x.mark):w.removeMark(M,S,x.mark);else if(g.parent.child(g.index()).isText&&g.index()==y.index()-(y.textOffset?0:1)){let t=g.parent.textBetween(g.parentOffset,y.parentOffset);if(e.someProp("handleTextInput",(n=>n(e,M,S,t))))return;w=e.state.tr.insertText(t,M,S)}if(w||(w=e.state.tr.replace(M,S,d.doc.slice(f.start-d.from,f.endB-d.from))),d.sel){let t=il(e,w.doc,d.sel);t&&!(ki&&Ai&&e.composing&&t.empty&&(f.start!=f.endB||e.input.lastAndroidDelete<Date.now()-100)&&(t.head==M||t.head==w.mapping.map(S)-1)||yi&&t.empty&&t.head==M)&&w.setSelection(t)}k&&w.ensureMarks(k),i&&w.setMeta("composition",i),e.dispatch(w.scrollIntoView())}function il(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:Ns(e,t.resolve(n.anchor),t.resolve(n.head))}function sl(e,t,n){let r=e.depth,o=t?e.end():e.pos;for(;r>0&&(t||e.indexAfter(r)==e.node(r).childCount);)r--,o++,t=!1;if(n){let t=e.node(r).maybeChild(e.indexAfter(r));for(;t&&!t.isLeaf;)t=t.firstChild,o++}return o}function al(e){if(2!=e.length)return!1;let t=e.charCodeAt(0),n=e.charCodeAt(1);return t>=56320&&t<=57343&&n>=55296&&n<=56319}class ll{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new sa,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(hl),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=dl(this),ul(this),this.nodeViews=pl(this),this.docView=is(this.state.doc,cl(this),Ua(this),this.dom,this),this.domObserver=new Xa(this,((e,t,n,r)=>ol(this,e,t,n,r))),this.domObserver.start(),function(e){for(let t in ra){let n=ra[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!ua(e,t)||ca(e,t)||!e.editable&&t.type in oa||n(e,t)},ia[t]?{passive:!0}:void 0)}Mi&&e.dom.addEventListener("input",(()=>null)),la(e)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&la(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(hl),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let e in this._props)t[e]=this._props[e];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var n;let r=this.state,o=!1,i=!1;e.storedMarks&&this.composing&&(Ma(this),i=!0),this.state=e;let s=r.plugins!=e.plugins||this._props.plugins!=t.plugins;if(s||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=pl(this);(function(e,t){let n=0,r=0;for(let r in e){if(e[r]!=t[r])return!0;n++}for(let e in t)r++;return n!=r})(e,this.nodeViews)&&(this.nodeViews=e,o=!0)}(s||t.handleDOMEvents!=this._props.handleDOMEvents)&&la(this),this.editable=dl(this),ul(this);let a=Ua(this),l=cl(this),c=r.plugins==e.plugins||r.doc.eq(e.doc)?e.scrollToSelection>r.scrollToSelection?"to selection":"preserve":"reset",u=o||!this.docView.matchesNode(e.doc,l,a);!u&&e.selection.eq(r.selection)||(i=!0);let d="preserve"==c&&i&&null==this.dom.style.overflowAnchor&&function(e){let t,n,r=e.dom.getBoundingClientRect(),o=Math.max(0,r.top);for(let i=(r.left+r.right)/2,s=o+1;s<Math.min(innerHeight,r.bottom);s+=5){let r=e.root.elementFromPoint(i,s);if(!r||r==e.dom||!e.dom.contains(r))continue;let a=r.getBoundingClientRect();if(a.top>=o-20){t=r,n=a.top;break}}return{refDOM:t,refTop:n,stack:Ii(e.dom)}}(this);if(i){this.domObserver.stop();let t=u&&(yi||ki)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&function(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}(r.selection,e.selection);if(u){let n=ki?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Sa(this)),!o&&this.docView.update(e.doc,l,a,this)||(this.docView.updateOuterDeco(l),this.docView.destroy(),this.docView=is(e.doc,l,a,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return oi(t.node,t.offset,n.anchorNode,n.anchorOffset)}(this))?Ms(this,t):(Ts(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),(null===(n=this.dragging)||void 0===n?void 0:n.node)&&!r.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,r),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():d&&function({refDOM:e,refTop:t,stack:n}){let r=e?e.getBoundingClientRect().top:0;Li(n,0==r?0:r-t)}(d)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(e=>e(this))));else if(this.state.selection instanceof no){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&Di(this,t.getBoundingClientRect(),e)}else Di(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}updateDraggedNode(e,t){let n=e.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{let e=n.from+(this.state.doc.content.size-t.doc.content.size);(e>0&&this.state.doc.nodeAt(e))==n.node&&(r=e)}this.dragging=new _a(e.slice,e.move,r<0?void 0:no.create(this.state.doc,r))}someProp(e,t){let n,r=this._props&&this._props[e];if(null!=r&&(n=t?t(r):r))return n;for(let r=0;r<this.directPlugins.length;r++){let o=this.directPlugins[r].props[e];if(null!=o&&(n=t?t(o):o))return n}let o=this.state.plugins;if(o)for(let r=0;r<o.length;r++){let i=o[r].props[e];if(null!=i&&(n=t?t(i):i))return n}}hasFocus(){if(yi){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(e){if(e.setActive)return e.setActive();if(Pi)return e.focus(Pi);let t=Ii(e);e.focus(null==Pi?{get preventScroll(){return Pi={preventScroll:!0},!0}}:void 0),Pi||(Pi=!1,Li(t,0))}(this.dom),Ms(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e;return e||document}updateRoot(){this._root=null}posAtCoords(e){return Vi(this,e)}coordsAtPos(e,t=1){return qi(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let r=this.docView.posFromDOM(e,t,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(e,t){return Xi(this,t||this.state,e)}pasteHTML(e,t){return Aa(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Aa(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(!function(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Ua(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,ni=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function(e,t){ca(e,t)||!ra[t.type]||!e.editable&&t.type in oa||ra[t.type](e,t)}(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return Mi&&11===this.root.nodeType&&function(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}(this.dom.ownerDocument)==this.dom&&function(e,t){if(t.getComposedRanges){let n=t.getComposedRanges(e.root)[0];if(n)return tl(e,n)}let n;function r(e){e.preventDefault(),e.stopImmediatePropagation(),n=e.getTargetRanges()[0]}return e.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",r,!0),n?tl(e,n):null}(this,e)||e}domSelection(){return this.root.getSelection()}}function cl(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),e.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(e.state)),n)for(let e in n)"class"==e?t.class+=" "+n[e]:"style"==e?t.style=(t.style?t.style+";":"")+n[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(n[e]))})),t.translate||(t.translate="no"),[La.node(0,e.state.doc.content.size,t)]}function ul(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:La.widget(e.state.selection.head,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function dl(e){return!e.someProp("editable",(t=>!1===t(e.state)))}function pl(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function hl(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var fl={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ml={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},gl="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),yl="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),vl=0;vl<10;vl++)fl[48+vl]=fl[96+vl]=String(vl);for(vl=1;vl<=24;vl++)fl[vl+111]="F"+vl;for(vl=65;vl<=90;vl++)fl[vl]=String.fromCharCode(vl+32),ml[vl]=String.fromCharCode(vl);for(var bl in fl)ml.hasOwnProperty(bl)||(ml[bl]=fl[bl]);const wl="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function kl(e){let t,n,r,o,i=e.split(/-(?!$)/),s=i[i.length-1];"Space"==s&&(s=" ");for(let e=0;e<i.length-1;e++){let s=i[e];if(/^(cmd|meta|m)$/i.test(s))o=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else if(/^s(hift)?$/i.test(s))r=!0;else{if(!/^mod$/i.test(s))throw new Error("Unrecognized modifier name: "+s);wl?o=!0:n=!0}}return t&&(s="Alt-"+s),n&&(s="Ctrl-"+s),o&&(s="Meta-"+s),r&&(s="Shift-"+s),s}function xl(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function Ml(e){return new go({props:{handleKeyDown:Sl(e)}})}function Sl(e){let t=function(e){let t=Object.create(null);for(let n in e)t[kl(n)]=e[n];return t}(e);return function(e,n){let r,o=function(e){var t=!(gl&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||yl&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?ml:fl)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(n),i=t[xl(o,n)];if(i&&i(e.state,e.dispatch,e))return!0;if(1==o.length&&" "!=o){if(n.shiftKey){let r=t[xl(o,n,!1)];if(r&&r(e.state,e.dispatch,e))return!0}if((n.shiftKey||n.altKey||n.metaKey||o.charCodeAt(0)>127)&&(r=fl[n.keyCode])&&r!=o){let o=t[xl(r,n)];if(o&&o(e.state,e.dispatch,e))return!0}}return!1}}function Cl(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Ol(e,t){const n={...e};return Cl(e)&&Cl(t)&&Object.keys(t).forEach((r=>{Cl(t[r])?r in e?n[r]=Ol(e[r],t[r]):Object.assign(n,{[r]:t[r]}):Object.assign(n,{[r]:t[r]})})),n}function Al(e){return"function"==typeof e}function Tl(e,t=void 0,...n){return Al(e)?t?e.bind(t)(...n):e(...n):e}function _l(e,t,n){if(void 0===e.config[t]&&e.parent)return _l(e.parent,t,n);if("function"==typeof e.config[t]){return e.config[t].bind({...n,parent:e.parent?_l(e.parent,t,n):null})}return e.config[t]}class Nl{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Tl(_l(this,"addOptions",{name:this.name}))),this.storage=Tl(_l(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Nl(e)}configure(e={}){const t=this.extend();return t.options=Ol(this.options,e),t.storage=Tl(_l(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Nl(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Tl(_l(t,"addOptions",{name:t.name})),t.storage=Tl(_l(t,"addStorage",{name:t.name,options:t.options})),t}}function $l(e,t,n){const{from:r,to:o}=t,{blockSeparator:i="\n\n",textSerializers:s={}}=n||{};let a="",l=!0;return e.nodesBetween(r,o,((e,t,n,c)=>{var u;const d=null==s?void 0:s[e.type.name];d?(e.isBlock&&!l&&(a+=i,l=!0),a+=d({node:e,pos:t,parent:n,index:c})):e.isText?(a+=null===(u=null==e?void 0:e.text)||void 0===u?void 0:u.slice(Math.max(r,t)-t,o-t),l=!1):e.isBlock&&!l&&(a+=i,l=!0)})),a}function El(e){return Object.fromEntries(Object.entries(e.nodes).filter((([,e])=>e.spec.toText)).map((([e,t])=>[e,t.spec.toText])))}const Dl=Nl.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new go({key:new bo("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:r,selection:o}=t,{ranges:i}=o,s=Math.min(...i.map((e=>e.$from.pos))),a=Math.max(...i.map((e=>e.$to.pos)));return $l(r,{from:s,to:a},{textSerializers:El(n)})}}})]}});var Il=Object.freeze({__proto__:null,blur:()=>({editor:e,view:t})=>(requestAnimationFrame((()=>{var n;e.isDestroyed||(t.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0)});var Ll=Object.freeze({__proto__:null,clearContent:(e=!1)=>({commands:t})=>t.setContent("",e)});var Pl=Object.freeze({__proto__:null,clearNodes:()=>({state:e,tr:t,dispatch:n})=>{const{selection:r}=t,{ranges:o}=r;return!n||(o.forEach((({$from:n,$to:r})=>{e.doc.nodesBetween(n.pos,r.pos,((e,n)=>{if(e.type.isText)return;const{doc:r,mapping:o}=t,i=r.resolve(o.map(n)),s=r.resolve(o.map(n+e.nodeSize)),a=i.blockRange(s);if(!a)return;const l=Ar(a);if(e.type.isTextblock){const{defaultType:e}=i.parent.contentMatchAt(i.index());t.setNodeMarkup(a.start,e)}(l||0===l)&&t.lift(a,l)}))})),!0)}});var zl=Object.freeze({__proto__:null,command:e=>t=>e(t)});var jl=Object.freeze({__proto__:null,createParagraphNear:()=>({state:e,dispatch:t})=>Lo(e,t)});function Bl(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}var Vl=Object.freeze({__proto__:null,deleteNode:e=>({tr:t,state:n,dispatch:r})=>{const o=Bl(e,n.schema),i=t.selection.$anchor;for(let e=i.depth;e>0;e-=1){if(i.node(e).type===o){if(r){const n=i.before(e),r=i.after(e);t.delete(n,r).scrollIntoView()}return!0}}return!1}});var Rl=Object.freeze({__proto__:null,deleteRange:e=>({tr:t,dispatch:n})=>{const{from:r,to:o}=e;return n&&t.delete(r,o),!0}});var Hl=Object.freeze({__proto__:null,deleteSelection:()=>({state:e,dispatch:t})=>wo(e,t)});var Fl=Object.freeze({__proto__:null,enter:()=>({commands:e})=>e.keyboardShortcut("Enter")});var ql=Object.freeze({__proto__:null,exitCode:()=>({state:e,dispatch:t})=>Io(e,t)});function Wl(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function Jl(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function Kl(e,t,n={strict:!0}){const r=Object.keys(t);return!r.length||r.every((r=>n.strict?t[r]===e[r]:Jl(t[r])?t[r].test(e[r]):t[r]===e[r]))}function Ul(e,t,n={}){return e.find((e=>e.type===t&&Kl(e.attrs,n)))}function Gl(e,t,n={}){return!!Ul(e,t,n)}function Yl(e,t,n={}){if(!e||!t)return;const r=e.parent.childAfter(e.parentOffset);if(!r.node)return;const o=Ul(r.node.marks,t,n);if(!o)return;let i=e.index(),s=e.start()+r.offset,a=i+1,l=s+r.node.nodeSize;for(Ul(r.node.marks,t,n);i>0&&o.isInSet(e.parent.child(i-1).marks);)i-=1,s-=e.parent.child(i).nodeSize;for(;a<e.parent.childCount&&Gl(e.parent.child(a).marks,t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:s,to:l}}var Zl=Object.freeze({__proto__:null,extendMarkRange:(e,t={})=>({tr:n,state:r,dispatch:o})=>{const i=Wl(e,r.schema),{doc:s,selection:a}=n,{$from:l,from:c,to:u}=a;if(o){const e=Yl(l,i,t);if(e&&e.from<=c&&e.to>=u){const t=eo.create(s,e.from,e.to);n.setSelection(t)}}return!0}});var Xl=Object.freeze({__proto__:null,first:e=>t=>{const n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1}});function Ql(e){return e&&"object"==typeof e&&!Array.isArray(e)&&!function(e){var t;return"class"===(null===(t=e.constructor)||void 0===t?void 0:t.toString().substring(0,5))}(e)}function ec(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function tc(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function nc(e,t=null){if(!t)return null;const n=Yr.atStart(e),r=Yr.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return r;const o=n.from,i=r.to;return"all"===t?eo.create(e,tc(0,o,i),tc(e.content.size,o,i)):eo.create(e,tc(t,o,i),tc(t,o,i))}var rc=Object.freeze({__proto__:null,focus:(e=null,t)=>({editor:n,view:r,tr:o,dispatch:i})=>{t={scrollIntoView:!0,...t};const s=()=>{ec()&&r.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(r.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())}))};if(r.hasFocus()&&null===e||!1===e)return!0;if(i&&null===e&&!(Ql(a=n.state.selection)&&a instanceof eo))return s(),!0;var a;const l=nc(n.state.doc,e)||n.state.selection,c=n.state.selection.eq(l);return i&&(c||o.setSelection(l),c&&o.storedMarks&&o.setStoredMarks(o.storedMarks),s()),!0}});var oc=Object.freeze({__proto__:null,forEach:(e,t)=>n=>e.every(((e,r)=>t(e,{...n,index:r})))});var ic=Object.freeze({__proto__:null,insertContent:(e,t)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},e,t)});function sc(e){const t=`<body>${e}</body>`;return(new window.DOMParser).parseFromString(t,"text/html").body}function ac(e,t,n){if(n={slice:!0,parseOptions:{},...n},"object"==typeof e&&null!==e)try{return Array.isArray(e)?sn.fromArray(e.map((e=>t.nodeFromJSON(e)))):t.nodeFromJSON(e)}catch(r){return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",r),ac("",t,n)}if("string"==typeof e){const r=Yn.fromSchema(t);return n.slice?r.parseSlice(sc(e),n.parseOptions).content:r.parse(sc(e),n.parseOptions)}return ac("",t,n)}var lc=Object.freeze({__proto__:null,insertContentAt:(e,t,n)=>({tr:r,dispatch:o,editor:i})=>{if(o){n={parseOptions:{},updateSelection:!0,...n};const o=ac(t,i.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if("<>"===o.toString())return!0;let{from:s,to:a}="number"==typeof e?{from:e,to:e}:e,l=!0,c=!0;if((o.toString().startsWith("<")?o:[o]).forEach((e=>{e.check(),l=!!l&&(e.isText&&0===e.marks.length),c=!!c&&e.isBlock})),s===a&&c){const{parent:e}=r.doc.resolve(s);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(s-=1,a+=1)}l?r.insertText(t,s,a):r.replaceWith(s,a,o),n.updateSelection&&function(e,t,n){const r=e.steps.length-1;if(r<t)return;const o=e.steps[r];if(!(o instanceof Mr||o instanceof Sr))return;const i=e.mapping.maps[r];let s=0;i.forEach(((e,t,n,r)=>{0===s&&(s=r)})),e.setSelection(Yr.near(e.doc.resolve(s),n))}(r,r.steps.length-1,-1)}return!0}});var cc=Object.freeze({__proto__:null,joinBackward:()=>({state:e,dispatch:t})=>xo(e,t)});var uc=Object.freeze({__proto__:null,joinForward:()=>({state:e,dispatch:t})=>To(e,t)});function dc(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var pc=Object.freeze({__proto__:null,keyboardShortcut:e=>({editor:t,view:n,tr:r,dispatch:o})=>{const i=function(e){const t=e.split(/-(?!$)/);let n,r,o,i,s=t[t.length-1];"Space"===s&&(s=" ");for(let e=0;e<t.length-1;e+=1){const s=t[e];if(/^(cmd|meta|m)$/i.test(s))i=!0;else if(/^a(lt)?$/i.test(s))n=!0;else if(/^(c|ctrl|control)$/i.test(s))r=!0;else if(/^s(hift)?$/i.test(s))o=!0;else{if(!/^mod$/i.test(s))throw new Error(`Unrecognized modifier name: ${s}`);ec()||dc()?i=!0:r=!0}}return n&&(s=`Alt-${s}`),r&&(s=`Ctrl-${s}`),i&&(s=`Meta-${s}`),o&&(s=`Shift-${s}`),s}(e).split(/-(?!$)/),s=i.find((e=>!["Alt","Ctrl","Meta","Shift"].includes(e))),a=new KeyboardEvent("keydown",{key:"Space"===s?" ":s,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction((()=>{n.someProp("handleKeyDown",(e=>e(n,a)))}));return null==l||l.steps.forEach((e=>{const t=e.map(r.mapping);t&&o&&r.maybeStep(t)})),!0}});function hc(e,t,n={}){const{from:r,to:o,empty:i}=e.selection,s=t?Bl(t,e.schema):null,a=[];e.doc.nodesBetween(r,o,((e,t)=>{if(e.isText)return;const n=Math.max(r,t),i=Math.min(o,t+e.nodeSize);a.push({node:e,from:n,to:i})}));const l=o-r,c=a.filter((e=>!s||s.name===e.node.type.name)).filter((e=>Kl(e.node.attrs,n,{strict:!1})));if(i)return!!c.length;return c.reduce(((e,t)=>e+t.to-t.from),0)>=l}var fc=Object.freeze({__proto__:null,lift:(e,t={})=>({state:n,dispatch:r})=>!!hc(n,Bl(e,n.schema),t)&&$o(n,r)});var mc=Object.freeze({__proto__:null,liftEmptyBlock:()=>({state:e,dispatch:t})=>Po(e,t)});var gc=Object.freeze({__proto__:null,liftListItem:e=>({state:t,dispatch:n})=>Xo(Bl(e,t.schema))(t,n)});var yc=Object.freeze({__proto__:null,newlineInCode:()=>({state:e,dispatch:t})=>Eo(e,t)});function vc(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function bc(e,t){const n="string"==typeof t?[t]:t;return Object.keys(e).reduce(((t,r)=>(n.includes(r)||(t[r]=e[r]),t)),{})}var wc=Object.freeze({__proto__:null,resetAttributes:(e,t)=>({tr:n,state:r,dispatch:o})=>{let i=null,s=null;const a=vc("string"==typeof e?e:e.name,r.schema);return!!a&&("node"===a&&(i=Bl(e,r.schema)),"mark"===a&&(s=Wl(e,r.schema)),o&&n.selection.ranges.forEach((e=>{r.doc.nodesBetween(e.$from.pos,e.$to.pos,((e,r)=>{i&&i===e.type&&n.setNodeMarkup(r,void 0,bc(e.attrs,t)),s&&e.marks.length&&e.marks.forEach((o=>{s===o.type&&n.addMark(r,r+e.nodeSize,s.create(bc(o.attrs,t)))}))}))})),!0)}});var kc=Object.freeze({__proto__:null,scrollIntoView:()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0)});var xc=Object.freeze({__proto__:null,selectAll:()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size})});var Mc=Object.freeze({__proto__:null,selectNodeBackward:()=>({state:e,dispatch:t})=>Co(e,t)});var Sc=Object.freeze({__proto__:null,selectNodeForward:()=>({state:e,dispatch:t})=>_o(e,t)});var Cc=Object.freeze({__proto__:null,selectParentNode:()=>({state:e,dispatch:t})=>Bo(e,t)});var Oc=Object.freeze({__proto__:null,selectTextblockEnd:()=>({state:e,dispatch:t})=>Fo(e,t)});var Ac=Object.freeze({__proto__:null,selectTextblockStart:()=>({state:e,dispatch:t})=>Ho(e,t)});function Tc(e,t,n={}){return ac(e,t,{slice:!1,parseOptions:n})}var _c=Object.freeze({__proto__:null,setContent:(e,t=!1,n={})=>({tr:r,editor:o,dispatch:i})=>{const{doc:s}=r,a=Tc(e,o.schema,n),l=eo.create(s,0,s.content.size);return i&&r.setSelection(l).replaceSelectionWith(a,!1).setMeta("preventUpdate",!t),!0}});function Nc(e,t){const n=Wl(t,e.schema),{from:r,to:o,empty:i}=e.selection,s=[];i?(e.storedMarks&&s.push(...e.storedMarks),s.push(...e.selection.$head.marks())):e.doc.nodesBetween(r,o,(e=>{s.push(...e.marks)}));const a=s.find((e=>e.type.name===n.name));return a?{...a.attrs}:{}}var $c=Object.freeze({__proto__:null,setMark:(e,t={})=>({tr:n,state:r,dispatch:o})=>{const{selection:i}=n,{empty:s,ranges:a}=i,l=Wl(e,r.schema);if(o)if(s){const e=Nc(r,l);n.addStoredMark(l.create({...e,...t}))}else a.forEach((e=>{const o=e.$from.pos,i=e.$to.pos;r.doc.nodesBetween(o,i,((e,r)=>{const s=Math.max(r,o),a=Math.min(r+e.nodeSize,i);e.marks.find((e=>e.type===l))?e.marks.forEach((e=>{l===e.type&&n.addMark(s,a,l.create({...e.attrs,...t}))})):n.addMark(s,a,l.create(t))}))}));return!0}});var Ec=Object.freeze({__proto__:null,setMeta:(e,t)=>({tr:n})=>(n.setMeta(e,t),!0)});var Dc=Object.freeze({__proto__:null,setNode:(e,t={})=>({state:n,dispatch:r,chain:o})=>{const i=Bl(e,n.schema);return i.isTextblock?o().command((({commands:e})=>!!Wo(i,t)(n)||e.clearNodes())).command((({state:e})=>Wo(i,t)(e,r))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)}});var Ic=Object.freeze({__proto__:null,setNodeSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,r=Yr.atStart(n).from,o=Yr.atEnd(n).to,i=tc(e,r,o),s=no.create(n,i);t.setSelection(s)}return!0}});var Lc=Object.freeze({__proto__:null,setTextSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:r,to:o}="number"==typeof e?{from:e,to:e}:e,i=eo.atStart(n).from,s=eo.atEnd(n).to,a=tc(r,i,s),l=tc(o,i,s),c=eo.create(n,a,l);t.setSelection(c)}return!0}});var Pc=Object.freeze({__proto__:null,sinkListItem:e=>({state:t,dispatch:n})=>Qo(Bl(e,t.schema))(t,n)});function zc(e,t,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const r=e.find((e=>e.type===t&&e.name===n));return!!r&&r.attribute.keepOnSplit})))}function jc(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const r=n.filter((e=>null==t?void 0:t.includes(e.type.name)));e.tr.ensureMarks(r)}}var Bc=Object.freeze({__proto__:null,splitBlock:({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:r,editor:o})=>{const{selection:i,doc:s}=t,{$from:a,$to:l}=i,c=zc(o.extensionManager.attributes,a.node().type.name,a.node().attrs);if(i instanceof no&&i.node.isBlock)return!(!a.parentOffset||!Nr(s,a.pos))&&(r&&(e&&jc(n,o.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(r){const r=l.parentOffset===l.parent.content.size;i instanceof eo&&t.deleteSelection();const s=0===a.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(a.node(-1).contentMatchAt(a.indexAfter(-1)));let u=r&&s?[{type:s,attrs:c}]:void 0,d=Nr(t.doc,t.mapping.map(a.pos),1,u);if(u||d||!Nr(t.doc,t.mapping.map(a.pos),1,s?[{type:s}]:void 0)||(d=!0,u=s?[{type:s,attrs:c}]:void 0),d&&(t.split(t.mapping.map(a.pos),1,u),s&&!r&&!a.parentOffset&&a.parent.type!==s)){const e=t.mapping.map(a.before()),n=t.doc.resolve(e);a.node(-1).canReplaceWith(n.index(),n.index()+1,s)&&t.setNodeMarkup(t.mapping.map(a.before()),s)}e&&jc(n,o.extensionManager.splittableMarks),t.scrollIntoView()}return!0}});var Vc=Object.freeze({__proto__:null,splitListItem:e=>({tr:t,state:n,dispatch:r,editor:o})=>{var i;const s=Bl(e,n.schema),{$from:a,$to:l}=n.selection,c=n.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(l))return!1;const u=a.node(-1);if(u.type!==s)return!1;const d=o.extensionManager.attributes;if(0===a.parent.content.size&&a.node(-1).childCount===a.indexAfter(-1)){if(2===a.depth||a.node(-3).type!==s||a.index(-2)!==a.node(-2).childCount-1)return!1;if(r){let e=sn.empty;const n=a.index(-1)?1:a.index(-2)?2:3;for(let t=a.depth-n;t>=a.depth-3;t-=1)e=sn.from(a.node(t).copy(e));const r=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,o=zc(d,a.node().type.name,a.node().attrs),l=(null===(i=s.contentMatch.defaultType)||void 0===i?void 0:i.createAndFill(o))||void 0;e=e.append(sn.from(s.createAndFill(null,l)||void 0));const c=a.before(a.depth-(n-1));t.replace(c,a.after(-r),new pn(e,4-n,0));let u=-1;t.doc.nodesBetween(c,t.doc.content.size,((e,t)=>{if(u>-1)return!1;e.isTextblock&&0===e.content.size&&(u=t+1)})),u>-1&&t.setSelection(eo.near(t.doc.resolve(u))),t.scrollIntoView()}return!0}const p=l.pos===a.end()?u.contentMatchAt(0).defaultType:null,h=zc(d,u.type.name,u.attrs),f=zc(d,a.node().type.name,a.node().attrs);t.delete(a.pos,l.pos);const m=p?[{type:s,attrs:h},{type:p,attrs:f}]:[{type:s,attrs:h}];return!!Nr(t.doc,a.pos,2)&&(r&&t.split(a.pos,2,m).scrollIntoView(),!0)}});function Rc(e){return t=>function(e,t){for(let n=e.depth;n>0;n-=1){const r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}}(t.$from,e)}function Hc(e){return{baseExtensions:e.filter((e=>"extension"===e.type)),nodeExtensions:e.filter((e=>"node"===e.type)),markExtensions:e.filter((e=>"mark"===e.type))}}function Fc(e,t){const{nodeExtensions:n}=Hc(t),r=n.find((t=>t.name===e));if(!r)return!1;const o=Tl(_l(r,"group",{name:r.name,options:r.options,storage:r.storage}));return"string"==typeof o&&o.split(" ").includes("list")}const qc=(e,t)=>{const n=Rc((e=>e.type===t))(e.selection);if(!n)return!0;const r=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===r)return!0;const o=e.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!$r(e.doc,n.pos)||(e.join(n.pos),!0)},Wc=(e,t)=>{const n=Rc((e=>e.type===t))(e.selection);if(!n)return!0;const r=e.doc.resolve(n.start).after(n.depth);if(void 0===r)return!0;const o=e.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!$r(e.doc,r)||(e.join(r),!0)};var Jc=Object.freeze({__proto__:null,toggleList:(e,t)=>({editor:n,tr:r,state:o,dispatch:i,chain:s,commands:a,can:l})=>{const{extensions:c}=n.extensionManager,u=Bl(e,o.schema),d=Bl(t,o.schema),{selection:p}=o,{$from:h,$to:f}=p,m=h.blockRange(f);if(!m)return!1;const g=Rc((e=>Fc(e.type.name,c)))(p);if(m.depth>=1&&g&&m.depth-g.depth<=1){if(g.node.type===u)return a.liftListItem(d);if(Fc(g.node.type.name,c)&&u.validContent(g.node.content)&&i)return s().command((()=>(r.setNodeMarkup(g.pos,u),!0))).command((()=>qc(r,u))).command((()=>Wc(r,u))).run()}return s().command((()=>!!l().wrapInList(u)||a.clearNodes())).wrapInList(u).command((()=>qc(r,u))).command((()=>Wc(r,u))).run()}});function Kc(e,t,n={}){const{empty:r,ranges:o}=e.selection,i=t?Wl(t,e.schema):null;if(r)return!!(e.storedMarks||e.selection.$from.marks()).filter((e=>!i||i.name===e.type.name)).find((e=>Kl(e.attrs,n,{strict:!1})));let s=0;const a=[];if(o.forEach((({$from:t,$to:n})=>{const r=t.pos,o=n.pos;e.doc.nodesBetween(r,o,((e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(r,t),i=Math.min(o,t+e.nodeSize);s+=i-n,a.push(...e.marks.map((e=>({mark:e,from:n,to:i}))))}))})),0===s)return!1;const l=a.filter((e=>!i||i.name===e.mark.type.name)).filter((e=>Kl(e.mark.attrs,n,{strict:!1}))).reduce(((e,t)=>e+t.to-t.from),0),c=a.filter((e=>!i||e.mark.type!==i&&e.mark.type.excludes(i))).reduce(((e,t)=>e+t.to-t.from),0);return(l>0?l+c:l)>=s}var Uc=Object.freeze({__proto__:null,toggleMark:(e,t={},n={})=>({state:r,commands:o})=>{const{extendEmptyMarkRange:i=!1}=n,s=Wl(e,r.schema);return Kc(r,s,t)?o.unsetMark(s,{extendEmptyMarkRange:i}):o.setMark(s,t)}});var Gc=Object.freeze({__proto__:null,toggleNode:(e,t,n={})=>({state:r,commands:o})=>{const i=Bl(e,r.schema),s=Bl(t,r.schema);return hc(r,i,n)?o.setNode(s):o.setNode(i,n)}});var Yc=Object.freeze({__proto__:null,toggleWrap:(e,t={})=>({state:n,commands:r})=>{const o=Bl(e,n.schema);return hc(n,o,t)?r.lift(o):r.wrapIn(o,t)}});var Zc=Object.freeze({__proto__:null,undoInputRule:()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let r=0;r<n.length;r+=1){const o=n[r];let i;if(o.spec.isInputRules&&(i=o.getState(e))){if(t){const t=e.tr,n=i.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(i.text){const n=t.doc.resolve(i.from).marks();t.replaceWith(i.from,i.to,e.schema.text(i.text,n))}else t.delete(i.from,i.to)}return!0}}return!1}});var Xc=Object.freeze({__proto__:null,unsetAllMarks:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:r,ranges:o}=n;return r||t&&o.forEach((t=>{e.removeMark(t.$from.pos,t.$to.pos)})),!0}});var Qc=Object.freeze({__proto__:null,unsetMark:(e,t={})=>({tr:n,state:r,dispatch:o})=>{var i;const{extendEmptyMarkRange:s=!1}=t,{selection:a}=n,l=Wl(e,r.schema),{$from:c,empty:u,ranges:d}=a;if(!o)return!0;if(u&&s){let{from:e,to:t}=a;const r=null===(i=c.marks().find((e=>e.type===l)))||void 0===i?void 0:i.attrs,o=Yl(c,l,r);o&&(e=o.from,t=o.to),n.removeMark(e,t,l)}else d.forEach((e=>{n.removeMark(e.$from.pos,e.$to.pos,l)}));return n.removeStoredMark(l),!0}});var eu=Object.freeze({__proto__:null,updateAttributes:(e,t={})=>({tr:n,state:r,dispatch:o})=>{let i=null,s=null;const a=vc("string"==typeof e?e:e.name,r.schema);return!!a&&("node"===a&&(i=Bl(e,r.schema)),"mark"===a&&(s=Wl(e,r.schema)),o&&n.selection.ranges.forEach((e=>{const o=e.$from.pos,a=e.$to.pos;r.doc.nodesBetween(o,a,((e,r)=>{i&&i===e.type&&n.setNodeMarkup(r,void 0,{...e.attrs,...t}),s&&e.marks.length&&e.marks.forEach((i=>{if(s===i.type){const l=Math.max(r,o),c=Math.min(r+e.nodeSize,a);n.addMark(l,c,s.create({...i.attrs,...t}))}}))}))})),!0)}});var tu=Object.freeze({__proto__:null,wrapIn:(e,t={})=>({state:n,dispatch:r})=>qo(Bl(e,n.schema),t)(n,r)});var nu=Object.freeze({__proto__:null,wrapInList:(e,t={})=>({state:n,dispatch:r})=>Zo(Bl(e,n.schema),t)(n,r)});const ru=Nl.create({name:"commands",addCommands:()=>({...Il,...Ll,...Pl,...zl,...jl,...Vl,...Rl,...Hl,...Fl,...ql,...Zl,...Xl,...rc,...oc,...ic,...lc,...cc,...uc,...pc,...fc,...mc,...gc,...yc,...wc,...kc,...xc,...Mc,...Sc,...Cc,...Oc,...Ac,..._c,...$c,...Ec,...Dc,...Ic,...Lc,...Pc,...Bc,...Vc,...Jc,...Uc,...Gc,...Yc,...Zc,...Xc,...Qc,...eu,...tu,...nu})}),ou=Nl.create({name:"editable",addProseMirrorPlugins(){return[new go({key:new bo("editable"),props:{editable:()=>this.editor.options.editable}})]}}),iu=Nl.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new go({key:new bo("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const r=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1},blur:(t,n)=>{e.isFocused=!1;const r=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1}}}})]}});function su(e){const{state:t,transaction:n}=e;let{selection:r}=n,{doc:o}=n,{storedMarks:i}=n;return{...t,schema:t.schema,plugins:t.plugins,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return i},get selection(){return r},get doc(){return o},get tr(){return r=n.selection,o=n.doc,i=n.storedMarks,n}}}class au{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:r}=t,{tr:o}=n,i=this.buildProps(o);return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,(...e)=>{const n=t(...e)(i);return o.getMeta("preventDispatch")||this.hasCustomState||r.dispatch(o),n}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:r,state:o}=this,{view:i}=r,s=[],a=!!e,l=e||o.tr,c={...Object.fromEntries(Object.entries(n).map((([e,n])=>[e,(...e)=>{const r=this.buildProps(l,t),o=n(...e)(r);return s.push(o),c}]))),run:()=>(a||!t||l.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(l),s.every((e=>!0===e)))};return c}createCan(e){const{rawCommands:t,state:n}=this,r=void 0,o=e||n.tr,i=this.buildProps(o,r),s=Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(...e)=>t(...e)({...i,dispatch:r})])));return{...s,chain:()=>this.createChain(o,r)}}buildProps(e,t=!0){const{rawCommands:n,editor:r,state:o}=this,{view:i}=r;o.storedMarks&&e.setStoredMarks(o.storedMarks);const s={tr:e,editor:r,view:i,state:su({state:o,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,(...e)=>t(...e)(s)])))}};return s}}const lu=Nl.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first((({commands:e})=>[()=>e.undoInputRule(),()=>e.command((({tr:t})=>{const{selection:n,doc:r}=t,{empty:o,$anchor:i}=n,{pos:s,parent:a}=i,l=Yr.atStart(r).from===s;return!(!(o&&l&&a.type.isTextblock)||a.textContent.length)&&e.clearNodes()})),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()])),t=()=>this.editor.commands.first((({commands:e})=>[()=>e.deleteSelection(),()=>e.joinForward(),()=>e.selectNodeForward()])),n={Enter:()=>this.editor.commands.first((({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},r={...n,Home:()=>this.editor.commands.selectTextblockStart(),End:()=>this.editor.commands.selectTextblockEnd()},o={...n,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return ec()||dc()?o:r},addProseMirrorPlugins(){return[new go({key:new bo("clearDocument"),appendTransaction:(e,t,n)=>{if(!(e.some((e=>e.docChanged))&&!t.doc.eq(n.doc)))return;const{empty:r,from:o,to:i}=t.selection,s=Yr.atStart(t.doc).from,a=Yr.atEnd(t.doc).to,l=o===s&&i===a,c=0===n.doc.textBetween(0,n.doc.content.size," "," ").length;if(r||!l||!c)return;const u=n.tr,d=su({state:n,transaction:u}),{commands:p}=new au({editor:this.editor,state:d});return p.clearNodes(),u.steps.length?u:void 0}})]}}),cu=Nl.create({name:"tabindex",addProseMirrorPlugins(){return[new go({key:new bo("tabindex"),props:{attributes:()=>{if(this.editor.isEditable)return{tabindex:"0"}}}})]}});var uu=Object.freeze({__proto__:null,ClipboardTextSerializer:Dl,Commands:ru,Editable:ou,FocusEvents:iu,Keymap:lu,Tabindex:cu});function du(e,t){const n=vc("string"==typeof t?t:t.name,e.schema);return"node"===n?function(e,t){const n=Bl(t,e.schema),{from:r,to:o}=e.selection,i=[];e.doc.nodesBetween(r,o,(e=>{i.push(e)}));const s=i.reverse().find((e=>e.type.name===n.name));return s?{...s.attrs}:{}}(e,t):"mark"===n?Nc(e,t):{}}function pu(e,t){const n=sr.fromSchema(t).serializeFragment(e),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}function hu(e,t){return $l(e,{from:0,to:e.content.size},t)}const fu=(e,t)=>{if(Jl(t))return t.exec(e);const n=t(e);if(!n)return null;const r=[];return r.push(n.text),r.index=n.index,r.input=e,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function mu(e){var t;const{editor:n,from:r,to:o,text:i,rules:s,plugin:a}=e,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(null===(t=c.nodeBefore||c.nodeAfter)||void 0===t?void 0:t.marks.find((e=>e.type.spec.code))))return!1;let u=!1;const d=c.parent.textBetween(Math.max(0,c.parentOffset-500),c.parentOffset,void 0," ")+i;return s.forEach((e=>{if(u)return;const t=fu(d,e.find);if(!t)return;const s=l.state.tr,c=su({state:l.state,transaction:s}),p={from:r-(t[0].length-i.length),to:o},{commands:h,chain:f,can:m}=new au({editor:n,state:c});null!==e.handler({state:c,range:p,match:t,commands:h,chain:f,can:m})&&s.steps.length&&(s.setMeta(a,{transform:s,from:r,to:o,text:i}),l.dispatch(s),u=!0)})),u}function gu(e){const{editor:t,rules:n}=e,r=new go({state:{init:()=>null,apply(e,t){const n=e.getMeta(this);return n||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput:(e,o,i,s)=>mu({editor:t,from:o,to:i,text:s,rules:n,plugin:r}),handleDOMEvents:{compositionend:e=>(setTimeout((()=>{const{$cursor:o}=e.state.selection;o&&mu({editor:t,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})})),!1)},handleKeyDown(e,o){if("Enter"!==o.key)return!1;const{$cursor:i}=e.state.selection;return!!i&&mu({editor:t,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:r})}},isInputRules:!0});return r}const yu=(e,t)=>{if(Jl(t))return[...e.matchAll(t)];const n=t(e);return n?n.map((t=>{const n=[];return n.push(t.text),n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(t.replaceWith)),n})):[]};function vu(e){const{editor:t,rules:n}=e;let r=null,o=!1,i=!1;const s=n.map((e=>new go({view(e){const t=t=>{var n;r=(null===(n=e.dom.parentElement)||void 0===n?void 0:n.contains(t.target))?e.dom.parentElement:null};return window.addEventListener("dragstart",t),{destroy(){window.removeEventListener("dragstart",t)}}},props:{handleDOMEvents:{drop:e=>(i=r===e.dom.parentElement,!1),paste:(e,t)=>{var n;const r=null===(n=t.clipboardData)||void 0===n?void 0:n.getData("text/html");return o=!!(null==r?void 0:r.includes("data-pm-slice")),!1}}},appendTransaction:(n,r,s)=>{const a=n[0],l="paste"===a.getMeta("uiEvent")&&!o,c="drop"===a.getMeta("uiEvent")&&!i;if(!l&&!c)return;const u=r.doc.content.findDiffStart(s.doc.content),d=r.doc.content.findDiffEnd(s.doc.content);if("number"!=typeof u||!d||u===d.b)return;const p=s.tr,h=su({state:s,transaction:p}),f=function(e){const{editor:t,state:n,from:r,to:o,rule:i}=e,{commands:s,chain:a,can:l}=new au({editor:t,state:n}),c=[];return n.doc.nodesBetween(r,o,((e,t)=>{if(!e.isTextblock||e.type.spec.code)return;const u=Math.max(r,t),d=Math.min(o,t+e.content.size),p=e.textBetween(u-t,d-t,void 0,"￼");yu(p,i.find).forEach((e=>{if(void 0===e.index)return;const t=u+e.index+1,r=t+e[0].length,o={from:n.tr.mapping.map(t),to:n.tr.mapping.map(r)},d=i.handler({state:n,range:o,match:e,commands:s,chain:a,can:l});c.push(d)}))})),c.every((e=>null!==e))}({editor:t,state:h,from:Math.max(u-1,0),to:d.b,rule:e});return f&&p.steps.length?p:void 0}})));return s}function bu(e){const t=[],{nodeExtensions:n,markExtensions:r}=Hc(e),o=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0};return e.forEach((e=>{const n=_l(e,"addGlobalAttributes",{name:e.name,options:e.options,storage:e.storage});if(!n)return;n().forEach((e=>{e.types.forEach((n=>{Object.entries(e.attributes).forEach((([e,r])=>{t.push({type:n,name:e,attribute:{...i,...r}})}))}))}))})),o.forEach((e=>{const n={name:e.name,options:e.options,storage:e.storage},r=_l(e,"addAttributes",n);if(!r)return;const o=r();Object.entries(o).forEach((([n,r])=>{t.push({type:e.name,name:n,attribute:{...i,...r}})}))})),t}function wu(e,t){return t.filter((e=>e.attribute.rendered)).map((t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]})).reduce(((e,t)=>function(...e){return e.filter((e=>!!e)).reduce(((e,t)=>{const n={...e};return Object.entries(t).forEach((([e,t])=>{n[e]?n[e]="class"===e?[n[e],t].join(" "):"style"===e?[n[e],t].join("; "):t:n[e]=t})),n}),{})}(e,t)),{})}function ku(e,t){return e.style?e:{...e,getAttrs:n=>{const r=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===r)return!1;const o=t.reduce(((e,t)=>{const r=t.attribute.parseHTML?t.attribute.parseHTML(n):function(e){return"string"!=typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}(n.getAttribute(t.name));return null==r?e:{...e,[t.name]:r}}),{});return{...r,...o}}}}function xu(e){return Object.fromEntries(Object.entries(e).filter((([e,t])=>("attrs"!==e||!function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t)))}function Mu(e){var t;const n=bu(e),{nodeExtensions:r,markExtensions:o}=Hc(e),i=null===(t=r.find((e=>_l(e,"topNode"))))||void 0===t?void 0:t.name,s=Object.fromEntries(r.map((t=>{const r=n.filter((e=>e.type===t.name)),o={name:t.name,options:t.options,storage:t.storage},i=xu({...e.reduce(((e,n)=>{const r=_l(n,"extendNodeSchema",o);return{...e,...r?r(t):{}}}),{}),content:Tl(_l(t,"content",o)),marks:Tl(_l(t,"marks",o)),group:Tl(_l(t,"group",o)),inline:Tl(_l(t,"inline",o)),atom:Tl(_l(t,"atom",o)),selectable:Tl(_l(t,"selectable",o)),draggable:Tl(_l(t,"draggable",o)),code:Tl(_l(t,"code",o)),defining:Tl(_l(t,"defining",o)),isolating:Tl(_l(t,"isolating",o)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),s=Tl(_l(t,"parseHTML",o));s&&(i.parseDOM=s.map((e=>ku(e,r))));const a=_l(t,"renderHTML",o);a&&(i.toDOM=e=>a({node:e,HTMLAttributes:wu(e,r)}));const l=_l(t,"renderText",o);return l&&(i.toText=l),[t.name,i]}))),a=Object.fromEntries(o.map((t=>{const r=n.filter((e=>e.type===t.name)),o={name:t.name,options:t.options,storage:t.storage},i=xu({...e.reduce(((e,n)=>{const r=_l(n,"extendMarkSchema",o);return{...e,...r?r(t):{}}}),{}),inclusive:Tl(_l(t,"inclusive",o)),excludes:Tl(_l(t,"excludes",o)),group:Tl(_l(t,"group",o)),spanning:Tl(_l(t,"spanning",o)),code:Tl(_l(t,"code",o)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),s=Tl(_l(t,"parseHTML",o));s&&(i.parseDOM=s.map((e=>ku(e,r))));const a=_l(t,"renderHTML",o);return a&&(i.toDOM=e=>a({mark:e,HTMLAttributes:wu(e,r)})),[t.name,i]})));return new Un({topNode:i,nodes:s,marks:a})}function Su(e,t){return t.nodes[e]||t.marks[e]||null}function Cu(e,t){return Array.isArray(t)?t.some((t=>("string"==typeof t?t:t.name)===e.name)):t}class Ou{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=Ou.resolve(e),this.schema=Mu(this.extensions),this.extensions.forEach((e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Su(e.name,this.schema)};if("mark"===e.type){(null===(t=Tl(_l(e,"keepOnSplit",n)))||void 0===t||t)&&this.splittableMarks.push(e.name)}const r=_l(e,"onBeforeCreate",n);r&&this.editor.on("beforeCreate",r);const o=_l(e,"onCreate",n);o&&this.editor.on("create",o);const i=_l(e,"onUpdate",n);i&&this.editor.on("update",i);const s=_l(e,"onSelectionUpdate",n);s&&this.editor.on("selectionUpdate",s);const a=_l(e,"onTransaction",n);a&&this.editor.on("transaction",a);const l=_l(e,"onFocus",n);l&&this.editor.on("focus",l);const c=_l(e,"onBlur",n);c&&this.editor.on("blur",c);const u=_l(e,"onDestroy",n);u&&this.editor.on("destroy",u)}))}static resolve(e){const t=Ou.sort(Ou.flatten(e)),n=function(e){const t=e.filter(((t,n)=>e.indexOf(t)!==n));return[...new Set(t)]}(t.map((e=>e.name)));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map((e=>`'${e}'`)).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map((e=>{const t=_l(e,"addExtensions",{name:e.name,options:e.options,storage:e.storage});return t?[e,...this.flatten(t())]:e})).flat(10)}static sort(e){return e.sort(((e,t)=>{const n=_l(e,"priority")||100,r=_l(t,"priority")||100;return n>r?-1:n<r?1:0}))}get commands(){return this.extensions.reduce(((e,t)=>{const n=_l(t,"addCommands",{name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:Su(t.name,this.schema)});return n?{...e,...n()}:e}),{})}get plugins(){const{editor:e}=this,t=Ou.sort([...this.extensions].reverse()),n=[],r=[],o=t.map((t=>{const o={name:t.name,options:t.options,storage:t.storage,editor:e,type:Su(t.name,this.schema)},i=[],s=_l(t,"addKeyboardShortcuts",o);if(s){const t=Ml(Object.fromEntries(Object.entries(s()).map((([t,n])=>[t,()=>n({editor:e})]))));i.push(t)}const a=_l(t,"addInputRules",o);Cu(t,e.options.enableInputRules)&&a&&n.push(...a());const l=_l(t,"addPasteRules",o);Cu(t,e.options.enablePasteRules)&&l&&r.push(...l());const c=_l(t,"addProseMirrorPlugins",o);if(c){const e=c();i.push(...e)}return i})).flat();return[gu({editor:e,rules:n}),...vu({editor:e,rules:r}),...o]}get attributes(){return bu(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=Hc(this.extensions);return Object.fromEntries(t.filter((e=>!!_l(e,"addNodeView"))).map((t=>{const n=this.attributes.filter((e=>e.type===t.name)),r={name:t.name,options:t.options,storage:t.storage,editor:e,type:Bl(t.name,this.schema)},o=_l(t,"addNodeView",r);if(!o)return[];return[t.name,(r,i,s,a)=>{const l=wu(r,n);return o()({editor:e,node:r,getPos:s,decorations:a,HTMLAttributes:l,extension:t})}]})))}}class Au{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach((e=>e.apply(this,t))),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter((e=>e!==t)):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}class Tu extends Au{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(e){const t=document.querySelector("style[data-tiptap-style]");if(null!==t)return t;const n=document.createElement("style");return n.setAttribute("data-tiptap-style",""),n.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(n),n}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 1px !important;\n  height: 1px !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}'))}setOptions(e={}){this.options={...this.options,...e},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e){this.setOptions({editable:e})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const n=Al(t)?t(e,this.state.plugins):[...this.state.plugins,e],r=this.state.reconfigure({plugins:n});this.view.updateState(r)}unregisterPlugin(e){if(this.isDestroyed)return;const t="string"==typeof e?`${e}$`:e.key,n=this.state.reconfigure({plugins:this.state.plugins.filter((e=>!e.key.startsWith(t)))});this.view.updateState(n)}createExtensionManager(){const e=[...this.options.enableCoreExtensions?Object.values(uu):[],...this.options.extensions].filter((e=>["extension","node","mark"].includes(null==e?void 0:e.type)));this.extensionManager=new Ou(e,this)}createCommandManager(){this.commandManager=new au({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=Tc(this.options.content,this.schema,this.options.parseOptions),t=nc(e,this.options.autofocus);this.view=new ll(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:fo.create({doc:e,selection:t})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews();this.view.dom.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach((e=>{var t;return null===(t=this.capturedTransaction)||void 0===t?void 0:t.step(e)})):void(this.capturedTransaction=e);const t=this.state.apply(e),n=!this.state.selection.eq(t.selection);this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});const r=e.getMeta("focus"),o=e.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:e}),o&&this.emit("blur",{editor:this,event:o.event,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return du(this.state,e)}isActive(e,t){const n="string"==typeof e?e:null,r="string"==typeof e?t:e;return function(e,t,n={}){if(!t)return hc(e,null,n)||Kc(e,null,n);const r=vc(t,e.schema);return"node"===r?hc(e,t,n):"mark"===r&&Kc(e,t,n)}(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return pu(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return hu(this.state.doc,{blockSeparator:t,textSerializers:{...n,...El(this.schema)}})}get isEmpty(){return function(e){var t;const n=null===(t=e.type.createAndFill())||void 0===t?void 0:t.toJSON(),r=e.toJSON();return JSON.stringify(n)===JSON.stringify(r)}(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(null===(e=this.view)||void 0===e?void 0:e.docView)}}function _u(e){const{state:t,transaction:n}=e;let{selection:r}=n,{doc:o}=n,{storedMarks:i}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return i},get selection(){return r},get doc(){return o},get tr(){return r=n.selection,o=n.doc,i=n.storedMarks,n}}}class Nu{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:r}=t,{tr:o}=n,i=this.buildProps(o);return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,(...e)=>{const n=t(...e)(i);return o.getMeta("preventDispatch")||this.hasCustomState||r.dispatch(o),n}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:r,state:o}=this,{view:i}=r,s=[],a=!!e,l=e||o.tr,c={...Object.fromEntries(Object.entries(n).map((([e,n])=>[e,(...e)=>{const r=this.buildProps(l,t),o=n(...e)(r);return s.push(o),c}]))),run:()=>(a||!t||l.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(l),s.every((e=>!0===e)))};return c}createCan(e){const{rawCommands:t,state:n}=this,r=!1,o=e||n.tr,i=this.buildProps(o,r),s=Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(...e)=>t(...e)({...i,dispatch:void 0})])));return{...s,chain:()=>this.createChain(o,r)}}buildProps(e,t=!0){const{rawCommands:n,editor:r,state:o}=this,{view:i}=r,s={tr:e,editor:r,view:i,state:_u({state:o,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,(...e)=>t(...e)(s)])))}};return s}}function $u(e,t,n){if(void 0===e.config[t]&&e.parent)return $u(e.parent,t,n);if("function"==typeof e.config[t]){return e.config[t].bind({...n,parent:e.parent?$u(e.parent,t,n):null})}return e.config[t]}function Eu(e){return{baseExtensions:e.filter((e=>"extension"===e.type)),nodeExtensions:e.filter((e=>"node"===e.type)),markExtensions:e.filter((e=>"mark"===e.type))}}function Du(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function Iu(...e){return e.filter((e=>!!e)).reduce(((e,t)=>{const n={...e};return Object.entries(t).forEach((([e,t])=>{if(n[e])if("class"===e){const r=t?t.split(" "):[],o=n[e]?n[e].split(" "):[],i=r.filter((e=>!o.includes(e)));n[e]=[...o,...i].join(" ")}else n[e]="style"===e?[n[e],t].join("; "):t;else n[e]=t})),n}),{})}function Lu(e){return"function"==typeof e}function Pu(e,t=void 0,...n){return Lu(e)?t?e.bind(t)(...n):e(...n):e}function zu(e){return"[object RegExp]"===Object.prototype.toString.call(e)}class ju{constructor(e){this.find=e.find,this.handler=e.handler}}class Bu{constructor(e){this.find=e.find,this.handler=e.handler}}function Vu(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Ru(e,t){const n={...e};return Vu(e)&&Vu(t)&&Object.keys(t).forEach((r=>{Vu(t[r])?r in e?n[r]=Ru(e[r],t[r]):Object.assign(n,{[r]:t[r]}):Object.assign(n,{[r]:t[r]})})),n}class Hu{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Pu($u(this,"addOptions",{name:this.name}))),this.storage=Pu($u(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Hu(e)}configure(e={}){const t=this.extend();return t.options=Ru(this.options,e),t.storage=Pu($u(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Hu({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Pu($u(t,"addOptions",{name:t.name})),t.storage=Pu($u(t,"addStorage",{name:t.name,options:t.options})),t}}function Fu(e,t,n){const{from:r,to:o}=t,{blockSeparator:i="\n\n",textSerializers:s={}}=n||{};let a="",l=!0;return e.nodesBetween(r,o,((e,n,c,u)=>{var d;const p=null==s?void 0:s[e.type.name];if(p)return e.isBlock&&!l&&(a+=i,l=!0),c&&(a+=p({node:e,pos:n,parent:c,index:u,range:t})),!1;e.isText?(a+=null===(d=null==e?void 0:e.text)||void 0===d?void 0:d.slice(Math.max(r,n)-n,o-n),l=!1):e.isBlock&&!l&&(a+=i,l=!0)})),a}function qu(e){return Object.fromEntries(Object.entries(e.nodes).filter((([,e])=>e.spec.toText)).map((([e,t])=>[e,t.spec.toText])))}Hu.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new go({key:new bo("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:r,selection:o}=t,{ranges:i}=o,s=Math.min(...i.map((e=>e.$from.pos))),a=Math.max(...i.map((e=>e.$to.pos))),l=qu(n);return Fu(r,{from:s,to:a},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}});function Wu(e,t,n={strict:!0}){const r=Object.keys(t);return!r.length||r.every((r=>n.strict?t[r]===e[r]:zu(t[r])?t[r].test(e[r]):t[r]===e[r]))}function Ju(e,t,n={}){return e.find((e=>e.type===t&&Wu(e.attrs,n)))}function Ku(e,t,n={}){return!!Ju(e,t,n)}function Uu(e,t,n={}){if(!e||!t)return;let r=e.parent.childAfter(e.parentOffset);if(e.parentOffset===r.offset&&0!==r.offset&&(r=e.parent.childBefore(e.parentOffset)),!r.node)return;const o=Ju([...r.node.marks],t,n);if(!o)return;let i=r.index,s=e.start()+r.offset,a=i+1,l=s+r.node.nodeSize;for(Ju([...r.node.marks],t,n);i>0&&o.isInSet(e.parent.child(i-1).marks);)i-=1,s-=e.parent.child(i).nodeSize;for(;a<e.parent.childCount&&Ku([...e.parent.child(a).marks],t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:s,to:l}}function Gu(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function Yu(e){return e instanceof eo}function Zu(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function Xu(e,t=null){if(!t)return null;const n=Yr.atStart(e),r=Yr.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return r;const o=n.from,i=r.to;return"all"===t?eo.create(e,Zu(0,o,i),Zu(e.content.size,o,i)):eo.create(e,Zu(t,o,i),Zu(t,o,i))}function Qu(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const ed=e=>{const t=e.childNodes;for(let n=t.length-1;n>=0;n-=1){const r=t[n];3===r.nodeType&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?e.removeChild(r):1===r.nodeType&&ed(r)}return e};function td(e){const t=`<body>${e}</body>`,n=(new window.DOMParser).parseFromString(t,"text/html").body;return ed(n)}function nd(e,t,n){if(n={slice:!0,parseOptions:{},...n},"object"==typeof e&&null!==e)try{return Array.isArray(e)&&e.length>0?sn.fromArray(e.map((e=>t.nodeFromJSON(e)))):t.nodeFromJSON(e)}catch(r){return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",r),nd("",t,n)}if("string"==typeof e){const r=Yn.fromSchema(t);return n.slice?r.parseSlice(td(e),n.parseOptions).content:r.parse(td(e),n.parseOptions)}return nd("",t,n)}function rd(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function od(e,t,n={}){const{from:r,to:o,empty:i}=e.selection,s=t?Du(t,e.schema):null,a=[];e.doc.nodesBetween(r,o,((e,t)=>{if(e.isText)return;const n=Math.max(r,t),i=Math.min(o,t+e.nodeSize);a.push({node:e,from:n,to:i})}));const l=o-r,c=a.filter((e=>!s||s.name===e.node.type.name)).filter((e=>Wu(e.node.attrs,n,{strict:!1})));if(i)return!!c.length;return c.reduce(((e,t)=>e+t.to-t.from),0)>=l}function id(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function sd(e,t){const n="string"==typeof t?[t]:t;return Object.keys(e).reduce(((t,r)=>(n.includes(r)||(t[r]=e[r]),t)),{})}function ad(e,t,n={}){return nd(e,t,{slice:!1,parseOptions:n})}function ld(e,t){const n=Gu(t,e.schema),{from:r,to:o,empty:i}=e.selection,s=[];i?(e.storedMarks&&s.push(...e.storedMarks),s.push(...e.selection.$head.marks())):e.doc.nodesBetween(r,o,(e=>{s.push(...e.marks)}));const a=s.find((e=>e.type.name===n.name));return a?{...a.attrs}:{}}function cd(e){return t=>function(e,t){for(let n=e.depth;n>0;n-=1){const r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}}(t.$from,e)}function ud(e,t,n){const r=[];return e===t?n.resolve(e).marks().forEach((t=>{const o=Uu(n.resolve(e-1),t.type);o&&r.push({mark:t,...o})})):n.nodesBetween(e,t,((e,t)=>{e&&void 0!==(null==e?void 0:e.nodeSize)&&r.push(...e.marks.map((n=>({from:t,to:t+e.nodeSize,mark:n}))))})),r}function dd(e,t,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const r=e.find((e=>e.type===t&&e.name===n));return!!r&&r.attribute.keepOnSplit})))}function pd(e,t,n={}){const{empty:r,ranges:o}=e.selection,i=t?Gu(t,e.schema):null;if(r)return!!(e.storedMarks||e.selection.$from.marks()).filter((e=>!i||i.name===e.type.name)).find((e=>Wu(e.attrs,n,{strict:!1})));let s=0;const a=[];if(o.forEach((({$from:t,$to:n})=>{const r=t.pos,o=n.pos;e.doc.nodesBetween(r,o,((e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(r,t),i=Math.min(o,t+e.nodeSize);s+=i-n,a.push(...e.marks.map((e=>({mark:e,from:n,to:i}))))}))})),0===s)return!1;const l=a.filter((e=>!i||i.name===e.mark.type.name)).filter((e=>Wu(e.mark.attrs,n,{strict:!1}))).reduce(((e,t)=>e+t.to-t.from),0),c=a.filter((e=>!i||e.mark.type!==i&&e.mark.type.excludes(i))).reduce(((e,t)=>e+t.to-t.from),0);return(l>0?l+c:l)>=s}function hd(e,t){const{nodeExtensions:n}=Eu(t),r=n.find((t=>t.name===e));if(!r)return!1;const o=Pu($u(r,"group",{name:r.name,options:r.options,storage:r.storage}));return"string"==typeof o&&o.split(" ").includes("list")}function fd(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const r=n.filter((e=>null==t?void 0:t.includes(e.type.name)));e.tr.ensureMarks(r)}}const md=(e,t)=>{const n=cd((e=>e.type===t))(e.selection);if(!n)return!0;const r=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===r)return!0;const o=e.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!$r(e.doc,n.pos)||(e.join(n.pos),!0)},gd=(e,t)=>{const n=cd((e=>e.type===t))(e.selection);if(!n)return!0;const r=e.doc.resolve(n.start).after(n.depth);if(void 0===r)return!0;const o=e.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!$r(e.doc,r)||(e.join(r),!0)};var yd=Object.freeze({__proto__:null,blur:()=>({editor:e,view:t})=>(requestAnimationFrame((()=>{var n;e.isDestroyed||(t.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0),clearContent:(e=!1)=>({commands:t})=>t.setContent("",e),clearNodes:()=>({state:e,tr:t,dispatch:n})=>{const{selection:r}=t,{ranges:o}=r;return!n||(o.forEach((({$from:n,$to:r})=>{e.doc.nodesBetween(n.pos,r.pos,((e,n)=>{if(e.type.isText)return;const{doc:r,mapping:o}=t,i=r.resolve(o.map(n)),s=r.resolve(o.map(n+e.nodeSize)),a=i.blockRange(s);if(!a)return;const l=Ar(a);if(e.type.isTextblock){const{defaultType:e}=i.parent.contentMatchAt(i.index());t.setNodeMarkup(a.start,e)}(l||0===l)&&t.lift(a,l)}))})),!0)},command:e=>t=>e(t),createParagraphNear:()=>({state:e,dispatch:t})=>Lo(e,t),cut:(e,t)=>({editor:n,tr:r})=>{const{state:o}=n,i=o.doc.slice(e.from,e.to);r.deleteRange(e.from,e.to);const s=r.mapping.map(t);return r.insert(s,i.content),r.setSelection(new eo(r.doc.resolve(s-1))),!0},deleteCurrentNode:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,r=n.$anchor.node();if(r.content.size>0)return!1;const o=e.selection.$anchor;for(let n=o.depth;n>0;n-=1){if(o.node(n).type===r.type){if(t){const t=o.before(n),r=o.after(n);e.delete(t,r).scrollIntoView()}return!0}}return!1},deleteNode:e=>({tr:t,state:n,dispatch:r})=>{const o=Du(e,n.schema),i=t.selection.$anchor;for(let e=i.depth;e>0;e-=1){if(i.node(e).type===o){if(r){const n=i.before(e),r=i.after(e);t.delete(n,r).scrollIntoView()}return!0}}return!1},deleteRange:e=>({tr:t,dispatch:n})=>{const{from:r,to:o}=e;return n&&t.delete(r,o),!0},deleteSelection:()=>({state:e,dispatch:t})=>wo(e,t),enter:()=>({commands:e})=>e.keyboardShortcut("Enter"),exitCode:()=>({state:e,dispatch:t})=>Io(e,t),extendMarkRange:(e,t={})=>({tr:n,state:r,dispatch:o})=>{const i=Gu(e,r.schema),{doc:s,selection:a}=n,{$from:l,from:c,to:u}=a;if(o){const e=Uu(l,i,t);if(e&&e.from<=c&&e.to>=u){const t=eo.create(s,e.from,e.to);n.setSelection(t)}}return!0},first:e=>t=>{const n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1},focus:(e=null,t={})=>({editor:n,view:r,tr:o,dispatch:i})=>{t={scrollIntoView:!0,...t};const s=()=>{Qu()&&r.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(r.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())}))};if(r.hasFocus()&&null===e||!1===e)return!0;if(i&&null===e&&!Yu(n.state.selection))return s(),!0;const a=Xu(o.doc,e)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||o.setSelection(a),l&&o.storedMarks&&o.setStoredMarks(o.storedMarks),s()),!0},forEach:(e,t)=>n=>e.every(((e,r)=>t(e,{...n,index:r}))),insertContent:(e,t)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),insertContentAt:(e,t,n)=>({tr:r,dispatch:o,editor:i})=>{if(o){n={parseOptions:{},updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};const o=nd(t,i.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if("<>"===o.toString())return!0;let{from:s,to:a}="number"==typeof e?{from:e,to:e}:{from:e.from,to:e.to},l=!0,c=!0;if((o.toString().startsWith("<")?o:[o]).forEach((e=>{e.check(),l=!!l&&(e.isText&&0===e.marks.length),c=!!c&&e.isBlock})),s===a&&c){const{parent:e}=r.doc.resolve(s);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(s-=1,a+=1)}let u;l?(u=Array.isArray(t)?t.map((e=>e.text||"")).join(""):"object"==typeof t&&t&&t.text?t.text:t,r.insertText(u,s,a)):(u=o,r.replaceWith(s,a,u)),n.updateSelection&&function(e,t,n){const r=e.steps.length-1;if(r<t)return;const o=e.steps[r];if(!(o instanceof Mr||o instanceof Sr))return;const i=e.mapping.maps[r];let s=0;i.forEach(((e,t,n,r)=>{0===s&&(s=r)})),e.setSelection(Yr.near(e.doc.resolve(s),n))}(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:s,text:u}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:s,text:u})}return!0},joinUp:()=>({state:e,dispatch:t})=>((e,t)=>{let n,r=e.selection,o=r instanceof no;if(o){if(r.node.isTextblock||!$r(e.doc,r.from))return!1;n=r.from}else if(n=Dr(e.doc,r.from,-1),null==n)return!1;if(t){let r=e.tr.join(n);o&&r.setSelection(no.create(r.doc,n-e.doc.resolve(n).nodeBefore.nodeSize)),t(r.scrollIntoView())}return!0})(e,t),joinDown:()=>({state:e,dispatch:t})=>((e,t)=>{let n,r=e.selection;if(r instanceof no){if(r.node.isTextblock||!$r(e.doc,r.to))return!1;n=r.to}else if(n=Dr(e.doc,r.to,1),null==n)return!1;return t&&t(e.tr.join(n).scrollIntoView()),!0})(e,t),joinBackward:()=>({state:e,dispatch:t})=>xo(e,t),joinForward:()=>({state:e,dispatch:t})=>To(e,t),joinItemBackward:()=>({tr:e,state:t,dispatch:n})=>{try{const r=Dr(t.doc,t.selection.$from.pos,-1);return null!=r&&(e.join(r,2),n&&n(e),!0)}catch{return!1}},joinItemForward:()=>({state:e,dispatch:t,tr:n})=>{try{const r=Dr(e.doc,e.selection.$from.pos,1);return null!=r&&(n.join(r,2),t&&t(n),!0)}catch(e){return!1}},joinTextblockBackward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let r=ko(e,n);if(!r)return!1;let o=Oo(r);return!!o&&Mo(e,o,t)})(e,t),joinTextblockForward:()=>({state:e,dispatch:t})=>((e,t,n)=>{let r=Ao(e,n);if(!r)return!1;let o=No(r);return!!o&&Mo(e,o,t)})(e,t),keyboardShortcut:e=>({editor:t,view:n,tr:r,dispatch:o})=>{const i=function(e){const t=e.split(/-(?!$)/);let n,r,o,i,s=t[t.length-1];"Space"===s&&(s=" ");for(let e=0;e<t.length-1;e+=1){const s=t[e];if(/^(cmd|meta|m)$/i.test(s))i=!0;else if(/^a(lt)?$/i.test(s))n=!0;else if(/^(c|ctrl|control)$/i.test(s))r=!0;else if(/^s(hift)?$/i.test(s))o=!0;else{if(!/^mod$/i.test(s))throw new Error(`Unrecognized modifier name: ${s}`);Qu()||rd()?i=!0:r=!0}}return n&&(s=`Alt-${s}`),r&&(s=`Ctrl-${s}`),i&&(s=`Meta-${s}`),o&&(s=`Shift-${s}`),s}(e).split(/-(?!$)/),s=i.find((e=>!["Alt","Ctrl","Meta","Shift"].includes(e))),a=new KeyboardEvent("keydown",{key:"Space"===s?" ":s,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction((()=>{n.someProp("handleKeyDown",(e=>e(n,a)))}));return null==l||l.steps.forEach((e=>{const t=e.map(r.mapping);t&&o&&r.maybeStep(t)})),!0},lift:(e,t={})=>({state:n,dispatch:r})=>!!od(n,Du(e,n.schema),t)&&$o(n,r),liftEmptyBlock:()=>({state:e,dispatch:t})=>Po(e,t),liftListItem:e=>({state:t,dispatch:n})=>Xo(Du(e,t.schema))(t,n),newlineInCode:()=>({state:e,dispatch:t})=>Eo(e,t),resetAttributes:(e,t)=>({tr:n,state:r,dispatch:o})=>{let i=null,s=null;const a=id("string"==typeof e?e:e.name,r.schema);return!!a&&("node"===a&&(i=Du(e,r.schema)),"mark"===a&&(s=Gu(e,r.schema)),o&&n.selection.ranges.forEach((e=>{r.doc.nodesBetween(e.$from.pos,e.$to.pos,((e,r)=>{i&&i===e.type&&n.setNodeMarkup(r,void 0,sd(e.attrs,t)),s&&e.marks.length&&e.marks.forEach((o=>{s===o.type&&n.addMark(r,r+e.nodeSize,s.create(sd(o.attrs,t)))}))}))})),!0)},scrollIntoView:()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),selectAll:()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),selectNodeBackward:()=>({state:e,dispatch:t})=>Co(e,t),selectNodeForward:()=>({state:e,dispatch:t})=>_o(e,t),selectParentNode:()=>({state:e,dispatch:t})=>Bo(e,t),selectTextblockEnd:()=>({state:e,dispatch:t})=>Fo(e,t),selectTextblockStart:()=>({state:e,dispatch:t})=>Ho(e,t),setContent:(e,t=!1,n={})=>({tr:r,editor:o,dispatch:i})=>{const{doc:s}=r,a=ad(e,o.schema,n);return i&&r.replaceWith(0,s.content.size,a).setMeta("preventUpdate",!t),!0},setMark:(e,t={})=>({tr:n,state:r,dispatch:o})=>{const{selection:i}=n,{empty:s,ranges:a}=i,l=Gu(e,r.schema);if(o)if(s){const e=ld(r,l);n.addStoredMark(l.create({...e,...t}))}else a.forEach((e=>{const o=e.$from.pos,i=e.$to.pos;r.doc.nodesBetween(o,i,((e,r)=>{const s=Math.max(r,o),a=Math.min(r+e.nodeSize,i);e.marks.find((e=>e.type===l))?e.marks.forEach((e=>{l===e.type&&n.addMark(s,a,l.create({...e.attrs,...t}))})):n.addMark(s,a,l.create(t))}))}));return function(e,t,n){var r;const{selection:o}=t;let i=null;if(Yu(o)&&(i=o.$cursor),i){const t=null!==(r=e.storedMarks)&&void 0!==r?r:i.marks();return!!n.isInSet(t)||!t.some((e=>e.type.excludes(n)))}const{ranges:s}=o;return s.some((({$from:t,$to:r})=>{let o=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(n);return e.doc.nodesBetween(t.pos,r.pos,((e,t,r)=>{if(o)return!1;if(e.isInline){const t=!r||r.type.allowsMarkType(n),i=!!n.isInSet(e.marks)||!e.marks.some((e=>e.type.excludes(n)));o=t&&i}return!o})),o}))}(r,n,l)},setMeta:(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),setNode:(e,t={})=>({state:n,dispatch:r,chain:o})=>{const i=Du(e,n.schema);return i.isTextblock?o().command((({commands:e})=>!!Wo(i,t)(n)||e.clearNodes())).command((({state:e})=>Wo(i,t)(e,r))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,r=Zu(e,0,n.content.size),o=no.create(n,r);t.setSelection(o)}return!0},setTextSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:r,to:o}="number"==typeof e?{from:e,to:e}:e,i=eo.atStart(n).from,s=eo.atEnd(n).to,a=Zu(r,i,s),l=Zu(o,i,s),c=eo.create(n,a,l);t.setSelection(c)}return!0},sinkListItem:e=>({state:t,dispatch:n})=>Qo(Du(e,t.schema))(t,n),splitBlock:({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:r,editor:o})=>{const{selection:i,doc:s}=t,{$from:a,$to:l}=i,c=dd(o.extensionManager.attributes,a.node().type.name,a.node().attrs);if(i instanceof no&&i.node.isBlock)return!(!a.parentOffset||!Nr(s,a.pos))&&(r&&(e&&fd(n,o.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(r){const r=l.parentOffset===l.parent.content.size;i instanceof eo&&t.deleteSelection();const s=0===a.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(a.node(-1).contentMatchAt(a.indexAfter(-1)));let u=r&&s?[{type:s,attrs:c}]:void 0,d=Nr(t.doc,t.mapping.map(a.pos),1,u);if(u||d||!Nr(t.doc,t.mapping.map(a.pos),1,s?[{type:s}]:void 0)||(d=!0,u=s?[{type:s,attrs:c}]:void 0),d&&(t.split(t.mapping.map(a.pos),1,u),s&&!r&&!a.parentOffset&&a.parent.type!==s)){const e=t.mapping.map(a.before()),n=t.doc.resolve(e);a.node(-1).canReplaceWith(n.index(),n.index()+1,s)&&t.setNodeMarkup(t.mapping.map(a.before()),s)}e&&fd(n,o.extensionManager.splittableMarks),t.scrollIntoView()}return!0},splitListItem:e=>({tr:t,state:n,dispatch:r,editor:o})=>{var i;const s=Du(e,n.schema),{$from:a,$to:l}=n.selection,c=n.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(l))return!1;const u=a.node(-1);if(u.type!==s)return!1;const d=o.extensionManager.attributes;if(0===a.parent.content.size&&a.node(-1).childCount===a.indexAfter(-1)){if(2===a.depth||a.node(-3).type!==s||a.index(-2)!==a.node(-2).childCount-1)return!1;if(r){let e=sn.empty;const n=a.index(-1)?1:a.index(-2)?2:3;for(let t=a.depth-n;t>=a.depth-3;t-=1)e=sn.from(a.node(t).copy(e));const r=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,o=dd(d,a.node().type.name,a.node().attrs),l=(null===(i=s.contentMatch.defaultType)||void 0===i?void 0:i.createAndFill(o))||void 0;e=e.append(sn.from(s.createAndFill(null,l)||void 0));const c=a.before(a.depth-(n-1));t.replace(c,a.after(-r),new pn(e,4-n,0));let u=-1;t.doc.nodesBetween(c,t.doc.content.size,((e,t)=>{if(u>-1)return!1;e.isTextblock&&0===e.content.size&&(u=t+1)})),u>-1&&t.setSelection(eo.near(t.doc.resolve(u))),t.scrollIntoView()}return!0}const p=l.pos===a.end()?u.contentMatchAt(0).defaultType:null,h=dd(d,u.type.name,u.attrs),f=dd(d,a.node().type.name,a.node().attrs);t.delete(a.pos,l.pos);const m=p?[{type:s,attrs:h},{type:p,attrs:f}]:[{type:s,attrs:h}];if(!Nr(t.doc,a.pos,2))return!1;if(r){const{selection:e,storedMarks:i}=n,{splittableMarks:s}=o.extensionManager,l=i||e.$to.parentOffset&&e.$from.marks();if(t.split(a.pos,2,m).scrollIntoView(),!l||!r)return!0;const c=l.filter((e=>s.includes(e.type.name)));t.ensureMarks(c)}return!0},toggleList:(e,t,n,r={})=>({editor:o,tr:i,state:s,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:p}=o.extensionManager,h=Du(e,s.schema),f=Du(t,s.schema),{selection:m,storedMarks:g}=s,{$from:y,$to:v}=m,b=y.blockRange(v),w=g||m.$to.parentOffset&&m.$from.marks();if(!b)return!1;const k=cd((e=>hd(e.type.name,d)))(m);if(b.depth>=1&&k&&b.depth-k.depth<=1){if(k.node.type===h)return c.liftListItem(f);if(hd(k.node.type.name,d)&&h.validContent(k.node.content)&&a)return l().command((()=>(i.setNodeMarkup(k.pos,h),!0))).command((()=>md(i,h))).command((()=>gd(i,h))).run()}return n&&w&&a?l().command((()=>{const e=u().wrapInList(h,r),t=w.filter((e=>p.includes(e.type.name)));return i.ensureMarks(t),!!e||c.clearNodes()})).wrapInList(h,r).command((()=>md(i,h))).command((()=>gd(i,h))).run():l().command((()=>!!u().wrapInList(h,r)||c.clearNodes())).wrapInList(h,r).command((()=>md(i,h))).command((()=>gd(i,h))).run()},toggleMark:(e,t={},n={})=>({state:r,commands:o})=>{const{extendEmptyMarkRange:i=!1}=n,s=Gu(e,r.schema);return pd(r,s,t)?o.unsetMark(s,{extendEmptyMarkRange:i}):o.setMark(s,t)},toggleNode:(e,t,n={})=>({state:r,commands:o})=>{const i=Du(e,r.schema),s=Du(t,r.schema);return od(r,i,n)?o.setNode(s):o.setNode(i,n)},toggleWrap:(e,t={})=>({state:n,commands:r})=>{const o=Du(e,n.schema);return od(n,o,t)?r.lift(o):r.wrapIn(o,t)},undoInputRule:()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let r=0;r<n.length;r+=1){const o=n[r];let i;if(o.spec.isInputRules&&(i=o.getState(e))){if(t){const t=e.tr,n=i.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(i.text){const n=t.doc.resolve(i.from).marks();t.replaceWith(i.from,i.to,e.schema.text(i.text,n))}else t.delete(i.from,i.to)}return!0}}return!1},unsetAllMarks:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:r,ranges:o}=n;return r||t&&o.forEach((t=>{e.removeMark(t.$from.pos,t.$to.pos)})),!0},unsetMark:(e,t={})=>({tr:n,state:r,dispatch:o})=>{var i;const{extendEmptyMarkRange:s=!1}=t,{selection:a}=n,l=Gu(e,r.schema),{$from:c,empty:u,ranges:d}=a;if(!o)return!0;if(u&&s){let{from:e,to:t}=a;const r=null===(i=c.marks().find((e=>e.type===l)))||void 0===i?void 0:i.attrs,o=Uu(c,l,r);o&&(e=o.from,t=o.to),n.removeMark(e,t,l)}else d.forEach((e=>{n.removeMark(e.$from.pos,e.$to.pos,l)}));return n.removeStoredMark(l),!0},updateAttributes:(e,t={})=>({tr:n,state:r,dispatch:o})=>{let i=null,s=null;const a=id("string"==typeof e?e:e.name,r.schema);return!!a&&("node"===a&&(i=Du(e,r.schema)),"mark"===a&&(s=Gu(e,r.schema)),o&&n.selection.ranges.forEach((e=>{const o=e.$from.pos,a=e.$to.pos;r.doc.nodesBetween(o,a,((e,r)=>{i&&i===e.type&&n.setNodeMarkup(r,void 0,{...e.attrs,...t}),s&&e.marks.length&&e.marks.forEach((i=>{if(s===i.type){const l=Math.max(r,o),c=Math.min(r+e.nodeSize,a);n.addMark(l,c,s.create({...i.attrs,...t}))}}))}))})),!0)},wrapIn:(e,t={})=>({state:n,dispatch:r})=>qo(Du(e,n.schema),t)(n,r),wrapInList:(e,t={})=>({state:n,dispatch:r})=>Zo(Du(e,n.schema),t)(n,r)});Hu.create({name:"commands",addCommands:()=>({...yd})}),Hu.create({name:"editable",addProseMirrorPlugins(){return[new go({key:new bo("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Hu.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new go({key:new bo("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const r=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1},blur:(t,n)=>{e.isFocused=!1;const r=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1}}}})]}}),Hu.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first((({commands:e})=>[()=>e.undoInputRule(),()=>e.command((({tr:t})=>{const{selection:n,doc:r}=t,{empty:o,$anchor:i}=n,{pos:s,parent:a}=i,l=i.parent.isTextblock&&s>0?t.doc.resolve(s-1):i,c=l.parent.type.spec.isolating,u=i.pos-i.parentOffset,d=c&&1===l.parent.childCount?u===i.pos:Yr.atStart(r).from===s;return!(!(o&&d&&a.type.isTextblock)||a.textContent.length)&&e.clearNodes()})),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()])),t=()=>this.editor.commands.first((({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()])),n={Enter:()=>this.editor.commands.first((({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},r={...n},o={...n,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Qu()||rd()?o:r},addProseMirrorPlugins(){return[new go({key:new bo("clearDocument"),appendTransaction:(e,t,n)=>{if(!(e.some((e=>e.docChanged))&&!t.doc.eq(n.doc)))return;const{empty:r,from:o,to:i}=t.selection,s=Yr.atStart(t.doc).from,a=Yr.atEnd(t.doc).to;if(r||!(o===s&&i===a))return;if(!(0===n.doc.textBetween(0,n.doc.content.size," "," ").length))return;const l=n.tr,c=_u({state:n,transaction:l}),{commands:u}=new Nu({editor:this.editor,state:c});return u.clearNodes(),l.steps.length?l:void 0}})]}}),Hu.create({name:"tabindex",addProseMirrorPlugins(){return[new go({key:new bo("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});function vd(e){return new ju({find:e.find,handler:({state:t,range:n,match:r})=>{const o=Pu(e.getAttributes,void 0,r);if(!1===o||null===o)return null;const{tr:i}=t,s=r[r.length-1],a=r[0];if(s){const r=a.search(/\S/),l=n.from+a.indexOf(s),c=l+s.length;if(ud(n.from,n.to,t.doc).filter((t=>t.mark.type.excluded.find((n=>n===e.type&&n!==t.mark.type)))).filter((e=>e.to>l)).length)return null;c<n.to&&i.delete(c,n.to),l>n.from&&i.delete(n.from+r,l);const u=n.from+r+s.length;i.addMark(n.from+r,u,e.type.create(o||{})),i.removeStoredMark(e.type)}}})}function bd(e){return new ju({find:e.find,handler:({state:t,range:n,match:r})=>{const o=Pu(e.getAttributes,void 0,r)||{},{tr:i}=t,s=n.from;let a=n.to;const l=e.type.create(o);if(r[1]){let e=s+r[0].lastIndexOf(r[1]);e>a?e=a:a=e+r[1].length;const t=r[0][r[0].length-1];i.insertText(t,s+r[0].length-1),i.replaceWith(e,a,l)}else r[0]&&i.insert(s-1,e.type.create(o)).delete(i.mapping.map(s),i.mapping.map(a));i.scrollIntoView()}})}function wd(e){return new ju({find:e.find,handler:({state:t,range:n,match:r})=>{const o=t.doc.resolve(n.from),i=Pu(e.getAttributes,void 0,r)||{};if(!o.node(-1).canReplaceWith(o.index(-1),o.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,i)}})}function kd(e){return new ju({find:e.find,handler:({state:t,range:n,match:r,chain:o})=>{const i=Pu(e.getAttributes,void 0,r)||{},s=t.tr.delete(n.from,n.to),a=s.doc.resolve(n.from).blockRange(),l=a&&Tr(a,e.type,i);if(!l)return null;if(s.wrap(a,l),e.keepMarks&&e.editor){const{selection:n,storedMarks:r}=t,{splittableMarks:o}=e.editor.extensionManager,i=r||n.$to.parentOffset&&n.$from.marks();if(i){const e=i.filter((e=>o.includes(e.type.name)));s.ensureMarks(e)}}if(e.keepAttributes){const t="bulletList"===e.type.name||"orderedList"===e.type.name?"listItem":"taskList";o().updateAttributes(t,i).run()}const c=s.doc.resolve(n.from-1).nodeBefore;c&&c.type===e.type&&$r(s.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(r,c))&&s.join(n.from-1)}})}class xd{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Pu($u(this,"addOptions",{name:this.name}))),this.storage=Pu($u(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new xd(e)}configure(e={}){const t=this.extend();return t.options=Ru(this.options,e),t.storage=Pu($u(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new xd({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Pu($u(t,"addOptions",{name:t.name})),t.storage=Pu($u(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,r=e.state.selection.$from;if(r.pos===r.end()){const o=r.marks();if(!!!o.find((e=>(null==e?void 0:e.type.name)===t.name)))return!1;const i=o.find((e=>(null==e?void 0:e.type.name)===t.name));return i&&n.removeStoredMark(i),n.insertText(" ",r.pos),e.view.dispatch(n),!0}return!1}}class Md{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Pu($u(this,"addOptions",{name:this.name}))),this.storage=Pu($u(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Md(e)}configure(e={}){const t=this.extend();return t.options=Ru(this.options,e),t.storage=Pu($u(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Md({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Pu($u(t,"addOptions",{name:t.name})),t.storage=Pu($u(t,"addStorage",{name:t.name,options:t.options})),t}}function Sd(e){return new Bu({find:e.find,handler:({state:t,range:n,match:r,pasteEvent:o})=>{const i=Pu(e.getAttributes,void 0,r,o);if(!1===i||null===i)return null;const{tr:s}=t,a=r[r.length-1],l=r[0];let c=n.to;if(a){const r=l.search(/\S/),o=n.from+l.indexOf(a),u=o+a.length;if(ud(n.from,n.to,t.doc).filter((t=>t.mark.type.excluded.find((n=>n===e.type&&n!==t.mark.type)))).filter((e=>e.to>o)).length)return null;u<n.to&&s.delete(u,n.to),o>n.from&&s.delete(n.from+r,o),c=n.from+r+a.length,s.addMark(n.from+r,c,e.type.create(i||{})),s.removeStoredMark(e.type)}}})}const Cd=/^\s*>\s$/,Od=Md.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:e}){return["blockquote",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[kd({find:Cd,type:this.type})]}}),Ad=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Td=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,_d=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Nd=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,$d=xd.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],renderHTML({HTMLAttributes:e}){return["strong",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[vd({find:Ad,type:this.type}),vd({find:_d,type:this.type})]},addPasteRules(){return[Sd({find:Td,type:this.type}),Sd({find:Nd,type:this.type})]}}),Ed=Md.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",Iu(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Dd=xd.create({name:"textStyle",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"span",getAttrs:e=>!!e.hasAttribute("style")&&{}}],renderHTML({HTMLAttributes:e}){return["span",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=ld(e,this.type);return!!Object.entries(n).some((([,e])=>!!e))||t.unsetMark(this.name)}}}}),Id=/^\s*([-+*])\s$/,Ld=Md.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:e}){return["ul",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Ed.name,this.editor.getAttributes(Dd.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=kd({find:Id,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=kd({find:Id,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Dd.name),editor:this.editor})),[e]}}),Pd=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))$/,zd=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))/g,jd=xd.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:e}){return["code",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[vd({find:Pd,type:this.type})]},addPasteRules(){return[Sd({find:zd,type:this.type})]}}),Bd=/^```([a-z]+)?[\s\n]$/,Vd=/^~~~([a-z]+)?[\s\n]$/,Rd=Md.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options,r=[...(null===(t=e.firstElementChild)||void 0===t?void 0:t.classList)||[]].filter((e=>e.startsWith(n))).map((e=>e.replace(n,"")))[0];return r||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:e,HTMLAttributes:t}){return["pre",Iu(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=1===t.pos;return!(!e||t.parent.type.name!==this.name)&&(!(!n&&t.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:r,empty:o}=n;if(!o||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,s=r.parent.textContent.endsWith("\n\n");return!(!i||!s)&&e.chain().command((({tr:e})=>(e.delete(r.pos-2,r.pos),!0))).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:r}=t,{$from:o,empty:i}=n;if(!i||o.parent.type!==this.type)return!1;if(!(o.parentOffset===o.parent.nodeSize-2))return!1;const s=o.after();if(void 0===s)return!1;return!r.nodeAt(s)&&e.commands.exitCode()}}},addInputRules(){return[wd({find:Bd,type:this.type,getAttributes:e=>({language:e[1]})}),wd({find:Vd,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new go({key:new bo("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),r=t.clipboardData.getData("vscode-editor-data"),o=r?JSON.parse(r):void 0,i=null==o?void 0:o.mode;if(!n||!i)return!1;const{tr:s}=e.state;return s.replaceSelectionWith(this.type.create({language:i})),s.setSelection(eo.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.insertText(n.replace(/\r\n?/g,"\n")),s.setMeta("paste",!0),e.dispatch(s),!0}}})]}}),Hd=Md.create({name:"doc",topNode:!0,content:"block+"});function Fd(e={}){return new go({view:t=>new qd(t,e)})}class qd{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=t.width)&&void 0!==n?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent;if(n){let n=t.nodeBefore,r=t.nodeAfter;if(n||r){let t=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(t){let o=t.getBoundingClientRect(),i=n?o.bottom:o.top;n&&r&&(i=(i+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:o.left,right:o.right,top:i-this.width/2,bottom:i+this.width/2}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let r,o,i=this.editorView.dom.offsetParent;if(this.element||(this.element=i.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!i||i==document.body&&"static"==getComputedStyle(i).position)r=-pageXOffset,o=-pageYOffset;else{let e=i.getBoundingClientRect();r=e.left-i.scrollLeft,o=e.top-i.scrollTop}this.element.style.left=e.left-r+"px",this.element.style.top=e.top-o+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),r=n&&n.type.spec.disableDropCursor,o="function"==typeof r?r(this.editorView,t,e):r;if(t&&!o){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=Ir(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Wd=Hu.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[Fd(this.options)]}});class Jd extends Yr{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return Jd.valid(n)?new Jd(n):Yr.near(n)}content(){return pn.empty}eq(e){return e instanceof Jd&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new Jd(e.resolve(t.pos))}getBookmark(){return new Kd(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),r=e.node(t);if(0!=n)for(let e=r.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),r=e.node(t);if(n!=r.childCount)for(let e=r.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let r=t.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&Jd.valid(e))return e;let r=e.pos,o=null;for(let n=e.depth;;n--){let i=e.node(n);if(t>0?e.indexAfter(n)<i.childCount:e.index(n)>0){o=i.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;r+=t;let s=e.doc.resolve(r);if(Jd.valid(s))return s}for(;;){let i=t>0?o.firstChild:o.lastChild;if(!i){if(o.isAtom&&!o.isText&&!no.isSelectable(o)){e=e.doc.resolve(r+o.nodeSize*t),n=!1;continue e}break}o=i,r+=t;let s=e.doc.resolve(r);if(Jd.valid(s))return s}return null}}}Jd.prototype.visible=!1,Jd.findFrom=Jd.findGapCursorFrom,Yr.jsonID("gapcursor",Jd);class Kd{constructor(e){this.pos=e}map(e){return new Kd(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Jd.valid(t)?new Jd(t):Yr.near(t)}}const Ud=Sl({ArrowLeft:Gd("horiz",-1),ArrowRight:Gd("horiz",1),ArrowUp:Gd("vert",-1),ArrowDown:Gd("vert",1)});function Gd(e,t){const n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,r,o){let i=e.selection,s=t>0?i.$to:i.$from,a=i.empty;if(i instanceof eo){if(!o.endOfTextblock(n)||0==s.depth)return!1;a=!1,s=e.doc.resolve(t>0?s.after():s.before())}let l=Jd.findGapCursorFrom(s,t,a);return!!l&&(r&&r(e.tr.setSelection(new Jd(l))),!0)}}function Yd(e,t,n){if(!e||!e.editable)return!1;let r=e.state.doc.resolve(t);if(!Jd.valid(r))return!1;let o=e.posAtCoords({left:n.clientX,top:n.clientY});return!(o&&o.inside>-1&&no.isSelectable(e.state.doc.nodeAt(o.inside)))&&(e.dispatch(e.state.tr.setSelection(new Jd(r))),!0)}function Zd(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof Jd))return!1;let{$from:n}=e.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!r)return!1;let o=sn.empty;for(let e=r.length-1;e>=0;e--)o=sn.from(r[e].createAndFill(null,o));let i=e.state.tr.replace(n.pos,n.pos,new pn(o,0,0));return i.setSelection(eo.near(i.doc.resolve(n.pos+1))),e.dispatch(i),!1}function Xd(e){if(!(e.selection instanceof Jd))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",ja.create(e.doc,[La.widget(e.selection.head,t,{key:"gapcursor"})])}const Qd=Hu.create({name:"gapCursor",addProseMirrorPlugins:()=>[new go({props:{decorations:Xd,createSelectionBetween:(e,t,n)=>t.pos==n.pos&&Jd.valid(n)?new Jd(n):null,handleClick:Yd,handleKeyDown:Ud,handleDOMEvents:{beforeinput:Zd}}})],extendNodeSchema(e){var t;return{allowGapCursor:null!==(t=Pu($u(e,"allowGapCursor",{name:e.name,options:e.options,storage:e.storage})))&&void 0!==t?t:null}}}),ep=Md.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",Iu(this.options.HTMLAttributes,e)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:r})=>e.first([()=>e.exitCode(),()=>e.command((()=>{const{selection:e,storedMarks:o}=n;if(e.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:s}=r.extensionManager,a=o||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{if(t&&a&&i){const t=a.filter((e=>s.includes(e.type.name)));e.ensureMarks(t)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),tp=Md.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map((e=>({tag:`h${e}`,attrs:{level:e}})))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,Iu(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce(((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})})),{})},addInputRules(){return this.options.levels.map((e=>wd({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}})))}});var np=200,rp=function(){};rp.prototype.append=function(e){return e.length?(e=rp.from(e),!this.length&&e||e.length<np&&this.leafAppend(e)||this.length<np&&e.leafPrepend(this)||this.appendInner(e)):this},rp.prototype.prepend=function(e){return e.length?rp.from(e).append(this):this},rp.prototype.appendInner=function(e){return new ip(this,e)},rp.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?rp.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},rp.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},rp.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},rp.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var r=[];return this.forEach((function(t,n){return r.push(e(t,n))}),t,n),r},rp.from=function(e){return e instanceof rp?e:e&&e.length?new op(e):rp.empty};var op=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,r){for(var o=t;o<n;o++)if(!1===e(this.values[o],r+o))return!1},t.prototype.forEachInvertedInner=function(e,t,n,r){for(var o=t-1;o>=n;o--)if(!1===e(this.values[o],r+o))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=np)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=np)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(rp);rp.empty=new op([]);var ip=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,r){var o=this.left.length;return!(t<o&&!1===this.left.forEachInner(e,t,Math.min(n,o),r))&&(!(n>o&&!1===this.right.forEachInner(e,Math.max(t-o,0),Math.min(this.length,n)-o,r+o))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,r){var o=this.left.length;return!(t>o&&!1===this.right.forEachInvertedInner(e,t-o,Math.max(n,o)-o,r+o))&&(!(n<o&&!1===this.left.forEachInvertedInner(e,Math.min(t,o),n,r))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(rp);const sp=rp;class ap{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,r,o=this.items.length;for(;;o--){if(this.items.get(o-1).selection){--o;break}}t&&(n=this.remapping(o,this.items.length),r=n.maps.length);let i,s,a=e.tr,l=[],c=[];return this.items.forEach(((e,t)=>{if(!e.step)return n||(n=this.remapping(o,t+1),r=n.maps.length),r--,void c.push(e);if(n){c.push(new lp(e.map));let t,o=e.step.map(n.slice(r));o&&a.maybeStep(o).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],l.push(new lp(t,void 0,void 0,l.length+c.length))),r--,t&&n.appendMap(t,r)}else a.maybeStep(e.step);return e.selection?(i=n?e.selection.map(n.slice(r)):e.selection,s=new ap(this.items.slice(0,o).append(c.reverse().concat(l)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:s,transform:a,selection:i}}addTransform(e,t,n,r){let o=[],i=this.eventCount,s=this.items,a=!r&&s.length?s.get(s.length-1):null;for(let n=0;n<e.steps.length;n++){let l,c=e.steps[n].invert(e.docs[n]),u=new lp(e.mapping.maps[n],c,t);(l=a&&a.merge(u))&&(u=l,n?o.pop():s=s.slice(0,s.length-1)),o.push(u),t&&(i++,t=void 0),r||(a=u)}let l=i-n.depth;return l>up&&(s=function(e,t){let n;return e.forEach(((e,r)=>{if(e.selection&&0==t--)return n=r,!1})),e.slice(n)}(s,l),i-=l),new ap(s.append(o),i)}remapping(e,t){let n=new fr;return this.items.forEach(((t,r)=>{let o=null!=t.mirrorOffset&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,o)}),e,t),n}addMaps(e){return 0==this.eventCount?this:new ap(this.items.append(e.map((e=>new lp(e)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-t),o=e.mapping,i=e.steps.length,s=this.eventCount;this.items.forEach((e=>{e.selection&&s--}),r);let a=t;this.items.forEach((t=>{let r=o.getMirror(--a);if(null==r)return;i=Math.min(i,r);let l=o.maps[r];if(t.step){let i=e.steps[r].invert(e.docs[r]),c=t.selection&&t.selection.map(o.slice(a+1,r));c&&s++,n.push(new lp(l,i,c))}else n.push(new lp(l))}),r);let l=[];for(let e=t;e<i;e++)l.push(new lp(o.maps[e]));let c=this.items.slice(0,r).append(l).append(n),u=new ap(c,s);return u.emptyItemCount()>500&&(u=u.compress(this.items.length-n.length)),u}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,r=[],o=0;return this.items.forEach(((i,s)=>{if(s>=e)r.push(i),i.selection&&o++;else if(i.step){let e=i.step.map(t.slice(n)),s=e&&e.getMap();if(n--,s&&t.appendMap(s,n),e){let a=i.selection&&i.selection.map(t.slice(n));a&&o++;let l,c=new lp(s.invert(),e,a),u=r.length-1;(l=r.length&&r[u].merge(c))?r[u]=l:r.push(c)}}else i.map&&n--}),this.items.length,0),new ap(sp.from(r.reverse()),o)}}ap.empty=new ap(sp.empty,0);class lp{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new lp(t.getMap().invert(),t,this.selection)}}}class cp{constructor(e,t,n,r,o){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r,this.prevComposition=o}}const up=20;function dp(e){let t=[];return e.forEach(((e,n,r,o)=>t.push(r,o))),t}function pp(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let o=t.map(e[r],1),i=t.map(e[r+1],-1);o<=i&&n.push(o,i)}return n}let hp=!1,fp=null;function mp(e){let t=e.plugins;if(fp!=t){hp=!1,fp=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){hp=!0;break}}return hp}const gp=new bo("history"),yp=new bo("closeHistory");function vp(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new go({key:gp,state:{init:()=>new cp(ap.empty,ap.empty,null,0,-1),apply:(t,n,r)=>function(e,t,n,r){let o,i=n.getMeta(gp);if(i)return i.historyState;n.getMeta(yp)&&(e=new cp(e.done,e.undone,null,0,-1));let s=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(s&&s.getMeta(gp))return s.getMeta(gp).redo?new cp(e.done.addTransform(n,void 0,r,mp(t)),e.undone,dp(n.mapping.maps[n.steps.length-1]),e.prevTime,e.prevComposition):new cp(e.done,e.undone.addTransform(n,void 0,r,mp(t)),null,e.prevTime,e.prevComposition);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(o=n.getMeta("rebased"))?new cp(e.done.rebased(n,o),e.undone.rebased(n,o),pp(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new cp(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),pp(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);{let o=n.getMeta("composition"),i=0==e.prevTime||!s&&e.prevComposition!=o&&(e.prevTime<(n.time||0)-r.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach(((e,r)=>{for(let o=0;o<t.length;o+=2)e<=t[o+1]&&r>=t[o]&&(n=!0)})),n}(n,e.prevRanges)),a=s?pp(e.prevRanges,n.mapping):dp(n.mapping.maps[n.steps.length-1]);return new cp(e.done.addTransform(n,i?t.selection.getBookmark():void 0,r,mp(t)),ap.empty,a,n.time,null==o?e.prevComposition:o)}}(n,r,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r="historyUndo"==n?wp:"historyRedo"==n?kp:null;return!!r&&(t.preventDefault(),r(e.state,e.dispatch))}}}})}function bp(e,t){return(n,r)=>{let o=gp.getState(n);if(!o||0==(e?o.undone:o.done).eventCount)return!1;if(r){let i=function(e,t,n){let r=mp(t),o=gp.get(t).spec.config,i=(n?e.undone:e.done).popEvent(t,r);if(!i)return null;let s=i.selection.resolve(i.transform.doc),a=(n?e.done:e.undone).addTransform(i.transform,t.selection.getBookmark(),o,r),l=new cp(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(s).setMeta(gp,{redo:n,historyState:l})}(o,n,e);i&&r(t?i.scrollIntoView():i)}return!0}}const wp=bp(!1,!0),kp=bp(!0,!0);bp(!1,!1),bp(!0,!1);const xp=Hu.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>wp(e,t),redo:()=>({state:e,dispatch:t})=>kp(e,t)}),addProseMirrorPlugins(){return[vp(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Mp=Md.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:e}){return["hr",Iu(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e,state:t})=>{const{$to:n}=t.selection,r=e();return 0===n.parentOffset?r.insertContentAt(Math.max(n.pos-2,0),{type:this.name}):r.insertContent({type:this.name}),r.command((({tr:e,dispatch:t})=>{var n;if(t){const{$to:t}=e.selection,r=t.end();if(t.nodeAfter)t.nodeAfter.isTextblock?e.setSelection(eo.create(e.doc,t.pos+1)):t.nodeAfter.isBlock?e.setSelection(no.create(e.doc,t.pos)):e.setSelection(eo.create(e.doc,t.pos));else{const o=null===(n=t.parent.type.contentMatch.defaultType)||void 0===n?void 0:n.create();o&&(e.insert(r,o),e.setSelection(eo.create(e.doc,r+1)))}e.scrollIntoView()}return!0})).run()}}},addInputRules(){return[bd({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),Sp=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Cp=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Op=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Ap=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Tp=xd.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=italic"}],renderHTML({HTMLAttributes:e}){return["em",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[vd({find:Sp,type:this.type}),vd({find:Op,type:this.type})]},addPasteRules(){return[Sd({find:Cp,type:this.type}),Sd({find:Ap,type:this.type})]}}),_p=Md.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",Iu(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Np=Md.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",Iu(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),$p=xd.create({name:"textStyle",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"span",getAttrs:e=>!!e.hasAttribute("style")&&{}}],renderHTML({HTMLAttributes:e}){return["span",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=ld(e,this.type);return!!Object.entries(n).some((([,e])=>!!e))||t.unsetMark(this.name)}}}}),Ep=/^(\d+)\.\s$/,Dp=Md.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return 1===t?["ol",Iu(this.options.HTMLAttributes,n),0]:["ol",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Np.name,this.editor.getAttributes($p.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=kd({find:Ep,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=kd({find:Ep,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes($p.name)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[e]}}),Ip=Md.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Lp=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Pp=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,zp=xd.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}],renderHTML({HTMLAttributes:e}){return["s",Iu(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){const e={};return rd()?e["Mod-Shift-s"]=()=>this.editor.commands.toggleStrike():e["Ctrl-Shift-s"]=()=>this.editor.commands.toggleStrike(),e},addInputRules(){return[vd({find:Lp,type:this.type})]},addPasteRules(){return[Sd({find:Pp,type:this.type})]}}),jp=Md.create({name:"text",group:"inline"}),Bp=Hu.create({name:"starterKit",addExtensions(){var e,t,n,r,o,i,s,a,l,c,u,d,p,h,f,m,g,y;const v=[];return!1!==this.options.blockquote&&v.push(Od.configure(null===(e=this.options)||void 0===e?void 0:e.blockquote)),!1!==this.options.bold&&v.push($d.configure(null===(t=this.options)||void 0===t?void 0:t.bold)),!1!==this.options.bulletList&&v.push(Ld.configure(null===(n=this.options)||void 0===n?void 0:n.bulletList)),!1!==this.options.code&&v.push(jd.configure(null===(r=this.options)||void 0===r?void 0:r.code)),!1!==this.options.codeBlock&&v.push(Rd.configure(null===(o=this.options)||void 0===o?void 0:o.codeBlock)),!1!==this.options.document&&v.push(Hd.configure(null===(i=this.options)||void 0===i?void 0:i.document)),!1!==this.options.dropcursor&&v.push(Wd.configure(null===(s=this.options)||void 0===s?void 0:s.dropcursor)),!1!==this.options.gapcursor&&v.push(Qd.configure(null===(a=this.options)||void 0===a?void 0:a.gapcursor)),!1!==this.options.hardBreak&&v.push(ep.configure(null===(l=this.options)||void 0===l?void 0:l.hardBreak)),!1!==this.options.heading&&v.push(tp.configure(null===(c=this.options)||void 0===c?void 0:c.heading)),!1!==this.options.history&&v.push(xp.configure(null===(u=this.options)||void 0===u?void 0:u.history)),!1!==this.options.horizontalRule&&v.push(Mp.configure(null===(d=this.options)||void 0===d?void 0:d.horizontalRule)),!1!==this.options.italic&&v.push(Tp.configure(null===(p=this.options)||void 0===p?void 0:p.italic)),!1!==this.options.listItem&&v.push(_p.configure(null===(h=this.options)||void 0===h?void 0:h.listItem)),!1!==this.options.orderedList&&v.push(Dp.configure(null===(f=this.options)||void 0===f?void 0:f.orderedList)),!1!==this.options.paragraph&&v.push(Ip.configure(null===(m=this.options)||void 0===m?void 0:m.paragraph)),!1!==this.options.strike&&v.push(zp.configure(null===(g=this.options)||void 0===g?void 0:g.strike)),!1!==this.options.text&&v.push(jp.configure(null===(y=this.options)||void 0===y?void 0:y.text)),v}});Macro.add("passagePreviewerMacro",{skipArgs:!1,handler:function(){var e="This is a test for $player.name, they are a $player.gender.type $player.species and stand at ''$player.measurements.height cm!''<br/><br/>You could also [[\"link back to home\"|home]] on the fly, try it out!",t=new Tu({extensions:[Bp],content:e});t.on("update",(function(){$("#preview").empty(),$("#preview").wiki(t.getText())})),$("<div/>").wiki("Twine Preview").appendTo(this.output),$('<div id="preview"/>').wiki(e).appendTo(this.output),$("<br/>").appendTo(this.output),$("<div/>").wiki("Twine Editor").appendTo(this.output),$("<div/>").addClass("twine-editor").append(t.options.element).appendTo(this.output)}});o(805);function Vp(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Rp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rp(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function Rp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Hp(){var e,t=[],n=Vp(E);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push("".concat(r.subjective," / ").concat(r.objective," / ").concat(r.possessive," / ").concat(r.reflexive))}}catch(e){n.e(e)}finally{n.f()}return t}function Fp(e){var t=0;return Hp().forEach((function(n,r){e===n&&(t=r)})),t}function qp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jp(e,t){var n;return t.forEach((function(t,r){Object.keys(t)[0]===e&&(n=r)})),n}function Kp(e){var t=p[e.id],n=t.name,r=t.desc,o=$("<div/>").addClass("portlet").addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").attr("value",e.id).data(e),i=$("<div/>").addClass("portlet-header").text(n);return i.addClass("ui-widget-header ui-corner-all"),o.append(i),o.append($("<div/>").addClass("portlet-content").wiki(r.baseDesc)),o.append($("<div/>").addClass("portlet-body-header").wiki("''Crit:'' ".concat(r.critDesc))),o.append($("<div/>").addClass("portlet-body-header").wiki("''Stat Mod:''")),o.append($("<div/>").addClass("portlet-body-content").wiki(Up(r.statMods))),o.append($("<div/>").addClass("portlet-body-header").wiki("''Reqs:''")),o.append($("<div/>").addClass("portlet-body-content").wiki(Up(r.reqs))),o}function Up(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return W().each(e,(function(e){t+="- ".concat(W().values(e)[0],"<br/>")})),t}function Gp(e,t){return $("<div/>").addClass("portlet-row").attr("id",e).sortable({connectWith:".portlet-row",handle:".portlet-header",tolerance:"pointer",forcePlaceholderSize:!0,cursor:"grabbing",update:function(e,t){if("equipped"===this.id){var n=[];$(this).find("> .portlet").each((function(){var e=$(this).data(),t=e.id,r=e.cooldown,o=e.currCooldown;n.push({id:t,cooldown:r,currCooldown:o})})),variables().player.attacks=n,$("#outOf").text("".concat(variables().player.attacks.length,"/3"))}},receive:function(e,n){$(this).children().length>t&&$(n.sender).sortable("cancel")}})}function Yp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xp(e){Engine.isRendering()?setTimeout(Xp,50,e):e()}function Qp(e,t,n){var r=$('<select name="'.concat(t,'"/>'));return _.each(e,(function(e,t){r.append($("<option/>").attr("value",t).prop("selected",t===n).wiki(e))})),r}Macro.add("genCharMacro",{skipArgs:!1,handler:function(){var e=$("#test"),t=qp(this.args,5),n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],a=variables().player,l=r.indexOf(r),c=_.findIndex(x,{name:n}),u=Jp(s,M),d=(Fp(o),Jp(i,N));variables().enemy=ue(me(a),l,c,u,d),e.empty(),e.append($("<span/>").wiki("!!?eName<br/>")),e.append($("<span/>").wiki("!!!Gender<br/>")),e.append($("<span/>").wiki("Penis: ?EPenis<br/>")),e.append($("<span/>").wiki("Balls: ?EBalls<br/>")),e.append($("<span/>").wiki("Breast: ?eBreast<br/>")),e.append($("<span/>").wiki("Vagina: ".concat(variables().enemy.gender.vagina,"<br/>"))),e.append($("<span/>").wiki("!!!Stats<br/>")),e.append($("<span/>").wiki("Health: ".concat(variables().enemy.stats.hlth,"<br/>"))),e.append($("<span/>").wiki("Strength: ".concat(variables().enemy.stats.strg,"<br/>"))),e.append($("<span/>").wiki("Consititution: ".concat(variables().enemy.stats.con,"<br/>"))),e.append($("<span/>").wiki("Dexterity: ".concat(variables().enemy.stats.dex,"<br/>"))),e.append($("<span/>").wiki("!!!Measurements<br/>")),e.append($("<span/>").wiki("Height: ?eHeight<br/>")),e.append($("<span/>").wiki("Weight: ?eWeight<br/>")),e.append($("<span/>").wiki("Body Fat: ".concat(variables().enemy.measurements.bodyFat,"<br/><br/>"))),e.append($("<span/>").wiki("!!!EXP<br/>")),e.append($("<span/>").wiki("Size: ".concat(variables().enemy.exp.size,"<br/>"))),e.append($("<span/>").wiki("<<enemyDescriptionMacro>>"))}}),function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(r)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,r=e.ui.mouse.prototype,o=r._mouseInit,i=r._mouseDestroy;r._touchStart=function(e){!n&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,this._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},r._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},r._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},r._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),o.call(t)},r._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),i.call(t)}}}(jQuery),Macro.add("movesetMacro",{skipArgs:!1,handler:function(){var e=variables().player,t=$("<div/>"),n=Gp("equipped",3);W().each(e.attacks,(function(e){n.append(Kp(e))}));var r=Gp("available",30);W().each(W().filter(e.learnedAttacks,(function(t){var n=t.id;return 0===W().filter(e.attacks,{id:n}).length})),(function(e){r.append(Kp(e))})),t.append($("<span/>").text("Equipped Attacks").addClass("moveset-equipped-count").tooltip({track:!0,hide:{duration:500}}).attr("title","Drag attacks to either equip or unquip them. Equipped attacks will appear in order from left to right.")).append($("<span/>").text("".concat(e.attacks.length,"/3")).attr("id","outOf").addClass("moveset-equipped-count")).append(n).append($("<br>")).append($("<span/>").text("Available Attacks").addClass("moveset-available")).append(r).appendTo(this.output)}}),Macro.add("playerFluffMacro",{skipArgs:!1,handler:function(){var e=variables().player;(0,F.logger)({player:e});var t,n=$("<span/>"),r=$("<span/>"),o=$("<span/>"),i=$("<span/>"),s=$("<span/>"),a=Z(e).muscleGut,l=Object.values(X(e.measurements.bodyFat))[0].showAbs;r.wiki("Your ?pSize ?pHeight frame is supporting ?pMuscleSingular ?pMuscle amount of muscles and ?pFatSingular ?pFat amount of body fat. With your muscles and fat, your total weight comes out to ?pWeight.").append("<br><br>"),o.wiki("Your chest sports ".concat((t=e,t.gender.breasts?"?pBreast cup breasts and ":""),"?pMusclePecs pectoral muscles. Looking at your arms, ?pMuscleArms. With your ?pMuscle amount of muscles, your arms ?pMuscleArmsSecond. Looking down at your stomach ").concat(function(e,t){return!e&&t?"you see a ?pFat muscle gut":"?pFatStomach"+(e?" ?pMuscleAbs":"")}(l,a),".")).append("<br><br>"),i.wiki("Your eyes and paws work their way down to explore below your waist. ".concat(function(e){var t=e.gender,n=t.penis,r=t.balls,o=t.vagina;n&&(n="You take your ?pPenis sized member in your paw. ");r&&(r="Slowly moving your paws down to your ?pBalls sized orbs you roll them around and emit a small purr of approval. ",n&&(r="Underneath your ?pPenis member you roll your ?pBalls sized testicles in your paws. "));o&&(o="You find a pert vagina. Taking your fingers you spread your wet lips and slip one in. A moan escapes your muzzle and you snap back to reality as you pull your paw away.",n&&(o="Lifting up your ?pPenis sized member you find a pert vagina. "),r&&(o="Lifting up your ?pBalls sized orbs you find a pert vagina. "));return"".concat(n||"").concat(r||"").concat(o||"")}(e))).append("<br><br>"),s.wiki("All around you are a ?pSize looking ?pSpecies."),n.append(r).append(o).append(i).append(s).appendTo(this.output)}}),Macro.add("restMacro",{skipArgs:!1,handler:function(){var e,t,n,r,o,i=variables().player;Ke(7),n=(e=i).capacity,r=e.exp,o=e.measurements,W().each(ie(n),(function(e){W().each(n[e],(function(e){t||(t=e.capacityAmount),e.capacityAmount-=t,W().each(e.exp,(function(e,t){e&&(r[t]+=e)}))})),se(o,n),W().remove(n[e],(function(e){return e.capacityAmount<=0}))})),variables().restText=ye(i),ve(i),Je(),""===variables().restText&&(variables().restText="You feel rested and rejuvenated!<br/>")}}),Macro.add("AttributeControls",{skipArgs:!1,handler:function(){var e=Yp(this.args,1)[0],t=variables().player,n=t.stats[e],r=$("<div/>").attr("id",e).data(e,n).append(t.stats[e]),o=$("<div/>").addClass("attribute-controls"),i=$("<button/>").append($("<i/>").addClass("fa fa-minus")).click((function(){c(!0)})),s=$("<button/>").append($("<i/>").addClass("fa fa-plus")).click((function(){c(!1)})),a=function(e,t,n){var r=$('<select name="'.concat(t,'"/>'));return W().each(e,(function(e,t){r.append($("<option/>").attr("value",t).prop("selected",t===n).wiki(e))})),r}({1:1,2:2,5:5,10:10},"".concat(e,"Select"));o.append(i).append(a).append(s);var l=$("<button/>").prop("disabled",!0).wiki("Reset").click((function(){var r=t.stats[e]-n;n=t.stats[e],d(r),a.find('option[value="1"]').prop("selected",!0),u()}));function c(e){var t=W().toInteger(a.find(":selected").text());e&&(t=-t),n+=t,d(t),u()}function u(){var o=W().toInteger(a.find(":selected").text());r.empty(),n!==t.stats[e]?(l.prop("disabled",!1),r.wiki("".concat(t.stats[e],' <i class="fa fa-arrow-right"/> ').concat(n))):(l.prop("disabled",!0),r.append(t.stats[e])),i.prop("disabled",!1),n-o<1&&i.prop("disabled",!0)}function d(t){r.data(e,n).trigger({type:"changeStat",stat:e,change:t})}$(this.output).append(r).append(o).append(l)}}),Macro.add("AttributeBuy",{skipArgs:!1,handler:function(){var e=0,t=[{stat:"strg",change:0},{stat:"con",change:0},{stat:"dex",change:0}],n=temporary().cost,r=variables().player,o=r.credits,i=r.stats,s=$("<div/>").text("Awaiting Changes"),a=$("<button/>").wiki("Waiting...").prop("disabled",!0).click((function(){W().each(t,(function(e){var t=e.stat,n=e.change;i[t]+=n})),variables().player.credits-=l(),Engine.show()}));function l(){return e*n}$(this.output).append(s).append(a),Xp((function(){$("body").on("changeStat",(function(n){var r=n.stat,i=n.change;e+=i;var c=W().find(t,{stat:r});W().set(c,"change",c.change+=i),a.prop("disabled",o<l()||0===l()),W().some(t,(function(e){return 0!==e.change}))?(e>0&&s.text("Cost: ".concat(l())),0===e&&s.text("No Charge"),e<0&&s.text("Rebate: ".concat(-l())),l()<=o?(a.text("Accept Changes"),a.prop("disabled",!1)):a.text("Not Enough Credits")):(s.text("Awaiting Changes"),a.text("Waiting..."))}))}))}}),Macro.add("GenWingMacro",{skipArgs:!1,handler:function(){var e=variables().player,t=$("<div/>"),n=$('<select name="species"/>');_.each(D,(function(t){n.append($("<option/>").attr("value",t).prop("selected",e.species===t).wiki(t))})),t.append($('<label for="species"/>').wiki("Species: ")),t.append(n);var r=$("<div/>").addClass("genital-container");r.append($("<h3/>").wiki("Gentials"));var o=$("<div/>").appendTo(r);o.append($("<span/>").wiki('Penis: ?PPenis <i class="fa fa-arrow-right"/> ?PPenis'));var i=$("<div/>").appendTo(o);i.append($("<button/>").append($("<i/>").addClass("fa fa-minus"))),i.append(Qp({1:1,10:10},"penisValue")),i.append($("<button/>").append($("<i/>").addClass("fa fa-plus")));var s=$("<div/>").appendTo(r);s.append($("<span/>").wiki('Testicals: PBalls <i class="fa fa-arrow-right"/> 100'));var a=$("<div/>").appendTo(s);a.append($("<button/>").append($("<i/>").addClass("fa fa-minus"))),a.append(Qp({1:1,10:10},"testiValue")),a.append($("<button/>").append($("<i/>").addClass("fa fa-plus")));var l=$("<div/>").appendTo(r);l.append($("<span/>").wiki("Vagina: "));var c=Qp({false:"Removed",true:"Equipped"},"vaginaValue","".concat(e.gender.vagina));l.append(c);var u=$("<div/>").append($("<button/>").wiki("Change").prop("disabled",e.credits<0).click((function(){var t=n.find(":selected").text();e.species=t,Engine.show()})));$(this.output).append(t).append(u)}});o(954);function eh(e){Engine.isRendering()?setTimeout(eh,50,e):e()}function th(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return nh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rh(e){Engine.isRendering()?setTimeout(rh,50,e):e()}function oh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ih(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ih(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ih(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Macro.add("TransferenceBuy",{skipArgs:!1,handler:function(){var e=variables().player,t=temporary(),n=t.skillPoints,r=t.credits,o=$("<div/>").addClass("trans-exchange-side");o.append($("<span/>").wiki("Skill Points"));var i=$("<span/>").text(n).appendTo(o),s=$("<div/>").addClass("trans-exchange-side");s.append($("<span/>").wiki("Credits"));var a=$("<span/>").text(r).appendTo(s),l=$("<button/>").append($("<i/>").addClass("fa fa-exchange")).click((function(){e.skillPoints+=n,e.credits+=r,Engine.show()}));function c(){l.prop("disabled",!1),0===n&&l.prop("disabled",!0)}$(this.output).append(o).append(l).append(s),eh((function(){$("body").on("UpdateCounters",(function(){var e;e=temporary(),n=e.skillPoints,r=e.credits,i.text(n),a.text(r),c(),$("body").trigger("UpdateChange")}))})),c()}}),Macro.add("TransferenceControls",{skipArgs:!1,handler:function(){var e=th(this.args,2),t=e[0],n=e[1],r=variables().player,o=temporary()[t],i=temporary()[n],s=$("<button/>").addClass("full-width").append($("<i/>").addClass("fa fa-plus")).click((function(){c(!1)})),a=$("<button/>").addClass("full-width").append($("<i/>").addClass("fa fa-minus")).click((function(){c(!0)})),l=function(e,t,n){var r=$('<select name="'.concat(t,'"/>'));return _.each(e,(function(e,t){r.append($("<option/>").attr("value",t).prop("selected",t===n).wiki(e))})),r}({1:1,10:10,50:50,100:100,1e3:1e3},"".concat(t,"Select"),"1").addClass("full-width");function c(e){var r=d()*(e?-1:1);o+=r,i-=r,temporary()[t]=o,temporary()[n]=i,u(),$("body").trigger("UpdateCounters")}function u(){s.prop("disabled",!0),a.prop("disabled",!0);var e=d();-r[t]<=o-e&&a.prop("disabled",!1),-r[n]<=i-e&&s.prop("disabled",!1)}function d(){return _.toInteger(l.find(":selected").text())}l.change((function(){u(),(0,F.logger)($(".trans").data("counters"))})),$(this.output).append(s).append(l).append(a),rh((function(){$("body").on("UpdateChange",(function(){o=temporary()[t],i=temporary()[n],u()}))})),u()}}),Macro.add("capacityBarMacro",{skipArgs:!1,handler:function(){var e=this.args[0],t=this.args[1],n=Math.clamp(Math.floor(oe(e,t)/e.capacity["".concat(t,"Max")]*100),0,100),r=$("<div/>").addClass("statusBar");n>100&&r.tooltip({track:!0,hide:{delay:100}}).attr("title","Over capacity, get home and rest asap!");var o=$("<div/>").addClass("".concat(n<100?"currentNotVisCapBar":"currentVisCapBar warningFlash")).css("width","".concat(n,"%")),i=$("<div/>").addClass("currentStatusText").text("".concat(function(e,t){return oe(e,t)>=e.capacity["".concat(t,"Max")]?"Visible":"Not Visible"}(e,t)));r.attr("id","macro-".concat(this.name)).append(o).append(i).appendTo(this.output)}}),Macro.add("iconMacro",{skipArgs:!1,handler:function(){var e,t=oh(this.args,2),n=t[0],r='<svg class="'+t[1]+'" xmlns="http://www.w3.org/2000/svg" ';switch(n){case"help":e=$(r+'viewBox="0 0 24 24"><title>help</title><path d="M10,19H13V22H10V19M12,2C17.35,2.22 19.68,7.62 16.5,11.67C15.67,12.67 14.33,13.33 13.67,14.17C13,15 13,16 13,17H10C10,15.33 10,13.92 10.67,12.92C11.33,11.92 12.67,11.33 13.5,10.67C15.92,8.43 15.32,5.26 12,5A3,3 0 0,0 9,8H6A6,6 0 0,1 12,2Z" /></svg>');break;case"list":e=$(r+'viewBox="0 0 24 24"><title>list-box</title><path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M7 7H9V9H7V7M7 11H9V13H7V11M7 15H9V17H7V15M17 17H11V15H17V17M17 13H11V11H17V13M17 9H11V7H17V9Z" /></svg>');break;case"braces":e=$(r+'viewBox="0 0 24 24"><title>code-braces</title><path d="M8,3A2,2 0 0,0 6,5V9A2,2 0 0,1 4,11H3V13H4A2,2 0 0,1 6,15V19A2,2 0 0,0 8,21H10V19H8V14A2,2 0 0,0 6,12A2,2 0 0,0 8,10V5H10V3M16,3A2,2 0 0,1 18,5V9A2,2 0 0,0 20,11H21V13H20A2,2 0 0,0 18,15V19A2,2 0 0,1 16,21H14V19H16V14A2,2 0 0,1 18,12A2,2 0 0,1 16,10V5H14V3H16Z" /></svg>');break;case"cog":e=$(r+'viewBox="0 0 24 24"><title>cog</title><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" /></svg>');break;case"chest":e=$(r+'viewBox="0 0 24 24"><title>treasure-chest</title><path d="M5,4H19A3,3 0 0,1 22,7V11H15V10H9V11H2V7A3,3 0 0,1 5,4M11,11H13V13H11V11M2,12H9V13L11,15H13L15,13V12H22V20H2V12Z" /></svg>');break;case"person":e=$(r+'viewBox="0 0 24 24"><title>account</title><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg>');break;case"wall":e=$(r+'viewBox="0 0 24 24"><title>wall</title><path d="M3,16H12V21H3V16M2,10H8V15H2V10M9,10H15V15H9V10M16,10H22V15H16V10M13,16H21V21H13V16M3,4H11V9H3V4M12,4H21V9H12V4Z" /></svg>');break;case"running person":e=$(r+'viewBox="0 0 24 24"><title>run-fast</title><path d="M16.5,5.5A2,2 0 0,0 18.5,3.5A2,2 0 0,0 16.5,1.5A2,2 0 0,0 14.5,3.5A2,2 0 0,0 16.5,5.5M12.9,19.4L13.9,15L16,17V23H18V15.5L15.9,13.5L16.5,10.5C17.89,12.09 19.89,13 22,13V11C20.24,11.03 18.6,10.11 17.7,8.6L16.7,7C16.34,6.4 15.7,6 15,6C14.7,6 14.5,6.1 14.2,6.1L9,8.3V13H11V9.6L12.8,8.9L11.2,17L6.3,16L5.9,18L12.9,19.4M4,9A1,1 0 0,1 3,8A1,1 0 0,1 4,7H7V9H4M5,5A1,1 0 0,1 4,4A1,1 0 0,1 5,3H10V5H5M3,13A1,1 0 0,1 2,12A1,1 0 0,1 3,11H7V13H3Z" /></svg>');break;case"dumbbell":e=$(r+'viewBox="0 0 24 24"><title>dumbbell</title><path d="M20.57,14.86L22,13.43L20.57,12L17,15.57L8.43,7L12,3.43L10.57,2L9.14,3.43L7.71,2L5.57,4.14L4.14,2.71L2.71,4.14L4.14,5.57L2,7.71L3.43,9.14L2,10.57L3.43,12L7,8.43L15.57,17L12,20.57L13.43,22L14.86,20.57L16.29,22L18.43,19.86L19.86,21.29L21.29,19.86L19.86,18.43L22,16.29L20.57,14.86Z" /></svg>');break;case"heart":e=$(r+'viewBox="0 0 24 24"><title>heart</title><path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z" /></svg>');break;case"study hat":e=$(r+'viewBox="0 0 24 24"><title>school</title><path d="M12,3L1,9L12,15L21,10.09V17H23V9M5,13.18V17.18L12,21L19,17.18V13.18L12,17L5,13.18Z" /></svg>');break;case"credits":e=$(r+'viewBox="0 0 24 24"><title>circle-multiple</title><path d="M15 4A8 8 0 1 1 7 12A8 8 0 0 1 15 4M3 12A6 6 0 0 0 7 17.65V19.74A8 8 0 0 1 7 4.26V6.35A6 6 0 0 0 3 12Z" /></svg>');break;case"map marker":e=$(r+'viewBox="0 0 24 24"><title>map-marker</title><path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" /></svg>');break;case"mirror":e=$(r+'viewBox="0 0 24 24"><title>mirror-variant</title><path d="M8.29 10.28L11.53 7.03L12.59 8.09L9.35 11.34L8.29 10.28M8.7 14.61L14.36 8.95L15.42 10L9.76 15.67L8.7 14.61M14.17 3L18 6.83V17.17L14.17 21H9.83L6 17.17V6.83L9.83 3H14.17M15 1H9L4 6V18L9 23H15L20 18V6L15 1Z" /></svg>');break;case"sword":e=$(r+'viewBox="0 0 24 24"><title>sword</title><path d="M6.92,5H5L14,14L15,13.06M19.96,19.12L19.12,19.96C18.73,20.35 18.1,20.35 17.71,19.96L14.59,16.84L11.91,19.5L10.5,18.09L11.92,16.67L3,7.75V3H7.75L16.67,11.92L18.09,10.5L19.5,11.91L16.83,14.58L19.95,17.7C20.35,18.1 20.35,18.73 19.96,19.12Z" /></svg>');break;case"bed":e=$(r+'viewBox="0 0 24 24"><title>bed</title><path d="M19,7H11V14H3V5H1V20H3V17H21V20H23V11A4,4 0 0,0 19,7M7,13A3,3 0 0,0 10,10A3,3 0 0,0 7,7A3,3 0 0,0 4,10A3,3 0 0,0 7,13Z" /></svg>');break;case"metro":e=$(r+'viewBox="0 0 24 24"><title>subway</title><path d="M8.5,15A1,1 0 0,1 9.5,16A1,1 0 0,1 8.5,17A1,1 0 0,1 7.5,16A1,1 0 0,1 8.5,15M7,9H17V14H7V9M15.5,15A1,1 0 0,1 16.5,16A1,1 0 0,1 15.5,17A1,1 0 0,1 14.5,16A1,1 0 0,1 15.5,15M18,15.88V9C18,6.38 15.32,6 12,6C9,6 6,6.37 6,9V15.88A2.62,2.62 0 0,0 8.62,18.5L7.5,19.62V20H9.17L10.67,18.5H13.5L15,20H16.5V19.62L15.37,18.5C16.82,18.5 18,17.33 18,15.88M17.8,2.8C20.47,3.84 22,6.05 22,8.86V22H2V8.86C2,6.05 3.53,3.84 6.2,2.8C8,2.09 10.14,2 12,2C13.86,2 16,2.09 17.8,2.8Z" /></svg>');break;case"village":e=$(r+'viewBox="0 0 24 24"><title>home-group</title><path d="M17,16H15V22H12V17H8V22H5V16H3L10,10L17,16M6,2L10,6H9V9H7V6H5V9H3V6H2L6,2M18,3L23,8H22V12H19V9H17V12H15.34L14,10.87V8H13L18,3Z" /></svg>');break;case"city":e=$(r+'viewBox="0 0 24 24"><title>city-variant</title><path d="M19,9V7A2,2 0 0,0 17,5H16V2H14V5H13A2,2 0 0,0 11,7V9A2,2 0 0,0 9,11V12H5A2,2 0 0,0 3,14V22H6V20H8V22H12V20H14V22H16V20H18V22H21V11A2,2 0 0,0 19,9M8,18H6V16H8V18M14,18H12V16H14V18M14,14H12V12H14V14M13,9V7H17V9H13M18,18H16V16H18V18M18,14H16V12H18V14Z" /></svg>');break;case"hospital":e=$(r+'viewBox="0 0 24 24"><title> hospital-box-outline</title><path d="M18 14H14V18H10V14H6V10H10V6H14V10H18M20 2H4C2.9 2 2 2.9 2 4V20C2 21.1 2.9 22 4 22H20C21.1 22 22 21.1 22 20V4C22 2.9 21.1 2 20 2M20 20H4V4H20V20Z" /></svg>');break;case"home":e=$(r+'viewBox="0 0 24 24"><title>home-variant</title><path d="M12,3L20,9V21H15V14H9V21H4V9L12,3Z" /></svg> ');break;case"fight":e=$(r+'viewBox="0 0 24 24"><title>sword-cross</title><path d="M6.2,2.44L18.1,14.34L20.22,12.22L21.63,13.63L19.16,16.1L22.34,19.28C22.73,19.67 22.73,20.3 22.34,20.69L21.63,21.4C21.24,21.79 20.61,21.79 20.22,21.4L17,18.23L14.56,20.7L13.15,19.29L15.27,17.17L3.37,5.27V2.44H6.2M15.89,10L20.63,5.26V2.44H17.8L13.06,7.18L15.89,10M10.94,15L8.11,12.13L5.9,14.34L3.78,12.22L2.37,13.63L4.84,16.1L1.66,19.29C1.27,19.68 1.27,20.31 1.66,20.7L2.37,21.41C2.76,21.8 3.39,21.8 3.78,21.41L7,18.23L9.44,20.7L10.85,19.29L8.73,17.17L10.94,15Z" /></svg>');break;case"store":e=$(r+'viewBox="0 0 24 24"><title>cart</title><path d="M17,18C15.89,18 15,18.89 15,20A2,2 0 0,0 17,22A2,2 0 0,0 19,20C19,18.89 18.1,18 17,18M1,2V4H3L6.6,11.59L5.24,14.04C5.09,14.32 5,14.65 5,15A2,2 0 0,0 7,17H19V15H7.42A0.25,0.25 0 0,1 7.17,14.75C7.17,14.7 7.18,14.66 7.2,14.63L8.1,13H15.55C16.3,13 16.96,12.58 17.3,11.97L20.88,5.5C20.95,5.34 21,5.17 21,5A1,1 0 0,0 20,4H5.21L4.27,2M7,18C5.89,18 5,18.89 5,20A2,2 0 0,0 7,22A2,2 0 0,0 9,20C9,18.89 8.1,18 7,18Z" /></svg>');break;case"back":e=$(r+'viewBox="0 0 24 24"><title>keyboard-backspace</title><path d="M21,11H6.83L10.41,7.41L9,6L3,12L9,18L10.41,16.58L6.83,13H21V11Z" /></svg>');break;case"plus minus":e=$(r+'viewBox="0 0 24 24"><title>plus-minus-variant</title><path d="M3 7H6V4H8V7H11V9H8V12H6V9H3V7M13 15H21V17H13V15M16.04 3H18.35L7.96 21H5.65L16.04 3Z" /></svg>');break;case"dna":e=$(r+'viewBox="0 0 24 24"><title>dna</title><path d="M4,2H6V4C6,5.44 6.68,6.61 7.88,7.78C8.74,8.61 9.89,9.41 11.09,10.2L9.26,11.39C8.27,10.72 7.31,10 6.5,9.21C5.07,7.82 4,6.1 4,4V2M18,2H20V4C20,6.1 18.93,7.82 17.5,9.21C16.09,10.59 14.29,11.73 12.54,12.84C10.79,13.96 9.09,15.05 7.88,16.22C6.68,17.39 6,18.56 6,20V22H4V20C4,17.9 5.07,16.18 6.5,14.79C7.91,13.41 9.71,12.27 11.46,11.16C13.21,10.04 14.91,8.95 16.12,7.78C17.32,6.61 18,5.44 18,4V2M14.74,12.61C15.73,13.28 16.69,14 17.5,14.79C18.93,16.18 20,17.9 20,20V22H18V20C18,18.56 17.32,17.39 16.12,16.22C15.26,15.39 14.11,14.59 12.91,13.8L14.74,12.61M7,3H17V4L16.94,4.5H7.06L7,4V3M7.68,6H16.32C16.08,6.34 15.8,6.69 15.42,7.06L14.91,7.5H9.07L8.58,7.06C8.2,6.69 7.92,6.34 7.68,6M9.09,16.5H14.93L15.42,16.94C15.8,17.31 16.08,17.66 16.32,18H7.68C7.92,17.66 8.2,17.31 8.58,16.94L9.09,16.5M7.06,19.5H16.94L17,20V21H7V20L7.06,19.5Z" /></svg>');break;case"exponent":e=$(r+'viewBox="0 0 24 24"><title>exponent-box</title><path d="M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3H5M13.76,6H15.39L16.5,8.6L17.59,6H19.24C19.24,6 17.5,10.57 16.46,12.32C16.08,12.89 15.35,13.27 14.5,13.25V11.75C14.96,11.76 15.25,11.5 15.5,11.13C15.61,11 15.68,10.8 15.74,10.64L13.76,6M6.41,9.59L9.21,12.38L12,9.59L13.41,11L10.62,13.79L13.41,16.59L12,18L9.21,15.21L6.41,18L5,16.59L7.79,13.79L5,11L6.41,9.59Z" /></svg>');break;case"transfer":e=$(r+'viewBox="0 0 24 24"><title>transfer</title><path d="M8 4A2 2 0 0 0 6 6V10H8V6H16V9H13.5L17 12.5L20.5 9H18V6A2 2 0 0 0 16 4H8M3 12V14H11V12H3M3 15V17H11V15H3M13 15V17H21V15H13M3 18V20H11V18H3M13 18V20H21V18H13Z" /></svg>');break;case"lift":e=$(r+'viewBox="0 0 24 24"><title>format-paragraph-spacing</title><path d="M3 17H21V19H3V17M3 2H21V4H3V2M3 20H21V22H3V20M13 8H15L12 5L9 8H11V13H9L12 16L15 13H13V8Z" /></svg>');break;case"shoe":e=$(r+'viewBox="0 0 24 24"><title>shoe-sneaker</title><path d="M2 15C2 15 2 12 4 12C4.68 12 5.46 11.95 6.28 11.82C7.2 12.54 8.5 13 10 13H10.25L8.56 11.29C8.91 11.18 9.25 11.05 9.59 10.91L11.5 12.82C11.89 12.74 12.25 12.63 12.58 12.5L10.55 10.45C10.85 10.28 11.14 10.11 11.43 9.91L13.5 12C13.8 11.79 14.04 11.56 14.25 11.32L12.22 9.29C12.46 9.07 12.7 8.83 12.92 8.58L14.79 10.45C14.91 10.14 15 9.83 15 9.5C15 8.65 14.55 7.89 13.84 7.28C13.89 7.19 13.95 7.1 14 7L15.53 6.23C16.38 7.17 18.14 7.84 20.25 7.97L20.3 8H21C21 8 22 9 22 12.5C22 13.07 22 13.57 21.96 14H19C17.9 14 16.58 14.26 15.3 14.5C14.12 14.76 12.9 15 12 15H2M21 17C21 17 21.58 17 21.86 15H19C17 15 14 16 12 16H2.28C2.62 16.6 3.26 17 4 17H21Z" /></svg>');break;case"bug":e=$(r+'viewBox="0 0 24 24"><title>bug</title><path d="M14,12H10V10H14M14,16H10V14H14M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.5,5 12,5C11.5,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z" /></svg>');break;default:e=$("<span style='color:red;'>ICON NAME NOT FOUND!<span>")}e.appendTo(this.output)}}),Macro.add("clockMacro",{skipArgs:!1,handler:function(){$("<span/>").text(We(variables().settings.units.twelveHour)).attr("id","macro-".concat(this.name)).appendTo(this.output)}}),Macro.add("creditMacro",{skipArgs:!1,handler:function(){e=$("<img/>").addClass("creditImg").attr("src","assets/credits/gunpoint.gif"),t=$("<div/>").addClass("creditOverlay").wiki("Articus/Gunpoint<br />Initial programmer"),(n=$("<div/>").addClass("creditWrapper").click((function(){window.location="https://www.furaffinity.net/user/gunpoint/"}))).append(t).append(e),n.appendTo(this.output),e=$("<img/>").addClass("creditImg").attr("src","assets/credits/ruweg.png"),t=$("<div/>").addClass("creditOverlay").wiki("Ruweg<br/>Programmer"),(n=$("<div/>").addClass("creditWrapper").click((function(){window.location="https://www.furaffinity.net/user/randomwolfguy/"}))).append(t).append(e),n.appendTo(this.output);var e=$("<img/>").addClass("creditImg").attr("src","assets/credits/raindrago.jpg"),t=$("<div/>").addClass("creditOverlay").wiki("Rain/Dragonien<br />Guest writer"),n=$("<div/>").addClass("creditWrapper").click((function(){window.location="https://www.furaffinity.net/user/dragonien/"}));n.append(t).append(e),n.appendTo(this.output)}});o(345),o(618),o(552);function sh(e,t){var n;return t.forEach((function(t,r){Object.keys(t)[0]===e&&(n=r)})),n}Macro.add("tempData",{skipArgs:!1,handler:function(){var e;temporary().species=D,temporary().playerSizes=re([2,3,4]),temporary().sizes=re(),temporary().bodyTypes=W().map(M,(function(e){return W().keys(e)[0]})),temporary().genders=(e=[],N.forEach((function(t){e.push(Object.keys(t)[0])})),e),temporary().pronouns=Hp()}}),Macro.add("startGameRoutine",{skipArgs:!0,handler:function(){var e=variables().player,t=D.indexOf(e.species),n=_.findIndex(x,{name:e.size}),r=sh("Normal",M),o=Fp(e.pronouns),i=sh(e.gender,N);variables().player=ue(15,t,n,r,i,e.name,o)}}),Macro.add("trainMacro",{skipArgs:!1,handler:function(){var e=this.args[0],t=this.args[1],n=this.args[2],r=this.args[3],o=variables().settings.tweak.hyperMode;if((0,F.logger)({hyperMode:o}),n<=variables().player.credits){var i=r*(o?4:1);variables().player.exp[e]+=i,variables().trainText="".concat(t," ").concat(i," ").concat(e,"!"),xe(n),Je(!0)}else variables().trainText="You don't have enough credits!",Je(!1)}}),Template.add("eName",(function(){return variables().enemy.name})),Template.add(["eSpecies","ESpecies"],(function(){return"eSpecies"===this.name?W().lowerFirst(variables().enemy.species):variables().enemy.species})),Template.add(["eGender","EGender"],(function(){return"eGender"===this.name?W().lowerFirst(variables().enemy.gender.type):variables().enemy.gender.type})),Template.add(["eSize","ESize"],(function(){var e=Y(variables().enemy.measurements.height);return"eSize"===this.name?W().lowerFirst(e):e})),Template.add("eHeight",(function(){return G(variables().enemy.measurements,variables().settings.units.imperial).heightText})),Template.add("eWeight",(function(){return G(variables().enemy.measurements,variables().settings.units.imperial).weightText})),Template.add(["ePenis","EPenis"],(function(){var e=ee(variables().enemy);return"ePenis"===this.name?W().lowerFirst(e):e})),Template.add(["eBalls","EBalls"],(function(){var e=te(variables().enemy);return"eBalls"===this.name?W().lowerFirst(e):e})),Template.add("eBreast",(function(){return Q(variables().enemy)})),Template.add(["eMuscleAbs","eMuscleArms","eMuscleArmsSecond","eMusclePecs","eMuscleSingular","eMuscle","EMuscle"],(function(){var e=Z(variables().enemy),t=e.abs,n=e.arms,r=e.armsSecond,o=e.name,i=e.pecs,s=e.singular;switch(this.name){case"eMuscleAbs":return t;case"eMuscleArms":return n;case"eMuscleArmsSecond":return r;case"eMusclePecs":return i;case"eMuscleSingular":return s;case"eMuscle":return W().lowerFirst(o)}})),Template.add(["eFatSingular","eFatStomach","eFat","EFat"],(function(){var e=X(variables().enemy.measurements.bodyFat),t=Object.values(e)[0],n=t.singular,r=t.stomach,o=Object.keys(e)[0];switch(this.name){case"eFatSingular":return n;case"eFatStomach":return r;case"eFat":return W().lowerFirst(o)}})),Template.add(["pSpecies","PSpecies"],(function(){return"pSpecies"===this.name?W().lowerFirst(variables().player.species):variables().player.species})),Template.add(["pGender","PGender"],(function(){return"pGender"===this.name?W().lowerFirst(variables().player.gender.type):variables().player.gender.type})),Template.add(["pSize","PSize"],(function(){var e=Y(variables().player.measurements.height);return"pSize"===this.name?W().lowerFirst(e):e})),Template.add("pHeight",(function(){return G(variables().player.measurements,variables().settings.units.imperial).heightText})),Template.add("pWeight",(function(){return G(variables().player.measurements,variables().settings.units.imperial).weightText})),Template.add(["pPenis","PPenis"],(function(){var e=ee(variables().player);return"pPenis"===this.name?W().lowerFirst(e):e})),Template.add(["pBalls","PBalls"],(function(){var e=te(variables().player);return"pBalls"===this.name?W().lowerFirst(e):e})),Template.add("pBreast",(function(){return Q(variables().player)})),Template.add(["pMuscleAbs","pMuscleArms","pMuscleArmsSecond","pMusclePecs","pMuscleSingular","pMuscle","PMuscle"],(function(){var e=Z(variables().player),t=e.abs,n=e.arms,r=e.armsSecond,o=e.name,i=e.pecs,s=e.singular;switch(this.name){case"pMuscleAbs":return t;case"pMuscleArms":return n;case"pMuscleArmsSecond":return r;case"pMusclePecs":return i;case"pMuscleSingular":return s;case"pMuscle":return W().lowerFirst(o)}})),Template.add(["pFatSingular","pFatStomach","pFat","PFat"],(function(){var e=X(variables().player.measurements.bodyFat),t=Object.values(e)[0],n=t.singular,r=t.stomach,o=Object.keys(e)[0];switch(this.name){case"pFatSingular":return n;case"pFatStomach":return r;case"pFat":return W().lowerFirst(o)}}));var ah="v0.9.",lh=2;function ch(e){e.version=ah+lh}function uh(e,t){t!==lh?ch(e):hh(e)}var dh="v0.10.",ph=0;function hh(e){e.version=dh+ph}function fh(e,t){t!==ph&&hh(e)}function mh(e,t){var n;W().each(e.state.history,(function(e){var t=e.variables;!function(e){var t=W().join(W().dropRight(W().split(e.version,".")),""),n=W().parseInt(W().join(W().drop(W().split(e.version,"."),2),""));a[t].upgrade(e,n)}(t),n=t.version})),n!==t&&mh(e,t)}function gh(e){return gh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gh(e)}function yh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yh(Object(n),!0).forEach((function(t){bh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bh(e,t,n){return t=function(e){var t=function(e,t){if("object"!=gh(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=gh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==gh(t)?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Config=vh(vh({},Config),l),setup.ImagePath="assets/",function(e,t,n,r,o,i){$(document.head).append('<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">');var s="v0.10.0";variables().version=s,variables().stores=d,variables().time={day:1,hour:0,min:0},variables().debug=l.debug,variables().settings=j,Save.onLoad.add((function(e){(0,F.logger)("Loading..."),mh(e,s)})),i.on(":passagestart",(function(e){e.passage.tags.includes("noreturn")||(variables().return=e.passage.title)}))}(Config,State,Story,Engine,Dialog,$(document))})()})();